

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/tuzi.png">
  <link rel="icon" href="/img/tuzi.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Alexander Liu">
  <meta name="keywords" content="åˆ†å¸ƒå¼ç³»ç»Ÿ,åç«¯ç ”å‘,æ•°æ®ååŒ">
  
    <meta name="description" content="å¤ä¹   æ–‡ä»¶ç³»ç»Ÿå®ç°ï¼šbread&#x2F;bwrite ä¸Šçš„æ•°æ®ç»“æ„ balloc&#x2F;bfree æ–‡ä»¶ï¼šFAT (é“¾è¡¨)&#x2F;UNIX æ–‡ä»¶ç³»ç»Ÿ (ç´¢å¼•) ç›®å½•æ–‡ä»¶     æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜  æ•°æ®ç»“æ„çš„å¦ä¸€ä¸ªå‡è®¾ï¼šå†…å­˜å¯é ä¸”å¯ä»¥æ¥å—æ–­ç”µæ•°æ®ä¸¢å¤± Q: æŒä¹…æ•°æ®æ˜¯ä¸èƒ½æ¥å—ä¸¢å¤±çš„ï¼Œå¦‚ä½•ä¿è¯æŒä¹…æ•°æ®çš„å¯é æ€§ï¼Ÿ   æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹  RAID (Redundant Array of Inexpensive Disks">
<meta property="og:type" content="article">
<meta property="og:title" content="NJUOS-28-æŒä¹…æ•°æ®çš„å¯é æ€§">
<meta property="og:url" content="https://alexanderliu-creator.github.io/2023/09/28/njuos-28-chi-jiu-shu-ju-de-ke-kao-xing/index.html">
<meta property="og:site_name" content="å…”ã®åšå®¢">
<meta property="og:description" content="å¤ä¹   æ–‡ä»¶ç³»ç»Ÿå®ç°ï¼šbread&#x2F;bwrite ä¸Šçš„æ•°æ®ç»“æ„ balloc&#x2F;bfree æ–‡ä»¶ï¼šFAT (é“¾è¡¨)&#x2F;UNIX æ–‡ä»¶ç³»ç»Ÿ (ç´¢å¼•) ç›®å½•æ–‡ä»¶     æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜  æ•°æ®ç»“æ„çš„å¦ä¸€ä¸ªå‡è®¾ï¼šå†…å­˜å¯é ä¸”å¯ä»¥æ¥å—æ–­ç”µæ•°æ®ä¸¢å¤± Q: æŒä¹…æ•°æ®æ˜¯ä¸èƒ½æ¥å—ä¸¢å¤±çš„ï¼Œå¦‚ä½•ä¿è¯æŒä¹…æ•°æ®çš„å¯é æ€§ï¼Ÿ   æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹  RAID (Redundant Array of Inexpensive Disks">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309280941573.png">
<meta property="article:published_time" content="2023-09-28T01:39:38.000Z">
<meta property="article:modified_time" content="2023-09-28T07:17:50.899Z">
<meta property="article:author" content="Alexander Liu">
<meta property="article:tag" content="ç ”0è‡ªå­¦">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309280941573.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>NJUOS-28-æŒä¹…æ•°æ®çš„å¯é æ€§ - å…”ã®åšå®¢</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"alexanderliu-creator.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="å…”ã®åšå®¢" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>å…”çš„åšå®¢</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background_post.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NJUOS-28-æŒä¹…æ•°æ®çš„å¯é æ€§"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Alexander Liu
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-09-28 09:39" pubdate>
          2023å¹´9æœˆ28æ—¥ ä¸Šåˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.2k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          44 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">NJUOS-28-æŒä¹…æ•°æ®çš„å¯é æ€§</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š15 å¤©å‰
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>å¤ä¹ </p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿå®ç°ï¼šbread/bwrite ä¸Šçš„æ•°æ®ç»“æ„<ul>
<li>balloc/bfree</li>
<li>æ–‡ä»¶ï¼šFAT (é“¾è¡¨)/UNIX æ–‡ä»¶ç³»ç»Ÿ (ç´¢å¼•)</li>
<li>ç›®å½•æ–‡ä»¶</li>
</ul>
</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li>æ•°æ®ç»“æ„çš„å¦ä¸€ä¸ªå‡è®¾ï¼š<strong>å†…å­˜å¯é ä¸”å¯ä»¥æ¥å—æ–­ç”µæ•°æ®ä¸¢å¤±</strong></li>
<li><strong>Q</strong>: æŒä¹…æ•°æ®æ˜¯ä¸èƒ½æ¥å—ä¸¢å¤±çš„ï¼Œå¦‚ä½•ä¿è¯æŒä¹…æ•°æ®çš„å¯é æ€§ï¼Ÿ</li>
</ul>
<hr>
<p>æœ¬æ¬¡è¯¾ä¸»è¦å†…å®¹</p>
<ul>
<li>RAID (Redundant Array of Inexpensive Disks)</li>
<li>å´©æºƒä¸€è‡´æ€§</li>
</ul>
<span id="more"></span>



<h1 id="Redundant-Array-of-Inexpensive-Disks-RAID"><a href="#Redundant-Array-of-Inexpensive-Disks-RAID" class="headerlink" title="Redundant Array of Inexpensive Disks (RAID)"></a>Redundant Array of Inexpensive Disks (RAID)</h1><h2 id="æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚-1-â€”â€”æ€§èƒ½"><a href="#æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚-1-â€”â€”æ€§èƒ½" class="headerlink" title="æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚ (1)â€”â€”æ€§èƒ½"></a>æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚ (1)â€”â€”æ€§èƒ½</h2><p>å­˜å‚¨ï¼šåªè¦ CPU (DMA) èƒ½å¤„ç†å¾—è¿‡æ¥ï¼Œæˆ‘å°±èƒ½æä¾›è¶³å¤Ÿçš„å¸¦å®½ï¼</p>
<ul>
<li>Computer System çš„ â€œindustryâ€ ä¼ ç»Ÿâ€”â€”åšçœŸå®æœ‰ç”¨çš„ç³»ç»Ÿ</li>
</ul>
<p><img src="https://jyywiki.cn/pages/OS/img/emc-vnx5300.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚-2-â€”â€”å¯é æ€§"><a href="#æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚-2-â€”â€”å¯é æ€§" class="headerlink" title="æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚ (2)â€”â€”å¯é æ€§"></a>æ—¥æ¸å¢é•¿çš„æŒä¹…å­˜å‚¨éœ€æ±‚ (2)â€”â€”å¯é æ€§</h2><p>ä»»ä½•ç‰©ç†å­˜å‚¨ä»‹è´¨éƒ½æœ‰å¤±æ•ˆçš„å¯èƒ½</p>
<ul>
<li>ä½ ä¾ç„¶å¸Œæœ›åœ¨å­˜å‚¨è®¾å¤‡å¤±æ•ˆçš„æ—¶å€™èƒ½ä¿æŒæ•°æ®çš„å®Œæ•´<ul>
<li>æå°æ¦‚ç‡äº‹ä»¶ï¼šæˆ˜äº‰çˆ†å‘/ä¸‰ä½“äººè¿›æ”»åœ°çƒ/ä¸–ç•Œæ¯ç­ ğŸ˜‚</li>
<li>å°æ¦‚ç‡äº‹ä»¶ï¼šç¡¬ç›˜æŸå<ul>
<li>å¤§é‡é‡å¤ = å¿…ç„¶å‘ç”Ÿ (ä½†æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›ç³»ç»Ÿèƒ½ç…§å¸¸è¿è½¬)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309280946125.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="RAID-å­˜å‚¨è®¾å¤‡çš„è™šæ‹ŸåŒ–"><a href="#RAID-å­˜å‚¨è®¾å¤‡çš„è™šæ‹ŸåŒ–" class="headerlink" title="RAID: å­˜å‚¨è®¾å¤‡çš„è™šæ‹ŸåŒ–"></a>RAID: å­˜å‚¨è®¾å¤‡çš„è™šæ‹ŸåŒ–</h2><blockquote>
<p>é‚£ä¹ˆï¼Œæ€§èƒ½å’Œå¯é æ€§ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½å…¨éƒ½è¦å‘¢ï¼Ÿ</p>
</blockquote>
<ul>
<li><p>Redundant Array of Inexpensive (<em>Independent</em>) Disks (RAID)</p>
<ul>
<li><p>æŠŠå¤šä¸ª (ä¸å¯é çš„) ç£ç›˜è™šæ‹Ÿæˆä¸€å—</p>
<p>éå¸¸å¯é ä¸”æ€§èƒ½æé«˜</p>
<p>çš„è™šæ‹Ÿç£ç›˜</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/971701.50214">A case for redundant arrays of inexpensive disks (RAID)</a> (SIGMODâ€™88)</li>
</ul>
</li>
</ul>
</li>
<li><p>RAID æ˜¯ä¸€ä¸ª â€œåå‘â€ çš„è™šæ‹ŸåŒ–</p>
<ul>
<li><p>è¿›ç¨‹ï¼šæŠŠä¸€ä¸ª CPU åˆ†æ—¶è™šæ‹Ÿæˆå¤šä¸ªè™šæ‹Ÿ CPU</p>
</li>
<li><p>è™šå­˜ï¼šæŠŠä¸€ä»½å†…å­˜é€šè¿‡ MMU è™šæ‹Ÿæˆå¤šä¸ªåœ°å€ç©ºé—´</p>
</li>
<li><p>æ–‡ä»¶ï¼šæŠŠä¸€ä¸ªå­˜å‚¨è®¾å¤‡è™šæ‹Ÿæˆå¤šä¸ªè™šæ‹Ÿç£ç›˜</p>
</li>
</ul>
</li>
</ul>
<h2 id="RAID-çš„-Fault-Model-Fail-Stop"><a href="#RAID-çš„-Fault-Model-Fail-Stop" class="headerlink" title="RAID çš„ Fault Model: Fail-Stop"></a>RAID çš„ Fault Model: Fail-Stop</h2><ul>
<li><p>ç£ç›˜å¯èƒ½åœ¨æŸä¸ªæ—¶åˆ»å¿½ç„¶å½»åº•æ— æ³•è®¿é—®</p>
<ul>
<li><p>æœºæ¢°æ•…éšœã€èŠ¯ç‰‡æ•…éšœâ€¦â€¦</p>
<ul>
<li>ç£ç›˜å¥½åƒå°± â€œå¿½ç„¶æ¶ˆå¤±â€ äº† (æ•°æ®å®Œå…¨ä¸¢å¤±)</li>
<li>å‡è®¾ç£ç›˜èƒ½æŠ¥å‘Šè¿™ä¸ªé—®é¢˜ (å¦‚ä½•æŠ¥å‘Šï¼Ÿ)</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.usenix.org/conference/fast-08/analysis-data-corruption-storage-stack">An analysis of data corruption in the storage stack</a> (FASTâ€™08)</p>
</li>
</ul>
</li>
<li><p>åœ¨é‚£ä¸ªéåœ°æ˜¯é»„é‡‘çš„å¹´ä»£</p>
<ul>
<li>1988: å‡‘å‡ å—ç›˜ï¼Œæ€ç¿»æ•´ä¸ªäº§ä¸šé“¾ï¼<ul>
<li>â€œSingle Large Expensive Disksâ€ (IBM 3380), v.s.</li>
<li>â€œRedundant Array of Inexpensive Disksâ€</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ä¸€ä¸ªæœ€ç®€å•çš„æƒ³æ³•"><a href="#ä¸€ä¸ªæœ€ç®€å•çš„æƒ³æ³•" class="headerlink" title="ä¸€ä¸ªæœ€ç®€å•çš„æƒ³æ³•"></a>ä¸€ä¸ªæœ€ç®€å•çš„æƒ³æ³•</h2><p>åœ¨ç³»ç»Ÿé‡Œå¤šæ¥å…¥ä¸€å—ç¡¬ç›˜ç”¨äº Fault Tolerance (RAID-1)</p>
<ul>
<li><p>å‡è®¾æœ‰ä¸¤å—ç›˜<em>A</em>, <em>B</em></p>
<ul>
<li>åŒæ ·è§„æ ¼ï¼Œå…±æœ‰ <em>n</em> å—</li>
</ul>
</li>
<li><p>â€œé•œåƒâ€ è™šæ‹Ÿç£ç›˜<em>V</em></p>
<ul>
<li>$V_i\ -&gt;\ {A_i, B_i}(1 \le i \le n)$</li>
</ul>
</li>
<li><p>å—è¯»å†™</p>
<ul>
<li><p>bread(<em>i</em>)</p>
<ul>
<li>å¯ä»¥ä» <em>A</em> æˆ– <em>B</em> ä¸­çš„ä»»æ„ä¸€ä¸ªè¯»å–</li>
</ul>
</li>
<li><p>bwrite(<em>i</em>)</p>
<ul>
<li>åŒæ—¶å°†åŒæ ·çš„æ•°æ®å†™å…¥ <em>A</em>, <em>B</em> çš„åŒä¸€ä½ç½®</li>
</ul>
</li>
<li><p>å®¹é”™ï¼Œä¸”è¯»é€Ÿåº¦ç¿»å€ (å‡è®¾å†…å­˜è¿œå¿«äºç£ç›˜)</p>
</li>
</ul>
</li>
</ul>
<h2 id="RAID-Design-Space"><a href="#RAID-Design-Space" class="headerlink" title="RAID: Design Space"></a>RAID: Design Space</h2><blockquote>
<p>RAID (è™šæ‹ŸåŒ–) = è™šæ‹Ÿç£ç›˜å—åˆ°ç‰©ç†ç£ç›˜å—çš„ â€œæ˜ å°„â€ã€‚</p>
</blockquote>
<p>ä¸¤å—ç£ç›˜çš„å…¶ä»–æ‹¼æ¥æ–¹æ³•</p>
<ul>
<li>é¡ºåºæ‹¼æ¥<ul>
<li><em>V</em>1â†’<em>A</em>1,V<em>2â†’</em>A2, â€¦â€¦, <em>Vn</em>â†’<em>An</em></li>
<li><em>Vn</em>+1â†’<em>B</em>1, <em>Vn</em>+2â†’<em>B</em>2, â€¦â€¦, $V_{2n}$<em>â†’</em>B<em>n</em></li>
</ul>
</li>
<li>äº¤é”™æ’åˆ— (RAID-0)<ul>
<li><em>V</em>1â†’<em>A</em>1, V<em>2â†’</em>B1</li>
<li><em>V</em>3â†’<em>A</em>2, V<em>4â†’</em>B2</li>
<li>$V_{2i-1}$â†’$A_i$, $V_{2i}$â†’$B_i$</li>
</ul>
</li>
<li>è™½ç„¶ä¸èƒ½å®¹é”™ï¼Œä½†å¯ä»¥åˆ©ç”¨å¥½ç£ç›˜çš„å¸¦å®½ã€‚</li>
</ul>
<blockquote>
<p>è·¨ç›˜è¯»å–æ•°æ®ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šç›˜çš„ä¼˜åŠ¿ï¼Œå¢åŠ è¯»å–çš„å¸¦å®½ï¼Œå¢åŠ è¯»å–é€Ÿåº¦ã€‚</p>
</blockquote>
<h2 id="RAID-Design-Space-contâ€™d"><a href="#RAID-Design-Space-contâ€™d" class="headerlink" title="RAID: Design Space (contâ€™d)"></a>RAID: Design Space (contâ€™d)</h2><blockquote>
<p>RAID: å…è®¸ â€œå¤šå¯¹å¤šâ€ çš„æ˜ å°„ (ä¸€ç»„æ˜ å°„ç§°ä¸º â€œæ¡å¸¦â€, stripe)</p>
</blockquote>
<p>RAID-10 = RAID-0 over RAID-1</p>
<ul>
<li><p><em>A</em>,<em>B</em>ç»„æˆ RAID-1(å®¹é”™)</p>
<ul>
<li>$X_1\ -&gt;{A_1, B_1}$</li>
<li>$X_2\ -&gt;{A_2, B_2}$</li>
</ul>
</li>
<li><p><em>C</em>,<em>D</em>ç»„æˆ RAID-1(å®¹é”™)</p>
<ul>
<li>$Y_1\ -&gt;{C_1, D_1}$</li>
<li>$Y_2\ -&gt;{C_2, D_2}$</li>
</ul>
</li>
<li><p><em>X</em>,<em>Y</em> ç»„æˆ RAID-0 (æ€§èƒ½ç¿»å€)</p>
<ul>
<li><em>V</em>1â†’<em>X</em>1â†’{<em>A</em>1, <em>B</em>1}, V<em>2â†’</em>Y*1â†’{*A2, B2}</li>
<li><em>V</em>3â†’<em>X</em>2â†’{<em>A</em>2, <em>B</em>2}, V<em>4â†’</em>Y*2â†’{<em>C</em>2,*D2}</li>
</ul>
</li>
<li><p>ç»“æ„ï¼š((RAID-1)-0)</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281124523.png" srcset="/img/loading.gif" lazyload alt="image-20230928112448445"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281129649.png" srcset="/img/loading.gif" lazyload alt="image-20230928112913584"></p>
<h2 id="RAID-Design-Space-contâ€™d-1"><a href="#RAID-Design-Space-contâ€™d-1" class="headerlink" title="RAID: Design Space (contâ€™d)"></a>RAID: Design Space (contâ€™d)</h2><blockquote>
<p>RAID-10ï¼šæœ‰æ—¶èƒ½å®¹å¿ä¸¤å—ç›˜åï¼Œæœ‰æ—¶å€™å´ä¸èƒ½ã€‚å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šå—ç›˜ï¼Œèƒ½å¦å‡å°‘æµªè´¹ï¼Ÿ</p>
</blockquote>
<ul>
<li><p>æ¢ä¸€ä¸ªé—®æ³•</p>
<ul>
<li><p>ç»™ä½  <em>n</em> ä¸ª bits b<em>1,<em>b</em>2,â€¦,<em>b</em>n</em></p>
</li>
<li><p>è‡³å°‘éœ€è¦å­˜å‚¨å¤šå°‘ bit ä¿¡æ¯ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„<em>bi</em>ä¸¢å¤± (å·²çŸ¥<em>i</em>) çš„æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥æ¢å¤å‡º<em>bi</em>ï¼Ÿ</p>
<ul>
<li>çº é”™ç </li>
<li>ç›¸åŒçš„æ•°å¼‚æˆ–ä¸º0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å¼‚æˆ–å¦™ç”¨"><a href="#å¼‚æˆ–å¦™ç”¨" class="headerlink" title="å¼‚æˆ–å¦™ç”¨"></a>å¼‚æˆ–å¦™ç”¨</h3><ul>
<li><p>ç›˜æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªBlock Array(Bit Array)ï¼ŒFault Toleranceå°±æ˜¯å½“æˆ‘çš„ç›˜å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œåˆ«çš„åœ°æ–¹è¿˜å¯ä»¥æ‹¼å‡‘ or æ‰¾å‡ºè¿™å¼ ç›˜ä¸Šçš„å†…å®¹ã€‚</p>
</li>
<li><p>å¼‚æˆ–å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¿å­˜ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€å—ç›˜å¯„äº†ã€‚ä¸€å¼€å§‹æˆ‘ä»¬è·å¾—æ‰€æœ‰å†…å®¹å¼‚æˆ–èµ·æ¥çš„ç»“æœï¼Œç„¶åæŠŠé™¤äº†è¿™ä¸€å—å„¿ç›˜ä¹‹å¤–çš„ä¸œè¥¿éƒ½å¼‚æˆ–ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ï¼Œå°±æ˜¯æŸå¤±çš„é‚£å—å„¿ç›˜çš„ä¿¡æ¯ï¼ï¼ï¼ï¼ˆç®€å•LeetcodeçŸ¥è¯†è¿ç§»åˆ°OSï¼Œç”šè‡³å¯ä»¥åšFault Toleranceâ€¦ï¼‰</p>
</li>
<li><p>å¦‚æœå¯¹äºä¸€ä¸ªByteArrayï¼Œåœ¨åªä¸¢å¤±ä¸€ä¸ªæ•°å­—çš„å‰æä¸‹ï¼Œæˆ‘ä½¿ç”¨å¤šä¸€ä¸ªByteï¼Œæ¥å­˜å‚¨æ‰€æœ‰Byteçš„å¼‚æˆ–è¿ç®—ç»“æœï¼Œå°±å¯ä»¥åšåˆ°Fault Toleranceã€‚å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªByteä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå®Œæˆä¸¢å¤±æ•°æ®çš„æ¢å¤ã€‚</p>
</li>
<li><p>é‚£å¯¹äºç›˜æ¥è¯´å‘¢ï¼Ÿå‡è®¾æœ‰å››ä¸ªç›˜ï¼Œå®Œå…¨å¯ä»¥ä¸‰ä¸ªç›˜å­˜æ•°æ®ï¼Œæœ€åä¸€ä¸ªç›˜å­˜å¥‡å¶æ ¡éªŒç»“æœã€‚</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281415847.png" srcset="/img/loading.gif" lazyload alt="image-20230928141549727"></p>
<h2 id="RAID-4-Parity-Disk"><a href="#RAID-4-Parity-Disk" class="headerlink" title="RAID-4: Parity Disk"></a>RAID-4: Parity Disk</h2><p>ä¸“é—¨ç•™ä¸€å—ç£ç›˜ä½œä¸ºå¥‡å¶æ ¡éªŒç›˜ã€‚</p>
<ul>
<li><p>{<em>V</em>1,<em>V</em>2,<em>V</em>3}â†’{<em>A</em>1,<em>B</em>1,<em>C</em>1,<em>D</em>1}</p>
<ul>
<li><em>V</em>1â†’<em>A</em>1, V<em>2â†’</em>B1, <em>V</em>3â†’<em>C</em>1 (ä¸å®¹é”™)</li>
<li><em>D1</em>=<em>V</em>1âŠ•<em>V</em>2âŠ•<em>V</em>3 (å¥‡å¶æ ¡éªŒ)</li>
</ul>
</li>
<li><p>æ€§èƒ½åˆ†æ</p>
<ul>
<li><p>Sequential/random read: 3x (75% æ€»å¸¦å®½)</p>
</li>
<li><p>Sequential write: 3x (75% æ€»å¸¦å®½)</p>
</li>
<li><p>Random write (tricky)</p>
<ul>
<li><em>D</em>1=<em>V</em>1âŠ•<em>V</em>2âŠ•<em>V</em>3</li>
<li>å†™å…¥ä»»æ„<em>V</em>1,<em>V</em>2,<em>V</em>3éƒ½éœ€è¦æ›´æ–°<em>D</em>1<ul>
<li>æ›´æ–°<em>V</em>1 éœ€è¦ readb({<em>A</em>1,<em>D</em>1}), writedb({<em>A</em>1,<em>D</em>1})</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="RAID-5-Rotating-Parity"><a href="#RAID-5-Rotating-Parity" class="headerlink" title="RAID-5: Rotating Parity"></a>RAID-5: Rotating Parity</h2><p>â€œäº¤é”™æ’åˆ—â€ parity block!</p>
<p><img src="https://jyywiki.cn/pages/OS/img/raid5.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<blockquote>
<p>å¥‡å¶æ ¡éªŒï¼Œæ‰“æ•£äº†æ”¾åˆ°ä¸åŒçš„ç›˜é‡Œé¢å»ã€‚Dæ˜¯ç“¶é¢ˆï¼Ÿæ‰“æ•£æ”¾åˆ°ä¸åŒçš„Diskä¸­ã€‚</p>
</blockquote>
<h2 id="RAID-5-æ€§èƒ½åˆ†æ"><a href="#RAID-5-æ€§èƒ½åˆ†æ" class="headerlink" title="RAID-5: æ€§èƒ½åˆ†æ"></a>RAID-5: æ€§èƒ½åˆ†æ</h2><p>è®©æ¯ä¸€å—ç›˜éƒ½æœ‰å‡ç­‰çš„æœºä¼šå­˜å‚¨ parity</p>
<ul>
<li>Sequential read/write: 3x (75% æ€»å¸¦å®½)</li>
<li>Random read (tricky)<ul>
<li>(read è¶³å¤Ÿå¤§ï¼Œæ‰€æœ‰ç£ç›˜éƒ½å¯ä»¥æä¾›æ•°æ®) 4x (100% æ€»å¸¦å®½)</li>
</ul>
</li>
<li>Random write (tricky)<ul>
<li>D1=<em>V</em>1âŠ•<em>V</em>2âŠ•<em>V</em>3; å†™å…¥ä»»æ„V1,*V2,*V3éƒ½éœ€è¦æ›´æ–° D1</li>
<li>å¥‡å¶æ ¡éªŒä¾ç„¶ä¸¥é‡æ‹–æ…¢äº†éšæœºå†™å…¥<ul>
<li>ä½†è‡³å°‘ <em>n</em> å—ç›˜å¯ä»¥è·å¾— <em>n</em>/4 çš„éšæœºå†™æ€§èƒ½</li>
<li>æœ‰ä¸€å®šçš„ scalability</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="RAID-è®¨è®º"><a href="#RAID-è®¨è®º" class="headerlink" title="RAID: è®¨è®º"></a>RAID: è®¨è®º</h2><p>æ›´å¿«ã€æ›´å¯é ã€è¿‘ä¹å…è´¹çš„å¤§å®¹é‡ç£ç›˜</p>
<ul>
<li><p>é©äº† â€œé«˜å¯é æ€§ç£ç›˜â€ çš„å‘½</p>
<ul>
<li>æˆä¸ºä»Šå¤©æœåŠ¡å™¨çš„æ ‡å‡†é…ç½®</li>
</ul>
</li>
<li><p>ç±»ä¼¼çš„é‡Œç¨‹ç¢‘</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/1165389.945450">The Google file system</a> (SOSPâ€™03) å’Œ <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.5555/1251254.1251264">MapReduce: Simplified data processing on large clusters</a> (OSDIâ€™04) å¼€å¯ â€œå¤§æ•°æ®â€ æ—¶ä»£</li>
</ul>
</li>
<li><p>RAID çš„å¯é æ€§</p>
<ul>
<li><p>RAID ç³»ç»Ÿå‘ç”Ÿæ–­ç”µï¼Ÿ</p>
<ul>
<li>ä¾‹å­ï¼šRAID-1 é•œåƒç›˜å‡ºç°ä¸ä¸€è‡´çš„æ•°æ®</li>
</ul>
</li>
<li><p>æ£€æµ‹åˆ°ç£ç›˜åï¼Ÿ</p>
<ul>
<li>è‡ªåŠ¨é‡ç»„</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Googleçš„åšæ³•ä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡è¿™é‡ŒRAIDæ˜¯å¯¹äºç£ç›˜æ¥åšçš„ï¼ŒGoogleæ˜¯å¯¹äºè®¡ç®—æœºæ¥åšçš„ã€‚æœ¬è´¨éƒ½æ˜¯è™šæ‹ŸåŒ–ï¼ŒæŠŠè¿™ä¹ˆå¤šå°è®¡ç®—æœºï¼ŒæŠ½è±¡ä¸ºä¸€å°è¶…çº§new beeçš„è®¡ç®—æœºï¼ˆProgram Modelï¼‰ï¼Œç„¶åç”¨MapReduceæ¥è¿›è¡Œä»»åŠ¡çš„åˆ†å‘å’Œè°ƒåº¦å¤„ç†ã€‚</p>
</blockquote>
<ul>
<li>Brain Storm: ç¥ç»ç½‘ç»œè¡Œä¸è¡Œå‘¢ï¼ŸæŠŠä¸å¯é çš„ä¸œè¥¿ï¼Œè™šæ‹ŸåŒ–ä¸ºå¯é çš„å‘¢ï¼Ÿæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ‹†å¤§ä¸ºå°å‘¢ï¼Ÿ</li>
</ul>
<h1 id="å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤"><a href="#å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤" class="headerlink" title="å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤"></a>å´©æºƒä¸€è‡´æ€§ä¸å´©æºƒæ¢å¤</h1><blockquote>
<p>ç¡¬ä»¶æ²¡é—®é¢˜ï¼Œè½¯ä»¶ä¹Ÿå¯èƒ½æœ‰é—®é¢˜å•Šorz</p>
</blockquote>
<h2 id="å¦ä¸€ç§-Fault-Model"><a href="#å¦ä¸€ç§-Fault-Model" class="headerlink" title="å¦ä¸€ç§ Fault Model"></a>å¦ä¸€ç§ Fault Model</h2><p>ç£ç›˜å¹¶æ²¡æœ‰æ•…éšœ</p>
<ul>
<li>ä½†æ“ä½œç³»ç»Ÿå†…æ ¸å¯èƒ½ crashï¼Œç³»ç»Ÿå¯èƒ½æ–­ç”µ</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281024925.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿï¼šè®¾å¤‡ä¸Šçš„æ ‘ç»“æ„<ul>
<li>å³ä¾¿åªæ˜¯ append ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿæ¶‰åŠå¤šå¤„ç£ç›˜çš„ä¿®æ”¹<ul>
<li>FATã€ç›®å½•æ–‡ä»¶ (æ–‡ä»¶å¤§å°) å’Œæ•°æ®</li>
<li>ç£ç›˜æœ¬èº«ä¸æä¾› â€œall or nothingâ€ çš„æ”¯æŒ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å´©æºƒä¸€è‡´æ€§-Crash-Consistency"><a href="#å´©æºƒä¸€è‡´æ€§-Crash-Consistency" class="headerlink" title="å´©æºƒä¸€è‡´æ€§ (Crash Consistency)"></a>å´©æºƒä¸€è‡´æ€§ (Crash Consistency)</h2><blockquote>
<p><strong>Crash Consistency</strong>: Move the file system from one consistent state (e.g., before the file got appended to) to another atomically (e.g., after the inode, bitmap, and new data block have been written to disk).</p>
</blockquote>
<p>(ä½ ä»¬å¹³æ—¶ç¼–ç¨‹æ—¶å‡è®¾ä¸ä¼šå‘ç”Ÿçš„äº‹ï¼Œæ“ä½œç³»ç»Ÿéƒ½è¦ç»™ä½ å…œåº•)</p>
<ul>
<li><p>ç£ç›˜ä¸æä¾›å¤šå—è¯»å†™ â€œall or nothingâ€ çš„æ”¯æŒ</p>
<ul>
<li>ç”šè‡³ä¸ºäº†æ€§èƒ½ï¼Œæ²¡æœ‰é¡ºåºä¿è¯<ul>
<li>bwrite å¯èƒ½è¢«ä¹±åº</li>
<li>æ‰€ä»¥ç£ç›˜è¿˜æä¾›äº† bflush ç­‰å¾…å·²å†™å…¥çš„æ•°æ®è½ç›˜</li>
<li>å›åˆ°è¢«å¹¶å‘ç¼–ç¨‹æ”¯é…çš„ææƒ§ï¼Ÿ<a target="_blank" rel="noopener" href="https://jyywiki.cn/pages/OS/2022/demos/peterson-barrier.c">peterson-barrier.c</a></li>
</ul>
</li>
</ul>
</li>
<li><p><del>é‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘æä¾›å•Šï¼š<a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.5555/1855741.1855752">Transactional flash</a> (OSDIâ€™08)</del></p>
</li>
</ul>
<h2 id="ç£ç›˜ä¹±åºçš„åæœ"><a href="#ç£ç›˜ä¹±åºçš„åæœ" class="headerlink" title="ç£ç›˜ä¹±åºçš„åæœ"></a>ç£ç›˜ä¹±åºçš„åæœ</h2><ul>
<li><p>ä¸º FAT æ–‡ä»¶è¿½åŠ å†™å…¥ä¸€ä¸ª cluster (4KB) éœ€è¦æ›´æ–°</p>
<ul>
<li><p>ç›®å½•é¡¹ä¸­çš„æ–‡ä»¶å¤§å° (100 â†’ 4196)</p>
</li>
<li><p>FAT è¡¨ä¸­ç»´æŠ¤çš„é“¾è¡¨ (EOF â†’ cluster-id, FREE â†’ EOF)</p>
</li>
<li><p>å®é™…æ•°æ®</p>
</li>
</ul>
</li>
<li><p>è¿™éº»çƒ¦äº†â€¦â€¦</p>
<ul>
<li><p>ä»»ä½•ä¸€ä¸ªå­é›†çš„å†™å…¥ä¸¢å¤±éƒ½å¯èƒ½å‡ºç°</p>
</li>
<li><p>æ–‡ä»¶ç³»ç»Ÿå°±è¿›å…¥äº† â€œä¸ä¸€è‡´â€ çš„çŠ¶æ€</p>
<ul>
<li>å¯èƒ½è¿å FAT çš„åŸºæœ¬å‡è®¾<ul>
<li>é“¾è¡¨æ— ç¯ä¸”é•¿åº¦å’Œæ–‡ä»¶å¤§å°ä¸€è‡´</li>
<li>FREE çš„ cluster ä¸èƒ½æœ‰å…¥è¾¹</li>
<li>â€¦â€¦</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="File-System-Checking-FSCK"><a href="#File-System-Checking-FSCK" class="headerlink" title="File System Checking (FSCK)"></a>File System Checking (FSCK)</h2><p>æ ¹æ®ç£ç›˜ä¸Šå·²æœ‰çš„ä¿¡æ¯ï¼Œæ¢å¤å‡º â€œæœ€å¯èƒ½â€ çš„æ•°æ®ç»“æ„</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281444160.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.5555/1855741.1855751">SQCK: A declarative file system checker</a> (OSDIâ€™08)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/3281031">Towards robust file system checkers</a> (FASTâ€™18)</p>
<ul>
<li>â€œwidely used file systems (EXT4, XFS, BtrFS, and F2FS) may leave the file system in an uncorrectable state if the repair procedure is interrupted unexpectedlyâ€ ğŸ˜‚</li>
</ul>
</li>
<li><p>é’ˆå¯¹ crashï¼Œæˆ‘ä»¬éœ€è¦æ›´å¯é çš„æ–¹æ³•æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¯é çš„æ–¹æ³•</p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´çš„æ ¹æœ¬åŸå› æ˜¯å­˜å‚¨è®¾å¤‡æ— æ³•æä¾›å¤šæ¬¡å†™å…¥çš„åŸå­æ€§</li>
</ul>
</li>
</ul>
<h1 id="æ—¥å¿—-Journaling"><a href="#æ—¥å¿—-Journaling" class="headerlink" title="æ—¥å¿— (Journaling)"></a>æ—¥å¿— (Journaling)</h1><h2 id="é‡æ–°æ€è€ƒæ•°æ®ç»“æ„çš„å­˜å‚¨"><a href="#é‡æ–°æ€è€ƒæ•°æ®ç»“æ„çš„å­˜å‚¨" class="headerlink" title="é‡æ–°æ€è€ƒæ•°æ®ç»“æ„çš„å­˜å‚¨"></a>é‡æ–°æ€è€ƒæ•°æ®ç»“æ„çš„å­˜å‚¨</h2><ul>
<li>ä¸¤ä¸ª â€œè§†è§’â€</li>
</ul>
<ol>
<li>å­˜å‚¨å®é™…<strong>æ•°æ®ç»“æ„</strong><ul>
<li>æ–‡ä»¶ç³»ç»Ÿçš„ â€œç›´è§‚â€ è¡¨ç¤º</li>
<li>crash unsafe</li>
</ul>
</li>
<li>Append-only è®°å½•æ‰€æœ‰<strong>å†å²æ“ä½œ</strong><ul>
<li>â€œé‡åšâ€ æ‰€æœ‰æ“ä½œå¾—åˆ°æ•°æ®ç»“æ„çš„å½“å‰çŠ¶æ€</li>
<li>å®¹æ˜“å®ç°å´©æºƒä¸€è‡´æ€§</li>
</ul>
</li>
</ol>
<ul>
<li><p>äºŒè€…çš„èåˆ</p>
<ul>
<li><p>æ•°æ®ç»“æ„æ“ä½œå‘ç”Ÿæ—¶ï¼Œç”¨ (2) append-only è®°å½•æ—¥å¿—</p>
</li>
<li><p>æ—¥å¿—è½ç›˜åï¼Œç”¨ (1) æ›´æ–°æ•°æ®ç»“æ„</p>
</li>
<li><p>å´©æºƒåï¼Œé‡æ”¾æ—¥å¿—å¹¶æ¸…é™¤ (ç§°ä¸º redo logï¼›ç›¸åº”ä¹Ÿå¯ä»¥ undo log)</p>
</li>
</ul>
</li>
</ul>
<h2 id="å®ç°-Atomic-Append"><a href="#å®ç°-Atomic-Append" class="headerlink" title="å®ç° Atomic Append"></a>å®ç° Atomic Append</h2><p>ç”¨ bread, bwrite å’Œ bflush å®ç° append()</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202309281453347.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol>
<li>å®šä½åˆ° journal çš„æœ«å°¾ (bread)</li>
<li>bwrite TXBegin å’Œæ‰€æœ‰æ•°æ®ç»“æ„æ“ä½œ</li>
<li><strong>bflush</strong> ç­‰å¾…æ•°æ®è½ç›˜</li>
<li>bwrite TXEnd</li>
<li><strong>bflush</strong> ç­‰å¾…æ•°æ®è½ç›˜</li>
<li>å°†æ•°æ®ç»“æ„æ“ä½œå†™å…¥å®é™…æ•°æ®ç»“æ„åŒºåŸŸ</li>
<li>ç­‰å¾…æ•°æ®è½ç›˜åï¼Œåˆ é™¤ (æ ‡è®°) æ—¥å¿—</li>
</ol>
<blockquote>
<p>æ²¡çœ‹åˆ°TXEndï¼Œå°±æŠŠäº‹åŠ¡å‰é¢çš„éƒ½æ‰”æ‰ã€‚åªè¦çœ‹åˆ°äº†TXEndï¼Œè¿™ä¸ªäº‹åŠ¡å°±è½ç›˜äº†ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼</p>
</blockquote>
<h2 id="Journaling-ä¼˜åŒ–"><a href="#Journaling-ä¼˜åŒ–" class="headerlink" title="Journaling: ä¼˜åŒ–"></a>Journaling: ä¼˜åŒ–</h2><p>ç°åœ¨ç£ç›˜éœ€è¦å†™å…¥åŒä»½çš„æ•°æ®</p>
<ul>
<li>æ‰¹å¤„ç† (xv6; jbd)<ul>
<li>å¤šæ¬¡ç³»ç»Ÿè°ƒç”¨çš„ Tx åˆå¹¶æˆä¸€ä¸ªï¼Œå‡å°‘ log çš„å¤§å°</li>
<li>jbd: å®šæœŸ write back</li>
</ul>
</li>
<li>Checksum (ext4)<ul>
<li>ä¸å†æ ‡è®° TxBegin/TxEnd</li>
<li>ç›´æ¥æ ‡è®° Tx çš„é•¿åº¦å’Œ checksum</li>
</ul>
</li>
<li>Metadata journaling (ext4 default)<ul>
<li>æ•°æ®å ç£ç›˜å†™å…¥çš„ç»å¤§éƒ¨åˆ†<ul>
<li>åªå¯¹ inode å’Œ bitmap åš journaling å¯ä»¥æé«˜æ€§èƒ½ï¼ˆä¸åœ¨æ—¥å¿—é‡Œé¢å†™æ•°æ®ï¼Œä¸ç„¶ä¼šå‘ç”Ÿå†™æ”¾å¤§çš„æƒ…å†µï¼‰</li>
</ul>
</li>
<li>ä¿è¯æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„æ˜¯ä¸€è‡´çš„ï¼›ä½†æ•°æ®å¯èƒ½ä¸¢å¤±</li>
</ul>
</li>
</ul>
<h2 id="Metadata-Journaling"><a href="#Metadata-Journaling" class="headerlink" title="Metadata Journaling"></a>Metadata Journaling</h2><ul>
<li><p>ä»åº”ç”¨è§†è§’æ¥çœ‹ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„è¡Œä¸ºå¯èƒ½å¾ˆæ€ªå¼‚</p>
<ul>
<li><p>å„ç±»ç³»ç»Ÿè½¯ä»¶ (git, sqlite, gdbm, â€¦) ä¸å¹¸ä¸­æ‹›</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cn.bing.com/search?q=All+file+systems+are+not+created+equal:+On+the+complexity+of+crafting+crash-consistent+applications&amp;form=APMCS1&amp;PC=APMC">All file systems are not created equal: On the complexity of crafting crash-consistent applications</a> (OSDIâ€™14)</li>
<li>(os-workbench é‡Œçš„å°ç§˜å¯†)</li>
</ul>
</li>
<li><p>æ›´å¤šçš„åº”ç”¨ç¨‹åºå¯èƒ½å‘ç”Ÿ data loss</p>
<ul>
<li>æˆ‘ä»¬çš„å·¥ä½œ: GNU coreutils, gmake, gzip, â€¦ ä¹Ÿæœ‰é—®é¢˜</li>
<li><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/2950290.2950327">Crash consistency validation made easy</a> (FSEâ€™16)</li>
</ul>
</li>
</ul>
</li>
<li><p>æ›´ä¸ºä¸€åŠ³æ°¸é€¸çš„æ–¹æ¡ˆï¼šTxOS</p>
<ul>
<li>xbegin/xend/xabort ç³»ç»Ÿè°ƒç”¨å®ç°è·¨ syscall çš„ â€œall-or-nothingâ€<ul>
<li>åº”ç”¨åœºæ™¯ï¼šæ•°æ®æ›´æ–°ã€è½¯ä»¶æ›´æ–°ã€check-useâ€¦â€¦</li>
<li><a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/1629575.1629591">Operating systems transactions</a> (SOSPâ€™09)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡è¯¾å›ç­”çš„é—®é¢˜</p>
<ul>
<li><p>Q: å¦‚ä½•ä¿è¯æŒä¹…æ•°æ®çš„å¯é æ€§ï¼Ÿ</p>
<ul>
<li>ç¡¬ä»¶å†—ä½™ï¼šRAID</li>
<li>è½¯ä»¶å®¹é”™ï¼šfsck å’Œ journaling</li>
</ul>
</li>
<li><p>Takeaway messages</p>
<ul>
<li><p>å¤šä¸ª bwrite ä¸ä¿è¯é¡ºåºå’ŒåŸå­æ€§</p>
</li>
<li><p>Journaling: æ•°æ®ç»“æ„çš„ä¸¤ä¸ªè§†è§’</p>
<ul>
<li>çœŸå®çš„æ•°æ®ç»“æ„</li>
<li>æ‰§è¡Œçš„å†å²æ“ä½œ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2022/slides/28.slides.html#/">Slides</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Y5411X7SN/?spm_id_from=333.999.0.0&amp;vd_source=ff957cd8fbaeb55d52afc75fbcc87dfd">Vedio</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="category-chain-item">å—äº¬å¤§å­¦æ“ä½œç³»ç»Ÿ</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%A0%940%E8%87%AA%E5%AD%A6/">#ç ”0è‡ªå­¦</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>NJUOS-28-æŒä¹…æ•°æ®çš„å¯é æ€§</div>
      <div>https://alexanderliu-creator.github.io/2023/09/28/njuos-28-chi-jiu-shu-ju-de-ke-kao-xing/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Alexander Liu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2023å¹´9æœˆ28æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/10/10/njuos-29-xv6-wen-jian-xi-tong-shi-xian/" title="NJUOS-29-XV6 æ–‡ä»¶ç³»ç»Ÿå®ç°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">NJUOS-29-XV6 æ–‡ä»¶ç³»ç»Ÿå®ç°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/09/25/njuos-27-fat-he-unix-wen-jian-xi-tong/" title="NJUOS-27-æ“ä½œç³»ç»Ÿçš„å®ç°">
                        <span class="hidden-mobile">NJUOS-27-æ“ä½œç³»ç»Ÿçš„å®ç°</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
