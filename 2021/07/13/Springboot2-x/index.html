

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/tuzi.png">
  <link rel="icon" href="/img/tuzi.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Alexander Liu">
  <meta name="keywords" content="分布式系统,后端研发,数据协同">
  
    <meta name="description" content="针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！基础使用篇：Boot的升级： 响应式编程：    接口中方法有默认实现，就不用把接口中的所有方法都写出来了，都有默认实现的，只用覆写我们要覆写的方法即可。（Java底层语法的升级，导致Adapter失效了，每个接口类中的抽象方法现在都是自带默认实现的嗷！！！我们直接对于需要覆写的方法进行覆写">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot2-x">
<meta property="og:url" content="http://example.com/2021/07/13/springboot2-x/index.html">
<meta property="og:site_name" content="兔の博客">
<meta property="og:description" content="针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！基础使用篇：Boot的升级： 响应式编程：    接口中方法有默认实现，就不用把接口中的所有方法都写出来了，都有默认实现的，只用覆写我们要覆写的方法即可。（Java底层语法的升级，导致Adapter失效了，每个接口类中的抽象方法现在都是自带默认实现的嗷！！！我们直接对于需要覆写的方法进行覆写">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713090303.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192105.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192351.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192708.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713201014.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713201128.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713220500.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714110023.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714111433.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714111749.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181171918-b8acfb93-4914-4208-9943-b37610e93864.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181460034-ba25f3c0-9cfd-4432-8949-3d1dd88d8b12.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181662070-9e526de8-fd78-4a02-9410-728f059d6aef.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715102235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715104704.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715104535.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271442869-63b4c3c7-c721-4074-987d-cbe5999273ae.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271678813-d8e1a1e5-94fa-412c-a7f1-6f27174fd127.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271813894-037be041-92a5-49af-a49c-c350b3dd587a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603262942726-107353bd-f8b7-44f6-93cf-2a3cad4093cf.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263283504-85bbd4d5-a9af-4dbf-b6a2-30b409868774.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263394724-33122714-9d06-42ec-bf45-e440e8b49c05.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263524227-386da4be-43b1-4b17-a2cc-8cf886346af9.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603337871521-25fc1aa1-133a-4ce0-a146-d565633d7658.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603338486441-9bbd22a9-813f-49bd-b51b-e66c7f4b8598.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603272018605-1bce3142-bdd9-4834-a028-c753e91c52ac.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606043749073-2573e24a-9ea9-459e-ad94-a433e1082624.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151090728-f7c60e6f-d0c0-4541-bfa3-8cc805dfd5d6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151359370-01cd1fbe-628a-4eea-9430-d79a78f59125.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151728659-68c8ce8a-1b2b-4ab0-b86d-c3a875184672.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163005521-a20d1d8e-0494-43d0-8135-308e7a22e896.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163447900-e2748217-0f31-4abb-9cce-546b4d790d0b.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163584708-e19770d6-6b35-4caa-bf21-266b73cb1ef1.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605164243168-1a31e9af-54a4-463e-b65a-c28ca7a8a2fa.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173127653-8a06cd0f-b8e1-4e22-9728-069b942eba3f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230907471-b0ed34bc-6782-40e7-84b7-615726312f01.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605231074299-25f5b062-2de1-4a09-91bf-11e018d6ec0e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230462280-ef98de47-6717-4e27-b4ec-3eb0690b55d0.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230546376-65dcf657-7653-4a58-837a-f5657778201a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173876646-f63575e2-50c8-44d5-9603-c2d11a78adae.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173657818-73331882-6086-490c-973b-af46ccf07b32.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605260623995-8b1f7cec-9713-4f94-9cf1-8dbc496bd245.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605261062877-0a27cc41-51cb-4018-a9af-4e0338a247cd.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210716201441.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606043749039-cefbf687-4feb-441d-bad8-c6d933248d3c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605680247945-088b0f17-185c-490b-8889-103e8b4d8c07.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679959020-54b96fe7-f2fc-4b4d-a392-426e1d5413de.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679471537-7db702dc-b165-4dc6-b64a-26459ee5fd6c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679913592-151a616a-c754-4da3-a2c1-91dc0230a48d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605498132699-4fae6085-a207-456c-89fa-e571ff1663da.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210716213802.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717115242.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717165415.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717165810.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605764129365-5b31a748-1541-4bee-9692-1917b3364bc6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605765121071-64cfc649-4892-49a3-ac08-88b52fb4286f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605847414866-32b6cc9c-5191-4052-92eb-069d652dfbf9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024421363-77083c34-0b0e-4698-bb72-42da351d3944.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024616835-bc491bf0-c3b1-4ac3-b886-d4ff3c9874ce.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024592756-d4ab8a6b-ec37-426b-8b39-010463603d57.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606114118010-f4aaf5ee-2747-4402-bc82-08321b2490ed.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606114688649-e6502134-88b3-48db-a463-04c23eddedc7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606284869220-8b63d54b-39c4-40f6-b226-f5f095ef9304.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606280937533-504d0889-b893-4a01-af68-2fc31ffce9fc.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718160633.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718160407.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718162702.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606366100317-5e0199fa-6709-4d32-bce3-bb262e2e5e6a.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719162954.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719170200.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719170434.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606704096118-53001250-a04a-4210-80ee-6de6a370be2e.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719203602.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719205324.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720155244.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720165749.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720165822.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720172721.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720172918.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720203340.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720203523.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192137.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192211.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192049.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192312.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606745732785-17d1227a-75b9-4f00-a3f1-7fc4137b5113.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720211243.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720211446.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720212207.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606796395719-eb57ab48-ae44-45e5-8d2e-c4d507aff49a.png?x-oss-process=image/resize,w_683">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606797616337-e73010e9-9cac-496d-a177-64b677af5a3d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721154738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155156.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155459.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155812.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165618.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165828.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165947.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606886483335-697ee1c1-2f69-43ab-bddc-3a038382319c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606884394162-ac7f2d8e-7abb-44df-9998-fb0f2705f238.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721224151.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606908975702-4f9a3208-15ca-4a78-9f76-939ef986db7e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606909073222-c6e77ca3-4b1c-4f38-a1c6-8614dec4f7bc.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721223231.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722160510.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722160756.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722161322.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722192435.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722192905.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722193108.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606995919308-b2c7ccaa-e720-4cc5-9801-2e170b3102e1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607005958877-bf152e3e-4d2d-42b6-a08c-ceef9870f3b6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607004823889-8373cea4-6305-40c1-af3b-921b071a28a8.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607006112013-6ed5c0a0-3e02-4bf1-bdb7-423e0a0b3f3c.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210724161055.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210724161802.png">
<meta property="article:published_time" content="2021-07-13T01:32:16.000Z">
<meta property="article:modified_time" content="2021-07-24T08:18:05.000Z">
<meta property="article:author" content="Alexander Liu">
<meta property="article:tag" content="后端">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713090303.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>SpringBoot2-x - 兔の博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="兔の博客" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>兔的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background_drinkingbeer.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SpringBoot2-x"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Alexander Liu
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-07-13 09:32" pubdate>
          2021年7月13日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          112k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          937 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringBoot2-x</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：1 年前
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！"><a href="#针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！" class="headerlink" title="针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！"></a>针对于Boot2的新特性，有了这一期的学习，连着两次学习boot，刚好巩固基础了嗷！！！尚硅谷还是香哇！！！</h1><h1 id="基础使用篇："><a href="#基础使用篇：" class="headerlink" title="基础使用篇："></a>基础使用篇：</h1><h2 id="Boot的升级："><a href="#Boot的升级：" class="headerlink" title="Boot的升级："></a>Boot的升级：</h2><ul>
<li>响应式编程：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713090303.png" srcset="/img/loading.gif" lazyload alt="image-20210713090303630"></p>
<ul>
<li>接口中方法有默认实现，就不用把接口中的所有方法都写出来了，都有默认实现的，只用覆写我们要覆写的方法即可。（Java底层语法的升级，导致Adapter失效了，每个接口类中的抽象方法现在都是自带默认实现的嗷！！！我们直接对于需要覆写的方法进行覆写就可以啦！！！）</li>
</ul>
<h2 id="一些补充："><a href="#一些补充：" class="headerlink" title="一些补充："></a>一些补充：</h2><p><code>@RestController = @Controller + @ResponseBody</code></p>
<ul>
<li><p>@ResponseBody是将相应的内容直接以字符串的形式写到浏览器中嗷！！！就不会发生页面跳转啦！！！</p>
</li>
<li><p>相应的资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot">SpringBoot2课程笔记</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT/?p=4&amp;spm_id_from=pageDriver">boot官方文档怎么使用</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot">SpringBoot官网</a></li>
</ul>
</li>
<li><p>自定义版本号：</p>
</li>
</ul>
<p>1、查看spring-boot-dependencies里面规定当前依赖的版本 用的 key。 </p>
<p>2、在当前项目里面重写配置：</p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">&lt;properties&gt;</span><br>    <span class="hljs-attr">&lt;mysql.version&gt;5.1.43&lt;/mysql.version&gt;</span><br><span class="hljs-attr">&lt;/properties&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>boot中的默认包结构配置：<ul>
<li>自动配好SpringMVC<ul>
<li>引入SpringMVC全套组件</li>
<li>自动配好SpringMVC常用组件（功能）</li>
</ul>
</li>
<li>自动配好Web常见功能，如：字符编码问题<ul>
<li>SpringBoot帮我们配置好了所有web开发的常见场景</li>
</ul>
</li>
<li>默认的包结构<ul>
<li>主程序所在包及其下面的所有子包里面的组件都会被默认扫描进来</li>
</ul>
</li>
<li>无需以前的包扫描配置</li>
<li>想要改变扫描路径，@SpringBootApplication(scanBasePackages=<strong>“com.tuzi”</strong>)<ul>
<li>或者@ComponentScan 指定扫描路径</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br>等同于<br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan("com.atguigu.boot")</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>AutoConfigurer就是我们核心的自动配置包，只有引入对应的场景，对应的自动配置类才会生效嗷！！！</li>
</ul>
<h2 id="注解使用："><a href="#注解使用：" class="headerlink" title="注解使用："></a>注解使用：</h2><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><ul>
<li>这个配置类就相当于原来的xml配置文件，这个就告诉Boot这是一个配置类。</li>
<li>原来的配置类（xml）是配置好了，Spring自动给你创建好对象。现在你用配置类来配置，那当然也要手动去创建对象然后加入到容器中去啊！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">#############################Configuration使用示例######################################################<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、配置类里面使用<span class="hljs-doctag">@Bean</span>标注在方法上给容器注册组件，默认也是单实例的</span><br><span class="hljs-comment"> * 2、配置类本身也是组件</span><br><span class="hljs-comment"> * 3、proxyBeanMethods：代理bean的方法</span><br><span class="hljs-comment"> *      Full(proxyBeanMethods = true)、【保证每个<span class="hljs-doctag">@Bean</span>方法被调用多少次返回的组件都是单实例的】</span><br><span class="hljs-comment"> *      Lite(proxyBeanMethods = false)【每个<span class="hljs-doctag">@Bean</span>方法被调用多少次返回的组件都是新创建的】</span><br><span class="hljs-comment"> *      组件依赖必须使用Full模式默认。其他默认是否Lite模式</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span> <span class="hljs-comment">//告诉SpringBoot这是一个配置类 == 配置文件</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> {<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Full:外部无论对配置类中的这个组件注册方法调用多少次获取的都是之前注册容器中的单实例对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span> <span class="hljs-comment">//给容器中添加组件。以方法名作为组件的id。返回类型就是组件类型。返回的值，就是组件在容器中的实例</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user01</span><span class="hljs-params">()</span>{<br>        <span class="hljs-type">User</span> <span class="hljs-variable">zhangsan</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"zhangsan"</span>, <span class="hljs-number">18</span>);<br>        <span class="hljs-comment">//user组件依赖了Pet组件</span><br>        <span class="hljs-comment">//但是如果标注了false的话，调用tomcatPet就会新建一个tomcatPet，而不是使用容器中的tomcatPet</span><br>        zhangsan.setPet(tomcatPet());<br>        <span class="hljs-keyword">return</span> zhangsan;<br>    }<br><br>    <span class="hljs-meta">@Bean("tom")</span> <span class="hljs-comment">//tom可以给我们添加到容器中的组件命名嗷！！！</span><br>    <span class="hljs-keyword">public</span> Pet <span class="hljs-title function_">tomcatPet</span><span class="hljs-params">()</span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pet</span>(<span class="hljs-string">"tomcat"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>以前是指定&lt;bean id=”…” class=”…”&gt;，然后里面设置属性，现在就是手动去构造这个类，然后通过@Bean注解将我们构造的这个对象（返回值），来添加到容器中嗷！！！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><br>################################<span class="hljs-meta">@Configuration</span>测试代码如下########################################<br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan("com.atguigu.boot")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> {<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-comment">//1、返回我们IOC容器</span><br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> SpringApplication.run(MainApplication.class, args);<br><br>        <span class="hljs-comment">//2、查看容器里面的组件</span><br>        String[] names = run.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) {<br>            System.out.println(name);<br>        }<br><br>        <span class="hljs-comment">//3、从容器中获取组件</span><br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom01</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">"tom"</span>, Pet.class);<br><br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom02</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">"tom"</span>, Pet.class);<br><br>        System.out.println(<span class="hljs-string">"组件："</span>+(tom01 == tom02));<br><br><br>        <span class="hljs-comment">//4、com.atguigu.boot.config.MyConfig$$EnhancerBySpringCGLIB$$51f1e1ca@1654a892</span><br>        <span class="hljs-type">MyConfig</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> run.getBean(MyConfig.class);<br>        System.out.println(bean);<br><br>        <span class="hljs-comment">//如果@Configuration(proxyBeanMethods = true)代理对象调用方法。SpringBoot总会检查这个组件是否在容器中有。</span><br>        <span class="hljs-comment">//保持组件单实例</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> bean.user01();<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> bean.user01();<br>        System.out.println(user == user1);<br><br><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user01</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">"user01"</span>, User.class);<br>        <span class="hljs-type">Pet</span> <span class="hljs-variable">tom</span> <span class="hljs-operator">=</span> run.getBean(<span class="hljs-string">"tom"</span>, Pet.class);<br><br>        System.out.println(<span class="hljs-string">"用户的宠物："</span>+(user01.getPet() == tom));<br><br><br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>true又叫做lite模式，如果容器中有，就从容器中将对应的对象拿出来，就可能会产生依赖关系。false的话又被称为full模式，每一次都会生成一个新的对象，就不会产生依赖关系。</li>
</ul>
<h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><ul>
<li>可以使用在自定的MyConfig文件或其他能被扫描到的位置都可以嗷</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192105.png" srcset="/img/loading.gif" lazyload alt="image-20210713192105621"></p>
<ul>
<li><p>@Import导入的默认组件的名字是全类名嗷！！！</p>
</li>
<li><p>主方法中可以通过下面的代码进行测试：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192351.png" srcset="/img/loading.gif" lazyload alt="image-20210713192350950"></p>
<ul>
<li>第一个是获取获取特定类型的所有组件，第二个是获取对应类型的特定组件。</li>
</ul>
<h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h3><ul>
<li><p>条件装配</p>
</li>
<li><p>满足条件的时候，才能够引入其后面跟着的类嗷！！！</p>
</li>
<li><p>它和儿子们：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713192708.png" srcset="/img/loading.gif" lazyload alt="image-20210713192708656"></p>
<p>上面这些都是@Conditional和它延申出来的实现类嗷！！！</p>
<ul>
<li>例如OnBean，有某个组件的时候，才干什么行为。</li>
<li>run.containsBean()能够判断容器中是否有某个组件，根据组件名字去获取，返回值是boolean嗷！！！</li>
<li><code>@ConditionalOnBean(name = "tom")</code>这种形式是用来扫描容器中是否有名字为tom的组件。注解可以注释到某个方法或某个类上，只有判断成立，类中或者方法中相应的配置才会生效嗷！！！</li>
<li>@Bean这个始终要有的哈，没有@Bean，就算条件装配也救不了你嗷！！！</li>
</ul>
<h3 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h3><ul>
<li>导入对应的资源配置。（@ImportResource(“classpath: beans.xml”)）</li>
<li>这个注解还允许我们使用之前的xml配置，导入了对应的路径之后，这个配置就生效了嗷！！！就能够根据我们的xml以之前的形式生成对应bean，这个注解放在扫描类的最外面注解就行啦！！！</li>
</ul>
<h3 id="属性自动配置（-ComfigurationProperties）："><a href="#属性自动配置（-ComfigurationProperties）：" class="headerlink" title="属性自动配置（@ComfigurationProperties）："></a>属性自动配置（@ComfigurationProperties）：</h3><h4 id="Component-ConfigurationProperties"><a href="#Component-ConfigurationProperties" class="headerlink" title="@Component + @ConfigurationProperties"></a>@Component + @ConfigurationProperties</h4><ul>
<li><p>如果单独使用@ConfigurationProperites的话，要和@Component捆绑使用嗷！！！</p>
</li>
<li><p>使用场景是我们之前的配置文件绑定到对应的对象，我们当时要写一个类。</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">getProperties</span> {<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> FileNotFoundException, IOException {<br>         <span class="hljs-type">Properties</span> <span class="hljs-variable">pps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>         pps.load(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"a.properties"</span>));<br>         <span class="hljs-type">Enumeration</span> <span class="hljs-variable">enum1</span> <span class="hljs-operator">=</span> pps.propertyNames();<span class="hljs-comment">//得到配置文件的名字</span><br>         <span class="hljs-keyword">while</span>(enum1.hasMoreElements()) {<br>             <span class="hljs-type">String</span> <span class="hljs-variable">strKey</span> <span class="hljs-operator">=</span> (String) enum1.nextElement();<br>             <span class="hljs-type">String</span> <span class="hljs-variable">strValue</span> <span class="hljs-operator">=</span> pps.getProperty(strKey);<br>             System.out.println(strKey + <span class="hljs-string">"="</span> + strValue);<br>             <span class="hljs-comment">//封装到JavaBean。</span><br>         }<br>     }<br> }<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>上面这个就是我们之前写的，需要自己去解析配置文件，然后对应好相应的属性，封装到JavaBean中嗷！！！（有点复杂）</li>
<li>ConfigurationProperties就是帮你完成这个的嗷！！！ConfigurationProperties的例子嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 只有在容器中的组件，才会拥有SpringBoot提供的强大功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "mycar")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> {<br><br>    <span class="hljs-keyword">private</span> String brand;<br>    <span class="hljs-keyword">private</span> Integer price;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBrand</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">return</span> brand;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBrand</span><span class="hljs-params">(String brand)</span> {<br>        <span class="hljs-built_in">this</span>.brand = brand;<br>    }<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">return</span> price;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(Integer price)</span> {<br>        <span class="hljs-built_in">this</span>.price = price;<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"Car{"</span> +<br>                <span class="hljs-string">"brand='"</span> + brand + <span class="hljs-string">'\''</span> +<br>                <span class="hljs-string">", price="</span> + price +<br>                <span class="hljs-string">'}'</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>标注了Prefix之后，这个类的配置就和我们的application.properties(.yml)绑定上了嗷！！！我们就可以通过在配置文件中配置相应的属性，来对于对应的类进行配置。</li>
<li>application.properities中：</li>
</ul>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">mycar.brand</span>=<span class="hljs-string">tesla</span><br><span class="hljs-attr">mycar.price</span>=<span class="hljs-string">300000</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>注意，由于@Component，这个时候组件已经在容器中了。是可以通过@Autowired来获取对应的组件的嗷！！！</li>
</ul>
<h4 id="EnableConfigurationProperties-ConfigurationProperties"><a href="#EnableConfigurationProperties-ConfigurationProperties" class="headerlink" title="@EnableConfigurationProperties + @ConfigurationProperties"></a>@EnableConfigurationProperties + @ConfigurationProperties</h4><ul>
<li>必须在配置类中写或者在启动类中写</li>
<li>@EnableConfigurationProperties（Car.class）<ul>
<li>它的作用：<ul>
<li>开启Car的属性配置功能</li>
<li>并且把Car这个组件自动注册到容器中（这个时候就不用在对应的类上写@Component啦！！！）：<ul>
<li>解决了有的时候，别人的类是第三方写好的，上面改不了，加不了@Component注解这个问题嗷！！！</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="自动配置原理："><a href="#自动配置原理：" class="headerlink" title="自动配置原理："></a>自动配置原理：</h2><ul>
<li>一顶三（三个核心注解）：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713201014.png" srcset="/img/loading.gif" lazyload alt="image-20210713201014773"></p>
<h3 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration:"></a>@SpringBootConfiguration:</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713201128.png" srcset="/img/loading.gif" lazyload alt="image-20210713201128058"></p>
<ul>
<li>本质上就是一个@Configuration，代表当前类是一个配置类。</li>
</ul>
<h3 id="EnableAutoConfiguration-最重要"><a href="#EnableAutoConfiguration-最重要" class="headerlink" title="@EnableAutoConfiguration(最重要)"></a>@EnableAutoConfiguration(最重要)</h3><ul>
<li>由下面两个注解合成：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import({AutoConfigurationImportSelector.class})</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration {<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>@AutoConfigurationPackage:</p>
<ul>
<li>由下面的@组成：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(AutoConfigurationPackages.Registrar.class)</span>  <span class="hljs-comment">//给容器中导入一个组件</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage {}<br><br><span class="hljs-comment">//利用Registrar给容器中导入一系列组件</span><br><span class="hljs-comment">//将指定的一个包下的所有组件导入进来？MainApplication 所在包下。</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>自动配置包</li>
<li>利用Registrar给容器中导入一系列组件(这里体现了，为什么主启动类同一层级所在的包和子包都能够被Boot识别和导入嗷！！！)</li>
<li>由于ACP -&gt; EAC -&gt; SBC，因此，SBC即主配置类即AutoConfigurationPackage真正标注的地方，这个地方才导向到了我们所谓的“主配置所在层级的包，以及这个包以下的子包！！！”</li>
</ul>
</li>
<li><p>@Import({AutoConfigurationImportSelector.class})：</p>
<ul>
<li><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210713220500.png" srcset="/img/loading.gif" lazyload alt="image-20210713220500529"></p>
</li>
<li><p>上面的AutoConfigurationImportSelector的核心方法selectImports中的核心方法orz。</p>
</li>
<li><p>```java<br>1、利用getAutoConfigurationEntry(annotationMetadata);给容器中批量导入一些组件<br>2、调用List<string> configurations = getCandidateConfigurations(annotationMetadata, attributes)获取到所有需要导入到容器中的配置类<br>3、利用工厂加载 Map&lt;String, List<string>&gt; loadSpringFactories(@Nullable ClassLoader classLoader)；得到所有的组件<br>4、从META-INF/spring.factories位置来加载一个文件。<br>默认扫描我们当前系统里面所有META-INF/spring.factories位置的文件<br>spring-boot-autoconfigure-2.3.4.RELEASE.jar包里面也有META-INF/spring.factories</string></string></p>
<figure class="highlight haskell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><br>- getCandidateConfigurations这个方法很重要，获得了我们的configurations，如下图所示嗷：![image-<span class="hljs-number">20210713220752294</span>](https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/<span class="hljs-number">20210713220752</span>.png)<br><br>- ```xml<br>  文件里面写死了spring-boot一启动就要给容器中加载的所有配置类<br>  spring-boot-autoconfigure-<span class="hljs-number">2.3</span>.<span class="hljs-number">4</span>.<span class="hljs-type">RELEASE</span>.jar/<span class="hljs-type">META</span>-<span class="hljs-type">INF</span>/spring.factories<br>  # <span class="hljs-type">Auto</span> <span class="hljs-type">Configure</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-type">EnableAutoConfiguration</span>=\<br>  org.springframework.boot.autoconfigure.admin.<span class="hljs-type">SpringApplicationAdminJmxAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.aop.<span class="hljs-type">AopAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.amqp.<span class="hljs-type">RabbitAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.batch.<span class="hljs-type">BatchAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.cache.<span class="hljs-type">CacheAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.cassandra.<span class="hljs-type">CassandraAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.context.<span class="hljs-type">ConfigurationPropertiesAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.context.<span class="hljs-type">LifecycleAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.context.<span class="hljs-type">MessageSourceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.context.<span class="hljs-type">PropertyPlaceholderAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.couchbase.<span class="hljs-type">CouchbaseAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.dao.<span class="hljs-type">PersistenceExceptionTranslationAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.cassandra.<span class="hljs-type">CassandraDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.cassandra.<span class="hljs-type">CassandraReactiveDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.cassandra.<span class="hljs-type">CassandraReactiveRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.cassandra.<span class="hljs-type">CassandraRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.couchbase.<span class="hljs-type">CouchbaseDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.couchbase.<span class="hljs-type">CouchbaseReactiveDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.couchbase.<span class="hljs-type">CouchbaseReactiveRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.couchbase.<span class="hljs-type">CouchbaseRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.elasticsearch.<span class="hljs-type">ElasticsearchDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.elasticsearch.<span class="hljs-type">ElasticsearchRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.elasticsearch.<span class="hljs-type">ReactiveElasticsearchRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.elasticsearch.<span class="hljs-type">ReactiveElasticsearchRestClientAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.jdbc.<span class="hljs-type">JdbcRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.jpa.<span class="hljs-type">JpaRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.ldap.<span class="hljs-type">LdapRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.mongo.<span class="hljs-type">MongoDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.mongo.<span class="hljs-type">MongoReactiveDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.mongo.<span class="hljs-type">MongoReactiveRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.mongo.<span class="hljs-type">MongoRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.neo4j.<span class="hljs-type">Neo4jDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.neo4j.<span class="hljs-type">Neo4jRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.solr.<span class="hljs-type">SolrRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.r2dbc.<span class="hljs-type">R2dbcDataAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.r2dbc.<span class="hljs-type">R2dbcRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.r2dbc.<span class="hljs-type">R2dbcTransactionManagerAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.redis.<span class="hljs-type">RedisAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.redis.<span class="hljs-type">RedisReactiveAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.redis.<span class="hljs-type">RedisRepositoriesAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.rest.<span class="hljs-type">RepositoryRestMvcAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.<span class="hljs-class"><span class="hljs-keyword">data</span>.web.<span class="hljs-type">SpringDataWebAutoConfiguration</span>,\</span><br>  org.springframework.boot.autoconfigure.elasticsearch.<span class="hljs-type">ElasticsearchRestClientAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.flyway.<span class="hljs-type">FlywayAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.freemarker.<span class="hljs-type">FreeMarkerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.groovy.template.<span class="hljs-type">GroovyTemplateAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.gson.<span class="hljs-type">GsonAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.h2.<span class="hljs-type">H2ConsoleAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.hateoas.<span class="hljs-type">HypermediaAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.hazelcast.<span class="hljs-type">HazelcastAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.hazelcast.<span class="hljs-type">HazelcastJpaDependencyAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.http.<span class="hljs-type">HttpMessageConvertersAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.http.codec.<span class="hljs-type">CodecsAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.influx.<span class="hljs-type">InfluxDbAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.info.<span class="hljs-type">ProjectInfoAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.integration.<span class="hljs-type">IntegrationAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jackson.<span class="hljs-type">JacksonAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jdbc.<span class="hljs-type">DataSourceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jdbc.<span class="hljs-type">JdbcTemplateAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jdbc.<span class="hljs-type">JndiDataSourceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jdbc.<span class="hljs-type">XADataSourceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jdbc.<span class="hljs-type">DataSourceTransactionManagerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jms.<span class="hljs-type">JmsAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jmx.<span class="hljs-type">JmxAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jms.<span class="hljs-type">JndiConnectionFactoryAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jms.activemq.<span class="hljs-type">ActiveMQAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jms.artemis.<span class="hljs-type">ArtemisAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jersey.<span class="hljs-type">JerseyAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jooq.<span class="hljs-type">JooqAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.jsonb.<span class="hljs-type">JsonbAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.kafka.<span class="hljs-type">KafkaAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.availability.<span class="hljs-type">ApplicationAvailabilityAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.ldap.embedded.<span class="hljs-type">EmbeddedLdapAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.ldap.<span class="hljs-type">LdapAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.liquibase.<span class="hljs-type">LiquibaseAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mail.<span class="hljs-type">MailSenderAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mail.<span class="hljs-type">MailSenderValidatorAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mongo.embedded.<span class="hljs-type">EmbeddedMongoAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mongo.<span class="hljs-type">MongoAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mongo.<span class="hljs-type">MongoReactiveAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.mustache.<span class="hljs-type">MustacheAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.orm.jpa.<span class="hljs-type">HibernateJpaAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.quartz.<span class="hljs-type">QuartzAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.r2dbc.<span class="hljs-type">R2dbcAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.rsocket.<span class="hljs-type">RSocketMessagingAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.rsocket.<span class="hljs-type">RSocketRequesterAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.rsocket.<span class="hljs-type">RSocketServerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.rsocket.<span class="hljs-type">RSocketStrategiesAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.servlet.<span class="hljs-type">SecurityAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.servlet.<span class="hljs-type">UserDetailsServiceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.servlet.<span class="hljs-type">SecurityFilterAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.reactive.<span class="hljs-type">ReactiveSecurityAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.reactive.<span class="hljs-type">ReactiveUserDetailsServiceAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.rsocket.<span class="hljs-type">RSocketSecurityAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.saml2.<span class="hljs-type">Saml2RelyingPartyAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.sendgrid.<span class="hljs-type">SendGridAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.session.<span class="hljs-type">SessionAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.oauth2.client.servlet.<span class="hljs-type">OAuth2ClientAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.oauth2.client.reactive.<span class="hljs-type">ReactiveOAuth2ClientAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.<span class="hljs-type">OAuth2ResourceServerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.<span class="hljs-type">ReactiveOAuth2ResourceServerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.solr.<span class="hljs-type">SolrAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.task.<span class="hljs-type">TaskExecutionAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.task.<span class="hljs-type">TaskSchedulingAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.thymeleaf.<span class="hljs-type">ThymeleafAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.transaction.<span class="hljs-type">TransactionAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.transaction.jta.<span class="hljs-type">JtaAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.validation.<span class="hljs-type">ValidationAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.client.<span class="hljs-type">RestTemplateAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.embedded.<span class="hljs-type">EmbeddedWebServerFactoryCustomizerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.<span class="hljs-type">HttpHandlerAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.<span class="hljs-type">ReactiveWebServerFactoryAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.<span class="hljs-type">WebFluxAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.error.<span class="hljs-type">ErrorWebFluxAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.function.client.<span class="hljs-type">ClientHttpConnectorAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.reactive.function.client.<span class="hljs-type">WebClientAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.<span class="hljs-type">DispatcherServletAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.<span class="hljs-type">ServletWebServerFactoryAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.error.<span class="hljs-type">ErrorMvcAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.<span class="hljs-type">HttpEncodingAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.<span class="hljs-type">MultipartAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.web.servlet.<span class="hljs-type">WebMvcAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.websocket.reactive.<span class="hljs-type">WebSocketReactiveAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.websocket.servlet.<span class="hljs-type">WebSocketServletAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.websocket.servlet.<span class="hljs-type">WebSocketMessagingAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.webservices.<span class="hljs-type">WebServicesAutoConfiguration</span>,\<br>  org.springframework.boot.autoconfigure.webservices.client.<span class="hljs-type">WebServiceTemplateAutoConfiguration</span><br></code></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
<li><p>开启自动配置项：</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">虽然我们<span class="hljs-number">127</span>个场景的所有自动配置启动的时候默认全部加载。xxxxAutoConfiguration<br>按照条件装配规则（<span class="hljs-meta">@Conditional</span>），最终会按需配置。<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>所以，启动先加载所有的所有的配置到Configuration变量中，最终生效是由条件配置来决定的嗷！！！</li>
</ul>
<h3 id="ComponentScan-“com-tuzi-boot”"><a href="#ComponentScan-“com-tuzi-boot”" class="headerlink" title="@ComponentScan(“com.tuzi.boot”)"></a>@ComponentScan(“com.tuzi.boot”)</h3><ul>
<li>对于扫描父包路径进行指定！！！（指定扫描某些package），从中获取Bean（类似于MyConfig类中的组件），记得这个是Scan to get Components！！！</li>
</ul>
<h3 id="Skills："><a href="#Skills：" class="headerlink" title="Skills："></a>Skills：</h3><ul>
<li>回头看配置类是否能够生效，找到对应的包下的autoconfigurer文件夹，找到对应的功能（例如cache）和其对应的自动配置类（例如CacheAutoConfiguration），然后去看起的了作用不？</li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT?p=15&amp;spm_id_from=pageDriver">这一课讲的非常好，探索底层嗷！！！</a></li>
<li>特殊语法：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnBean(MultipartResolver.class)</span>  <span class="hljs-comment">//容器中有这个类型组件</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span> <span class="hljs-comment">//容器中没有这个名字 multipartResolver 的组件</span><br><span class="hljs-keyword">public</span> MultipartResolver <span class="hljs-title function_">multipartResolver</span><span class="hljs-params">(MultipartResolver resolver)</span> {<br>    <span class="hljs-comment">//给@Bean标注的方法传入了对象参数，这个参数的值就会从容器中找。</span><br>    <span class="hljs-comment">//SpringMVC multipartResolver。防止有些用户配置的文件上传解析器不符合规范</span><br>    <span class="hljs-comment">// Detect if the user has created a MultipartResolver but named it incorrectly</span><br>    <span class="hljs-keyword">return</span> resolver;<br>}<br><span class="hljs-comment">//给容器中加入了文件上传解析器，相当于更名嗷！！！</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>设计模式：</p>
<ul>
<li>通过@ConditionalOnMissingBean这种方式，来实现会在底层配好所有的组件，但是如果用户自己配置了的话，以用户的优先。</li>
<li>那用户怎么配置呢？那简单啊，你在用户的配置类中（标注有@Confuration），使用@Bean来向容器中加入我自己配置的组件，容器就不会配置默认的组件了嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean</span><br><span class="hljs-keyword">public</span> CharacterEncodingFilter <span class="hljs-title function_">characterEncodingFilter</span><span class="hljs-params">()</span> {<br>}<br></code></pre></td></tr></tbody></table></figure>




</li>
<li><p>总结：</p>
<ul>
<li>SpringBoot先加载所有的自动配置类  xxxxxAutoConfiguration</li>
<li>每个自动配置类按照条件进行生效，默认都会绑定配置文件指定的值。xxxxProperties里面拿。xxxProperties和配置文件进行了绑定</li>
<li>生效的配置类就会给容器中装配很多组件</li>
<li>只要容器中有这些组件，相当于这些功能就有了</li>
<li>定制化配置：<ul>
<li>用户直接自己@Bean替换底层的组件</li>
<li>用户去看这个组件是获取的配置文件什么值就去修改。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>xxxxxAutoConfiguration —&gt; 组件  —&gt;</strong> <strong>xxxxProperties里面拿值  —-&gt; application.properties</strong></p>
<p>两个很有意思的东西：</p>
<ul>
<li>想换掉源码中底层给你配置的某个默认配置类，使用@Bean自己写一个就完了嘛。</li>
<li>在Properties中使用绑定配置，所以可以在xxxProperties配置中找到你需要的值，然后在配置文件中去改嗷！！！</li>
</ul>
<h2 id="大彻大悟！！！上面讲的这一串太好了！！！"><a href="#大彻大悟！！！上面讲的这一串太好了！！！" class="headerlink" title="大彻大悟！！！上面讲的这一串太好了！！！"></a>大彻大悟！！！上面讲的这一串太好了！！！</h2><h2 id="最佳实践："><a href="#最佳实践：" class="headerlink" title="最佳实践："></a>最佳实践：</h2><ul>
<li><p>引入场景依赖</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></li>
</ul>
</li>
<li><p>查看自动配置了哪些（选做）</p>
<ul>
<li>自己分析，引入场景对应的自动配置一般都生效了</li>
<li>配置文件中debug=true开启自动配置报告。Negative（不生效）\Positive（生效）</li>
</ul>
</li>
<li><p>是否需要修改</p>
<ul>
<li>参照文档修改配置项<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</a></li>
<li>自己分析。xxxxProperties绑定了配置文件的哪些。</li>
</ul>
</li>
</ul>
</li>
<li><p>自定义加入或者替换组件</p>
<ul>
<li>@Bean、@Component……（用户配置优先）</li>
</ul>
</li>
<li><p>自定义器  <strong>XXXXXCustomizer</strong>；</p>
</li>
<li><p>……</p>
</li>
</ul>
<h1 id="开发小技巧："><a href="#开发小技巧：" class="headerlink" title="开发小技巧："></a>开发小技巧：</h1><h2 id="Lombok："><a href="#Lombok：" class="headerlink" title="Lombok："></a>Lombok：</h2><ul>
<li>简化JavaBean的开发：<ul>
<li>getter and setter</li>
<li>constructor</li>
<li>tostring</li>
<li>麻烦子！！！</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--idea中搜索安装lombok插件--&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>编译的时候会自动生成对应的setter和getter方法嗷！！！</li>
<li>引入了对应的插件之后，@Data这个注解就会自动帮忙在编译的时候生成getter和setter方法嗷。</li>
<li>当引入@Data时，原本灰色的属性编程紫色了，说明这个注解引入成功了嗷！！！</li>
<li>同理，@ToString就能够帮助我们在编译的时候自动生成ToString方法</li>
<li>总结，引入了Maven并且安装了lombok插件后，有如下可用的注解：<ul>
<li>@Data：getter and setter</li>
<li>@ToString：toString method</li>
<li>@NoArgsConstructor：无参构造器</li>
<li>@AllArgsConstructor：全参构造器</li>
<li>@EqualsAndHashCode：哈希码方法</li>
<li>@Slf4j：日志构造器，就可以直接使用日志啦！！！</li>
</ul>
</li>
<li>根据情况使用，比如全参不好用，那我们就不注解，除此之外，我们仍然可以定制自己的构造器嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">===============================简化JavaBean开发===================================<br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-comment">//@AllArgsConstructor</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-meta">@EqualsAndHashCode</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br><br>    <span class="hljs-keyword">private</span> Pet pet;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name,Integer age)</span>{<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    }<br><br><br>}<br><br><br><br>================================简化日志开发===================================<br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> {<br>    <span class="hljs-meta">@RequestMapping("/hello")</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handle01</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("name")</span> String name)</span>{<br>        <br>        log.info(<span class="hljs-string">"请求进来了...."</span>);<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, Spring Boot 2!"</span>+<span class="hljs-string">"你好："</span>+name;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h2 id="dev-tools："><a href="#dev-tools：" class="headerlink" title="dev-tools："></a>dev-tools：</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>Ctrl+F9</code>就能够快速实现“热更新”（本质上如果时动态文件就重启，静态页面就刷新嗷！！！）</li>
</ul>
<h2 id="Spring-Initializer："><a href="#Spring-Initializer：" class="headerlink" title="Spring Initializer："></a>Spring Initializer：</h2><ul>
<li>这个我就熟啦，不介绍啦，经常用嗷！！！</li>
<li>引入依赖，创建好了我们的项目结构嗷之类的嗷！！！</li>
</ul>
<h1 id="核心功能篇："><a href="#核心功能篇：" class="headerlink" title="核心功能篇："></a>核心功能篇：</h1><h2 id="Yaml："><a href="#Yaml：" class="headerlink" title="Yaml："></a>Yaml：</h2><ul>
<li><p>语法：</p>
<h3 id="1-2-3、数据类型"><a href="#1-2-3、数据类型" class="headerlink" title="1.2.3、数据类型"></a>1.2.3、数据类型</h3><ul>
<li>字面量：单个的、不可再分的值。date、boolean、string、number、null</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">k:</span> <span class="hljs-string">v</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>对象：键值对的集合。map、hash、set、object</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">行内写法：</span>  <span class="hljs-attr">k:</span> {<span class="hljs-string">k1:v1</span>,<span class="hljs-string">k2:v2</span>,<span class="hljs-string">k3:v3</span>}<br><span class="hljs-comment">#或</span><br><span class="hljs-attr">k:</span> <br>  <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span><br>  <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span><br>  <span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>数组：一组按次序排列的值。array、list、queue</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">行内写法：</span>  <span class="hljs-attr">k:</span> [<span class="hljs-string">v1</span>,<span class="hljs-string">v2</span>,<span class="hljs-string">v3</span>]<br><span class="hljs-comment">#或者</span><br><span class="hljs-attr">k:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v1</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v2</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>示例：</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperities(prefix="person")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {<br>	<br>	<span class="hljs-keyword">private</span> String userName;<br>	<span class="hljs-keyword">private</span> Boolean boss;<br>	<span class="hljs-keyword">private</span> Date birth;<br>	<span class="hljs-keyword">private</span> Integer age;<br>	<span class="hljs-keyword">private</span> Pet pet;<br>	<span class="hljs-keyword">private</span> String[] interests;<br>	<span class="hljs-keyword">private</span> List&lt;String&gt; animal;<br>	<span class="hljs-keyword">private</span> Map&lt;String, Object&gt; score;<br>	<span class="hljs-keyword">private</span> Set&lt;Double&gt; salarys;<br>	<span class="hljs-keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;<br>}<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pet</span> {<br>	<span class="hljs-keyword">private</span> String name;<br>	<span class="hljs-keyword">private</span> Double weight;<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>yaml和properties配置文件都存在的情况下会同时生效嗷！！！</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># yaml表示以上对象</span><br><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">userName:</span> <span class="hljs-string">zhangsan</span><br>  <span class="hljs-attr">boss:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">birth:</span> <span class="hljs-number">2019</span><span class="hljs-string">/12/12</span> <span class="hljs-number">20</span><span class="hljs-string">:12:33</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br>  <span class="hljs-attr">pet:</span> <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">tomcat</span><br>    <span class="hljs-attr">weight:</span> <span class="hljs-number">23.4</span><br>  <span class="hljs-attr">interests:</span> [<span class="hljs-string">篮球</span>,<span class="hljs-string">游泳</span>]<br>  <span class="hljs-attr">animal:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">jerry</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">mario</span><br>  <span class="hljs-attr">score:</span><br>    <span class="hljs-attr">english:</span> <br>      <span class="hljs-attr">first:</span> <span class="hljs-number">30</span><br>      <span class="hljs-attr">second:</span> <span class="hljs-number">40</span><br>      <span class="hljs-attr">third:</span> <span class="hljs-number">50</span><br>    <span class="hljs-attr">math:</span> [<span class="hljs-number">131</span>,<span class="hljs-number">140</span>,<span class="hljs-number">148</span>]<br>    <span class="hljs-attr">chinese:</span> {<span class="hljs-attr">first:</span> <span class="hljs-number">128</span>,<span class="hljs-attr">second:</span> <span class="hljs-number">136</span>}<br>  <span class="hljs-attr">salarys:</span> [<span class="hljs-number">3999</span>,<span class="hljs-number">4999.98</span>,<span class="hljs-number">5999.99</span>]<br>  <span class="hljs-attr">allPets:</span><br>    <span class="hljs-attr">sick:</span><br>      <span class="hljs-bullet">-</span> {<span class="hljs-attr">name:</span> <span class="hljs-string">tom</span>}<br>      <span class="hljs-bullet">-</span> {<span class="hljs-attr">name:</span> <span class="hljs-string">jerry</span>,<span class="hljs-attr">weight:</span> <span class="hljs-number">47</span>}<br>    <span class="hljs-attr">health:</span> [{<span class="hljs-attr">name:</span> <span class="hljs-string">mario</span>,<span class="hljs-attr">weight:</span> <span class="hljs-number">47</span>}]<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>List和String[]和Set在yaml中的配置都是一样的嗷，有行内写法和数组写法两种嗷！！！</li>
<li>测试是否书写正确：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714110023.png" srcset="/img/loading.gif" lazyload alt="image-20210714110023281"></p>
<ul>
<li>yaml中不用加单双引号，加了也没事儿，都是字符串嗷！！！但是有\n之类的，双引号就会转义为换行。单引号就不会转义而是选择作为字符串正常输出，有点像shell编程嗷！！！</li>
</ul>
<h2 id="注释处理器："><a href="#注释处理器：" class="headerlink" title="注释处理器："></a>注释处理器：</h2><ul>
<li><p>我们自己写的prefix没有提示，就很容易出问题嗷！！！自定义的类和配置文件绑定一般没有提示。</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br> <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                         <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                     <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>导入之后：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714111433.png" srcset="/img/loading.gif" lazyload alt="image-20210714111433692"></p>
<p>把项目重新跑一次，跑完之后生成了对应的meta能用了嗷！！！</p>
<ul>
<li>运行然后停止，再一次在yaml中输入对应的内容的时候，就有提示啦！！！如下图所示：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210714111749.png" srcset="/img/loading.gif" lazyload alt="image-20210714111748902"></p>
<ul>
<li>这个功能和业务无关，开发好用，部署不用。所以打包的时候将其排除在外，所以才有了下面那一段的配置，打包的时候排除了这个提示的类嗷！！！</li>
</ul>
<h2 id="Web开发："><a href="#Web开发：" class="headerlink" title="Web开发："></a>Web开发：</h2><h3 id="1、SpringMVC自动配置概览"><a href="#1、SpringMVC自动配置概览" class="headerlink" title="1、SpringMVC自动配置概览"></a>1、SpringMVC自动配置概览</h3><p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(大多场景我们都无需自定义配置)</strong></p>
<p>The auto-configuration adds the following features on top of Spring’s defaults:</p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
<ul>
<li>内容协商视图解析器和BeanName视图解析器</li>
</ul>
</li>
<li><p>Support for serving static resources, including support for WebJars (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">later in this document</a>)).</p>
<ul>
<li>静态资源（包括webjars）</li>
</ul>
</li>
<li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p>
<ul>
<li>自动注册 <code>Converter，GenericConverter，Formatter </code></li>
</ul>
</li>
<li><p>Support for <code>HttpMessageConverters</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters">later in this document</a>).</p>
<ul>
<li>支持 <code>HttpMessageConverters</code> （后来我们配合内容协商理解原理）</li>
</ul>
</li>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes">later in this document</a>).</p>
<ul>
<li>自动注册 <code>MessageCodesResolver</code> （国际化用）</li>
</ul>
</li>
<li><p>Static <code>index.html</code> support.</p>
<ul>
<li>静态index.html 页支持</li>
</ul>
</li>
<li><p>Custom <code>Favicon</code> support (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon">later in this document</a>).</p>
<ul>
<li>自定义 <code>Favicon</code></li>
</ul>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).</p>
<ul>
<li>自动使用 <code>ConfigurableWebBindingInitializer</code> ，（DataBinder负责将请求数据绑定到JavaBean上）</li>
</ul>
</li>
</ul>
<h4 id="Boot提供的自动配置方法："><a href="#Boot提供的自动配置方法：" class="headerlink" title="Boot提供的自动配置方法："></a>Boot提供的自动配置方法：</h4><blockquote>
<p>If you want to keep those Spring Boot MVC customizations and make more <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
</blockquote>
<p><strong>不用@EnableWebMvc注解。使用</strong> <code>**@Configuration**</code> <strong>+</strong> <code>**WebMvcConfigurer**</code> <strong>自定义规则</strong></p>
<blockquote>
<p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.</p>
</blockquote>
<p><strong>声明</strong> <code>**WebMvcRegistrations**</code> <strong>改变默认底层组件</strong></p>
<blockquote>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p>
</blockquote>
<p><strong>使用</strong> <code>**@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管SpringMVC**</code></p>
<h3 id="2、简单功能分析"><a href="#2、简单功能分析" class="headerlink" title="2、简单功能分析"></a>2、简单功能分析</h3><h4 id="2-1、静态资源访问"><a href="#2-1、静态资源访问" class="headerlink" title="2.1、静态资源访问"></a>2.1、静态资源访问</h4><h5 id="1、静态资源目录"><a href="#1、静态资源目录" class="headerlink" title="1、静态资源目录"></a>1、静态资源目录</h5><p>只要静态资源放在类路径下： called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code></p>
<p>浏览器访问 ： 当前项目根路径/ + 静态资源名 </p>
<p>原理： 静态映射/**。</p>
<p>请求进来，先去找<strong>Controller</strong>看能不能处理。不能处理的所有请求又都交给<strong>静态资源处理器</strong>。静态资源也找不到则响应404页面。（先动态处理，后静态处理，找不到就404）</p>
<p>改变默认的静态资源路径：解决拦截器会拦截所有页面的问题，可以通过前缀的这种方式来放行对于静态资源的请求嗷！！！</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">/res/**</span><br><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">static-locations:</span> [<span class="hljs-string">classpath:/haha/</span>]<br></code></pre></td></tr></tbody></table></figure>



<h5 id="2、静态资源访问前缀"><a href="#2、静态资源访问前缀" class="headerlink" title="2、静态资源访问前缀"></a>2、静态资源访问前缀</h5><p>默认无前缀</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">/res/**</span><br></code></pre></td></tr></tbody></table></figure>

<p>当前项目 + static-path-pattern + 静态资源名 = 静态资源文件夹下找对应的静态文件嗷！！！</p>
<h5 id="3、静态资源访问位置修改"><a href="#3、静态资源访问位置修改" class="headerlink" title="3、静态资源访问位置修改"></a>3、静态资源访问位置修改</h5><p>默认就是上面那一些，但是可以修改：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">static-locations:</span> [<span class="hljs-string">classpath:/haha/</span>]<br></code></pre></td></tr></tbody></table></figure>





<h5 id="4、webjar（使用位置）"><a href="#4、webjar（使用位置）" class="headerlink" title="4、webjar（使用位置）"></a>4、webjar（使用位置）</h5><ul>
<li>将css和js打成了jar包方便使用，例如jquery哇，就是webjar嗷！！！（提供了一些配置好的样式和行为之类的嗷！！！）</li>
<li>这一类的内容都是从专门的webjars官网上扒相关的依赖扒出来的，这种jar包有自己独特的结构。boot整合了这些jar包，并且能够访问这种结构下的静态资源，就是我们现在所见到的webjars</li>
<li>引入了新的依赖，我们需要重新加载项目进行加载嗷！！！</li>
</ul>
<p>自动映射 /<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">webjars</a>/**</p>
<p><a target="_blank" rel="noopener" href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">http://localhost:8080/webjars/<strong>jquery/3.5.1/jquery.js</strong></a>   后面地址要按照依赖里面的包路径</p>
<h4 id="2-2、欢迎页支持"><a href="#2-2、欢迎页支持" class="headerlink" title="2.2、欢迎页支持"></a>2.2、欢迎页支持</h4><ul>
<li>静态资源路径下  index.html<ul>
<li>可以配置静态资源路径</li>
<li>但是不可以配置静态资源的访问前缀。否则导致 index.html不能被默认访问</li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**   这个会导致welcome page功能失效</span><br><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">static-locations:</span> [<span class="hljs-string">classpath:/haha/</span>]<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>controller能处理/index</li>
</ul>
<h4 id="2-3、自定义-Favicon"><a href="#2-3、自定义-Favicon" class="headerlink" title="2.3、自定义 Favicon"></a>2.3、自定义 <code>Favicon</code></h4><p>favicon.ico 放在静态资源目录下即可。</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**   这个会导致 Favicon 功能失效</span><br></code></pre></td></tr></tbody></table></figure>





<h4 id="2-4、静态资源配置原理"><a href="#2-4、静态资源配置原理" class="headerlink" title="2.4、静态资源配置原理"></a>2.4、静态资源配置原理</h4><ul>
<li>SpringBoot启动默认加载  xxxAutoConfiguration 类（自动配置类）</li>
<li>SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })</span><br><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><br><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><br><span class="hljs-meta">@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><br><span class="hljs-meta">		ValidationAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfiguration</span> {}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>给容器中配了什么。</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Import(EnableWebMvcConfiguration.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties({ WebMvcProperties.class, ResourceProperties.class })</span><br><span class="hljs-meta">@Order(0)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcAutoConfigurationAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>配置文件的相关属性和xxx进行了绑定。WebMvcProperties==<strong>spring.mvc</strong>、ResourceProperties==<strong>spring.resources</strong></li>
</ul>
<h5 id="1、配置类只有一个有参构造器"><a href="#1、配置类只有一个有参构造器" class="headerlink" title="1、配置类只有一个有参构造器"></a>1、配置类只有一个有参构造器</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">	<span class="hljs-comment">//有参构造器所有参数的值都会从容器中确定</span><br><span class="hljs-comment">//ResourceProperties resourceProperties；获取和spring.resources绑定的所有的值的对象</span><br><span class="hljs-comment">//WebMvcProperties mvcProperties 获取和spring.mvc绑定的所有的值的对象</span><br><span class="hljs-comment">//ListableBeanFactory beanFactory Spring的beanFactory</span><br><span class="hljs-comment">//HttpMessageConverters 找到所有的HttpMessageConverters</span><br><span class="hljs-comment">//ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========</span><br><span class="hljs-comment">//DispatcherServletPath  </span><br><span class="hljs-comment">//ServletRegistrationBean   给应用注册Servlet、Filter....</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">WebMvcAutoConfigurationAdapter</span><span class="hljs-params">(ResourceProperties resourceProperties, WebMvcProperties mvcProperties,</span><br><span class="hljs-params">                                      ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span><br><span class="hljs-params">                                      ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span><br><span class="hljs-params">                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span><br><span class="hljs-params">                                      ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> {<br>    <span class="hljs-built_in">this</span>.resourceProperties = resourceProperties;<br>    <span class="hljs-built_in">this</span>.mvcProperties = mvcProperties;<br>    <span class="hljs-built_in">this</span>.beanFactory = beanFactory;<br>    <span class="hljs-built_in">this</span>.messageConvertersProvider = messageConvertersProvider;<br>    <span class="hljs-built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();<br>    <span class="hljs-built_in">this</span>.dispatcherServletPath = dispatcherServletPath;<br>    <span class="hljs-built_in">this</span>.servletRegistrations = servletRegistrations;<br>}<br></code></pre></td></tr></tbody></table></figure>









<h5 id="2、资源处理的默认规则"><a href="#2、资源处理的默认规则" class="headerlink" title="2、资源处理的默认规则"></a>2、资源处理的默认规则</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> {<br>    <span class="hljs-comment">//resourceProperties是从容器中拿的，静态资源访问的配置。</span><br>    <span class="hljs-comment">//如果这里整成false，往下走不了，后面所有的静态资源都生效不了嗷！！！</span><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">this</span>.resourceProperties.isAddMappings()) {<br>        logger.debug(<span class="hljs-string">"Default resource handling disabled"</span>);<br>        <span class="hljs-keyword">return</span>;<br>    }<br>    <span class="hljs-type">Duration</span> <span class="hljs-variable">cachePeriod</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.resourceProperties.getCache().getPeriod();<br>    <span class="hljs-type">CacheControl</span> <span class="hljs-variable">cacheControl</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();<br>    <span class="hljs-comment">//webjars的规则</span><br>    <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(<span class="hljs-string">"/webjars/**"</span>)) {<br>        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-string">"/webjars/**"</span>)<br>     .addResourceLocations(<span class="hljs-string">"classpath:/META-INF/resources/webjars/"</span>)<br>                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>    }<br><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">staticPathPattern</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern();<br>    <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) {<br>        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)<br>                                             .addResourceLocations(getResourceLocations(<span class="hljs-built_in">this</span>.resourceProperties.getStaticLocations()))<br>                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>    }<br>}<br><br></code></pre></td></tr></tbody></table></figure>



<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-comment">#  mvc:</span><br><span class="hljs-comment">#    static-path-pattern: /res/**</span><br><br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment"># 禁用所有静态资源规则</span><br><span class="hljs-string">@ConfigurationProperties(prefix</span> <span class="hljs-string">=</span> <span class="hljs-string">"spring.resources"</span><span class="hljs-string">,</span> <span class="hljs-string">ignoreUnknownFields</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span><span class="hljs-string">)</span><br><span class="hljs-string">public</span> <span class="hljs-string">class</span> <span class="hljs-string">ResourceProperties</span> {<br><br>	<span class="hljs-string">private</span> <span class="hljs-string">static</span> <span class="hljs-string">final</span> <span class="hljs-string">String</span>[] <span class="hljs-string">CLASSPATH_RESOURCE_LOCATIONS</span> <span class="hljs-string">=</span> { <span class="hljs-string">"classpath:/META-INF/resources/"</span>,<br>			<span class="hljs-string">"classpath:/resources/"</span>, <span class="hljs-string">"classpath:/static/"</span>, <span class="hljs-string">"classpath:/public/"</span> }<span class="hljs-string">;</span><br><br>	<span class="hljs-string">/**</span><br>	 <span class="hljs-string">*</span> <span class="hljs-string">Locations</span> <span class="hljs-string">of</span> <span class="hljs-string">static</span> <span class="hljs-string">resources.</span> <span class="hljs-string">Defaults</span> <span class="hljs-string">to</span> <span class="hljs-string">classpath:</span>[<span class="hljs-string">/META-INF/resources/</span>,<br>	 <span class="hljs-string">*</span> <span class="hljs-string">/resources/</span>, <span class="hljs-string">/static/</span>, <span class="hljs-string">/public/</span>]<span class="hljs-string">.</span><br>	 <span class="hljs-string">*/</span><br>	<span class="hljs-string">//private</span> <span class="hljs-string">String</span>[] <span class="hljs-string">staticLocations</span> <span class="hljs-string">=</span> <span class="hljs-string">CLASSPATH_RESOURCE_LOCATIONS;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="3、欢迎页的处理规则"><a href="#3、欢迎页的处理规则" class="headerlink" title="3、欢迎页的处理规则"></a>3、欢迎页的处理规则</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//HandlerMapping：处理器映射。保存了每一个Handler能处理哪些请求。（非常重要的组件，用不同的处理方法处理不同的请求）	</span><br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-comment">//下面参数中的这些东西都是从容器中拿出来嗷！！！</span><br><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title function_">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext,</span><br><span class="hljs-params">FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> {<br>    <span class="hljs-type">WelcomePageHandlerMapping</span> <span class="hljs-variable">welcomePageHandlerMapping</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WelcomePageHandlerMapping</span>(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),<br>    <span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern());<br>    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));<br>    welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());<br>    <span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>}<br><br>WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,<br>ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) {<br>    <span class="hljs-keyword">if</span> (welcomePage.isPresent() &amp;&amp; <span class="hljs-string">"/**"</span>.equals(staticPathPattern)) {<br>    <span class="hljs-comment">//要用欢迎页功能，必须是/**</span><br>    logger.info(<span class="hljs-string">"Adding welcome page: "</span> + welcomePage.get());<br>    setRootViewName(<span class="hljs-string">"forward:index.html"</span>);<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) {<br>    <span class="hljs-comment">// 调用Controller  /index</span><br>    logger.info(<span class="hljs-string">"Adding welcome page template: index"</span>);<br>    setRootViewName(<span class="hljs-string">"index"</span>);S<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>



<h5 id="4、favicon"><a href="#4、favicon" class="headerlink" title="4、favicon"></a>4、favicon</h5><h3 id="3、请求参数处理"><a href="#3、请求参数处理" class="headerlink" title="3、请求参数处理"></a>3、请求参数处理</h3><h4 id="0、请求映射"><a href="#0、请求映射" class="headerlink" title="0、请求映射"></a>0、请求映射</h4><h5 id="0-1、rest使用与原理"><a href="#0-1、rest使用与原理" class="headerlink" title="0.1、rest使用与原理"></a>0.1、rest使用与原理</h5><ul>
<li>@xxxMapping；<ul>
<li>Rest风格支持（<em>使用<strong>HTTP</strong>请求方式动词来表示对资源的操作</em>）</li>
<li><em>以前：</em><em>/getUser</em>  <em>获取用户</em>    <em>/deleteUser</em> <em>删除用户</em>   <em>/editUser</em>  <em>修改用户</em>      <em>/saveUser</em> <em>保存用户</em></li>
<li><em>现在： /user</em>    *GET-*<em>获取用户</em>    *DELETE-*<em>删除用户</em>     *PUT-*<em>修改用户</em>      *POST-*<em>保存用户</em></li>
<li>核心Filter；HiddenHttpMethodFilter<ul>
<li>用法： 表单method=post，隐藏域 _method=put</li>
<li>SpringBoot中手动开启</li>
</ul>
</li>
<li>扩展：如何把_method 这个名字换成我们自己喜欢的。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = "/user",method = RequestMethod.GET)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"GET-张三"</span>;<br>}<br><br><span class="hljs-meta">@RequestMapping(value = "/user",method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">saveUser</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"POST-张三"</span>;<br>}<br><br><br><span class="hljs-meta">@RequestMapping(value = "/user",method = RequestMethod.PUT)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">putUser</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"PUT-张三"</span>;<br>}<br><br><span class="hljs-meta">@RequestMapping(value = "/user",method = RequestMethod.DELETE)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"DELETE-张三"</span>;<br>}<br><br><br><span class="hljs-meta">@Bean</span>	<br><span class="hljs-meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span><br><span class="hljs-meta">@ConditionalOnProperty(prefix = "spring.mvc.hiddenmethod.filter", name = "enabled", matchIfMissing = false)</span><br><span class="hljs-keyword">public</span> OrderedHiddenHttpMethodFilter <span class="hljs-title function_">hiddenHttpMethodFilter</span><span class="hljs-params">()</span> {<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderedHiddenHttpMethodFilter</span>();<br>}<br><br><br><span class="hljs-comment">//自定义filter(主要是_method的解析，将自己写的加入到配置类中去从而加入到容器中去，而不用容器为我们生成嗷！！！注意，这里自己定义的容器，可以参照默认的容器来改嗷！！！)</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> HiddenHttpMethodFilter <span class="hljs-title function_">hiddenHttpMethodFilter</span><span class="hljs-params">()</span>{<br>    <span class="hljs-type">HiddenHttpMethodFilter</span> <span class="hljs-variable">methodFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HiddenHttpMethodFilter</span>();<br>    <span class="hljs-comment">//这里新建一个Filter，然后改变里面这个Filter的的MethodParam嗷！！！</span><br>    methodFilter.setMethodParam(<span class="hljs-string">"_m"</span>);<br>    <span class="hljs-keyword">return</span> methodFilter;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>Rest原理（表单提交要使用REST的时候）</p>
<ul>
<li>表单提交会带上**_method=PUT**</li>
<li><strong>请求过来被</strong>HiddenHttpMethodFilter拦截<ul>
<li>请求是否正常，并且是POST:<ul>
<li>获取到**_method**的值。</li>
<li>兼容以下请求；<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong></li>
<li><strong>原生request（post），包装模式requesWrapper重写了getMethod方法，返回的是传入的值。</strong></li>
<li><strong>过滤器链放行的时候用wrapper（原request的包装类，主要是重写了getMethod方法）。以后的方法调用getMethod是调用requesWrapper的。</strong></li>
</ul>
</li>
</ul>
</li>
<li>本质上就是Filter传入参数（原request和request带有的_method的值），重新构造一个“带有_method方法的request”，作为包装后的request嗷！！！</li>
</ul>
<p><strong>Rest使用客户端工具，</strong></p>
<ul>
<li>如PostMan直接发送Put、delete等方式请求，无需Filter。（表单的Http层只有Get和Post，因此需要Filter的处理。而PostMan等客户端可以直接在Http层发送类似于Put这样的请求，因此就不需要Filter的处理了嗷！！！）</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">hiddenmethod:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment">#开启页面表单的Rest功能</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>上面这一段是可以根据<code>OrderedHiddenHttpMethodFilter</code>的源码看到的嗷，只有配置了以上的配置，才能够使得我们Rest风格生效嗷！！！</p>
</li>
<li><p>前后端分离，Rest风格必须要掌握嗷！！！</p>
</li>
<li><p>新的东西嗷！！！</p>
<ul>
<li>@GetMapping</li>
<li>@PostMapping</li>
<li>@PutMapping</li>
<li>@DeleteMapping</li>
</ul>
</li>
</ul>
<h5 id="0-2、请求映射原理"><a href="#0-2、请求映射原理" class="headerlink" title="0.2、请求映射原理"></a>0.2、请求映射原理</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181171918-b8acfb93-4914-4208-9943-b37610e93864.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>SpringMVC功能分析都从 org.springframework.web.servlet.DispatcherServlet     -&gt;doDispatch（）</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception {<br>    <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br>    <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br><br>    <span class="hljs-keyword">try</span> {<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">try</span> {<br>        processedRequest = checkMultipart(request);<br>        multipartRequestParsed = (processedRequest != request);<br><br>        <span class="hljs-comment">// 找到当前请求使用哪个Handler（Controller的方法）处理，Handler其实就是我们编写的Controller，对应的方法嗷！！！</span><br>        mappedHandler = getHandler(processedRequest);<br><br>        <span class="hljs-comment">//HandlerMapping：处理器映射。/xxx-&gt;&gt;xxxx</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181460034-ba25f3c0-9cfd-4432-8949-3d1dd88d8b12.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><strong>RequestMappingHandlerMapping</strong>：保存了所有@RequestMapping 和handler的映射规则。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603181662070-9e526de8-fd78-4a02-9410-728f059d6aef.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>所有的请求映射都在HandlerMapping中（SpringBoot默人的和我们配置的都有嗷！！！）</p>
<ul>
<li><p>SpringBoot自动配置欢迎页的 WelcomePageHandlerMapping 。访问 /能访问到index.html；</p>
</li>
<li><p>SpringBoot自动配置了默认 的 RequestMappingHandlerMapping</p>
</li>
<li><p>请求进来，挨个尝试所有的HandlerMapping看是否有请求信息。</p>
</li>
<li><p>如果有就找到这个请求对应的handler</p>
</li>
<li><p>如果没有就是下一个 HandlerMapping</p>
</li>
<li><p>我们需要一些自定义的映射处理，我们也可以自己给容器中放<strong>HandlerMapping</strong>。自定义 <strong>HandlerMapping</strong>（使用场景比如：不同版本情况下，大量的配置规则需要更改。这个时候我们就可以自定义HandlerMapping来指定处理的请求和其对应的Handler）</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> HandlerExecutionChain <span class="hljs-title function_">getHandler</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception {<br>	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings != <span class="hljs-literal">null</span>) {<br>		<span class="hljs-keyword">for</span> (HandlerMapping mapping : <span class="hljs-built_in">this</span>.handlerMappings) {<br>            <span class="hljs-comment">//这个getHandler就直接帮助我们找到了对应的Controller，就很有意思</span><br>			<span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> mapping.getHandler(request);<br>			<span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) {<br>				<span class="hljs-keyword">return</span> handler;<br>			}<br>		}<br>	}<br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>







<h4 id="1、普通参数与基本注解"><a href="#1、普通参数与基本注解" class="headerlink" title="1、普通参数与基本注解"></a>1、普通参数与基本注解</h4><h5 id="1-1、注解："><a href="#1-1、注解：" class="headerlink" title="1.1、注解："></a>1.1、注解：</h5><p>@PathVariable、@RequestHeader、@ModelAttribute、@RequestParam、@MatrixVariable、@CookieValue、@RequestBody、@RequestAttribute</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterTestController</span> {<br><br>	<span class="hljs-comment">//下面这些都是rest风格中常用的嗷！！！</span><br>    <span class="hljs-comment">//car/2/owner/zhangsan</span><br>    <span class="hljs-comment">//注意Map的用法嗷，可以一次把所有的路径变量都提取出来嗷！！！</span><br>    <span class="hljs-comment">//请求头的用法和其他的感觉都是一样的嗷！！！</span><br>    <span class="hljs-meta">@GetMapping("/car/{id}/owner/{username}")</span><br>    <span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">getCar</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Integer id,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable("username")</span> String name,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@PathVariable</span> Map&lt;String,String&gt; pv,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader("User-Agent")</span> String userAgent,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestHeader</span> Map&lt;String,String&gt; header,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam("age")</span> Integer age,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam("inters")</span> List&lt;String&gt; inters,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@RequestParam</span> Map&lt;String,String&gt; params,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue("_ga")</span> String _ga,</span><br><span class="hljs-params">                                     <span class="hljs-meta">@CookieValue("_ga")</span> Cookie cookie)</span>{<br><br><br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br><span class="hljs-comment">//        map.put("id",id);</span><br><span class="hljs-comment">//        map.put("name",name);</span><br><span class="hljs-comment">//        map.put("pv",pv);</span><br><span class="hljs-comment">//        map.put("userAgent",userAgent);</span><br><span class="hljs-comment">//        map.put("headers",header);</span><br>        map.put(<span class="hljs-string">"age"</span>,age);<br>        map.put(<span class="hljs-string">"inters"</span>,inters);<br>        map.put(<span class="hljs-string">"params"</span>,params);<br>        map.put(<span class="hljs-string">"_ga"</span>,_ga);<br>        System.out.println(cookie.getName()+<span class="hljs-string">"===&gt;"</span>+cookie.getValue());<br>        <span class="hljs-keyword">return</span> map;<br>    }<br><br><span class="hljs-comment">//这里直接获得请求体中的数据嗷！！！</span><br>    <span class="hljs-meta">@PostMapping("/save")</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">postMethod</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String content)</span>{<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">"content"</span>,content);<br>        <span class="hljs-keyword">return</span> map;<br>    }<br><br><br>    <span class="hljs-comment">//1、语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</span><br>    <span class="hljs-comment">//2、SpringBoot默认是禁用了矩阵变量的功能</span><br>    <span class="hljs-comment">//手动开启：原理。对于路径的处理UrlPathHelper进行解析。</span><br>    <span class="hljs-comment">//removeSemicolonContent（移除分号内容）支持矩阵变量的</span><br>    <span class="hljs-comment">//3、矩阵变量必须有url路径变量才能被解析,从获取到的路径来看，矩阵变量并不算url的一部分！！！</span><br>    <span class="hljs-meta">@GetMapping("/cars/{path}")</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">carsSell</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable("low")</span> Integer low,</span><br><span class="hljs-params">                        <span class="hljs-meta">@MatrixVariable("brand")</span> List&lt;String&gt; brand,</span><br><span class="hljs-params">                        <span class="hljs-meta">@PathVariable("path")</span> String path)</span>{<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        map.put(<span class="hljs-string">"low"</span>,low);<br>        map.put(<span class="hljs-string">"brand"</span>,brand);<br>        map.put(<span class="hljs-string">"path"</span>,path);<br>        <span class="hljs-keyword">return</span> map;<br>    }<br><br>    <span class="hljs-comment">// /boss/1;age=20/2;age=10</span><br>	<span class="hljs-comment">// 有两个路径变量，同时matrix中也有两个嗷！！！因此可以通过不同的pathVar来获得不同的值嗷！！！不指定的话，默认获取的都是第一个的值嗷！！！</span><br>    <span class="hljs-meta">@GetMapping("/boss/{bossId}/{empId}")</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">boss</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(value = "age",pathVar = "bossId")</span> Integer bossAge,</span><br><span class="hljs-params">                    <span class="hljs-meta">@MatrixVariable(value = "age",pathVar = "empId")</span> Integer empAge)</span>{<br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        map.put(<span class="hljs-string">"bossAge"</span>,bossAge);<br>        map.put(<span class="hljs-string">"empAge"</span>,empAge);<br>        <span class="hljs-keyword">return</span> map;<br><br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>@RequestAttribute一般用在页面跳转的时候，request.set之后，forward到不同的页面，然后request.get拿出来对应的属性进行处理。这个时候，就可以用到@RequestAttribute直接以参数的形式拿到对应的参数，方便进一步进行处理嗷！！！</li>
<li>矩阵变量：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715102235.png" srcset="/img/loading.gif" lazyload alt="image-20210715102235551"></p>
<ul>
<li><p>由于我们的boot自动关闭了这个功能，我们需要重写底层的一些东西来打开矩阵处理对应的功能嗷！！！</p>
</li>
<li><p>手动开启Matrix的两种方式：</p>
</li>
</ul>
<ol>
<li>使用@Bean向容器中放上一个WebMvcConfigurer类型的组件：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715104704.png" srcset="/img/loading.gif" lazyload alt="image-20210715104704788"></p>
<ol start="2">
<li>让配置类实现WebMvcConfigurer接口，修改我们要修改的方法即可：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210715104535.png" srcset="/img/loading.gif" lazyload alt="image-20210715104535073"></p>
<ul>
<li><p>上面两个的本质是一样的嗷！！！都是向容器中加了一个WebMvcConfigurer组件而已，一个是通过继承加上@Configuration添加的。另外一个是在@Configuration下的@Bean中添加的嗷！！！</p>
</li>
<li><p>原理讲解都是从dispatcherServlet的doDispatch方法开始的嗷，我们一定要注意嗷！！！这个才是核心方法嗷！！！</p>
</li>
</ul>
<h5 id="1-2、Servlet-API："><a href="#1-2、Servlet-API：" class="headerlink" title="1.2、Servlet API："></a>1.2、Servlet API：</h5><p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p>
<p><strong>ServletRequestMethodArgumentResolver  以上的部分参数</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {<br>		Class&lt;?&gt; paramType = parameter.getParameterType();<br>		<span class="hljs-keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||<br>				ServletRequest.class.isAssignableFrom(paramType) ||<br>				MultipartRequest.class.isAssignableFrom(paramType) ||<br>				HttpSession.class.isAssignableFrom(paramType) ||<br>				(pushBuilder != <span class="hljs-literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||<br>				Principal.class.isAssignableFrom(paramType) ||<br>				InputStream.class.isAssignableFrom(paramType) ||<br>				Reader.class.isAssignableFrom(paramType) ||<br>				HttpMethod.class == paramType ||<br>				Locale.class == paramType ||<br>				TimeZone.class == paramType ||<br>				ZoneId.class == paramType);<br>	}<br></code></pre></td></tr></tbody></table></figure>



<h5 id="1-3、复杂参数："><a href="#1-3、复杂参数：" class="headerlink" title="1.3、复杂参数："></a>1.3、复杂参数：</h5><ul>
<li><p>Model很重要，Model可以设置全局的值，model中设置的值最终会被放到request的请求域中嗷！！！</p>
</li>
<li><p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域  request.setAttribute）、</strong>Errors/BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String,Object&gt; map,  Model model, HttpServletRequest request 都是可以给request域中放数据，<br>request.getAttribute();<br></code></pre></td></tr></tbody></table></figure>

<p><strong>Map、Model类型的参数</strong>，会返回 mavContainer.getModel（）；—&gt; BindingAwareModelMap 是Model 也是Map</p>
<ul>
<li>Map和Model的底层本质上都是调用的<strong>mavContainer</strong>.getModel(); 获取到值的</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271442869-63b4c3c7-c721-4074-987d-cbe5999273ae.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271678813-d8e1a1e5-94fa-412c-a7f1-6f27174fd127.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603271813894-037be041-92a5-49af-a49c-c350b3dd587a.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>所有的数据都放在了ModelAndView中嗷，操作都是对于ModelAndView的更新</li>
</ul>
<h5 id="1-4、自定义对象参数："><a href="#1-4、自定义对象参数：" class="headerlink" title="1.4、自定义对象参数："></a>1.4、自定义对象参数：</h5><p>可以自动类型转换与格式化，可以级联封装。</p>
<ul>
<li>使用级联封装，Boot可以帮助我们直接进行对象的封装，封装好的对象作为参数传入到对应的Controller方法中！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *     姓名： &lt;input name="userName"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     年龄： &lt;input name="age"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     生日： &lt;input name="birth"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     宠物姓名：&lt;input name="pet.name"/&gt;&lt;br/&gt;</span><br><span class="hljs-comment"> *     宠物年龄：&lt;input name="pet.age"/&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {<br>    <br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Pet pet;<br>    <br>}<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pet</span> {<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String age;<br><br>}<br><br>result<br></code></pre></td></tr></tbody></table></figure>



<h4 id="2、POJO封装过程"><a href="#2、POJO封装过程" class="headerlink" title="2、POJO封装过程"></a>2、POJO封装过程</h4><ul>
<li><p><strong>ServletModelAttributeMethodProcessor</strong></p>
</li>
<li><p>查看3.5.3嗷！！！</p>
</li>
</ul>
<h4 id="3、参数处理原理"><a href="#3、参数处理原理" class="headerlink" title="3、参数处理原理"></a>3、参数处理原理</h4><ul>
<li><p>DispatcherServlet和其中的doDispatch方法很重要嗷！！！</p>
</li>
<li><p>HandlerMapping中找到能处理请求的Handler（Controller.method()）</p>
</li>
<li><p>为当前Handler 找一个适配器 HandlerAdapter； <strong>RequestMappingHandlerAdapter</strong></p>
</li>
<li><p>适配器执行目标方法并确定方法参数的每一个值</p>
</li>
</ul>
<h5 id="3-1、HandlerAdapter"><a href="#3-1、HandlerAdapter" class="headerlink" title="3.1、HandlerAdapter"></a>3.1、HandlerAdapter</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603262942726-107353bd-f8b7-44f6-93cf-2a3cad4093cf.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>0 - 支持方法上标注@RequestMapping </p>
<p>1 - 支持函数式编程的</p>
<p>xxxxxx</p>
<h5 id="3-2、执行目标方法"><a href="#3-2、执行目标方法" class="headerlink" title="3.2、执行目标方法"></a>3.2、执行目标方法</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Actually invoke the handler.</span><br><span class="hljs-comment">//DispatcherServlet -- doDispatch</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br>mav = invokeHandlerMethod(request, response, handlerMethod); <span class="hljs-comment">//执行目标方法</span><br><br><br><span class="hljs-comment">//ServletInvocableHandlerMethod</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);<br><span class="hljs-comment">//获取方法的参数值</span><br>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);<br></code></pre></td></tr></tbody></table></figure>

<h5 id="3-3、参数解析器-HandlerMethodArgumentResolver"><a href="#3-3、参数解析器-HandlerMethodArgumentResolver" class="headerlink" title="3.3、参数解析器-HandlerMethodArgumentResolver"></a>3.3、参数解析器-HandlerMethodArgumentResolver</h5><p>确定将要执行的目标方法的每一个参数的值是什么;</p>
<p>SpringMVC目标方法能写多少种参数类型。取决于参数解析器。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263283504-85bbd4d5-a9af-4dbf-b6a2-30b409868774.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263394724-33122714-9d06-42ec-bf45-e440e8b49c05.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>当前解析器是否支持解析这种参数</li>
<li>支持就调用 resolveArgument</li>
</ul>
<h5 id="3-4、返回值处理器"><a href="#3-4、返回值处理器" class="headerlink" title="3.4、返回值处理器"></a>3.4、返回值处理器</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603263524227-386da4be-43b1-4b17-a2cc-8cf886346af9.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="3-5、如何确定目标方法每一个参数的值"><a href="#3-5、如何确定目标方法每一个参数的值" class="headerlink" title="3.5、如何确定目标方法每一个参数的值"></a>3.5、如何确定目标方法每一个参数的值</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java">============InvocableHandlerMethod==========================<br><span class="hljs-keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,<br>			Object... providedArgs) <span class="hljs-keyword">throws</span> Exception {<br><br>		MethodParameter[] parameters = getMethodParameters();<br>		<span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(parameters)) {<br>			<span class="hljs-keyword">return</span> EMPTY_ARGS;<br>		}<br><br>		Object[] args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[parameters.length];<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; parameters.length; i++) {<br>			<span class="hljs-type">MethodParameter</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> parameters[i];<br>			parameter.initParameterNameDiscovery(<span class="hljs-built_in">this</span>.parameterNameDiscoverer);<br>			args[i] = findProvidedArgument(parameter, providedArgs);<br>			<span class="hljs-keyword">if</span> (args[i] != <span class="hljs-literal">null</span>) {<br>				<span class="hljs-keyword">continue</span>;<br>			}<br>			<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.resolvers.supportsParameter(parameter)) {<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="hljs-string">"No suitable resolver"</span>));<br>			}<br>			<span class="hljs-keyword">try</span> {<br>				args[i] = <span class="hljs-built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="hljs-built_in">this</span>.dataBinderFactory);<br>			}<br>			<span class="hljs-keyword">catch</span> (Exception ex) {<br>				<span class="hljs-comment">// Leave stack trace for later, exception may actually be resolved and handled...</span><br>				<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {<br>					<span class="hljs-type">String</span> <span class="hljs-variable">exMsg</span> <span class="hljs-operator">=</span> ex.getMessage();<br>					<span class="hljs-keyword">if</span> (exMsg != <span class="hljs-literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) {<br>						logger.debug(formatArgumentError(parameter, exMsg));<br>					}<br>				}<br>				<span class="hljs-keyword">throw</span> ex;<br>			}<br>		}<br>		<span class="hljs-keyword">return</span> args;<br>	}<br></code></pre></td></tr></tbody></table></figure>

<h6 id="3-5-1、挨个判断所有参数解析器那个支持解析这个参数"><a href="#3-5-1、挨个判断所有参数解析器那个支持解析这个参数" class="headerlink" title="3.5.1、挨个判断所有参数解析器那个支持解析这个参数"></a>3.5.1、挨个判断所有参数解析器那个支持解析这个参数</h6><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">private</span> HandlerMethodArgumentResolver <span class="hljs-title function_">getArgumentResolver</span><span class="hljs-params">(MethodParameter parameter)</span> {<br>    <span class="hljs-type">HandlerMethodArgumentResolver</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.argumentResolverCache.get(parameter);<br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) {<br>        <span class="hljs-keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="hljs-built_in">this</span>.argumentResolvers) {<br>            <span class="hljs-keyword">if</span> (resolver.supportsParameter(parameter)) {<br>                result = resolver;<br>                <span class="hljs-built_in">this</span>.argumentResolverCache.put(parameter, result);<br>                <span class="hljs-keyword">break</span>;<br>            }<br>        }<br>    }<br>    <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></tbody></table></figure>

<h6 id="3-5-2、解析这个参数的值"><a href="#3-5-2、解析这个参数的值" class="headerlink" title="3.5.2、解析这个参数的值"></a>3.5.2、解析这个参数的值</h6><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">调用各自 HandlerMethodArgumentResolver 的 resolveArgument 方法即可<br></code></pre></td></tr></tbody></table></figure>

<h6 id="3-5-3、自定义类型参数-封装POJO"><a href="#3-5-3、自定义类型参数-封装POJO" class="headerlink" title="3.5.3、自定义类型参数 封装POJO"></a>3.5.3、自定义类型参数 封装POJO</h6><p><strong>ServletModelAttributeMethodProcessor  这个参数处理器支持</strong></p>
<p> <strong>是否为简单类型。</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSimpleValueType</span><span class="hljs-params">(Class&lt;?&gt; type)</span> {<br>		<span class="hljs-keyword">return</span> (Void.class != type &amp;&amp; <span class="hljs-keyword">void</span>.class != type &amp;&amp;<br>				(ClassUtils.isPrimitiveOrWrapper(type) ||<br>				Enum.class.isAssignableFrom(type) ||<br>				CharSequence.class.isAssignableFrom(type) ||<br>				Number.class.isAssignableFrom(type) ||<br>				Date.class.isAssignableFrom(type) ||<br>				Temporal.class.isAssignableFrom(type) ||<br>				URI.class == type ||<br>				URL.class == type ||<br>				Locale.class == type ||<br>				Class.class == type));<br>	}<br><span class="hljs-meta">@Override</span><br>	<span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, <span class="hljs-meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="hljs-params">                                    NativeWebRequest webRequest, <span class="hljs-meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {<br><br>    Assert.state(mavContainer != <span class="hljs-literal">null</span>, <span class="hljs-string">"ModelAttributeMethodProcessor requires ModelAndViewContainer"</span>);<br>    Assert.state(binderFactory != <span class="hljs-literal">null</span>, <span class="hljs-string">"ModelAttributeMethodProcessor requires WebDataBinderFactory"</span>);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> ModelFactory.getNameForParameter(parameter);<br>    <span class="hljs-type">ModelAttribute</span> <span class="hljs-variable">ann</span> <span class="hljs-operator">=</span> parameter.getParameterAnnotation(ModelAttribute.class);<br>    <span class="hljs-keyword">if</span> (ann != <span class="hljs-literal">null</span>) {<br>        mavContainer.setBinding(name, ann.binding());<br>    }<br><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">attribute</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">BindingResult</span> <span class="hljs-variable">bindingResult</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">if</span> (mavContainer.containsAttribute(name)) {<br>        attribute = mavContainer.getModel().get(name);<br>    }<br>    <span class="hljs-keyword">else</span> {<br>        <span class="hljs-comment">// Create attribute instance</span><br>        <span class="hljs-keyword">try</span> {<br>            attribute = createAttribute(name, parameter, binderFactory, webRequest);<br>        }<br>        <span class="hljs-keyword">catch</span> (BindException ex) {<br>            <span class="hljs-keyword">if</span> (isBindExceptionRequired(parameter)) {<br>                <span class="hljs-comment">// No BindingResult parameter -&gt; fail with BindException</span><br>                <span class="hljs-keyword">throw</span> ex;<br>            }<br>            <span class="hljs-comment">// Otherwise, expose null/empty value and associated BindingResult</span><br>            <span class="hljs-keyword">if</span> (parameter.getParameterType() == Optional.class) {<br>                attribute = Optional.empty();<br>            }<br>            bindingResult = ex.getBindingResult();<br>        }<br>    }<br><br>    <span class="hljs-keyword">if</span> (bindingResult == <span class="hljs-literal">null</span>) {<br>        <span class="hljs-comment">// Bean property binding and validation;</span><br>        <span class="hljs-comment">// skipped in case of binding failure on construction.</span><br>        <span class="hljs-type">WebDataBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> binderFactory.createBinder(webRequest, attribute, name);<br>        <span class="hljs-keyword">if</span> (binder.getTarget() != <span class="hljs-literal">null</span>) {<br>            <span class="hljs-keyword">if</span> (!mavContainer.isBindingDisabled(name)) {<br>                bindRequestParameters(binder, webRequest);<br>            }<br>            validateIfApplicable(binder, parameter);<br>            <span class="hljs-keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) {<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindException</span>(binder.getBindingResult());<br>            }<br>        }<br>        <span class="hljs-comment">// Value type adaptation, also covering java.util.Optional</span><br>        <span class="hljs-keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) {<br>            attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);<br>        }<br>        bindingResult = binder.getBindingResult();<br>    }<br><br>    <span class="hljs-comment">// Add resolved attribute and BindingResult at the end of the model</span><br>    Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();<br>    mavContainer.removeAttributes(bindingResultModel);<br>    mavContainer.addAllAttributes(bindingResultModel);<br><br>    <span class="hljs-keyword">return</span> attribute;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><strong>WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</strong></p>
<p><strong>WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</strong></p>
<p><strong>WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</strong></p>
<p><strong>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean – Integer）</strong></p>
<p><strong>byte – &gt; file</strong></p>
<p>@FunctionalInterface<strong>public interface</strong> Converter&lt;S, T&gt;</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603337871521-25fc1aa1-133a-4ce0-a146-d565633d7658.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603338486441-9bbd22a9-813f-49bd-b51b-e66c7f4b8598.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>未来我们可以给WebDataBinder里面放自己的Converter；</p>
<p><strong>private static final class</strong> StringToNumber&lt;T **extends** Number&gt; <strong>implements</strong> Converter&lt;String, T&gt;</p>
<p>自定义 Converter</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1、WebMvcConfigurer定制化SpringMVC的功能</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() {<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> {<br>            <span class="hljs-type">UrlPathHelper</span> <span class="hljs-variable">urlPathHelper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlPathHelper</span>();<br>            <span class="hljs-comment">// 不移除；后面的内容。矩阵变量功能就可以生效</span><br>            urlPathHelper.setRemoveSemicolonContent(<span class="hljs-literal">false</span>);<br>            configurer.setUrlPathHelper(urlPathHelper);<br>        }<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFormatters</span><span class="hljs-params">(FormatterRegistry registry)</span> {<br>            registry.addConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Converter</span>&lt;String, Pet&gt;() {<br><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> Pet <span class="hljs-title function_">convert</span><span class="hljs-params">(String source)</span> {<br>                    <span class="hljs-comment">// 啊猫,3</span><br>                    <span class="hljs-keyword">if</span>(!StringUtils.isEmpty(source)){<br>                        <span class="hljs-type">Pet</span> <span class="hljs-variable">pet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pet</span>();<br>                        String[] split = source.split(<span class="hljs-string">","</span>);<br>                        pet.setName(split[<span class="hljs-number">0</span>]);<br>                        pet.setAge(Integer.parseInt(split[<span class="hljs-number">1</span>]));<br>                        <span class="hljs-keyword">return</span> pet;<br>                    }<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                }<br>            });<br>        }<br>    };<br>}<br></code></pre></td></tr></tbody></table></figure>



<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT/?p=36&amp;spm_id_from=pageDriver">POJO的Converter的定制视频嗷！！！</a></li>
</ul>
<h5 id="3-6、目标方法执行完成"><a href="#3-6、目标方法执行完成" class="headerlink" title="3.6、目标方法执行完成"></a>3.6、目标方法执行完成</h5><p>将所有的数据都放在 <strong>ModelAndViewContainer</strong>；包含要去的页面地址View。还包含Model数据。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1603272018605-1bce3142-bdd9-4834-a028-c753e91c52ac.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="3-7、处理派发结果"><a href="#3-7、处理派发结果" class="headerlink" title="3.7、处理派发结果"></a>3.7、处理派发结果</h5><p><strong>processDispatchResult</strong>(processedRequest, response, mappedHandler, mv, dispatchException);</p>
<p>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">InternalResourceView：<br><span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">renderMergedOutputModel</span><span class="hljs-params">(</span><br><span class="hljs-params">			Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception {<br><br>		<span class="hljs-comment">// Expose the model object as request attributes.</span><br>		exposeModelAsRequestAttributes(model, request);<br><br>		<span class="hljs-comment">// Expose helpers as request attributes, if any.</span><br>		exposeHelpers(request);<br><br>		<span class="hljs-comment">// Determine the path for the request dispatcher.</span><br>		<span class="hljs-type">String</span> <span class="hljs-variable">dispatcherPath</span> <span class="hljs-operator">=</span> prepareForRendering(request, response);<br><br>		<span class="hljs-comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).</span><br>		<span class="hljs-type">RequestDispatcher</span> <span class="hljs-variable">rd</span> <span class="hljs-operator">=</span> getRequestDispatcher(request, dispatcherPath);<br>		<span class="hljs-keyword">if</span> (rd == <span class="hljs-literal">null</span>) {<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletException</span>(<span class="hljs-string">"Could not get RequestDispatcher for ["</span> + getUrl() +<br>					<span class="hljs-string">"]: Check that the corresponding file exists within your web application archive!"</span>);<br>		}<br><br>		<span class="hljs-comment">// If already included or response already committed, perform include, else forward.</span><br>		<span class="hljs-keyword">if</span> (useInclude(request, response)) {<br>			response.setContentType(getContentType());<br>			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {<br>				logger.debug(<span class="hljs-string">"Including ["</span> + getUrl() + <span class="hljs-string">"]"</span>);<br>			}<br>			rd.include(request, response);<br>		}<br><br>		<span class="hljs-keyword">else</span> {<br>			<span class="hljs-comment">// Note: The forwarded resource is supposed to determine the content type itself.</span><br>			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {<br>				logger.debug(<span class="hljs-string">"Forwarding to ["</span> + getUrl() + <span class="hljs-string">"]"</span>);<br>			}<br>			rd.forward(request, response);<br>		}<br>	}<br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//暴露模型作为请求域属性</span><br><span class="hljs-comment">// Expose the model object as request attributes.</span><br>		exposeModelAsRequestAttributes(model, request);<br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exposeModelAsRequestAttributes</span><span class="hljs-params">(Map&lt;String, Object&gt; model,</span><br><span class="hljs-params">			HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception {<br><br>    <span class="hljs-comment">//model中的所有数据遍历挨个放在请求域中</span><br>		model.forEach((name, value) -&gt; {<br>			<span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {<br>				request.setAttribute(name, value);<br>			}<br>			<span class="hljs-keyword">else</span> {<br>				request.removeAttribute(name);<br>			}<br>		});<br>	}<br></code></pre></td></tr></tbody></table></figure>





<h3 id="4、数据响应与内容协商"><a href="#4、数据响应与内容协商" class="headerlink" title="4、数据响应与内容协商"></a>4、数据响应与内容协商</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606043749073-2573e24a-9ea9-459e-ad94-a433e1082624.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="1、响应JSON"><a href="#1、响应JSON" class="headerlink" title="1、响应JSON"></a>1、响应JSON</h4><h5 id="1-1、jackson-jar-ResponseBody"><a href="#1-1、jackson-jar-ResponseBody" class="headerlink" title="1.1、jackson.jar+@ResponseBody"></a>1.1、jackson.jar+@ResponseBody</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--web场景自动引入了json场景--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151090728-f7c60e6f-d0c0-4541-bfa3-8cc805dfd5d6.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>给前端自动返回json数据；</p>
<h6 id="1-1-1、返回值解析器"><a href="#1-1-1、返回值解析器" class="headerlink" title="1.1.1、返回值解析器"></a>1.1.1、返回值解析器</h6><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151359370-01cd1fbe-628a-4eea-9430-d79a78f59125.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>上面这个和参数解析器类似，对于返回值进行分析的嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> {<br>    <span class="hljs-built_in">this</span>.returnValueHandlers.handleReturnValue(<br>        returnValue, getReturnValueType(returnValue), mavContainer, webRequest);<br>}<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleReturnValue</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span><br><span class="hljs-params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="hljs-keyword">throws</span> Exception {<br><br>    <span class="hljs-type">HandlerMethodReturnValueHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> selectHandler(returnValue, returnType);<br>    <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unknown return value type: "</span> + returnType.getParameterType().getName());<br>    }<br>    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);<br>}<br>RequestResponseBodyMethodProcessor  <br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleReturnValue</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span><br><span class="hljs-params">                                  ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span><br>    <span class="hljs-keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException {<br><br>    mavContainer.setRequestHandled(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ServletServerHttpRequest</span> <span class="hljs-variable">inputMessage</span> <span class="hljs-operator">=</span> createInputMessage(webRequest);<br>    <span class="hljs-type">ServletServerHttpResponse</span> <span class="hljs-variable">outputMessage</span> <span class="hljs-operator">=</span> createOutputMessage(webRequest);<br><br>    <span class="hljs-comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span><br>    <span class="hljs-comment">// 使用消息转换器进行写出操作</span><br>    writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);<br>}<br></code></pre></td></tr></tbody></table></figure>



<h6 id="1-1-2、返回值解析器原理"><a href="#1-1-2、返回值解析器原理" class="headerlink" title="1.1.2、返回值解析器原理"></a>1.1.2、返回值解析器原理</h6><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605151728659-68c8ce8a-1b2b-4ab0-b86d-c3a875184672.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><p>1、返回值处理器判断是否支持这种类型返回值 supportsReturnType</p>
</li>
<li><p>2、返回值处理器调用 handleReturnValue 进行处理</p>
</li>
<li><p>3、RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody 注解的：</p>
<ul>
<li><ol>
<li>利用 MessageConverters 进行处理，将数据写为json：<ul>
<li>1、内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>2、服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</li>
<li>3、SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？<ul>
<li>1、得到MappingJackson2HttpMessageConverter可以将对象写为json</li>
<li>2、利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163005521-a20d1d8e-0494-43d0-8135-308e7a22e896.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="1-2、SpringMVC到底支持哪些返回值"><a href="#1-2、SpringMVC到底支持哪些返回值" class="headerlink" title="1.2、SpringMVC到底支持哪些返回值"></a>1.2、SpringMVC到底支持哪些返回值</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">ModelAndView<br>Model<br>View<br>ResponseEntity <br>ResponseBodyEmitter<br>StreamingResponseBody<br>HttpEntity<br>HttpHeaders<br>Callable<br>DeferredResult<br>ListenableFuture<br>CompletionStage<br>WebAsyncTask<br>有 <span class="hljs-meta">@ModelAttribute</span> 且为对象类型的<br><span class="hljs-meta">@ResponseBody</span> 注解 ---&gt; RequestResponseBodyMethodProcessor；<br></code></pre></td></tr></tbody></table></figure>

<h5 id="1-3、HTTPMessageConverter原理"><a href="#1-3、HTTPMessageConverter原理" class="headerlink" title="1.3、HTTPMessageConverter原理"></a>1.3、HTTPMessageConverter原理</h5><h6 id="1-3-1、MessageConverter规范"><a href="#1-3-1、MessageConverter规范" class="headerlink" title="1.3.1、MessageConverter规范"></a>1.3.1、MessageConverter规范</h6><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163447900-e2748217-0f31-4abb-9cce-546b4d790d0b.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>HttpMessageConverter: 看是否支持将此 Class类型的对象，转为MediaType类型的数据。</p>
<p>例子：Person对象转为JSON。或者 JSON转为Person</p>
<h6 id="1-3-2、默认的MessageConverter"><a href="#1-3-2、默认的MessageConverter" class="headerlink" title="1.3.2、默认的MessageConverter"></a>1.3.2、默认的MessageConverter</h6><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605163584708-e19770d6-6b35-4caa-bf21-266b73cb1ef1.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>0 - 只支持Byte类型的</p>
<p>1 - String</p>
<p>2 - String</p>
<p>3 - Resource</p>
<p>4 - ResourceRegion</p>
<p>5 - DOMSource.class \SAXSource.class) \ StAXSource.class \StreamSource.class \Source.class</p>
<p>6 - MultiValueMap</p>
<p><strong>7 - true</strong> </p>
<p>8 - true</p>
<p>9 - 支持注解方式xml处理的。</p>
<p>最终 MappingJackson2HttpMessageConverter  把对象转为JSON（利用底层的jackson的objectMapper转换的）</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605164243168-1a31e9af-54a4-463e-b65a-c28ca7a8a2fa.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="2、内容协商"><a href="#2、内容协商" class="headerlink" title="2、内容协商"></a>2、内容协商</h4><ul>
<li>根据客户端接收能力不同，返回不同媒体类型的数据。(比如这里我们引入xml，就能够相应xml依赖啦！！！)</li>
</ul>
<h5 id="2-1、引入xml依赖"><a href="#2-1、引入xml依赖" class="headerlink" title="2.1、引入xml依赖"></a>2.1、引入xml依赖</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<h5 id="2-2、postman分别测试返回json和xml"><a href="#2-2、postman分别测试返回json和xml" class="headerlink" title="2.2、postman分别测试返回json和xml"></a>2.2、postman分别测试返回json和xml</h5><p>只需要改变请求头中Accept字段。Http协议中规定的，告诉服务器本客户端可以接收的数据类型。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173127653-8a06cd0f-b8e1-4e22-9728-069b942eba3f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="2-3、开启浏览器参数方式内容协商功能"><a href="#2-3、开启浏览器参数方式内容协商功能" class="headerlink" title="2.3、开启浏览器参数方式内容协商功能"></a>2.3、开启浏览器参数方式内容协商功能</h5><ul>
<li>这个主要就能够实现，我想给浏览器写json，而不是xml，这个时候就需要开启额外的功能（不像Postman，浏览器发送的请求头不好改Content-type的嗷！！！）</li>
</ul>
<p>为了方便内容协商，开启基于请求参数的内容协商功能。</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>    <span class="hljs-attr">contentnegotiation:</span><br>      <span class="hljs-attr">favor-parameter:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">#开启请求参数内容协商模式</span><br></code></pre></td></tr></tbody></table></figure>

<p>发请求： <a target="_blank" rel="noopener" href="http://localhost:8080/test/person?format=json">http://localhost:8080/test/person?format=json</a> </p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/test/person?format=xml">http://localhost:8080/test/person?format=xml</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230907471-b0ed34bc-6782-40e7-84b7-615726312f01.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>确定客户端接收什么样的内容类型；</p>
<p>1、Parameter策略优先确定是要返回json数据（获取请求头中的format的值）</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605231074299-25f5b062-2de1-4a09-91bf-11e018d6ec0e.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>2、最终进行内容协商返回给客户端json即可。</p>
<p>3、多个策略中，按照优先级排序，获得第一个不是*/*的就返回。如果获得的是*/*，那就继续循环去遍历下一个策略。如果策略遍历一遍之后，都是*/*，那我们就直接只能返回这个了嗷。</p>
<h5 id="2-4、内容协商原理"><a href="#2-4、内容协商原理" class="headerlink" title="2.4、内容协商原理"></a>2.4、内容协商原理</h5><ul>
<li><p>1、判断当前响应头中是否已经有确定的媒体类型。MediaType</p>
</li>
<li><p><strong>2、获取客户端（PostMan、浏览器）支持接收的内容类型。（获取客户端Accept请求头字段）【application/xml】</strong></p>
<ul>
<li><p><strong>contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</strong></p>
</li>
<li><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230462280-ef98de47-6717-4e27-b4ec-3eb0690b55d0.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p><strong>HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型</strong> </p>
</li>
<li><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605230546376-65dcf657-7653-4a58-837a-f5657778201a.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
</ul>
</li>
<li><p>3、遍历循环所有当前系统的 <strong>MessageConverter</strong>，看谁<strong>支持操作这个对象</strong>（Person）</p>
</li>
<li><p>4、找到支持操作Person的converter，把converter支持的媒体类型统计出来。</p>
</li>
<li><p>5、客户端需要【application/xml】。服务端处理总能力【一共10种，包括json、xml在内，还需要循环遍历再排除来得到真正能够处理这个对象的东西！！！】</p>
</li>
<li><p>选择出来能够真正处理这个对象的如下统计所示：<img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173876646-f63575e2-50c8-44d5-9603-c2d11a78adae.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>6、上面只是能够处理指定对象而已，和我们的浏览器的要求匹配吗？不一定吧。所以下面就是把我们找出来能够处理的对象，和我们浏览器的要求进行匹配。进行内容协商的最佳匹配媒体类型。（最佳匹配，找出服务端能够提供的，同时满足客户端需求的方式。有可能有多个，还需要对于这些进行排序，然后得到最佳的那一个对象提供服务。<strong>最终选中的永远只有一个！！！</strong>）</p>
</li>
<li><p>7、用支持将对象转为最佳匹配媒体类型 的converter。调用它进行转化 。</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605173657818-73331882-6086-490c-973b-af46ccf07b32.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>导入了jackson处理xml的包，xml的converter就会自动进来</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebMvcConfigurationSupport</span><br><span class="hljs-variable">jackson2XmlPresent</span> <span class="hljs-operator">=</span> ClassUtils.isPresent(<span class="hljs-string">"com.fasterxml.jackson.dataformat.xml.XmlMapper"</span>, classLoader);<br><br><span class="hljs-keyword">if</span> (jackson2XmlPresent) {<br>			<span class="hljs-type">Jackson2ObjectMapperBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> Jackson2ObjectMapperBuilder.xml();<br>			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.applicationContext != <span class="hljs-literal">null</span>) {<br>				builder.applicationContext(<span class="hljs-built_in">this</span>.applicationContext);<br>			}<br>			messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2XmlHttpMessageConverter</span>(builder.build()));<br>		}<br></code></pre></td></tr></tbody></table></figure>







<h5 id="2-5、自定义-MessageConverter"><a href="#2-5、自定义-MessageConverter" class="headerlink" title="2.5、自定义 MessageConverter"></a>2.5、自定义 MessageConverter</h5><p><strong>实现多协议数据兼容。json、xml、x-guigu</strong></p>
<p>0、@ResponseBody 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p>
<p>1、Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p>
<p>2、所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p>
<p>3、内容协商找到最终的 <strong>messageConverter</strong>；</p>
<p>SpringMVC的什么功能。一个入口给容器中添加一个  WebMvcConfigurer。</p>
<ul>
<li>下面这一段代码就是在配置文件MyConfig中，对于Configurer的扩写，添加了我们自定义的GuiguMessageConverter</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title function_">webMvcConfigurer</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() {<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> {<br>			convert.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GuiguMessageConverter</span>());<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605260623995-8b1f7cec-9713-4f94-9cf1-8dbc496bd245.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605261062877-0a27cc41-51cb-4018-a9af-4e0338a247cd.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>自定义功能的添加（一个是解析浏览器参数策略，另外一个是本地服务器处理功能的添加）：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210716201441.png" srcset="/img/loading.gif" lazyload alt="image-20210716201259824"></p>
<ul>
<li><strong>有可能我们添加的自定义的功能会覆盖默认很多功能，比如默认方法添加的一些东西，会导致一些默认的功能失效。因此我们还需要查看源码，看看源码中某些类型是如何进行配置的嗷！！！</strong></li>
</ul>
<p>大家考虑，上述功能除了我们完全自定义外？SpringBoot有没有为我们提供基于配置文件的快速修改媒体类型功能？怎么配置呢？【提示：参照SpringBoot官方文档web开发内容协商章节】</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT?p=41&amp;spm_id_from=pageDriver">自定义MessageConverter的教程</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT?p=42&amp;spm_id_from=pageDriver">Converter课后作业的教程</a></li>
</ul>
<h3 id="5、视图解析与模板引擎"><a href="#5、视图解析与模板引擎" class="headerlink" title="5、视图解析与模板引擎"></a>5、视图解析与模板引擎</h3><p>视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p>
<h4 id="1、视图解析"><a href="#1、视图解析" class="headerlink" title="1、视图解析"></a>1、视图解析</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606043749039-cefbf687-4feb-441d-bad8-c6d933248d3c.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="1、视图解析原理流程"><a href="#1、视图解析原理流程" class="headerlink" title="1、视图解析原理流程"></a>1、视图解析原理流程</h5><p>1、目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer 里面。包括数据和视图地址</strong></p>
<p><strong>2、方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在</strong> <strong>ModelAndViewContainer</strong> </p>
<p><strong>3、任何目标方法执行完成以后都会返回 ModelAndView</strong>（<strong>数据和视图地址</strong>）。</p>
<p><strong>4、processDispatchResult  处理派发结果（页面该如何响应）</strong></p>
<ul>
<li>1、<strong>render</strong>(<strong>mv</strong>, request, response); 进行页面渲染逻辑<ul>
<li><p>1、根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻辑】</p>
<ul>
<li><p>1、所有的视图解析器尝试是否能根据当前返回值得到<strong>View</strong>对象</p>
</li>
<li><p>2、得到了  <strong>redirect:/main.html</strong> –&gt; Thymeleaf new <strong>RedirectView</strong>()</p>
</li>
<li><p>3、ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</p>
</li>
<li><p>4、view.render(mv.getModelInternal(), request, response);   视图对象调用自定义的render进行页面渲染工作</p>
<ul>
<li><p><strong>RedirectView 如何渲染【重定向到一个页面】</strong></p>
</li>
<li><p><strong>1、获取目标url地址</strong></p>
</li>
<li><p><strong>2、response.sendRedirect(encodedURL);</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>视图解析：</strong></p>
<ul>
<li><p><strong>返回值以 forward: 开始： new InternalResourceView(forwardUrl); –&gt;  转发</strong>request.getRequestDispatcher(path).forward(request, response);</p>
</li>
<li><p><strong>返回值以</strong> <strong>redirect: 开始：</strong> <strong>new RedirectView() –》 render就是重定向</strong> </p>
</li>
<li><p><strong>返回值是普通字符串： new ThymeleafView（）—&gt;</strong> 自定义视图解析器+自定义视图；</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605680247945-088b0f17-185c-490b-8889-103e8b4d8c07.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679959020-54b96fe7-f2fc-4b4d-a392-426e1d5413de.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679471537-7db702dc-b165-4dc6-b64a-26459ee5fd6c.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605679913592-151a616a-c754-4da3-a2c1-91dc0230a48d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="2、模板引擎-Thymeleaf"><a href="#2、模板引擎-Thymeleaf" class="headerlink" title="2、模板引擎-Thymeleaf"></a>2、模板引擎-Thymeleaf</h4><h5 id="1、thymeleaf简介"><a href="#1、thymeleaf简介" class="headerlink" title="1、thymeleaf简介"></a>1、thymeleaf简介</h5><p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p>
<p><strong>现代化、服务端Java模板引擎</strong></p>
<h5 id="2、基本语法"><a href="#2、基本语法" class="headerlink" title="2、基本语法"></a>2、基本语法</h5><h6 id="1、表达式"><a href="#1、表达式" class="headerlink" title="1、表达式"></a>1、表达式</h6><table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>变量取值</td>
<td>${…}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{…}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{…}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{…}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{…}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody></table>
<h6 id="2、字面量"><a href="#2、字面量" class="headerlink" title="2、字面量"></a>2、字面量</h6><p>文本值: <strong>‘one text’</strong> <strong>,</strong> <strong>‘Another one!’</strong> <strong>,…</strong>数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> <strong>,…</strong>布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p>空值: <strong>null</strong></p>
<p>变量： one，two，…. 变量不能有空格</p>
<h6 id="3、文本操作"><a href="#3、文本操作" class="headerlink" title="3、文本操作"></a>3、文本操作</h6><p>字符串拼接: <strong>+</strong></p>
<p>变量替换: <strong>|The name is ${name}|</strong> </p>
<h6 id="4、数学运算"><a href="#4、数学运算" class="headerlink" title="4、数学运算"></a>4、数学运算</h6><p>运算符: + , - , * , / , %</p>
<h6 id="5、布尔运算"><a href="#5、布尔运算" class="headerlink" title="5、布尔运算"></a>5、布尔运算</h6><p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong> </p>
<h6 id="6、比较运算"><a href="#6、比较运算" class="headerlink" title="6、比较运算"></a>6、比较运算</h6><p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;** **,** **&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong> </p>
<h6 id="7、条件运算"><a href="#7、条件运算" class="headerlink" title="7、条件运算"></a>7、条件运算</h6><p>If-then: <strong>(if) ? (then)</strong></p>
<p>If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p>Default: (value) <strong>?: (defaultvalue)</strong> </p>
<h6 id="8、特殊操作"><a href="#8、特殊操作" class="headerlink" title="8、特殊操作"></a>8、特殊操作</h6><p>无操作： _</p>
<h5 id="3、设置属性值-th-attr"><a href="#3、设置属性值-th-attr" class="headerlink" title="3、设置属性值-th:attr"></a>3、设置属性值-th:attr</h5><p>设置单个值</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"subscribe.html"</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"action=@{/subscribe}"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Subscribe!"</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"value=#{subscribe.submit}"</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>设置多个值</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../../images/gtvglogo.png"</span>  <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"src=@{/images/gtvglogo.png},title=#{logo},alt=#{logo}"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>以上两个的代替写法 th:xxxx</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Subscribe!"</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">"#{subscribe.submit}"</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"subscribe.html"</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">"@{/subscribe}"</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<p>所有h5兼容的标签写法</p>
<p><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h5 id="4、迭代"><a href="#4、迭代" class="headerlink" title="4、迭代"></a>4、迭代</h5><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"prod : ${prods}"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.name}"</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.price}"</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.inStock}? #{true} : #{false}"</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"prod,iterStat : ${prods}"</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">"${iterStat.odd}? 'odd'"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.name}"</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.price}"</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.inStock}? #{true} : #{false}"</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="5、条件运算"><a href="#5、条件运算" class="headerlink" title="5、条件运算"></a>5、条件运算</h5><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"comments.html"</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/product/comments(prodId=${prod.id})}"</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:if</span>=<span class="hljs-string">"${not #lists.isEmpty(prod.comments)}"</span>&gt;</span>view<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:switch</span>=<span class="hljs-string">"${user.role}"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"'admin'"</span>&gt;</span>User is an administrator<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"#{roles.manager}"</span>&gt;</span>User is a manager<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"*"</span>&gt;</span>User is some other thing<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="6、属性优先级"><a href="#6、属性优先级" class="headerlink" title="6、属性优先级"></a>6、属性优先级</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605498132699-4fae6085-a207-456c-89fa-e571ff1663da.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="3、thymeleaf使用"><a href="#3、thymeleaf使用" class="headerlink" title="3、thymeleaf使用"></a>3、thymeleaf使用</h4><h5 id="1、引入Starter"><a href="#1、引入Starter" class="headerlink" title="1、引入Starter"></a>1、引入Starter</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<h5 id="2、自动配置好了thymeleaf"><a href="#2、自动配置好了thymeleaf" class="headerlink" title="2、自动配置好了thymeleaf"></a>2、自动配置好了thymeleaf</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span><br><span class="hljs-meta">@ConditionalOnClass({ TemplateMode.class, SpringTemplateEngine.class })</span><br><span class="hljs-meta">@AutoConfigureAfter({ WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThymeleafAutoConfiguration</span> { }<br></code></pre></td></tr></tbody></table></figure>



<p>自动配好的策略</p>
<ul>
<li><p>1、所有thymeleaf的配置值都在 ThymeleafProperties</p>
</li>
<li><p>2、配置好了 <strong>SpringTemplateEngine</strong> </p>
</li>
<li><p><strong>3、配好了</strong> <strong>ThymeleafViewResolver</strong> </p>
</li>
<li><p>4、我们只需要直接开发页面</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"classpath:/templates/"</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SUFFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">".html"</span>;  <span class="hljs-comment">//xxx.html</span><br></code></pre></td></tr></tbody></table></figure>

<h5 id="3、页面开发"><a href="#3、页面开发" class="headerlink" title="3、页面开发"></a>3、页面开发</h5><ul>
<li>学的教训：记得要加名称空间啊啊啊啊orz。</li>
<li>所有的域中的取值，都是${}这种方式来进行的嗷！！！</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.thymeleaf.org"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${msg}"</span>&gt;</span>哈哈<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"www.atguigu.com"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"${link}"</span>&gt;</span>去百度<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"www.atguigu.com"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{link}"</span>&gt;</span>去百度2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>@{}中填充的就是真正的连接，不能够是变量嗷！！！默认的起始地址就是当前的项目的地址嗷！！！</li>
</ul>
<h4 id="4、构建后台管理系统"><a href="#4、构建后台管理系统" class="headerlink" title="4、构建后台管理系统"></a>4、构建后台管理系统</h4><h5 id="1、项目创建"><a href="#1、项目创建" class="headerlink" title="1、项目创建"></a>1、项目创建</h5><p>thymeleaf、web-starter、devtools、lombok</p>
<h5 id="2、静态资源处理"><a href="#2、静态资源处理" class="headerlink" title="2、静态资源处理"></a>2、静态资源处理</h5><p>自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210716213802.png" srcset="/img/loading.gif" lazyload alt="image-20210716213802653"></p>
<h5 id="3、路径构建"><a href="#3、路径构建" class="headerlink" title="3、路径构建"></a>3、路径构建</h5><ul>
<li>注意，加入到form的action才有意义嗷！！！</li>
</ul>
<p>th:action=”@{/login}”</p>
<h5 id="4、模板抽取"><a href="#4、模板抽取" class="headerlink" title="4、模板抽取"></a>4、模板抽取</h5><ul>
<li>前后加上div标签最好啦，div比较保险嗷，include , insert , replace三者有所不同，注意康康嗷！！！</li>
<li>replace感觉用到的最多，直接拿公共抽取部分来整个替换原有的div，感觉非常方便嗷！！！</li>
<li>使用公共模板之后，相当于导航的功能的页面跳转，只需要在公共页面中修改即可嗷！！！</li>
<li>注意，有的时候bug的出现很有可能是抽取的公共页面中引入了某些资源，原本的代码中也引入了某些资源导致了冲突嗷！！！</li>
</ul>
<p>th:insert/replace/include</p>
<h5 id="5、页面跳转"><a href="#5、页面跳转" class="headerlink" title="5、页面跳转"></a>5、页面跳转</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping("/login")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">main</span><span class="hljs-params">(User user, HttpSession session, Model model)</span>{<br><br>    <span class="hljs-keyword">if</span>(StringUtils.hasLength(user.getUserName()) &amp;&amp; <span class="hljs-string">"123456"</span>.equals(user.getPassword())){<br>        <span class="hljs-comment">//把登陆成功的用户保存起来</span><br>        session.setAttribute(<span class="hljs-string">"loginUser"</span>,user);<br>        <span class="hljs-comment">//登录成功重定向到main.html;  重定向防止表单重复提交</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/main.html"</span>;<br>    }<span class="hljs-keyword">else</span> {<br>        model.addAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"账号密码错误"</span>);<br>        <span class="hljs-comment">//回到登录页面</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>;<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>



<h5 id="6、数据渲染"><a href="#6、数据渲染" class="headerlink" title="6、数据渲染"></a>6、数据渲染</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping("/dynamic_table")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(Model model)</span>{<br><span class="hljs-comment">//表格内容的遍历</span><br>List&lt;User&gt; users = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"123456"</span>),<br>	<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"lisi"</span>, <span class="hljs-string">"123444"</span>),<br>	<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"haha"</span>, <span class="hljs-string">"aaaaa"</span>),<br>	<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"hehe "</span>, <span class="hljs-string">"aaddd"</span>));<br>	model.addAttribute(<span class="hljs-string">"users"</span>,users);<br>	<br>	<span class="hljs-keyword">return</span> <span class="hljs-string">"table/dynamic_table"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>


<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"display table table-bordered"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hidden-table-info"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>    	<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    		<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    		<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    		<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    	<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gradeX"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"user,stats:${users}"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${stats.count}"</span>&gt;</span>Trident<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${user.userName}"</span>&gt;</span>Internet<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>[[${user.password}]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="7、工程问题"><a href="#7、工程问题" class="headerlink" title="7、工程问题"></a>7、工程问题</h5><ul>
<li><p>刷新页面表单重复提交比较耗费资源咋办呢？</p>
<ul>
<li>使用重定向，这样做的目的是重定向到某一个页面，并且使得网页的url发生了改变。这个时候再次刷新页面本质上就不会再次提交表单，而是请求静态资源（通过另外一个Controller来处理），就会快嗷！！！</li>
<li>第一次登录过程中使用重定向之后，后续刷新页面相当于直接请求资源！！！</li>
</ul>
</li>
<li><p>就像上面所说，如果获得了登录页面的绝对地址，访问就能登录，显然非常不合理，那这该怎么办捏？</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 处理登录提交的表单，并且控制跳转到main页面</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> user 页面表单封装对象</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> session 存储登录的用户</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> model 添加request域的数据，例如登录失败等信息</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping("/login")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">main</span><span class="hljs-params">(User user, HttpSession session, Model model)</span>{<br><br>    <span class="hljs-keyword">if</span> (StringUtils.hasLength(user.getUserName()) &amp;&amp; StringUtils.hasLength(user.getPassword())){<br>        <span class="hljs-comment">//把登录成功的用户保存起来</span><br>        session.setAttribute(<span class="hljs-string">"loginUser"</span>,user);<br>        <span class="hljs-comment">//重定向到main亚目</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/main.html"</span>;<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-comment">//用户名密码不符合要求嗷！！！</span><br>        model.addAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"账号密码错误，请重新登录"</span>);<br>        <span class="hljs-comment">//回到登录页面</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>;<br>    }<br>}<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 和上面的重定向搭配使用，解决了页面刷新过程中，表单重复提交的问题嗷！！！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> session 获取用户Session判断是否登录</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> model 向request全局变量添加信息</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> 返回具体页面</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping("/main.html")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">mainPage</span><span class="hljs-params">(HttpSession session, Model model)</span>{<br><br>    <span class="hljs-comment">//判断是否登录，登录了才能访问对应的页面</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> (User) session.getAttribute(<span class="hljs-string">"loginUser"</span>);<br>    <span class="hljs-keyword">if</span> (loginUser != <span class="hljs-literal">null</span>){<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"main"</span>;<br>    }<span class="hljs-keyword">else</span> {<br>        <span class="hljs-comment">//回到登录页</span><br>        model.addAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"未登录系统，请重新登录"</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>上面两个搭配使用，完成登录的验证功能。</p>
<p>并且session作为全局作用域，后续保存的数据（例如封装的用户名和密码等用户数据），还能在后续的页面中取出来，继续发挥作用嗷！！！例如<code>[[${session.loginUser.userName}]]</code></p>
<ul>
<li>正式退出的时候，还要对于Session等进行处理嗷！！！</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717115242.png" srcset="/img/loading.gif" lazyload alt="image-20210717115241895"></li>
</ul>
<p>可以通过status作为变量参数去取出一些类似于count，index这样的属性，方便我们遍历的时候使用嗷！！！</p>
<h3 id="6、拦截器"><a href="#6、拦截器" class="headerlink" title="6、拦截器"></a>6、拦截器</h3><h4 id="1、HandlerInterceptor-接口"><a href="#1、HandlerInterceptor-接口" class="headerlink" title="1、HandlerInterceptor 接口"></a>1、HandlerInterceptor 接口</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 登录检查</span><br><span class="hljs-comment"> * 1、配置好拦截器要拦截哪些请求</span><br><span class="hljs-comment"> * 2、把这些配置放在容器中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行之前</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        log.info(<span class="hljs-string">"preHandle拦截的请求路径是{}"</span>,requestURI);<br><br>        <span class="hljs-comment">//登录检查逻辑</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">"loginUser"</span>);<br><br>        <span class="hljs-keyword">if</span>(loginUser != <span class="hljs-literal">null</span>){<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        }<br><br>        <span class="hljs-comment">//拦截住。未登录。跳转到登录页</span><br>        request.setAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"请先登录"</span>);<br><span class="hljs-comment">//        re.sendRedirect("/");</span><br>        request.getRequestDispatcher(<span class="hljs-string">"/"</span>).forward(request,response);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行完成以后</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> modelAndView</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception {<br>        log.info(<span class="hljs-string">"postHandle执行{}"</span>,modelAndView);<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 页面渲染以后</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception {<br>        log.info(<span class="hljs-string">"afterCompletion执行异常{}"</span>,ex);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="2、配置拦截器"><a href="#2、配置拦截器" class="headerlink" title="2、配置拦截器"></a>2、配置拦截器</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、编写一个拦截器实现HandlerInterceptor接口</span><br><span class="hljs-comment"> * 2、拦截器注册到容器中（实现WebMvcConfigurer的addInterceptors）</span><br><span class="hljs-comment"> * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> {<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">"/**"</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">"/"</span>,<span class="hljs-string">"/login"</span>,<span class="hljs-string">"/css/**"</span>,<span class="hljs-string">"/fonts/**"</span>,<span class="hljs-string">"/images/**"</span>,<span class="hljs-string">"/js/**"</span>); <span class="hljs-comment">//放行的请求</span><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>一开始为了方便测试在Controller中设置的拦截器要撤掉嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717165415.png" srcset="/img/loading.gif" lazyload alt="image-20210717165414903"></p>
<ul>
<li>存放信息处理：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210717165810.png" srcset="/img/loading.gif" lazyload alt="image-20210717165810843"></p>
<p>这里和前端一样，只能从request中将相应的值取出来。sendRedirect这个时候是不可以的嗷，因为sendRedirect本质上是让客户端发送第二次请求。第二次请求就不会带有我们设置的信息了，所以这里应该使用forward（也可以是我们上面这种写法），将请求转发给”/“处理，传入我们现在的request和response，方便我们我们页面渲染的时候进行处理。</p>
<ul>
<li>Log.info()可以打印输出对应位置的某些信息到控制台，方便我们debug或研究程序的执行顺序嗷！！！</li>
</ul>
<h4 id="3、拦截器原理"><a href="#3、拦截器原理" class="headerlink" title="3、拦截器原理"></a>3、拦截器原理</h4><p>1、根据当前请求，找到<strong>HandlerExecutionChain【</strong>可以处理请求的handler以及handler的所有 拦截器】</p>
<p>2、先来<strong>顺序执行</strong> 所有拦截器的 preHandle方法</p>
<ul>
<li>1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li>
<li>2、如果当前拦截器返回为false。直接    倒序执行所有已经执行了的拦截器的  afterCompletion；</li>
</ul>
<p><strong>3、如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></p>
<p><strong>4、所有拦截器都返回True。执行目标方法</strong></p>
<p><strong>5、倒序执行所有拦截器的postHandle方法。</strong></p>
<p><strong>6、前面的步骤有任何异常都会直接倒序触发</strong> afterCompletion</p>
<p>7、页面成功渲染完成以后，也会倒序触发 afterCompletion</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605764129365-5b31a748-1541-4bee-9692-1917b3364bc6.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605765121071-64cfc649-4892-49a3-ac08-88b52fb4286f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="7、文件上传"><a href="#7、文件上传" class="headerlink" title="7、文件上传"></a>7、文件上传</h3><h4 id="1、页面表单"><a href="#1、页面表单" class="headerlink" title="1、页面表单"></a>1、页面表单</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/upload"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"file"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h4 id="2、文件上传代码"><a href="#2、文件上传代码" class="headerlink" title="2、文件上传代码"></a>2、文件上传代码</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * MultipartFile 自动封装上传过来的文件</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> email</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> headerImg</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> photos</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping("/upload")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("email")</span> String email,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestParam("username")</span> String username,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart("headerImg")</span> MultipartFile headerImg,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart("photos")</span> MultipartFile[] photos)</span> <span class="hljs-keyword">throws</span> IOException {<br><br>    log.info(<span class="hljs-string">"上传的信息：email={}，username={}，headerImg={}，photos={}"</span>,<br>             email,username,headerImg.getSize(),photos.length);<br><br>    <span class="hljs-keyword">if</span>(!headerImg.isEmpty()){<br>        <span class="hljs-comment">//保存到文件服务器，OSS服务器</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> headerImg.getOriginalFilename();<br>        headerImg.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"H:\\cache\\"</span>+originalFilename));<br>    }<br><br>    <span class="hljs-keyword">if</span>(photos.length &gt; <span class="hljs-number">0</span>){<br>        <span class="hljs-comment">//这里无非是进行遍历而已嘛！！！</span><br>        <span class="hljs-keyword">for</span> (MultipartFile photo : photos) {<br>            <span class="hljs-keyword">if</span>(!photo.isEmpty()){<br>                <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> photo.getOriginalFilename();<br>                <span class="hljs-comment">//下面这里保存了文件嗷！！！</span><br>                photo.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"H:\\cache\\"</span>+originalFilename));<br>            }<br>        }<br>    }<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"main"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<h4 id="3、自动配置原理"><a href="#3、自动配置原理" class="headerlink" title="3、自动配置原理"></a>3、自动配置原理</h4><p><strong>文件上传自动配置类-MultipartAutoConfiguration—–MultipartProperties</strong></p>
<ul>
<li><p>自动配置好了 <strong>StandardServletMultipartResolver   【文件上传解析器】</strong></p>
</li>
<li><p><strong>原理步骤</strong></p>
<ul>
<li><p><strong>1、请求进来使用文件上传解析器判断（</strong>isMultipart<strong>）并封装（</strong>resolveMultipart，<strong>返回</strong>MultipartHttpServletRequest<strong>）文件上传请求</strong></p>
</li>
<li><p><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></p>
</li>
<li><p><strong>3、将request中文件信息封装为一个Map；</strong>MultiValueMap&lt;String, MultipartFile&gt;</p>
</li>
</ul>
</li>
</ul>
<p><strong>FileCopyUtils</strong>。实现文件流的拷贝</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping("/upload")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("email")</span> String email,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestParam("username")</span> String username,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart("headerImg")</span> MultipartFile headerImg,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart("photos")</span> MultipartFile[] photos)</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605847414866-32b6cc9c-5191-4052-92eb-069d652dfbf9.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="8、异常处理"><a href="#8、异常处理" class="headerlink" title="8、异常处理"></a>8、异常处理</h3><h4 id="1、错误处理"><a href="#1、错误处理" class="headerlink" title="1、错误处理"></a>1、错误处理</h4><h5 id="1、默认规则"><a href="#1、默认规则" class="headerlink" title="1、默认规则"></a>1、默认规则</h5><ul>
<li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li>
<li><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024421363-77083c34-0b0e-4698-bb72-42da351d3944.png" srcset="/img/loading.gif" lazyload alt="img"></li>
<li>上面的JSON中附带的默认对象，其实都是可以在模板引擎中当作变量来获取的嗷！！！</li>
<li><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024616835-bc491bf0-c3b1-4ac3-b886-d4ff3c9874ce.png" srcset="/img/loading.gif" lazyload alt="img"></li>
<li><strong>要对其进行自定义，添加</strong><code>**View**</code><strong>解析为</strong><code>**error**``** **</code></li>
<li>要完全替换默认行为，可以实现 <code>ErrorController </code>并注册该类型的Bean定义，或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</li>
<li>error/下的4xx，5xx页面会被自动解析；</li>
<li><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606024592756-d4ab8a6b-ec37-426b-8b39-010463603d57.png" srcset="/img/loading.gif" lazyload alt="img"></li>
</ul>
<h4 id="2、定制错误处理逻辑"><a href="#2、定制错误处理逻辑" class="headerlink" title="2、定制错误处理逻辑"></a>2、定制错误处理逻辑</h4><ul>
<li><p>自定义错误页</p>
<ul>
<li>error/404.html   error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</li>
</ul>
</li>
<li><p>@ControllerAdvice+@ExceptionHandler处理全局异常；底层是 <strong>ExceptionHandlerExceptionResolver 支持的</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.exception;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {<br><br>    <span class="hljs-meta">@ExceptionHandler({ArithmeticException.class,NullPointerException.class})</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handlerArithException</span><span class="hljs-params">(Exception e)</span>{<br><br>        log.error(<span class="hljs-string">"异常是:{}"</span>,e);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>; <span class="hljs-comment">//视图地址</span><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>@ResponseStatus+自定义异常 ；底层是 <strong>ResponseStatusExceptionResolver ，把responsestatus注解的信息底层调用</strong> <strong>response.sendError(statusCode, resolvedReason)；tomcat发送的/error</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.exception;<br><br><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;<br><br><span class="hljs-meta">@ResponseStatus(value = HttpStatus.FORBIDDEN,reason = "用户数量太多")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTooManyException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserTooManyException</span><span class="hljs-params">()</span>{<br><br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserTooManyException</span><span class="hljs-params">(String message)</span>{<br>        <span class="hljs-built_in">super</span>(message);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>Spring底层的异常，如 参数类型转换异常；<strong>DefaultHandlerExceptionResolver 处理框架底层的异常。</strong></p>
</li>
<li><p>response.sendError(HttpServletResponse.<strong>SC_BAD_REQUEST</strong>, ex.getMessage()); </p>
</li>
<li><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606114118010-f4aaf5ee-2747-4402-bc82-08321b2490ed.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>自定义实现 HandlerExceptionResolver 处理异常；可以作为默认的全局异常处理规则</p>
<ul>
<li><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606114688649-e6502134-88b3-48db-a463-04c23eddedc7.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
<li><p>```java<br>package com.tuzi.exception;</p>
<p>import org.springframework.core.Ordered;<br>import org.springframework.core.annotation.Order;<br>import org.springframework.stereotype.Component;<br>import org.springframework.web.servlet.HandlerExceptionResolver;<br>import org.springframework.web.servlet.ModelAndView;</p>
<p>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;<br>import java.io.IOException;</p>
<p>//自定义异常处理<br>@Order(value = Ordered.HIGHEST_PRECEDENCE) //优先级最高<br>@Component<br>public class CustomerHandlerExceptionResolver implements HandlerExceptionResolver {<br>@Override<br>public ModelAndView resolveException(HttpServletRequest httpServletRequest,<br>                                     HttpServletResponse httpServletResponse,<br>                                     Object o,<br>                                     Exception e) {<br>    try {<br>        httpServletResponse.sendError(511,”我喜欢的错误嗷！！！”);<br>    } catch (IOException ioException) {<br>        ioException.printStackTrace();<br>    }<br><br>    return new ModelAndView();<br>}<br>}</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs less"><br><span class="hljs-selector-tag">-</span> **<span class="hljs-selector-tag">ErrorViewResolver</span>**  实现自定义处理异常；<br><br>  <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.sendError</span> 。<span class="hljs-selector-tag">error</span>请求就会转给<span class="hljs-selector-tag">controller</span><br>  <span class="hljs-selector-tag">-</span> 你的异常没有任何人能处理。<span class="hljs-selector-tag">tomcat</span>底层 <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.sendError</span>。<span class="hljs-selector-tag">error</span>请求就会转给<span class="hljs-selector-tag">controller</span><br>  <span class="hljs-selector-tag">-</span> **<span class="hljs-selector-tag">basicErrorController</span> 要去的页面地址是** **<span class="hljs-selector-tag">ErrorViewResolver</span>**  ；<br><br><br><br><br><br>#### <span class="hljs-number">3</span>、异常处理自动配置原理<br><br><span class="hljs-selector-tag">-</span> **<span class="hljs-selector-tag">ErrorMvcAutoConfiguration</span>  自动配置异常处理规则**<br>  <span class="hljs-selector-tag">-</span> **容器中的组件：类型：<span class="hljs-selector-tag">DefaultErrorAttributes</span> <span class="hljs-selector-tag">-</span>&gt;** **<span class="hljs-selector-tag">id</span>：<span class="hljs-selector-tag">errorAttributes</span>**<br><br>    <span class="hljs-selector-tag">-</span> **<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span>** **<span class="hljs-selector-tag">DefaultErrorAttributes</span>** **<span class="hljs-selector-tag">implements</span>** **<span class="hljs-selector-tag">ErrorAttributes</span>**, **<span class="hljs-selector-tag">HandlerExceptionResolver</span>**<br>    <span class="hljs-selector-tag">-</span> **<span class="hljs-selector-tag">DefaultErrorAttributes</span>**：定义错误页面中可以包含哪些数据。<br><br>    <span class="hljs-selector-tag">-</span> !<span class="hljs-selector-attr">[img]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606044430037-8d599e30-1679-407c-96b7-4df345848fa4.png)</span><br>    - ![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606044487738-8cb1dcda-08c5-4104-a634-b2468512e60f.png)</span><br>  - **容器中的组件：类型：**BasicErrorController --&gt; id：basicErrorController（json+白页 适配响应）**<br>    - **处理默认** **/error 路径的请求；页面响应** **new** <span class="hljs-built_in">ModelAndView</span>(**<span class="hljs-string">"error"</span>**, model)；<br>    - **容器中有组件 View**-&gt;**id是error**；（响应默认错误页）<br><br>    - 容器中放组件 **BeanNameViewResolver（视图解析器）；按照返回的视图名作为组件的id去容器中找View对象。**<br><br>  - **容器中的组件：**类型：**DefaultErrorViewResolver -&gt; id：**conventionErrorViewResolver<br><br>    - 如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面<br>    - error/<span class="hljs-number">404</span>、<span class="hljs-number">5</span>xx.html<br><br><br><br>- 如果想要返回页面；就会找error视图【**StaticView**】。(默认是一个白页)<br><br><br><br><br><br>![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606043870164-3770e116-344f-448e-8bff-8f32438edc9a.png)写出去json</span><br><br>![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606043904074-50b7f088-2d2b-4da5-85e2-0a756da74dca.png) 错误页</span><br><br><br><br><br><br>#### <span class="hljs-number">4</span>、异常处理步骤流程<br><br><span class="hljs-number">1</span>、执行目标方法，目标方法运行期间有任何异常都会被catch、而且标志当前请求结束；并且用 **dispatchException** 进行封装<br><br><span class="hljs-number">2</span>、进入视图解析流程（页面渲染？） <br><br><span class="hljs-built_in">processDispatchResult</span>(processedRequest, response, mappedHandler, **mv**, **dispatchException**);<br><br><span class="hljs-number">3</span>、**mv** = **processHandlerException**；处理handler发生的异常，处理完成返回ModelAndView；<br><br>- <span class="hljs-number">1</span>、遍历所有的 **handlerExceptionResolvers，看谁能处理当前异常【HandlerExceptionResolver处理器异常解析器】**<br>- ![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606047252166-ce71c3a1-0e0e-4499-90f4-6d80014ca19f.png)</span><br>- **<span class="hljs-number">2</span>、系统默认的  异常解析器；**<br>- ![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606047109161-c68a46c1-202a-4db1-bbeb-23fcae49bbe9.png)</span><br><br>  - **<span class="hljs-number">1</span>、DefaultErrorAttributes先来处理异常。把异常信息保存到request域，并且返回null；**<br>  - **<span class="hljs-number">2</span>、默认没有任何人能处理异常，所以异常会被抛出**<br><br>    - **<span class="hljs-number">1</span>、如果没有任何人能处理最终底层就会发送 /error 请求。会被底层的BasicErrorController处理**<br>    - **<span class="hljs-number">2</span>、解析错误视图；遍历所有的**  **ErrorViewResolver  看谁能解析。**<br>    - ![img](<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.nlark.com/yuque/0/2020/png/1354552/1606047900473-e31c1dc3-7a5f-4f70-97de-5203429781fa.png)</span><br>    - **<span class="hljs-number">3</span>、默认的** **DefaultErrorViewResolver ,作用是把响应状态码作为错误页的地址，error/<span class="hljs-number">500</span>.html** <br>    - **<span class="hljs-number">4</span>、模板引擎最终响应这个页面** **error/<span class="hljs-number">500</span>.html** <br>- 总结：出了错误的时候，系统会先去找有没有什么方法是能够处理异常的（如果自己没写的话，就找不到，返回null），处理不了的话，当然就得告诉用户出了问题了嗷orz。系统就会默认发送/error的请求，通过ErrorViewResolver，返回对应的出错的视图给用户展示。<br><br><br><br>### <span class="hljs-number">9</span>、Web原生组件注入（Servlet、Filter、Listener）<br><br>#### <span class="hljs-number">1</span>、使用Servlet API<br><br><span class="hljs-variable">@ServletComponentScan</span>(basePackages = **<span class="hljs-string">"com.atguigu.admin"</span>**) :指定原生Servlet组件都放在那里(位于主配置类中)<br><br><span class="hljs-variable">@WebServlet</span>(urlPatterns = **<span class="hljs-string">"/my"</span>**)：效果：直接响应，**没有经过Spring的拦截器？**（位于编写的Servlet的相应类中，这个Servlet应该继承HttpServlet嗷！！！）<br><br><span class="hljs-variable">@WebFilter</span>(urlPatterns={**<span class="hljs-string">"/css/\*"</span>**,**<span class="hljs-string">"/images/\*"</span>**})<br><br><span class="hljs-variable">@WebListener</span><br><br><span class="hljs-built_in">``</span>`java<br>package com.tuzi.servlet;<br><br><br>import javax.servlet.ServletException;<br>import javax.servlet.annotation.WebServlet;<br>import javax.servlet.http.HttpServlet;<br>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;<br>import java.io.IOException;<br><br><span class="hljs-variable">@WebServlet</span>(urlPatterns = <span class="hljs-string">"/my"</span>)<br>public class MyServlet extends HttpServlet {<br>    <span class="hljs-variable">@Override</span><br>    protected void <span class="hljs-built_in">doGet</span>(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {<br>        resp.<span class="hljs-built_in">getWriter</span>().<span class="hljs-built_in">write</span>(<span class="hljs-string">"这是兔兔的测试嗷！！！"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.servlet;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletContextEvent;<br><span class="hljs-keyword">import</span> javax.servlet.ServletContextListener;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebListener;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@WebListener</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletContextListener</span> {<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> {<br>        log.info(<span class="hljs-string">"MyListener监听到项目初始化完成"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextDestroyed</span><span class="hljs-params">(ServletContextEvent sce)</span> {<br>        log.info(<span class="hljs-string">"MyListener监听到项目销毁"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.servlet;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@WebFilter(urlPatterns = {"/css/*","/images/*"})</span> <span class="hljs-comment">//拦截的对象</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException {<br>        log.info(<span class="hljs-string">"MyFilter初始化完成"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {<br>        log.info(<span class="hljs-string">"MyFilter销毁"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException {<br>        log.info(<span class="hljs-string">"MyFilter工作"</span>);<br>        filterChain.doFilter(servletRequest,servletResponse);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>



<ul>
<li><p>推荐可以这种方式；</p>
</li>
<li><p>注意：Servlet下的写法是单星，Spring中的写法是双星</p>
</li>
</ul>
<p>扩展：DispatchServlet 如何注册进来</p>
<ul>
<li><p>容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 <strong>spring.mvc。</strong></p>
</li>
<li><p><strong>通过</strong> <strong>ServletRegistrationBean</strong><dispatcherservlet> 把 DispatcherServlet  配置进来。</dispatcherservlet></p>
</li>
<li><p>默认映射的是 / 路径。</p>
</li>
</ul>
<p><code>spring.mvc.servlet.path=/mvc/</code></p>
<ul>
<li>可以通过上面这种方式来配置对应的路径嗷！！！（DispatcherServlet对应的拦截的路径嗷！！！）</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606284869220-8b63d54b-39c4-40f6-b226-f5f095ef9304.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>Tomcat-Servlet；</p>
<p>多个Servlet都能处理到同一层路径，精确优选原则(有点像计算机网络中学习到的最长前缀匹配原则。)</p>
<p>A： /my/</p>
<p>B： /my/1</p>
<h4 id="2、使用RegistrationBean"><a href="#2、使用RegistrationBean" class="headerlink" title="2、使用RegistrationBean"></a>2、使用RegistrationBean</h4><ul>
<li>就相当于不用注解啦，直接再构造一个类，将我们写好的Servlet加入到容器中就可以生效了嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">`ServletRegistrationBean`, `FilterRegistrationBean`, and `ServletListenerRegistrationBean<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRegistConfig</span> {<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">myServlet</span><span class="hljs-params">()</span>{<br>        <span class="hljs-type">MyServlet</span> <span class="hljs-variable">myServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServlet</span>();<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(myServlet,<span class="hljs-string">"/my"</span>,<span class="hljs-string">"/my02"</span>);<br>    }<br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title function_">myFilter</span><span class="hljs-params">()</span>{<br><br>        <span class="hljs-type">MyFilter</span> <span class="hljs-variable">myFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFilter</span>();<br><span class="hljs-comment">//        return new FilterRegistrationBean(myFilter,myServlet());这就默认拦截和myServlet一样的路径嗷！</span><br>        <span class="hljs-type">FilterRegistrationBean</span> <span class="hljs-variable">filterRegistrationBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterRegistrationBean</span>(myFilter);<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">"/my"</span>,<span class="hljs-string">"/css/*"</span>));<br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletListenerRegistrationBean <span class="hljs-title function_">myListener</span><span class="hljs-params">()</span>{<br>        <span class="hljs-type">MySwervletContextListener</span> <span class="hljs-variable">mySwervletContextListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySwervletContextListener</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletListenerRegistrationBean</span>(mySwervletContextListener);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>一定要记得@Bean，@Bean才是把对应返回的组件放到容器中来。</li>
<li>这里用单实例的最好嗷，一个就够了，不然可能会有很多杂的东西在容器里面嗷！！！</li>
</ul>
<h3 id="10、嵌入式Servlet容器"><a href="#10、嵌入式Servlet容器" class="headerlink" title="10、嵌入式Servlet容器"></a>10、嵌入式Servlet容器</h3><h4 id="1、切换嵌入式Servlet容器"><a href="#1、切换嵌入式Servlet容器" class="headerlink" title="1、切换嵌入式Servlet容器"></a>1、切换嵌入式Servlet容器</h4><ul>
<li><p>默认支持的webServer</p>
<ul>
<li><code>Tomcat</code>, <code>Jetty</code>, or <code>Undertow</code></li>
<li><code>ServletWebServerApplicationContext 容器启动寻找ServletWebServerFactory 并引导创建服务器</code></li>
</ul>
</li>
<li><p>切换服务器</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606280937533-504d0889-b893-4a01-af68-2fc31ffce9fc.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>





<ul>
<li>原理<ul>
<li>SpringBoot应用启动发现当前是Web应用。web场景包-导入tomcat</li>
<li>web应用会创建一个web版的ioc容器 <code>ServletWebServerApplicationContext</code> </li>
<li><code>ServletWebServerApplicationContext</code> 启动的时候寻找 <code>**ServletWebServerFactory**``（Servlet 的web服务器工厂---&gt; Servlet 的web服务器）</code> </li>
<li>SpringBoot底层默认有很多的WebServer工厂；<code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code>, or <code>UndertowServletWebServerFactory</code></li>
<li><code>底层直接会有一个自动配置类。ServletWebServerFactoryAutoConfiguration</code></li>
<li><code>ServletWebServerFactoryAutoConfiguration导入了ServletWebServerFactoryConfiguration（配置类）</code></li>
<li><code>ServletWebServerFactoryConfiguration 配置类 根据动态判断系统中到底导入了哪个Web服务器的包。（默认是web-starter导入tomcat包），容器中就有 TomcatServletWebServerFactory</code></li>
<li><code>TomcatServletWebServerFactory 创建出Tomcat服务器并启动；TomcatWebServer 的构造器拥有初始化方法initialize---this.tomcat.start();</code></li>
<li><code>内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）</code></li>
<li>``</li>
</ul>
</li>
</ul>
<h4 id="2、定制Servlet容器"><a href="#2、定制Servlet容器" class="headerlink" title="2、定制Servlet容器"></a>2、定制Servlet容器</h4><ul>
<li><p>实现  **WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; **</p>
<ul>
<li>把配置文件的值和<strong>ServletWebServerFactory 进行绑定</strong></li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718160633.png" srcset="/img/loading.gif" lazyload alt="image-20210718160633431"></li>
</ul>
</li>
<li><p>修改配置文件 <strong>server.xxx</strong></p>
</li>
<li><p>直接自定义 <strong>ConfigurableServletWebServerFactory</strong> ：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718160407.png" srcset="/img/loading.gif" lazyload alt="image-20210718160406922"></p>
<p><strong>xxxxxCustomizer</strong>：定制化器，可以改变xxxx的默认规则</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;<br><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomizationBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebServerFactoryCustomizer</span>&lt;ConfigurableServletWebServerFactory&gt; {<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">customize</span><span class="hljs-params">(ConfigurableServletWebServerFactory server)</span> {<br>        server.setPort(<span class="hljs-number">9000</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h3 id="11、定制化原理"><a href="#11、定制化原理" class="headerlink" title="11、定制化原理"></a>11、定制化原理</h3><h4 id="1、定制化的常见方式"><a href="#1、定制化的常见方式" class="headerlink" title="1、定制化的常见方式"></a>1、定制化的常见方式</h4><ul>
<li><p>修改配置文件；</p>
</li>
<li><p><strong>xxxxxCustomizer；</strong></p>
</li>
<li><p><strong>编写自定义的配置类   xxxConfiguration；+</strong> <strong>@Bean替换、增加容器中默认组件；视图解析器</strong> </p>
</li>
<li><p><strong>Web应用 编写一个配置类实现</strong> <strong>WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件</strong>(一个类，搞定所有问题，可以加入@Bean拓展组件，也可以覆盖某些方法，加入自己写的组件嗷！！！)</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210718162702.png" srcset="/img/loading.gif" lazyload alt="image-20210718162631570"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span><br></code></pre></td></tr></tbody></table></figure>

<p>上面这两个就是例子，可以使用实现WebMvcConfigurer加上@Configuration的方式，覆盖一些函数加入某些功能或者是在对应的类中通过@Bean将我们需要的组件放入到容器中来。</p>
<ul>
<li>@EnableWebMvc + WebMvcConfigurer —— @Bean  可以全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能<ul>
<li>原理</li>
<li>1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页…..</li>
<li>2、一旦使用 @EnableWebMvc 。会 @Import(DelegatingWebMvcConfiguration.<strong>class</strong>)</li>
<li>3、<strong>DelegatingWebMvcConfiguration</strong> 的 作用，只保证SpringMVC最基本的使用<ul>
<li>把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</li>
<li>自动配置了一些非常底层的组件。<strong>RequestMappingHandlerMapping</strong>、这些组件依赖的组件都是从容器中获取</li>
<li><strong>public class</strong> DelegatingWebMvcConfiguration <strong>extends</strong> <strong>WebMvcConfigurationSupport</strong></li>
</ul>
</li>
<li>4、<strong>WebMvcAutoConfiguration</strong> 里面的配置要能生效 必须  @ConditionalOnMissingBean(<strong>WebMvcConfigurationSupport</strong>.<strong>class</strong>)</li>
<li>5、@EnableWebMvc  导致了 <strong>WebMvcAutoConfiguration  没有生效。</strong></li>
<li>… …</li>
</ul>
</li>
</ul>
<h4 id="2、原理分析套路"><a href="#2、原理分析套路" class="headerlink" title="2、原理分析套路"></a>2、原理分析套路</h4><p><strong>场景starter</strong> <strong>- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties –</strong> <strong>绑定配置文件项</strong> </p>
<h2 id="数据访问："><a href="#数据访问：" class="headerlink" title="数据访问："></a>数据访问：</h2><h3 id="1、SQL"><a href="#1、SQL" class="headerlink" title="1、SQL"></a>1、SQL</h3><h4 id="1、数据源的自动配置-HikariDataSource"><a href="#1、数据源的自动配置-HikariDataSource" class="headerlink" title="1、数据源的自动配置-HikariDataSource"></a>1、数据源的自动配置-<strong>HikariDataSource</strong></h4><h5 id="1、导入JDBC场景"><a href="#1、导入JDBC场景" class="headerlink" title="1、导入JDBC场景"></a>1、导入JDBC场景</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>导入的starter中包含了以下的内容：</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606366100317-5e0199fa-6709-4d32-bce3-bb262e2e5e6a.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>数据库驱动？</li>
</ul>
<p>为什么导入JDBC场景，官方不导入驱动？官方不知道我们接下要操作什么数据库。如果我们使用的是MySql，我们还要引入如下的MySQL驱动：</p>
<p>数据库版本要和驱动版本对应</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml">默认版本：<br><span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>8.0.22<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;version&gt;5.1.49&lt;/version&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>想要修改版本<br>1、直接依赖引入具体版本（maven的就近依赖原则）<br>2、重新声明版本（maven的属性的就近优先原则）<br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.49<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719162954.png" srcset="/img/loading.gif" lazyload alt="image-20210719162954595"></p>
<h4 id="2、分析自动配置"><a href="#2、分析自动配置" class="headerlink" title="2、分析自动配置"></a>2、分析自动配置</h4><h5 id="1、自动配置的类"><a href="#1、自动配置的类" class="headerlink" title="1、自动配置的类"></a>1、自动配置的类</h5><ul>
<li>DataSourceAutoConfiguration ： 数据源的自动配置<ul>
<li>修改数据源相关的配置：<strong>spring.datasource</strong></li>
<li><strong>数据库连接池的配置，是自己容器中没有DataSource才自动配置的</strong></li>
<li>底层配置好的连接池是：<strong>HikariDataSource</strong></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Conditional(PooledDataSourceCondition.class)</span><br><span class="hljs-meta">@ConditionalOnMissingBean({ DataSource.class, XADataSource.class })</span><br><span class="hljs-meta">@Import({ DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span><br><span class="hljs-meta">		DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span><br><span class="hljs-meta">		DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class })</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PooledDataSourceConfiguration</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>DataSourceTransactionManagerAutoConfiguration： 事务管理器的自动配置</p>
</li>
<li><p>JdbcTemplateAutoConfiguration： <strong>JdbcTemplate的自动配置，可以来对数据库进行crud</strong></p>
<ul>
<li>可以修改这个配置项@ConfigurationProperties(prefix = <strong>“spring.jdbc”</strong>) 来修改JdbcTemplate</li>
<li>@Bean@Primary    JdbcTemplate；容器中有这个组件</li>
</ul>
</li>
<li><p>JndiDataSourceAutoConfiguration： jndi的自动配置</p>
</li>
<li><p>XADataSourceAutoConfiguration： 分布式事务相关的</p>
</li>
</ul>
<h4 id="3、修改配置项"><a href="#3、修改配置项" class="headerlink" title="3、修改配置项"></a>3、修改配置项</h4><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br></code></pre></td></tr></tbody></table></figure>



<h4 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot05WebAdminApplicationTests</span> {<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> {<br><br><span class="hljs-comment">//        jdbcTemplate.queryForObject("select * from account_tbl")</span><br><span class="hljs-comment">//        jdbcTemplate.queryForList("select * from account_tbl",)</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">aLong</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(<span class="hljs-string">"select count(*) from account_tbl"</span>, Long.class);<br>        log.info(<span class="hljs-string">"记录总数：{}"</span>,aLong);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>

<h3 id="2、使用Druid数据源"><a href="#2、使用Druid数据源" class="headerlink" title="2、使用Druid数据源"></a>2、使用Druid数据源</h3><h4 id="1、druid官方github地址"><a href="#1、druid官方github地址" class="headerlink" title="1、druid官方github地址"></a>1、druid官方github地址</h4><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<p>整合第三方技术的两种方式</p>
<ul>
<li>自定义</li>
<li>找starter</li>
</ul>
<h4 id="2、自定义方式"><a href="#2、自定义方式" class="headerlink" title="2、自定义方式"></a>2、自定义方式</h4><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT/?p=61&amp;spm_id_from=pageDriver">这一课讲的十分好，如何把druid手动整合。如何通过官方的Spring文档来导入到SpringBoot中嗷！！！</a></p>
<h5 id="1、创建数据源"><a href="#1、创建数据源" class="headerlink" title="1、创建数据源"></a>1、创建数据源</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>//下面是Spring中常见的Druid配置，在boot中，我们通过配置类的方式来对于数据源进行配置嗷！！！<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.pool.DruidDataSource"</span></span><br><span class="hljs-tag">		<span class="hljs-attr">destroy-method</span>=<span class="hljs-string">"close"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.url}"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.username}"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.password}"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxActive"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"20"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initialSize"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxWait"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"60000"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"minIdle"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"timeBetweenEvictionRunsMillis"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"60000"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"minEvictableIdleTimeMillis"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"300000"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"testWhileIdle"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"testOnBorrow"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"testOnReturn"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"poolPreparedStatements"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxOpenPreparedStatements"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"20"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>官网给的所有的配置文件，都是可以通过配置类以及配置类的相关方法进行配置的嗷！！！可以去看druid的官方文档嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719170200.png" srcset="/img/loading.gif" lazyload alt="image-20210719170200031"></p>
<ul>
<li>如果我们这里使用了@ConfigurationProperities，这些属性也可以通过在配置文件中进行配置来进行自动的绑定嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719170434.png" srcset="/img/loading.gif" lazyload alt="image-20210719170433151"></p>
<ul>
<li>官方文档中对于什么Servlet的配置啊之类的，我们只需要翻译成boot中对应的内容，类似于ServletRegistrationBean，将对应的组件加入到容器中即可嗷！！！</li>
</ul>
<h5 id="2、StatViewServlet"><a href="#2、StatViewServlet" class="headerlink" title="2、StatViewServlet"></a>2、StatViewServlet</h5><p>StatViewServlet的用途包括：</p>
<ul>
<li>提供监控信息展示的html页面</li>
<li>提供监控信息的JSON API</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DruidStatView<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.alibaba.druid.support.http.StatViewServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DruidStatView<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/druid/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="3、StatFilter"><a href="#3、StatFilter" class="headerlink" title="3、StatFilter"></a>3、StatFilter</h5><p>用于统计监控信息；如SQL监控、URI监控</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">需要给数据源中配置如下属性；可以允许多个filter，多个用，分割；如：<br><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filters"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"stat,slf4j"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>系统中所有filter：</p>
<table>
<thead>
<tr>
<th>别名</th>
<th>Filter类名</th>
</tr>
</thead>
<tbody><tr>
<td>default</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>stat</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>mergeStat</td>
<td>com.alibaba.druid.filter.stat.MergeStatFilter</td>
</tr>
<tr>
<td>encoding</td>
<td>com.alibaba.druid.filter.encoding.EncodingConvertFilter</td>
</tr>
<tr>
<td>log4j</td>
<td>com.alibaba.druid.filter.logging.Log4jFilter</td>
</tr>
<tr>
<td>log4j2</td>
<td>com.alibaba.druid.filter.logging.Log4j2Filter</td>
</tr>
<tr>
<td>slf4j</td>
<td>com.alibaba.druid.filter.logging.Slf4jLogFilter</td>
</tr>
<tr>
<td>commonlogging</td>
<td>com.alibaba.druid.filter.logging.CommonsLogFilter</td>
</tr>
</tbody></table>
<p><strong>慢SQL记录配置</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stat-filter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.filter.stat.StatFilter"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"slowSqlMillis"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"10000"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"logSlowSql"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>使用 slowSqlMillis 定义慢SQL的时长<br></code></pre></td></tr></tbody></table></figure>









<h4 id="3、使用官方starter方式"><a href="#3、使用官方starter方式" class="headerlink" title="3、使用官方starter方式"></a>3、使用官方starter方式</h4><h5 id="1、引入druid-starter"><a href="#1、引入druid-starter" class="headerlink" title="1、引入druid-starter"></a>1、引入druid-starter</h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<h5 id="2、分析自动配置-1"><a href="#2、分析自动配置-1" class="headerlink" title="2、分析自动配置"></a>2、分析自动配置</h5><ul>
<li><p>扩展配置项 <strong>spring.datasource.druid</strong></p>
</li>
<li><p>DruidSpringAopConfiguration.<strong>class</strong>,   监控SpringBean的；配置项：<strong>spring.datasource.druid.aop-patterns</strong></p>
</li>
<li><p>DruidStatViewServletConfiguration.<strong>class</strong>, 监控页的配置：<strong>spring.datasource.druid.stat-view-servlet；默认开启</strong></p>
</li>
<li><p>DruidWebStatFilterConfiguration.<strong>class</strong>, web监控配置；<strong>spring.datasource.druid.web-stat-filter；默认开启</strong></p>
</li>
<li><p>DruidFilterConfiguration.<strong>class</strong>}) 所有Druid自己filter的配置</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_STAT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.stat"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_CONFIG_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.config"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_ENCODING_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.encoding"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_SLF4J_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.slf4j"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_LOG4J_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.log4j"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_LOG4J2_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.log4j2"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_COMMONS_LOG_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.commons-log"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_WALL_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.datasource.druid.filter.wall"</span>;<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>上面这些是官方已经为我们配置好了的，我们只需要在配置文件中对于其进行配置即可嗷！！！</li>
</ul>
<h5 id="3、配置示例"><a href="#3、配置示例" class="headerlink" title="3、配置示例"></a>3、配置示例</h5><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">aop-patterns:</span> <span class="hljs-string">com.atguigu.admin.*</span>  <span class="hljs-comment">#监控SpringBean</span><br>      <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall</span>     <span class="hljs-comment"># 底层开启功能，stat（sql监控），wall（防火墙）</span><br><br>      <span class="hljs-attr">stat-view-servlet:</span>   <span class="hljs-comment"># 配置监控页功能</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">login-password:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">resetEnable:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#这个就是重置按钮</span><br><br>      <span class="hljs-attr">web-stat-filter:</span>  <span class="hljs-comment"># 监控web</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">urlPattern:</span> <span class="hljs-string">/*</span><br>        <span class="hljs-attr">exclusions:</span> <span class="hljs-string">'*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*'</span><br><br><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">stat:</span>    <span class="hljs-comment"># 对上面filters里面的stat的详细配置</span><br>          <span class="hljs-attr">slow-sql-millis:</span> <span class="hljs-number">1000</span><br>          <span class="hljs-attr">logSlowSql:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">wall:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">config:</span><br>            <span class="hljs-attr">drop-table-allow:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></tbody></table></figure>

<p>SpringBoot配置示例</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<p>配置项列表<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8">https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8</a></p>
<h3 id="3、整合MyBatis操作"><a href="#3、整合MyBatis操作" class="headerlink" title="3、整合MyBatis操作"></a>3、整合MyBatis操作</h3><p><a target="_blank" rel="noopener" href="https://github.com/mybatis">https://github.com/mybatis</a></p>
<p>starter</p>
<p>SpringBoot官方的Starter：spring-boot-starter-*</p>
<p>第三方的： *-spring-boot-starter</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606704096118-53001250-a04a-4210-80ee-6de6a370be2e.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="1、配置模式"><a href="#1、配置模式" class="headerlink" title="1、配置模式"></a>1、配置模式</h4><ul>
<li><p>全局配置文件</p>
</li>
<li><p>SqlSessionFactory: 自动配置好了</p>
</li>
<li><p>SqlSession：自动配置了 <strong>SqlSessionTemplate 组合了SqlSession</strong></p>
</li>
<li><p>@Import(<strong>AutoConfiguredMapperScannerRegistrar</strong>.<strong>class</strong>）；</p>
</li>
<li><p>Mapper： 只要我们写的操作MyBatis的接口标准了 <strong>@Mapper 就会被自动扫描进来</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(MybatisProperties.class)</span> ： MyBatis配置项绑定类。<br><span class="hljs-meta">@AutoConfigureAfter({ DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisAutoConfiguration</span>{}<br><br><span class="hljs-meta">@ConfigurationProperties(prefix = "mybatis")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisProperties</span><br></code></pre></td></tr></tbody></table></figure>

<p>可以修改配置文件中 mybatis 开始的所有；</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置mybatis规则</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">config-location:</span> <span class="hljs-string">classpath:mybatis/mybatis-config.xml</span>  <span class="hljs-comment">#全局配置文件位置</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span>  <span class="hljs-comment">#sql映射文件位置</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>上面是配置文件，下面是和以前的MyBatis用法一样的Mapper映射文件，需要搭配mapper抽象类接口一起使用嗷！！！</li>
<li>注意，以下配置文件不是我们所说的全局配置文件，全局配置文件可以上官方文档中拷贝出来嗷！！！</li>
<li>注意Mapper抽象类上面要加上@Mapper注解。</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml">Mapper接口---&gt;绑定Xml<br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="hljs-meta">        <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.atguigu.admin.mapper.AccountMapper"</span>&gt;</span><br><span class="hljs-comment">&lt;!--    public Account getAcct(Long id); --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAcct"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.atguigu.admin.bean.Account"</span>&gt;</span><br>        select * from  account_tbl where  id=#{id}<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>全局配置文件：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719203602.png" srcset="/img/loading.gif" lazyload alt="image-20210719203601908"></p>
<p>可以在配置文件中开启对应的驼峰命名规则。同理，xml太麻烦，在我们的配置文件中有没有默认绑定上对应的规则呢？如下所示嗷！！！</p>
<p>配置 <strong>private</strong> Configuration <strong>configuration</strong>; mybatis.<strong>configuration下面的所有，就是相当于改mybatis全局配置文件中的值</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置mybatis规则</span><br><span class="hljs-attr">mybatis:</span><br><span class="hljs-comment">#  config-location: classpath:mybatis/mybatis-config.xml</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <br><span class="hljs-comment">#可以不写全局；配置文件，所有全局配置文件的配置都放在configuration配置项中即可</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>下面的配置，和我们上面指定的全局配置文件不能够同时存在嗷！！！</p>
</li>
<li><p>MyBatis使用规则：</p>
<ul>
<li><p>导入mybatis官方starter</p>
</li>
<li><p>编写mapper接口。标准@Mapper注解</p>
</li>
<li><p>编写sql映射文件并绑定mapper接口</p>
</li>
<li><p>在application.yaml中指定Mapper配置文件的位置，以及指定全局配置文件的信息 （建议；<strong>配置在mybatis.configuration</strong>中，不用全局配置文件嗷，太麻烦啦！！！）</p>
</li>
</ul>
</li>
</ul>
<h4 id="2、纯注解模式"><a href="#2、纯注解模式" class="headerlink" title="2、纯注解模式"></a>2、纯注解模式</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CityMapper</span> {<br><br>    <span class="hljs-meta">@Select("select * from city where id=#{id}")</span><br>    <span class="hljs-keyword">public</span> City <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(City city)</span>;<br><br>}<br></code></pre></td></tr></tbody></table></figure>







<h4 id="3、混合模式"><a href="#3、混合模式" class="headerlink" title="3、混合模式"></a>3、混合模式</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CityMapper</span> {<br><br>    <span class="hljs-meta">@Select("select * from city where id=#{id}")</span><br>    <span class="hljs-keyword">public</span> City <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(City city)</span>;<br><br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>复杂的专门放在对应的Mapper文件中即可。</p>
</li>
<li><p>拿到对应的Id：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210719205324.png" srcset="/img/loading.gif" lazyload alt="image-20210719205324303"></p>
<p>可以通过注解的形式来拿到对应的id嗷！！！并且可以把拿到的id放入对应的City的属性中。</p>
<ul>
<li>这个例子在MyBatis的官方文档中的spring-boot-starter的Quick Start中嗷！！！</li>
</ul>
<p><strong>最佳实战：</strong></p>
<ul>
<li><p>引入mybatis-starter</p>
</li>
<li><p><strong>配置application.yaml中，指定mapper-location位置即可</strong></p>
</li>
<li><p>编写Mapper接口并标注@Mapper注解</p>
</li>
<li><p>简单方法直接注解方式</p>
</li>
<li><p>复杂方法编写mapper.xml进行绑定映射</p>
</li>
<li><p><em>@MapperScan(“com.atguigu.admin.mapper”) 简化，其他的接口就可以不用标注@Mapper注解</em>（专门整一个mapper的包出来，里面全放对应的文件，就可以不在每个类上面标注mapper了，只用扫描整个包就好了。建议还是用Mapper来标注上嗷！！！）</p>
</li>
</ul>
<h3 id="4、整合-MyBatis-Plus-完成CRUD"><a href="#4、整合-MyBatis-Plus-完成CRUD" class="headerlink" title="4、整合 MyBatis-Plus 完成CRUD"></a>4、整合 MyBatis-Plus 完成CRUD</h3><h4 id="1、什么是MyBatis-Plus"><a href="#1、什么是MyBatis-Plus" class="headerlink" title="1、什么是MyBatis-Plus"></a>1、什么是MyBatis-Plus</h4><p><a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a>（简称 MP）是一个 <a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/">MyBatis</a> 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/">mybatis plus 官网</a></p>
<p>建议安装 <strong>MybatisX</strong> 插件 </p>
<h4 id="2、整合MyBatis-Plus"><a href="#2、整合MyBatis-Plus" class="headerlink" title="2、整合MyBatis-Plus"></a>2、整合MyBatis-Plus</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>自动配置</p>
<ul>
<li><p>MybatisPlusAutoConfiguration 配置类，MybatisPlusProperties 配置项绑定。<strong>mybatis-plus：xxx 就是对****mybatis-plus的定制</strong></p>
</li>
<li><p><strong>SqlSessionFactory 自动配置好。底层是容器中默认的数据源</strong></p>
</li>
<li><p><strong>mapperLocations 自动配置好的。有默认值。</strong>classpath*:/mapper/**/*.xml；任意包的类路径下的所有mapper文件夹下任意路径下的所有xml都是sql映射文件。  建议以后sql映射文件，放在 mapper下。</p>
</li>
<li><p><strong>容器中也自动配置好了</strong> <strong>SqlSessionTemplate</strong></p>
</li>
<li><p><strong>@Mapper 标注的接口也会被自动扫描；建议直接</strong> @MapperScan(<strong>“com.tuzi.mapper”</strong>) 批量扫描就行</p>
</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>只需要我们的Mapper继承 <strong>BaseMapper</strong> 就可以拥有crud能力</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720155244.png" srcset="/img/loading.gif" lazyload alt="image-20210720155244605"></p>
<ul>
<li>相当于上面这样就直接写好了orz</li>
</ul>
<h4 id="3、CRUD功能"><a href="#3、CRUD功能" class="headerlink" title="3、CRUD功能"></a>3、CRUD功能</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@GetMapping("/user/delete/{id}")</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id,</span><br><span class="hljs-params">                             <span class="hljs-meta">@RequestParam(value = "pn",defaultValue = "1")</span>Integer pn,</span><br><span class="hljs-params">                             RedirectAttributes ra)</span>{<br><br>        userService.removeById(id);<br><br>        ra.addAttribute(<span class="hljs-string">"pn"</span>,pn);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/dynamic_table"</span>;<br>    }<br><br><br>    <span class="hljs-meta">@GetMapping("/dynamic_table")</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value="pn",defaultValue = "1")</span> Integer pn,Model model)</span>{<br>        <span class="hljs-comment">//表格内容的遍历</span><br><span class="hljs-comment">//        response.sendError</span><br><span class="hljs-comment">//     List&lt;User&gt; users = Arrays.asList(new User("zhangsan", "123456"),</span><br><span class="hljs-comment">//                new User("lisi", "123444"),</span><br><span class="hljs-comment">//                new User("haha", "aaaaa"),</span><br><span class="hljs-comment">//                new User("hehe ", "aaddd"));</span><br><span class="hljs-comment">//        model.addAttribute("users",users);</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        if(users.size()&gt;3){</span><br><span class="hljs-comment">//            throw new UserTooManyException();</span><br><span class="hljs-comment">//        }</span><br>        <span class="hljs-comment">//从数据库中查出user表中的用户进行展示</span><br><br>        <span class="hljs-comment">//构造分页参数</span><br>        Page&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pn, <span class="hljs-number">2</span>);<br>        <span class="hljs-comment">//调用page进行分页</span><br>        Page&lt;User&gt; userPage = userService.page(page, <span class="hljs-literal">null</span>);<br><br><br><span class="hljs-comment">//        userPage.getRecords()</span><br><span class="hljs-comment">//        userPage.getCurrent()</span><br><span class="hljs-comment">//        userPage.getPages()</span><br><br><br>        model.addAttribute(<span class="hljs-string">"users"</span>,userPage);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"table/dynamic_table"</span>;<br>    }<br></code></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {<br><br><br>}<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; {<br><br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="4、工程问题"><a href="#4、工程问题" class="headerlink" title="4、工程问题"></a>4、工程问题</h4><ul>
<li>代码如下：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.bean;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.ToString;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {<br><br>    <span class="hljs-comment">//下面是用户登录的字段</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 所有属性都应该在数据库中嗷！！！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-comment">//以下是数据库的字段</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String email;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String s1, String s)</span> {<br>        <span class="hljs-built_in">this</span>.userName = s1;<br>        <span class="hljs-built_in">this</span>.password = s;<br>    }<br>}<br><span class="hljs-comment">//不在表中的属性可以使用plus的注解来注标记嗷！！！</span><br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>属性：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; {<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>上面这种写法默认是去数据库种寻找同名的User表，如果表的名字和这个类的名字不一样，就要采用注解来注释，帮助MyBatisPlus找到这种表：</p>
<p><code>@TableName("user_tbl")</code>，这个注解是添加在User这个类上，而不是Mapper类上嗷！！！</p>
<ul>
<li>Controller -&gt; Service -&gt; Mapper(Dao层)，先有接口，后有实现类，注入接口来进行编写的嗷！！！（对于Service层来说的嗷！！！）</li>
<li><code>ctrl + alt + l</code>可以格式化html文件格式嗷</li>
<li>Service层结构：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.tuzi.bean.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; {<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>对应的Impl的代码：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.tuzi.bean.User;<br><span class="hljs-keyword">import</span> com.tuzi.mapper.UserMapper;<br><span class="hljs-keyword">import</span> com.tuzi.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>上面这个Impl就是结合之前的Mapper和User等一起使用的嗷，默认也有很多功能。而且@Service了之后，就可以在Controller中自动注入来使用了嗷！！！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>UserService userService;<br><br><span class="hljs-meta">@GetMapping("/dynamic_table")</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">dynamic_table</span><span class="hljs-params">(Model model)</span>{<br>	List&lt;User&gt; list = userService.list(); <span class="hljs-comment">//上面的抽象类和实现并未自己实现方法，但是可以使用默认的方法来实现功能嗷！！！</span><br>	model.addAttribute(<span class="hljs-string">"users"</span>,list);<br>	<span class="hljs-keyword">return</span> <span class="hljs-string">"table/dynamic_table"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>原理一样的，Mapper(Dao层)先打好（继承BasePackage，传入Bean，就有默认的Dao层方法），然后处理Service层业务（可以是空的接口继承IService传入Bean，实现类则继承ServiceImpl，传入Mapper和对应的Bean，实现类要@Service，然后在Controller中就可以通过自动注入的方式，调用Service层的功能实现服务嗷！！！）</li>
<li>实例后续：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720165749.png" srcset="/img/loading.gif" lazyload alt="image-20210720165749288"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720165822.png" srcset="/img/loading.gif" lazyload alt="image-20210720165822715"></p>
<p>总的来说就是分页条是通过JavaScript来实现的，我们可以把相应的JS注释掉，从我们的HTML中审查元素手动取出我们的分页条，然后添加到我们的页面中，利用后端的数据库传入的数据再次来实现分页条。</p>
<ul>
<li>分页数据查询：<code>userService.Page()</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720172721.png" srcset="/img/loading.gif" lazyload alt="image-20210720172714217"></p>
<p>系统内部设置好了，多少页，每页多少条数据。拿到Page之后，Page中还有其他的属性嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720172918.png" srcset="/img/loading.gif" lazyload alt="image-20210720172918768"></p>
<ul>
<li><p>直接把上面得到的Page对象放入Model中就好了嗷！！！</p>
</li>
<li><p>流程：用户点击第几页 -&gt; 后端收到之后传入对应的参数 -&gt; 返回page对象 -&gt; 前端拿到Page对象取值进行渲染。</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720203340.png" srcset="/img/loading.gif" lazyload alt="image-20210720203340544"></p>
</li>
<li><p>上面这个东西在thymeleaf文档中都有嗷！！！这里就是在路径上添加变量的方法嗷！！！</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720203523.png" srcset="/img/loading.gif" lazyload alt="image-20210720203523780"></p>
<h4 id="5、带翻页的列表展示功能"><a href="#5、带翻页的列表展示功能" class="headerlink" title="5、带翻页的列表展示功能"></a>5、带翻页的列表展示功能</h4><ul>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192137.png" srcset="/img/loading.gif" lazyload alt="image-20210720192137023">注释掉前端JS实现的翻页功能。</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192211.png" srcset="/img/loading.gif" lazyload alt="image-20210720192211048">从JS文件渲染的页面中，提取出我们要的翻页的组件，并将其加入到我们的页面中来。</li>
<li>放入对应的page全局变量，方便我们后续取值：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192049.png" srcset="/img/loading.gif" lazyload alt="image-20210720192049444"></p>
<ul>
<li>修改我们的HTML页面：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192235.png" srcset="/img/loading.gif" lazyload alt="image-20210720192235319"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720192312.png" srcset="/img/loading.gif" lazyload alt="image-20210720192312200"></p>
<ul>
<li>除此之外，我们还需要引入对应的插件：</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tuzi.config;<br><br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisConfig</span> {<br>    <span class="hljs-comment">// 最新版</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> {<br>        <span class="hljs-comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span><br>        <span class="hljs-comment">// paginationInterceptor.setOverflow(false);</span><br>        <span class="hljs-comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span><br>        <span class="hljs-comment">// paginationInterceptor.setLimit(500);</span><br>        <span class="hljs-comment">// 开启 count 的 join 优化,只针对部分 left join</span><br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br><br>        <span class="hljs-comment">//这是分页拦截器</span><br>        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">paginationInnerInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>();<br>        paginationInnerInterceptor.setOverflow(<span class="hljs-literal">true</span>);<br>        paginationInnerInterceptor.setMaxLimit(<span class="hljs-number">500L</span>);<br><br>        interceptor.addInnerInterceptor(paginationInnerInterceptor);<br>        <span class="hljs-keyword">return</span> interceptor;<br>    }<br>}	<span class="hljs-comment">//一定要记得加上@Configuration</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>接着对于页面逻辑进行进一步的修改：</li>
</ul>
<h3 id="5、NoSQL"><a href="#5、NoSQL" class="headerlink" title="5、NoSQL"></a>5、NoSQL</h3><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、<strong>缓存</strong>和消息中间件。 它支持多种类型的数据结构，如 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#strings">字符串（strings）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hashes">散列（hashes）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#lists">列表（lists）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sets">集合（sets）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets">有序集合（sorted sets）</a> 与范围查询， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> 和 <a target="_blank" rel="noopener" href="http://www.redis.cn/commands/geoadd.html">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/replication.html">复制（replication）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/commands/eval.html">LUA脚本（Lua scripting）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/lru-cache.html">LRU驱动事件（LRU eviction）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/topics/transactions.html">事务（transactions）</a> 和不同级别的 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/persistence.html">磁盘持久化（persistence）</a>， 并通过 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/sentinel.html">Redis哨兵（Sentinel）</a>和自动 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/cluster-tutorial.html">分区（Cluster）</a>提供高可用性（high availability）。</p>
<h4 id="1、Redis自动配置"><a href="#1、Redis自动配置" class="headerlink" title="1、Redis自动配置"></a>1、Redis自动配置</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606745732785-17d1227a-75b9-4f00-a3f1-7fc4137b5113.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>自动配置：</p>
<ul>
<li><p>RedisAutoConfiguration 自动配置类。RedisProperties 属性类 –&gt; <strong>spring.redis.xxx是对redis的配置</strong></p>
</li>
<li><p>连接工厂是准备好的。<strong>Lettuce</strong>ConnectionConfiguration、<strong>Jedis</strong>ConnectionConfiguration</p>
</li>
<li><p><strong>自动注入了RedisTemplate</strong>&lt;**Object**, **Object**&gt; ： xxxTemplate；</p>
</li>
<li><p><strong>自动注入了StringRedisTemplate；k：v都是String</strong></p>
</li>
<li><p><strong>key：value</strong></p>
</li>
<li><p><strong>底层只要我们使用</strong> <strong>StringRedisTemplate、</strong>RedisTemplate就可以操作redis</p>
</li>
</ul>
<p><strong>redis环境搭建</strong></p>
<p><strong>1、阿里云按量付费redis。经典网络</strong></p>
<p><strong>2、申请redis的公网连接地址</strong></p>
<p><strong>3、修改白名单  允许0.0.0.0/0 访问</strong></p>
<h4 id="2、RedisTemplate与Lettuce"><a href="#2、RedisTemplate与Lettuce" class="headerlink" title="2、RedisTemplate与Lettuce"></a>2、RedisTemplate与Lettuce</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedis</span><span class="hljs-params">()</span>{<br>    ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();<br><br>    operations.set(<span class="hljs-string">"hello"</span>,<span class="hljs-string">"world"</span>);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> operations.get(<span class="hljs-string">"hello"</span>);<br>    System.out.println(hello);<br>}<br></code></pre></td></tr></tbody></table></figure>









<h4 id="3、切换至jedis"><a href="#3、切换至jedis" class="headerlink" title="3、切换至jedis"></a>3、切换至jedis</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--导入jedis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>


<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-string">r-bp1nc7reqesxisgxpipd.redis.rds.aliyuncs.com</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">lfy:Lfy123456</span><br>      <span class="hljs-attr">client-type:</span> <span class="hljs-string">jedis</span><br>      <span class="hljs-attr">jedis:</span><br>        <span class="hljs-attr">pool:</span><br>          <span class="hljs-attr">max-active:</span> <span class="hljs-number">10</span><br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>二者区别：<img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720211243.png" srcset="/img/loading.gif" lazyload alt="image-20210720211242900"></li>
<li>计数功能的实现：</li>
</ul>
<ol>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720211446.png" srcset="/img/loading.gif" lazyload alt="image-20210720211446266"></li>
<li>和以前一样直接在对应的Config中new出我们写的上面这个拦截器并且加入到容器中可以吗？不可以，因为我们自己new的，里面的@AutoWired没法用啊orz，只有容器中的组件，Spring才会操作注解。那怎么办？</li>
<li>你自动注入啊，这个配置类本身就是@Component，你先在对应的Config类中，自动注入我们放入容器中的这个Interceptor，再用registry注册给对应的管理器就行啦！！！</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210720212207.png" srcset="/img/loading.gif" lazyload alt="image-20210720212207022"></li>
</ol>
<p>自动注入对应的redisTemplate，然后使用对应的方法取出对应的值之后，放入model中，即可以被前端页面获取到。</p>
<h2 id="单元测试："><a href="#单元测试：" class="headerlink" title="单元测试："></a>单元测试：</h2><p><a target="_blank" rel="noopener" href="https://doczhcn.gitbook.io/junit5/">JUnit5官方文档</a></p>
<h3 id="1、JUnit5-的变化"><a href="#1、JUnit5-的变化" class="headerlink" title="1、JUnit5 的变化"></a>1、JUnit5 的变化</h3><p>Spring Boot 2.2.0 版本开始引入 JUnit 5 作为单元测试默认库</p>
<p>作为最新版本的JUnit框架，JUnit5与之前版本的Junit框架有很大的不同。由三个不同子项目的几个不同模块组成。</p>
<p>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</p>
<p>JUnit Platform: Junit Platform是在JVM上启动测试框架的基础，不仅支持Junit自制的测试引擎，其他测试引擎也都可以接入。</p>
<p>JUnit Jupiter: JUnit Jupiter提供了JUnit5的新的编程模型，是JUnit5新特性的核心。内部 包含了一个测试引擎，用于在Junit Platform上运行。</p>
<p>JUnit Vintage: 由于JUint已经发展多年，为了照顾老的项目，JUnit Vintage提供了兼容JUnit4.x,Junit3.x的测试引擎。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606796395719-eb57ab48-ae44-45e5-8d2e-c4d507aff49a.png?x-oss-process=image/resize,w_683" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>注意：</p>
<p>SpringBoot 2.4 以上版本移除了默认对 Vintage 的依赖。如果需要兼容junit4需要自行引入（不能使用junit4的功能 @Test）</p>
<p><strong>JUnit 5’s Vintage Engine Removed from spring-boot-starter-test,如果需要继续兼容junit4需要自行引入vintage</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hamcrest<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hamcrest-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>







<p>orgjunit.jupiterjunit-jupiter:5.7.0test)</p>
<p>iorgjunitjupiterjunit-jupiterapi5.7.0(</p>
<p>org.apiguardian:apiguardian-ap1.1.0</p>
<p>org.opentest4i:opentest4j:1.2.0(test)</p>
<p>orgjunit.platfommjunit-platform-commons1.7.0()</p>
<p>orgjunitjupiterjuiit-jupiter-params5.7.0(est)</p>
<p>dorgjunit.jupiterjunit-jupiterengine.7.()</p>
<p>org.apiguardian:apiguadinai.1.mitdoulicate)</p>
<p>lorgjunit.platformjunit-platform-engine;1.7.0(test)</p>
<p>org.apiguardianapiguardianapi.1.1.0(tsomittedforduplic</p>
<p>org.opentest4iopentes41.2.0ioduica)</p>
<p>org.junit.platfomjuitlafomcommo.</p>
<p>org.junitjupiterjunituitapi..duic</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606797616337-e73010e9-9cac-496d-a177-64b677af5a3d.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>现在版本：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot05WebAdminApplicationTests</span> {<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> {<br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<p>以前：</p>
<p>@SpringBootTest + @RunWith(SpringTest.class)</p>
<p>SpringBoot整合Junit以后：</p>
<ul>
<li><p>编写测试方法：@Test标注（注意需要使用junit5版本的注解）</p>
</li>
<li><p>Junit类具有Spring的功能，@Autowired、比如 @Transactional 标注测试方法，测试完成后自动回滚</p>
</li>
</ul>
<h3 id="2、JUnit5常用注解"><a href="#2、JUnit5常用注解" class="headerlink" title="2、JUnit5常用注解"></a>2、JUnit5常用注解</h3><ul>
<li>有官方文档嗷！！！</li>
<li>如果需要SpringBoot中的功能，例如自动注入功能，就需要@SpringBootTest注解嗷！！！</li>
</ul>
<p>JUnit5的注解与JUnit4的注解有所变化</p>
<p><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></p>
<ul>
<li><p>@Test :表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</p>
</li>
<li><p>@ParameterizedTest :表示方法是参数化测试，下方会有详细介绍</p>
</li>
<li><p>@RepeatedTest :表示方法可重复执行，下方会有详细介绍</p>
</li>
<li><p>@DisplayName :为测试类或者测试方法设置展示名称</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721154738.png" srcset="/img/loading.gif" lazyload alt="image-20210721154738122"></p>
<ul>
<li><p>@BeforeEach :表示在每个单元测试之前执行</p>
</li>
<li><p>@AfterEach :表示在每个单元测试之后执行</p>
</li>
<li><p>@BeforeAll :表示在所有单元测试之前执行</p>
</li>
<li><p>@AfterAll :表示在所有单元测试之后执行</p>
</li>
</ul>
<p>上面这个就类似于我们软件测试中学习到的方法的升级版本嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155156.png" srcset="/img/loading.gif" lazyload alt="image-20210721155156226"></p>
<ul>
<li><p>@Tag :表示单元测试类别，类似于JUnit4中的@Categories</p>
</li>
<li><p>@Disabled :表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</p>
</li>
<li><p>@Timeout :表示测试方法运行如果超过了指定时间将会返回错误</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155459.png" srcset="/img/loading.gif" lazyload alt="image-20210721155459034"></p>
<ul>
<li>@ExtendWith :为测试类或测试方法提供扩展类引用</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test; <span class="hljs-comment">//注意这里使用的是jupiter的Test注解！！</span><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDemo</span> {<br><br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-meta">@DisplayName("第一次测试")</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">firstTest</span><span class="hljs-params">()</span> {<br>      System.out.println(<span class="hljs-string">"hello world"</span>);<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>@RepeatedTest，重复测试，可以设置这个方法重复测试的次数：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721155812.png" srcset="/img/loading.gif" lazyload alt="image-20210721155811853"></p>
<h3 id="3、断言（assertions）"><a href="#3、断言（assertions）" class="headerlink" title="3、断言（assertions）"></a>3、断言（assertions）</h3><p>断言（assertions）是测试方法中的核心部分，用来对测试需要满足的条件进行验证。这些断言方法都是 org.junit.jupiter.api.Assertions 的静态方法。JUnit 5 内置的断言可以分成如下几个类别：</p>
<p>检查业务逻辑返回的数据是否合理。</p>
<p>所有的测试运行结束以后，会有一个详细的测试报告；</p>
<h4 id="3-1、简单断言"><a href="#3-1、简单断言" class="headerlink" title="3.1、简单断言"></a>3.1、简单断言</h4><p>用来对单个值进行简单的验证。如：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>判断两个对象或两个原始类型是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>判断两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td>assertSame</td>
<td>判断两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>判断两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td>assertTrue</td>
<td>判断给定的布尔值是否为 true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>判断给定的布尔值是否为 false</td>
</tr>
<tr>
<td>assertNull</td>
<td>判断给定的对象引用是否为 null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>判断给定的对象引用是否不为 null</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("simple assertion")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simple</span><span class="hljs-params">()</span> {<br>     assertEquals(<span class="hljs-number">3</span>, <span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-string">"simple math"</span>);  <span class="hljs-comment">//最后一个参数是自定义的错误参数嗷！！！</span><br>     assertNotEquals(<span class="hljs-number">3</span>, <span class="hljs-number">1</span> + <span class="hljs-number">1</span>);<br><br>     assertNotSame(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());<br>     <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>     assertSame(obj, obj);<br><br>     assertFalse(<span class="hljs-number">1</span> &gt; <span class="hljs-number">2</span>);<br>     assertTrue(<span class="hljs-number">1</span> &lt; <span class="hljs-number">2</span>);<br><br>     assertNull(<span class="hljs-literal">null</span>);<br>     assertNotNull(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="3-2、数组断言"><a href="#3-2、数组断言" class="headerlink" title="3.2、数组断言"></a>3.2、数组断言</h4><p>通过 assertArrayEquals 方法来判断两个对象或原始类型的数组是否相等</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("array assertion")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">array</span><span class="hljs-params">()</span> {<br>    assertArrayEquals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>}, <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>});<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="3-3、组合断言"><a href="#3-3、组合断言" class="headerlink" title="3.3、组合断言"></a>3.3、组合断言</h4><p>assertAll 方法接受多个 org.junit.jupiter.api.Executable 函数式接口的实例作为要验证的断言，可以通过 lambda 表达式很容易的提供这些断言</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("assert all")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">all</span><span class="hljs-params">()</span> {<br> assertAll(<span class="hljs-string">"Math"</span>,<br>    	() -&gt; assertEquals(<span class="hljs-number">2</span>, <span class="hljs-number">1</span> + <span class="hljs-number">1</span>),<br>    	() -&gt; assertTrue(<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>)<br> 	);<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="3-4、异常断言"><a href="#3-4、异常断言" class="headerlink" title="3.4、异常断言"></a>3.4、异常断言</h4><p>在JUnit4时期，想要测试方法的异常情况时，需要用@Rule注解的ExpectedException变量还是比较麻烦的。而JUnit5提供了一种新的断言方式Assertions.assertThrows() ,配合函数式编程就可以进行使用。(断定业务逻辑一定会出现某些异常，如果正常执行则会报错嗷！！！)</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("异常测试")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionTest</span><span class="hljs-params">()</span> {<br>    <span class="hljs-type">ArithmeticException</span> <span class="hljs-variable">exception</span> <span class="hljs-operator">=</span> Assertions.assertThrows(<br>           <span class="hljs-comment">//扔出断言异常</span><br>            ArithmeticException.class, () -&gt; System.out.println(<span class="hljs-number">1</span> % <span class="hljs-number">0</span>));<br><br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="3-5、超时断言"><a href="#3-5、超时断言" class="headerlink" title="3.5、超时断言"></a>3.5、超时断言</h4><p>Junit5还提供了Assertions.assertTimeout() 为测试方法设置了超时时间</p>
<ul>
<li>断定业务逻辑一定在我指定的时间内完成</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("超时测试")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutTest</span><span class="hljs-params">()</span> {<br>    <span class="hljs-comment">//如果测试方法时间超过1s将会异常</span><br>    Assertions.assertTimeout(Duration.ofMillis(<span class="hljs-number">1000</span>), () -&gt; Thread.sleep(<span class="hljs-number">500</span>));<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="3-6、快速失败"><a href="#3-6、快速失败" class="headerlink" title="3.6、快速失败"></a>3.6、快速失败</h4><p>通过 fail 方法直接使得测试失败</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("fail")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFail</span><span class="hljs-params">()</span> {<br>    fail(<span class="hljs-string">"This should fail"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>





<h3 id="4、前置条件（assumptions）"><a href="#4、前置条件（assumptions）" class="headerlink" title="4、前置条件（assumptions）"></a>4、前置条件（assumptions）</h3><p>JUnit 5 中的前置条件（assumptions【假设】）类似于断言，不同之处在于不满足的断言会使得测试方法失败，而不满足的前置条件只会使得测试方法的执行终止。前置条件可以看成是测试方法执行的前提，当该前提不满足时，就没有继续执行的必要。（即跳过当前的方法不执行剩下的代码嗷！！！）</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName("前置条件")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssumptionsTest</span> {<br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> <span class="hljs-string">"DEV"</span>;<br>}<br>    <br> <span class="hljs-meta">@Test</span><br> <span class="hljs-meta">@DisplayName("simple")</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simpleAssume</span><span class="hljs-params">()</span> {<br>    assumeTrue(Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">"DEV"</span>));<br>    assumeFalse(() -&gt; Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">"PROD"</span>));<br> }<br> <br> <span class="hljs-meta">@Test</span><br> <span class="hljs-meta">@DisplayName("assume then do")</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">assumeThenDo</span><span class="hljs-params">()</span> {<br>    assumingThat(<br>       Objects.equals(<span class="hljs-built_in">this</span>.environment, <span class="hljs-string">"DEV"</span>),<br>       () -&gt; System.out.println(<span class="hljs-string">"In DEV"</span>)<br>    );<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>assumeTrue 和 assumFalse 确保给定的条件为 true 或 false，不满足条件会使得测试执行终止。assumingThat 的参数是表示条件的布尔值和对应的 Executable 接口的实现对象。只有条件满足时，Executable 对象才会被执行；当条件不满足时，测试执行并不会终止。</p>
<h3 id="5、嵌套测试"><a href="#5、嵌套测试" class="headerlink" title="5、嵌套测试"></a>5、嵌套测试</h3><p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用@BeforeEach 和@AfterEach 注解，而且嵌套的层次没有限制。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName("A stack")</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestingAStackDemo</span> {<br><br>    Stack&lt;Object&gt; stack;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName("is instantiated with new Stack()")</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">isInstantiatedWithNew</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    }<br><br>    <span class="hljs-meta">@Nested</span><br>    <span class="hljs-meta">@DisplayName("when new")</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhenNew</span> {<br><br>        <span class="hljs-meta">@BeforeEach</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">createNewStack</span><span class="hljs-params">()</span> {<br>            stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("is empty")</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> {<br>            assertTrue(stack.isEmpty());<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("throws EmptyStackException when popped")</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">throwsExceptionWhenPopped</span><span class="hljs-params">()</span> {<br>            assertThrows(EmptyStackException.class, stack::pop);<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("throws EmptyStackException when peeked")</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">throwsExceptionWhenPeeked</span><span class="hljs-params">()</span> {<br>            assertThrows(EmptyStackException.class, stack::peek);<br>        }<br><br>        <span class="hljs-meta">@Nested</span><br>        <span class="hljs-meta">@DisplayName("after pushing an element")</span><br>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterPushing</span> {<br><br>            <span class="hljs-type">String</span> <span class="hljs-variable">anElement</span> <span class="hljs-operator">=</span> <span class="hljs-string">"an element"</span>;<br><br>            <span class="hljs-meta">@BeforeEach</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">pushAnElement</span><span class="hljs-params">()</span> {<br>                stack.push(anElement);<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("it is no longer empty")</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">isNotEmpty</span><span class="hljs-params">()</span> {<br>                assertFalse(stack.isEmpty());<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("returns the element when popped and is empty")</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnElementWhenPopped</span><span class="hljs-params">()</span> {<br>                assertEquals(anElement, stack.pop());<br>                assertTrue(stack.isEmpty());<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("returns the element when peeked but remains not empty")</span><br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnElementWhenPeeked</span><span class="hljs-params">()</span> {<br>                assertEquals(anElement, stack.peek());<br>                assertFalse(stack.isEmpty());<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165618.png" srcset="/img/loading.gif" lazyload alt="image-20210721165618766"></p>
<ul>
<li>栈的驱动的规则：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165828.png" srcset="/img/loading.gif" lazyload alt="image-20210721165828334"></p>
<ul>
<li>明显的层级关系：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721165947.png" srcset="/img/loading.gif" lazyload alt="image-20210721165946971"></p>
<h3 id="6、参数化测试"><a href="#6、参数化测试" class="headerlink" title="6、参数化测试"></a>6、参数化测试</h3><p>参数化测试是JUnit5很重要的一个新特性，它使得用不同的参数多次运行测试成为了可能，也为我们的单元测试带来许多便利。</p>
<p>利用@ValueSource等注解，指定入参，我们将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。</p>
<p>@ValueSource: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型</p>
<p>@NullSource: 表示为参数化测试提供一个null的入参</p>
<p>@EnumSource: 表示为参数化测试提供一个枚举入参</p>
<p>@CsvFileSource：表示读取指定CSV文件内容作为参数化测试入参</p>
<p>@MethodSource：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<p>当然如果参数化测试仅仅只能做到指定普通的入参还达不到让我觉得惊艳的地步。让我真正感到他的强大之处的地方在于他可以支持外部的各类入参。如:CSV,YML,JSON 文件甚至方法的返回值也可以作为入参。只需要去实现ArgumentsProvider接口，任何外部文件都可以作为它的入参。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@ValueSource(strings = {"one", "two", "three"})</span><br><span class="hljs-meta">@DisplayName("参数化测试1")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parameterizedTest1</span><span class="hljs-params">(String string)</span> {<br>    System.out.println(string);<br>    Assertions.assertTrue(StringUtils.isNotBlank(string));<br>}<br><br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@MethodSource("method")</span>    <span class="hljs-comment">//指定方法名</span><br><span class="hljs-meta">@DisplayName("方法来源参数")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithExplicitLocalMethodSource</span><span class="hljs-params">(String name)</span> {<br>    System.out.println(name);<br>    Assertions.assertNotNull(name);<br>}<br><br><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {<br>    <span class="hljs-keyword">return</span> Stream.of(<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>



<h3 id="7、迁移指南"><a href="#7、迁移指南" class="headerlink" title="7、迁移指南"></a>7、迁移指南</h3><p>在进行迁移的时候需要注意如下的变化：</p>
<ul>
<li><p>注解在 org.junit.jupiter.api 包中，断言在 org.junit.jupiter.api.Assertions 类中，前置条件在 org.junit.jupiter.api.Assumptions 类中。</p>
</li>
<li><p>把@Before 和@After 替换成@BeforeEach 和@AfterEach。</p>
</li>
<li><p>把@BeforeClass 和@AfterClass 替换成@BeforeAll 和@AfterAll。</p>
</li>
<li><p>把@Ignore 替换成@Disabled。</p>
</li>
<li><p>把@Category 替换成@Tag。</p>
</li>
<li><p>把@RunWith、@Rule 和@ClassRule 替换成@ExtendWith。</p>
</li>
</ul>
<h2 id="指标监控："><a href="#指标监控：" class="headerlink" title="指标监控："></a>指标监控：</h2><h3 id="1、SpringBoot-Actuator"><a href="#1、SpringBoot-Actuator" class="headerlink" title="1、SpringBoot Actuator"></a>1、SpringBoot Actuator</h3><h4 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h4><p>未来每一个微服务在云上部署以后，我们都需要对其进行监控、追踪、审计、控制等。SpringBoot就抽取了Actuator场景，使得我们每个微服务快速引用即可获得生产级别的应用监控、审计等功能。</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606886483335-697ee1c1-2f69-43ab-bddc-3a038382319c.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>加入了对应的配置之后，我们需要对应配置文件中，关于web暴露的EndPoints进行配置，才能够更加方便的使用嗷！！！</li>
<li>使用步骤：<ul>
<li>引入依赖</li>
<li>配置文件中暴露出来嗷！！！</li>
</ul>
</li>
</ul>
<h4 id="2、1-x与2-x的不同"><a href="#2、1-x与2-x的不同" class="headerlink" title="2、1.x与2.x的不同"></a>2、1.x与2.x的不同</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606884394162-ac7f2d8e-7abb-44df-9998-fb0f2705f238.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="3、如何使用"><a href="#3、如何使用" class="headerlink" title="3、如何使用"></a>3、如何使用</h4><ul>
<li><p>引入场景</p>
</li>
<li><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator/</a>**</p>
</li>
<li><p>暴露所有监控信息为HTTP</p>
</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#暴露所有端点信息</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">'*'</span>  <span class="hljs-comment">#以web方式暴露</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>测试</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/beans">http://localhost:8080/actuator/beans</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/configprops">http://localhost:8080/actuator/configprops</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/metrics</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics/jvm.gc.pause">http://localhost:8080/actuator/metrics/jvm.gc.pause</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/</a>endpointName/detailPath<br>。。。。。。</p>
<h4 id="4、可视化"><a href="#4、可视化" class="headerlink" title="4、可视化"></a>4、可视化</h4><p><a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></p>
<ul>
<li>打开官方文档，根据Quick Start中新建一个项目，引入对应的依赖和注解之后，就可以学怎么使用了嗷！！！</li>
</ul>
<h3 id="2、Actuator-Endpoint"><a href="#2、Actuator-Endpoint" class="headerlink" title="2、Actuator Endpoint"></a>2、Actuator Endpoint</h3><h4 id="1、最常使用的端点"><a href="#1、最常使用的端点" class="headerlink" title="1、最常使用的端点"></a>1、最常使用的端点</h4><table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>暴露当前应用程序的审核事件信息。需要一个<code>AuditEventRepository组件</code>。</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>显示应用程序中所有Spring Bean的完整列表。</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>暴露可用的缓存。</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>显示自动配置的所有条件信息，包括匹配或不匹配的原因。</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>显示所有<code>@ConfigurationProperties</code>。</td>
</tr>
<tr>
<td><code>env</code></td>
<td>暴露Spring的属性<code>ConfigurableEnvironment</code></td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>显示已应用的所有Flyway数据库迁移。 需要一个或多个<code>Flyway</code>组件。</td>
</tr>
<tr>
<td><code>health</code></td>
<td>显示应用程序运行状况信息。</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个<code>HttpTraceRepository</code>组件。</td>
</tr>
<tr>
<td><code>info</code></td>
<td>显示应用程序信息。</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>显示Spring <code>integrationgraph</code> 。需要依赖<code>spring-integration-core</code>。</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>显示和修改应用程序中日志的配置。</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>显示已应用的所有Liquibase数据库迁移。需要一个或多个<code>Liquibase</code>组件。</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>显示当前应用程序的“指标”信息。</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>显示所有<code>@RequestMapping</code>路径列表。</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>显示应用程序中的计划任务。</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>使应用程序正常关闭。默认禁用。</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>显示由<code>ApplicationStartup</code>收集的启动步骤数据。需要使用<code>SpringApplication</code>进行配置<code>BufferingApplicationStartup</code>。</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>执行线程转储。</td>
</tr>
</tbody></table>
<p>如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>heapdump</code></td>
<td>返回<code>hprof</code>堆转储文件。</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>通过HTTP暴露JMX bean（需要引入Jolokia，不适用于WebFlux）。需要引入依赖<code>jolokia-core</code>。</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>返回日志文件的内容（如果已设置<code>logging.file.name</code>或<code>logging.file.path</code>属性）。支持使用HTTP<code>Range</code>标头来检索部分日志文件的内容。</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>以Prometheus服务器可以抓取的格式公开指标。需要依赖<code>micrometer-registry-prometheus</code>。</td>
</tr>
</tbody></table>
<p>最常用的Endpoint</p>
<ul>
<li><p><strong>Health：监控状况</strong></p>
</li>
<li><p><strong>Metrics：运行时指标</strong></p>
</li>
<li><p><strong>Loggers：日志记录</strong></p>
</li>
<li><p>默认show-details都是关闭的，需要手动设为开启的，方便我们查看内部的详细信息。<img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721224151.png" srcset="/img/loading.gif" lazyload alt="image-20210721224151384"></p>
</li>
</ul>
<h4 id="2、Health-Endpoint"><a href="#2、Health-Endpoint" class="headerlink" title="2、Health Endpoint"></a>2、Health Endpoint</h4><p>健康检查端点，我们一般用于在云平台，平台会定时的检查应用的健康状况，我们就需要Health Endpoint可以为平台返回当前应用的一系列组件健康状况的集合。</p>
<p>重要的几点：</p>
<ul>
<li><p>health endpoint返回的结果，应该是一系列健康检查后的一个汇总报告</p>
</li>
<li><p>很多的健康检查默认已经自动配置好了，比如：数据库、redis等</p>
</li>
<li><p>可以很容易的添加自定义的健康检查机制</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606908975702-4f9a3208-15ca-4a78-9f76-939ef986db7e.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="3、Metrics-Endpoint"><a href="#3、Metrics-Endpoint" class="headerlink" title="3、Metrics Endpoint"></a>3、Metrics Endpoint</h4><p>提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；</p>
<ul>
<li><p>通过Metrics对接多种监控系统</p>
</li>
<li><p>简化核心Metrics开发</p>
</li>
<li><p>添加自定义Metrics或者扩展已有Metrics</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606909073222-c6e77ca3-4b1c-4f38-a1c6-8614dec4f7bc.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="4、管理Endpoints"><a href="#4、管理Endpoints" class="headerlink" title="4、管理Endpoints"></a>4、管理Endpoints</h4><h5 id="1、开启与禁用Endpoints"><a href="#1、开启与禁用Endpoints" class="headerlink" title="1、开启与禁用Endpoints"></a>1、开启与禁用Endpoints</h5><ul>
<li>默认所有的Endpoint除过shutdown都是开启的。</li>
<li>需要开启或者禁用某个Endpoint。配置模式为  <strong>management.endpoint.&lt;endpointName&gt;.enabled = true</strong></li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">beans:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>或者禁用所有的Endpoint然后手动开启指定的Endpoint</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">beans:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></tbody></table></figure>





<h5 id="2、暴露Endpoints"><a href="#2、暴露Endpoints" class="headerlink" title="2、暴露Endpoints"></a>2、暴露Endpoints</h5><p>支持的暴露方式</p>
<ul>
<li><p>HTTP：默认只暴露<strong>health</strong>和<strong>info</strong> Endpoint</p>
</li>
<li><p><strong>JMX</strong>：默认暴露所有Endpoint</p>
</li>
<li><p>除过health和info，剩下的Endpoint都应该进行保护访问。如果引入SpringSecurity，则会默认配置安全访问规则</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>ID</th>
<th>JMX</th>
<th>Web</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>env</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>health</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>heapdump</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>info</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody></table>
<p>手动配置暴露Web端口的对应的EndPoints，方便前后端的交互：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210721223231.png" srcset="/img/loading.gif" lazyload alt="image-20210721223231643"></p>
<h3 id="3、定制-Endpoint"><a href="#3、定制-Endpoint" class="headerlink" title="3、定制 Endpoint"></a>3、定制 Endpoint</h3><h4 id="1、定制-Health-信息"><a href="#1、定制-Health-信息" class="headerlink" title="1、定制 Health 信息"></a>1、定制 Health 信息</h4><ul>
<li>实现接口</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.Health;<br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHealthIndicator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HealthIndicator</span> {<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Health <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {<br>        <span class="hljs-type">int</span> <span class="hljs-variable">errorCode</span> <span class="hljs-operator">=</span> check(); <span class="hljs-comment">// perform some specific health check</span><br>        <span class="hljs-keyword">if</span> (errorCode != <span class="hljs-number">0</span>) {<br>            <span class="hljs-keyword">return</span> Health.down().withDetail(<span class="hljs-string">"Error Code"</span>, errorCode).build();<br>        }<br>        <span class="hljs-keyword">return</span> Health.up().build();<br>    }<br><br>}<br><br>构建Health<br><span class="hljs-type">Health</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> Health.down()<br>                .withDetail(<span class="hljs-string">"msg"</span>, <span class="hljs-string">"error service"</span>)<br>                .withDetail(<span class="hljs-string">"code"</span>, <span class="hljs-string">"500"</span>)<br>                .withException(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>())<br>                .build();<br>management:<br>    health:<br>      enabled: <span class="hljs-literal">true</span><br>      show-details: always #总是显示详细信息。可显示每个模块的状态信息<br></code></pre></td></tr></tbody></table></figure>



<ul>
<li>继承抽象类</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComHealthIndicator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHealthIndicator</span> {<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 真实的检查方法</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> builder</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHealthCheck</span><span class="hljs-params">(Health.Builder builder)</span> <span class="hljs-keyword">throws</span> Exception {<br>        <span class="hljs-comment">//mongodb。  获取连接进行测试</span><br>        Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// 检查完成</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>){<br><span class="hljs-comment">//            builder.up(); //健康</span><br>            builder.status(Status.UP);<br>            map.put(<span class="hljs-string">"count"</span>,<span class="hljs-number">1</span>);<br>            map.put(<span class="hljs-string">"ms"</span>,<span class="hljs-number">100</span>);<br>        }<span class="hljs-keyword">else</span> {<br><span class="hljs-comment">//            builder.down();</span><br>            builder.status(Status.OUT_OF_SERVICE);<br>            map.put(<span class="hljs-string">"err"</span>,<span class="hljs-string">"连接超时"</span>);<br>            map.put(<span class="hljs-string">"ms"</span>,<span class="hljs-number">3000</span>);<br>        }<br><br><br>        builder.withDetail(<span class="hljs-string">"code"</span>,<span class="hljs-number">100</span>)<br>                .withDetails(map);<br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722160510.png" srcset="/img/loading.gif" lazyload alt="image-20210722160510274"></p>
<h4 id="2、定制info信息"><a href="#2、定制info信息" class="headerlink" title="2、定制info信息"></a>2、定制info信息</h4><p>常用两种方式：</p>
<h5 id="1、编写配置文件"><a href="#1、编写配置文件" class="headerlink" title="1、编写配置文件"></a>1、编写配置文件</h5><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">info:</span><br>  <span class="hljs-attr">appName:</span> <span class="hljs-string">boot-admin</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.1</span><br>  <span class="hljs-attr">mavenProjectName:</span> <span class="hljs-string">@project.artifactId@</span>  <span class="hljs-comment">#使用@@可以获取maven的pom文件值</span><br>  <span class="hljs-attr">mavenProjectVersion:</span> <span class="hljs-string">@project.version@</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722160756.png" srcset="/img/loading.gif" lazyload alt="image-20210722160756108"></p>
<ul>
<li>如果要去父类中的信息也可以取到的，<code>@project.parent.Information@</code>这种形式就可以取到嗷！！！</li>
</ul>
<h5 id="2、编写InfoContributor"><a href="#2、编写InfoContributor" class="headerlink" title="2、编写InfoContributor"></a>2、编写InfoContributor</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Collections;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.info.Info;<br><span class="hljs-keyword">import</span> org.springframework.boot.actuate.info.InfoContributor;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleInfoContributor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InfoContributor</span> {<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contribute</span><span class="hljs-params">(Info.Builder builder)</span> {<br>        builder.withDetail(<span class="hljs-string">"example"</span>,<br>                Collections.singletonMap(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>));<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722161322.png" srcset="/img/loading.gif" lazyload alt="image-20210722161321910"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/info">http://localhost:8080/actuator/info</a> 会输出以上方式返回的所有info信息</p>
<h4 id="3、定制Metrics信息"><a href="#3、定制Metrics信息" class="headerlink" title="3、定制Metrics信息"></a>3、定制Metrics信息</h4><h5 id="1、SpringBoot支持自动适配的Metrics"><a href="#1、SpringBoot支持自动适配的Metrics" class="headerlink" title="1、SpringBoot支持自动适配的Metrics"></a>1、SpringBoot支持自动适配的Metrics</h5><ul>
<li><p>JVM metrics, report utilization of:</p>
<ul>
<li>Various memory and buffer pools</li>
<li>Statistics related to garbage collection</li>
<li>Threads utilization</li>
<li>Number of classes loaded/unloaded</li>
</ul>
</li>
<li><p>CPU metrics</p>
</li>
<li><p>File descriptor metrics</p>
</li>
<li><p>Kafka consumer and producer metrics</p>
</li>
<li><p>Log4j2 metrics: record the number of events logged to Log4j2 at each level</p>
</li>
<li><p>Logback metrics: record the number of events logged to Logback at each level</p>
</li>
<li><p>Uptime metrics: report a gauge for uptime and a fixed gauge representing the application’s absolute start time</p>
</li>
<li><p>Tomcat metrics (<code>server.tomcat.mbeanregistry.enabled</code> must be set to <code>true</code> for all Tomcat metrics to be registered)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-integration/docs/5.4.1/reference/html/system-management.html#micrometer-integration">Spring Integration</a> metrics</p>
</li>
</ul>
<h5 id="2、增加定制Metrics"><a href="#2、增加定制Metrics" class="headerlink" title="2、增加定制Metrics"></a>2、增加定制Metrics</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span>{<br>    Counter counter;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyService</span><span class="hljs-params">(MeterRegistry meterRegistry)</span>{<br>         counter = meterRegistry.counter(<span class="hljs-string">"myservice.method.running.counter"</span>);<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> {<br>        counter.increment();<br>        <span class="hljs-comment">//统计hello被调用的次数，每次被调用就加一</span><br>    }<br>}<br><br><br><span class="hljs-comment">//也可以使用下面的方式</span><br><span class="hljs-meta">@Bean</span><br>MeterBinder <span class="hljs-title function_">queueSize</span><span class="hljs-params">(Queue queue)</span> {<br>    <span class="hljs-keyword">return</span> (registry) -&gt; Gauge.builder(<span class="hljs-string">"queueSize"</span>, queue::size).register(registry);<br>}<br></code></pre></td></tr></tbody></table></figure>





<h4 id="4、定制Endpoint"><a href="#4、定制Endpoint" class="headerlink" title="4、定制Endpoint"></a>4、定制Endpoint</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Endpoint(id = "myservice")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DockerEndpoint</span> {<br>    <span class="hljs-meta">@ReadOperation</span><br>    <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">getDockerInfo</span><span class="hljs-params">()</span>{<br>        <span class="hljs-keyword">return</span> Collections.singletonMap(<span class="hljs-string">"info"</span>,<span class="hljs-string">"docker started..."</span>);<br>    }<br><br>    <span class="hljs-meta">@WriteOperation</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">restartDocker</span><span class="hljs-params">()</span>{<br>        System.out.println(<span class="hljs-string">"docker restarted...."</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>场景：开发<strong>ReadinessEndpoint</strong>来管理程序是否就绪，或者<strong>Liveness****Endpoint</strong>来管理程序是否存活；</p>
<ul>
<li>可以结合ConfigurationProperties开启对应的配置功能。</li>
</ul>
<p>当然，这个也可以直接使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-kubernetes-probes">https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-kubernetes-probes</a></p>
<h2 id="原理解析"><a href="#原理解析" class="headerlink" title="原理解析"></a>原理解析</h2><h3 id="1、Profile功能"><a href="#1、Profile功能" class="headerlink" title="1、Profile功能"></a>1、Profile功能</h3><p>为了方便多环境适配，springboot简化了profile功能。</p>
<h4 id="1、application-profile功能"><a href="#1、application-profile功能" class="headerlink" title="1、application-profile功能"></a>1、application-profile功能</h4><ul>
<li><p>默认配置文件  application.yaml；任何时候都会加载</p>
</li>
<li><p>指定环境配置文件  application-{env}.yaml</p>
</li>
<li><p>激活指定环境</p>
<ul>
<li>配置文件激活</li>
<li>命令行激活：java -jar xxx.jar –<strong>spring.profiles.active=prod  –person.name=haha</strong><ul>
<li><strong>修改配置文件的任意值，命令行优先</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>默认配置与环境配置同时生效</p>
</li>
<li><p>同名配置项，profile配置优先</p>
</li>
</ul>
<h4 id="2、-Profile条件装配功能"><a href="#2、-Profile条件装配功能" class="headerlink" title="2、@Profile条件装配功能"></a>2、@Profile条件装配功能</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Profile("production")</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductionConfiguration</span> {<br><br>    <span class="hljs-comment">// ...</span><br><br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><p>production环境下下面的才生效嗷，比较常用在@Bean上面，在对应的Profile下，相应的配置才会生效（有点像ConditionOnBean的那种感觉，现在是ConditionalOnProfile）。可以标注在方法上或者是类上。</p>
</li>
<li><p>@Profile可以设置值为一个list，里面可以加上“default”，就是默认情况下后面的配置会生效。</p>
</li>
</ul>
<h4 id="3、profile分组"><a href="#3、profile分组" class="headerlink" title="3、profile分组"></a>3、profile分组</h4><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.profiles.group.production[0]</span>=<span class="hljs-string">proddb</span><br><span class="hljs-attr">spring.profiles.group.production[1]</span>=<span class="hljs-string">prodmq</span><br><br><span class="hljs-attr">使用：--spring.profiles.active</span>=<span class="hljs-string">production  激活</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>上面这个会加载production整个组，这个组中实际对应的application-proddb/-prodmq这两个配置文件嗷！！！（本质就是分组嘛！！！）</li>
</ul>
<h4 id="4、小例子："><a href="#4、小例子：" class="headerlink" title="4、小例子："></a>4、小例子：</h4><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722192435.png" srcset="/img/loading.gif" lazyload alt="image-20210722192435511"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722192905.png" srcset="/img/loading.gif" lazyload alt="image-20210722192905058"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210722193108.png" srcset="/img/loading.gif" lazyload alt="image-20210722193108097"></p>
<h3 id="2、外部化配置"><a href="#2、外部化配置" class="headerlink" title="2、外部化配置"></a>2、外部化配置</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</a></p>
<ol>
<li><p>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</p>
</li>
<li><p><code>@PropertySource</code> annotations on your <code>@Configuration</code> classes. Please note that such property sources are not added to the <code>Environment</code> until the application context is being refreshed. This is too late to configure certain properties such as <code>logging.*</code> and <code>spring.main.*</code> which are read before refresh begins.</p>
</li>
<li><p><strong>Config data (such as</strong> <code>**application.properties**</code> <strong>files)</strong></p>
</li>
<li><p>A <code>RandomValuePropertySource</code> that has properties only in <code>random.*</code>.</p>
</li>
<li><p>OS environment variables.</p>
</li>
<li><p>Java System properties (<code>System.getProperties()</code>).</p>
</li>
<li><p>JNDI attributes from <code>java:comp/env</code>.</p>
</li>
<li><p><code>ServletContext</code> init parameters.</p>
</li>
<li><p><code>ServletConfig</code> init parameters.</p>
</li>
<li><p>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</p>
</li>
<li><p>Command line arguments.</p>
</li>
<li><p><code>properties</code> attribute on your tests. Available on <code>@SpringBootTest</code> and the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">test annotations for testing a particular slice of your application</a>.</p>
</li>
<li><p><code>@TestPropertySource</code> annotations on your tests.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-devtools-globalsettings">Devtools global settings properties</a> in the <code>$HOME/.config/spring-boot</code> directory when devtools is active.</p>
</li>
</ol>
<h4 id="1、外部配置源"><a href="#1、外部配置源" class="headerlink" title="1、外部配置源"></a>1、外部配置源</h4><p>常用：<strong>Java属性文件</strong>、<strong>YAML文件</strong>、<strong>环境变量</strong>、<strong>命令行参数</strong>；</p>
<h4 id="2、配置文件查找位置"><a href="#2、配置文件查找位置" class="headerlink" title="2、配置文件查找位置"></a>2、配置文件查找位置</h4><p>(1) classpath 根路径</p>
<p>(2) classpath 根路径下config目录</p>
<p>(3) jar包当前目录</p>
<p>(4) jar包当前目录的config目录</p>
<p>(5) /config子目录的直接子目录</p>
<ul>
<li>优先级越往下越高嗷！！！！！</li>
</ul>
<h4 id="3、配置文件加载顺序："><a href="#3、配置文件加载顺序：" class="headerlink" title="3、配置文件加载顺序："></a>3、配置文件加载顺序：</h4><ol>
<li>　当前jar包内部的application.properties和application.yml</li>
<li>　当前jar包内部的application-{profile}.properties 和 application-{profile}.yml</li>
<li>　引用的外部jar包的application.properties和application.yml</li>
<li>　引用的外部jar包的application-{profile}.properties 和 application-{profile}.yml</li>
</ol>
<ul>
<li>优先级越往下越高嗷！！！！！</li>
</ul>
<h4 id="4、指定环境优先，外部优先，后面的可以覆盖前面的同名配置项"><a href="#4、指定环境优先，外部优先，后面的可以覆盖前面的同名配置项" class="headerlink" title="4、指定环境优先，外部优先，后面的可以覆盖前面的同名配置项"></a>4、指定环境优先，外部优先，后面的可以覆盖前面的同名配置项</h4><h3 id="3、自定义starter"><a href="#3、自定义starter" class="headerlink" title="3、自定义starter"></a>3、自定义starter</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT?p=83&amp;spm_id_from=pageDriver">这个自定义的starter太强了！！！</a></p>
<h4 id="1、starter启动原理"><a href="#1、starter启动原理" class="headerlink" title="1、starter启动原理"></a>1、starter启动原理</h4><ul>
<li>starter-pom引入 autoconfigurer 包</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606995919308-b2c7ccaa-e720-4cc5-9801-2e170b3102e1.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><p>autoconfigure包中配置使用 <strong>META-INF/spring.factories</strong> 中 <strong>EnableAutoConfiguration 的值，使得项目启动加载指定的自动配置类</strong></p>
</li>
<li><p><strong>编写自动配置类 xxxAutoConfiguration -&gt; xxxxProperties</strong></p>
</li>
<li><p><strong>@Configuration</strong></p>
</li>
<li><p><strong>@Conditional</strong></p>
</li>
<li><p><strong>@EnableConfigurationProperties</strong></p>
</li>
<li><p><strong>@Bean</strong></p>
</li>
<li><p>……</p>
</li>
</ul>
<p><strong>引入starter</strong> <strong>— xxxAutoConfiguration — 容器中放入组件 —- 绑定xxxProperties —-</strong> <strong>配置项</strong></p>
<h4 id="2、自定义starter"><a href="#2、自定义starter" class="headerlink" title="2、自定义starter"></a>2、自定义starter</h4><p><strong>atguigu-hello-spring-boot-starter（启动器）</strong></p>
<p><strong>atguigu-hello-spring-boot-starter-autoconfigure（自动配置包）</strong></p>
<h3 id="4、SpringBoot原理"><a href="#4、SpringBoot原理" class="headerlink" title="4、SpringBoot原理"></a>4、SpringBoot原理</h3><p>Spring原理【<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gW411W7wy?p=1">Spring注解</a>】、<strong>SpringMVC</strong>原理、<strong>自动配置原理</strong>、SpringBoot原理</p>
<h4 id="1、SpringBoot启动过程"><a href="#1、SpringBoot启动过程" class="headerlink" title="1、SpringBoot启动过程"></a>1、SpringBoot启动过程</h4><ul>
<li><p>创建 <strong>SpringApplication</strong></p>
<ul>
<li><p>保存一些信息。</p>
</li>
<li><p>判定当前应用的类型。ClassUtils。Servlet</p>
</li>
<li><p><strong>bootstrappers****：初始启动引导器（</strong>List<bootstrapper><strong>）：去spring.factories文件中找</strong> org.springframework.boot.<strong>Bootstrapper</strong></bootstrapper></p>
</li>
<li><p>找 <strong>ApplicationContextInitializer</strong>；去<strong>spring.factories找ApplicationContextInitializer</strong></p>
<ul>
<li>List&lt;ApplicationContextInitializer&lt;?&gt;&gt; <strong>initializers</strong></li>
</ul>
</li>
<li><p><strong>找</strong> <strong>ApplicationListener  ；应用监听器。</strong>去<strong>spring.factories****找</strong> <strong>ApplicationListener</strong></p>
<ul>
<li>List&lt;ApplicationListener&lt;?&gt;&gt; <strong>listeners</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>运行 <strong>SpringApplication</strong></p>
<ul>
<li><p><strong>StopWatch</strong>：用于监控整个应用的启停的嗷！！！</p>
</li>
<li><p><strong>记录应用的启动时间</strong></p>
</li>
<li><p><strong>创建引导上下文（Context环境）</strong>createBootstrapContext()</p>
<ul>
<li>获取到所有之前的 <strong>bootstrappers（这个上面有哦！！！） 挨个执行</strong> intitialize() 来完成对引导启动器上下文环境设置</li>
</ul>
</li>
<li><p>让当前应用进入<strong>headless</strong>模式。<strong>java.awt.headless</strong></p>
</li>
<li><p><strong>获取所有</strong> <strong>RunListener</strong>（运行监听器）【为了方便所有Listener进行事件感知】</p>
<ul>
<li>getSpringFactoriesInstances 去<strong>spring.factories</strong>中找<strong>SpringApplicationRunListener</strong>. </li>
<li>遍历 <strong>SpringApplicationRunListener 调用 starting 方法；</strong></li>
<li><strong>相当于通知所有感兴趣系统正在启动过程的人，项目正在 starting。</strong></li>
</ul>
</li>
<li><p>保存命令行参数；ApplicationArguments</p>
</li>
<li><p>准备环境 prepareEnvironment（）;</p>
<ul>
<li><p>返回或者创建基础环境信息对象。<strong>StandardServletEnvironment</strong></p>
</li>
<li><p><strong>配置环境信息对象。</strong></p>
<ul>
<li><strong>读取所有的配置源的配置属性值。</strong></li>
</ul>
</li>
<li><p>绑定环境信息</p>
</li>
<li><p>监听器调用 listener.environmentPrepared()；通知所有的监听器当前环境准备完成</p>
</li>
</ul>
</li>
<li><p>创建IOC容器（createApplicationContext（））</p>
<ul>
<li>根据项目类型（Servlet）创建容器，</li>
<li>当前会创建 <strong>AnnotationConfigServletWebServerApplicationContext</strong></li>
</ul>
</li>
<li><p><strong>准备ApplicationContext IOC容器的基本信息</strong>  <strong>prepareContext()</strong></p>
<ul>
<li><p>保存环境信息</p>
</li>
<li><p>IOC容器的后置处理流程。</p>
</li>
<li><p>应用初始化器；applyInitializers；</p>
<ul>
<li>遍历所有的 <strong>ApplicationContextInitializer 。调用</strong> <strong>initialize.。来对ioc容器进行初始化扩展功能</strong></li>
<li>遍历所有的 listener 调用 <strong>contextPrepared。EventPublishRunListenr；通知所有的监听器****contextPrepared</strong></li>
</ul>
</li>
<li><p><strong>所有的监听器 调用</strong> <strong>contextLoaded。通知所有的监听器</strong> <strong>contextLoaded；</strong></p>
</li>
</ul>
</li>
<li><p><strong>刷新IOC容器。</strong>refreshContext</p>
<ul>
<li>创建容器中的所有组件（Spring注解）</li>
</ul>
</li>
<li><p>容器刷新完成后工作？afterRefresh</p>
</li>
<li><p>所有监听器调用 listeners.<strong>started</strong>(context); <strong>通知所有的监听器</strong> <strong>started</strong></p>
</li>
<li><p>调用所有runners；callRunners()</p>
<ul>
<li><p><strong>获取容器中的</strong> <strong>ApplicationRunner</strong> </p>
</li>
<li><p><strong>获取容器中的</strong>  <strong>CommandLineRunner</strong></p>
</li>
<li><p><strong>合并所有runner并且按照@Order进行排序</strong></p>
</li>
<li><p><strong>遍历所有的runner。调用 run</strong> <strong>方法</strong></p>
</li>
</ul>
</li>
<li><p><strong>如果以上有异常，</strong></p>
<ul>
<li><strong>调用Listener 的 failed</strong></li>
</ul>
</li>
<li><p><strong>调用所有监听器的 running 方法</strong>  listeners.running(context); <strong>通知所有的监听器</strong> <strong>running</strong> </p>
</li>
<li><p>running如果有问题。继续通知 failed 。调用所有 Listener 的failed；通知所有的监听器failed</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Bootstrapper</span> {<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Initialize the given {<span class="hljs-doctag">@link</span> BootstrapRegistry} with any required registrations.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> registry the registry to initialize</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">intitialize</span><span class="hljs-params">(BootstrapRegistry registry)</span>;<br><br>}<br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607005958877-bf152e3e-4d2d-42b6-a08c-ceef9870f3b6.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607004823889-8373cea4-6305-40c1-af3b-921b071a28a8.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1607006112013-6ed5c0a0-3e02-4bf1-bdb7-423e0a0b3f3c.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationRunner</span> {<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Callback used to run the bean.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> args incoming application arguments</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> Exception on error</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>}<br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CommandLineRunner</span> {<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Callback used to run the bean.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> args incoming main method arguments</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> Exception on error</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="2、Application-Events-and-Listeners"><a href="#2、Application-Events-and-Listeners" class="headerlink" title="2、Application Events and Listeners"></a>2、Application Events and Listeners</h4><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-application-events-and-listeners">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-application-events-and-listeners</a></p>
<p><strong>ApplicationContextInitializer</strong></p>
<p><strong>ApplicationListener</strong></p>
<p><strong>SpringApplicationRunListener</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210724161055.png" srcset="/img/loading.gif" lazyload alt="image-20210724161047849"></p>
<h4 id="3、ApplicationRunner-与-CommandLineRunner"><a href="#3、ApplicationRunner-与-CommandLineRunner" class="headerlink" title="3、ApplicationRunner 与 CommandLineRunner"></a>3、ApplicationRunner 与 CommandLineRunner</h4><ul>
<li><p>放入容器中，就能够得到嗷！！！</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210724161802.png" srcset="/img/loading.gif" lazyload alt="image-20210724161802363"></p>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%90%8E%E7%AB%AF/">#后端</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SpringBoot2-x</div>
      <div>http://example.com/2021/07/13/springboot2-x/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Alexander Liu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年7月13日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/07/24/spring-cloud-spring-cloud-alibaba/" title="Spring Cloud + Spring Cloud Alibaba">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring Cloud + Spring Cloud Alibaba</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/07/03/springboot-an-lai-la/" title="SpringBoot俺来啦">
                        <span class="hidden-mobile">SpringBoot俺来啦</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
