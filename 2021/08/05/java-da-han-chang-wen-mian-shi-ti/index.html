<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Java常问面试题总结与提高, 分布式系统,后端研发,数据协同">
    <meta name="description" content="Java高频考点


1. 局部变量表和计算栈
非常有意思的一道题目嗷！！！

知识点在于栈，局部变量表等东西的操作嗷，类似于Println和符号运算这样的操作。本质上，都是先把操作数放在栈里面，然后对于栈里面的数字进行操作的。
然后就是+">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Java常问面试题总结与提高 | 兔の博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <style>
        body{
            background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="兔の博客" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">兔の博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">兔の博客</div>
        <div class="logo-desc">
            
            欢迎来到兔子的小窝，这里是兔子的一些笔记分享
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Java常问面试题总结与提高</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%A4%A7%E4%B8%89%E8%87%AA%E5%AD%A6/">
                                <span class="chip bg-color">大三自学</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-08-05
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-10-12
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    12.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    45 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Java高频考点"><a href="#Java高频考点" class="headerlink" title="Java高频考点"></a>Java高频考点</h1><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210805214421.png" alt="image-20210805214421596"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210805214638.png" alt="image-20210805214638422"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210805214700.png" alt="image-20210805214700114"></p>
<h1 id="1-局部变量表和计算栈"><a href="#1-局部变量表和计算栈" class="headerlink" title="1. 局部变量表和计算栈"></a>1. 局部变量表和计算栈</h1><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210829092913.png" alt="image-20210829092912831"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/happy_bigqiang/article/details/90414541">非常有意思的一道题目嗷！！！</a></p>
<ul>
<li>知识点在于栈，局部变量表等东西的操作嗷，类似于Println和符号运算这样的操作。本质上，都是先把操作数放在栈里面，然后对于栈里面的数字进行操作的。</li>
<li>然后就是++这样的操作，在前在后，对于局部变量表操作和栈操作的顺序是不一样的嗷！！！</li>
</ul>
<h1 id="2-Singleton示例"><a href="#2-Singleton示例" class="headerlink" title="2. Singleton示例"></a>2. Singleton示例</h1><ul>
<li><p>单例，系统中只有一个实例对象可以被获取和使用的代码模式。例如JVM运行环境中的Runtime类</p>
</li>
<li><p>要点：</p>
<ul>
<li><p>某个类只能由一个实例</p>
<ul>
<li>构造器私有化</li>
</ul>
</li>
<li><p>必须自行创建这个实例</p>
<ul>
<li>静态变量来保证实例唯一</li>
</ul>
</li>
<li><p>必须向整个系统提供这个实例</p>
<ul>
<li>向整个系统提供这个实例：</li>
</ul>
<ol>
<li>直接暴露</li>
<li>静态变量的get方法获取</li>
</ol>
</li>
</ul>
</li>
<li><p>创建类型：</p>
<ol>
<li>饿汉式：</li>
</ol>
<ul>
<li>直接实例化饿汉式</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210829163721.png" alt="image-20210829163713857"></p>
<p>获取这个对象：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210829164100.png" alt="image-20210829164100868"></p>
<ol start="2">
<li>JDK1.5之后，枚举类型：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210829163830.png" alt="image-20210829163830867"></p>
<p>获取这个对象：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210829164212.png" alt="image-20210829164212855"></p>
<p>枚举类型会帮助我们重写String方法嗷！</p>
<ol start="3">
<li>静态代码块的方式：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210901222143.png" alt="image-20210901222143617"></p>
<p>类初始化的时候new处对象，保证对象只在初始化的时候创建一次嗷！！！</p>
<ol start="2">
<li>懒汉式：</li>
</ol>
</li>
</ul>
<h1 id="3-volatile"><a href="#3-volatile" class="headerlink" title="3. volatile:"></a>3. volatile:</h1><p>volatile是什么</p>
<ul>
<li>轻量级的同步机制</li>
<li>特性：<ul>
<li>保证可见性</li>
<li>不保证原子性</li>
<li>禁止指令重排</li>
</ul>
</li>
</ul>
<h2 id="JMM："><a href="#JMM：" class="headerlink" title="JMM："></a>JMM：</h2><ul>
<li>JVM（Java虚拟机）</li>
<li>JMM（Java内存模型）：<ul>
<li>并不真实存在，描述的是一组规则或规范</li>
</ul>
</li>
<li>几个概念：<ul>
<li>主内存：<ul>
<li><strong>共享</strong>内存区域，所有线程都可以访问嗷！</li>
</ul>
</li>
<li>工作内存：<ul>
<li>每个线程私有的工作内存空间</li>
</ul>
</li>
</ul>
</li>
<li>各自线程的工作内存会拷贝主内存中对应的数据，然后各自对于数据进行修改，修改完成之后，才会尝试将数据<strong>写回</strong>主物理内存。</li>
<li>只有在工作内存才能够对于变量进行修改嗷！！！不同的线程是不能够访问对方的工作内存嗷！！！工作内存的结果需要写回主内存之后，才能够真正的生效嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210808083346.png" alt="image-20210808083346242"></p>
<h3 id="可见性定义："><a href="#可见性定义：" class="headerlink" title="可见性定义："></a>可见性定义：</h3><ul>
<li>一个线程对于数据进行了修改并且写回了主内存之后，其他的线程要马上能够知道嗷！！！只要有变动，大家都要立马知道嗷！！！</li>
<li>第一时间通知到所有线程的过程，这个就叫做可见性。</li>
</ul>
<h3 id="原子性："><a href="#原子性：" class="headerlink" title="原子性："></a>原子性：</h3><h2 id="Volatile特性："><a href="#Volatile特性：" class="headerlink" title="Volatile特性："></a>Volatile特性：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913190045.png" alt="image-20210913190044888"></p>
<h3 id="可见性："><a href="#可见性：" class="headerlink" title="可见性："></a>可见性：</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addTo60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">MyData</span> myData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t come in"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//模拟线程处理过程</span>
        myData<span class="token punctuation">.</span><span class="token function">addTo60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"AAA"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>myData<span class="token punctuation">.</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//main线程就一直在这里等待嗷！！！</span>
<span class="token punctuation">}</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"number变成了60啦！！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>没有volatile就没有多线程的可见性嗷！！！</li>
<li>然后你发现不得行！！！主线程仍然是卡住的，因为没有任何线程来通知主线程，这个值发生了改变，主线程自己的工作空间中的值，是没有变化的嗷！！！（默认是没有可见性的嗷！！！）</li>
<li>如何实现可见性呢？Volatile！！！</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addTo60</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>测试和上面的代码是一样的嗷！！！然后发现，volatile其实就是起到了及时通知main线程，某个变量发生了改变的作用。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210808083024.png" alt="image-20210808083024568"></p>
<h3 id="不保证原子性："><a href="#不保证原子性：" class="headerlink" title="不保证原子性："></a>不保证原子性：</h3><ul>
<li>原子性是什么？<ul>
<li>不可分割，完整性，也即某个线程不能被分割，要整体完成，要么同时成功，要么同时失败。</li>
</ul>
</li>
<li>例子：</li>
</ul>
<p><code>valatile i</code></p>
<p><code>public methodPlus(){i++}</code></p>
<p>然后启动多个线程来同时操作（也就是常见的i++的例子）</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913192205.png" alt="image-20210913192205069"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913192013.png" alt="image-20210913192012747"></p>
<p>结果不是20000嗷！！！</p>
<ul>
<li>原理解释：<ul>
<li>可以在方法上加上sychronized吗？<ul>
<li>可以，可以保证20000</li>
<li>但是不好，效率消耗太大了嗷！！！</li>
</ul>
</li>
</ul>
</li>
<li>为啥会&lt;2000呀！！！</li>
</ul>
<p>多线程的调度出问题了嗷！！！</p>
<p>A和B同时读入了0，同时加1。A写入1，还没来得及通知别的线程，B就再次被调度写入了1，这就出问题了orz，就会导致这种情况的出现嗷！！！</p>
<ul>
<li>字节码：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913192921.png" alt="image-20210913192921349"></p>
<ul>
<li><p>如何解决原子性：</p>
<ol>
<li>加入sync，太重了，不用这个</li>
<li><code>AutomicInteger automicInteger = new AutomicInteger();</code></li>
</ol>
<p>用法的话，建议去看看官方文档中怎么写的嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913193550.png" alt="image-20210913193550094"></p>
<p>说白了底层为CAS，比起volatile来说，还是加了个轻量级锁orz。</p>
</li>
</ul>
<h3 id="禁止指令重排："><a href="#禁止指令重排：" class="headerlink" title="禁止指令重排："></a>禁止指令重排：</h3><ul>
<li>多线程：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914182640.png" alt="image-20210914182640288"></p>
<ul>
<li>重排：</li>
</ul>
<p><img src="C:\Users\Alexander\AppData\Roaming\Typora\typora-user-images\image-20210913194820605.png" alt="image-20210913194820605"></p>
<ul>
<li>处理器在进行重排序的时候必须要考虑指令之间的<strong>数据依赖性</strong></li>
<li>由于数据依赖性，指令重排也要考虑数据依赖性哈！！！volatile来决定嗷！！！</li>
<li>指令重排多线程下出现，这个重排是客观存在的，两个线程中使用的变量能够保证一致性嗷！！！避免指令重排优化，从而避免多线程环境下程序出现乱序执行的情况。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913200926.png" alt="image-20210913200926447"></p>
<ul>
<li>指令屏障（保证禁止指令重排嗷！！！）：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913201109.png" alt="image-20210913201108269"></p>
<p>禁止指令重排嗷！！！保证了安全性嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210913201109.png" alt="指令重排"></p>
<ul>
<li>volatile的特点：<ul>
<li>可见性（强制刷出各种CPU的缓存数据嗷！！！）</li>
<li>禁止指令重排</li>
</ul>
</li>
</ul>
<h2 id="什么时候用Volatile："><a href="#什么时候用Volatile：" class="headerlink" title="什么时候用Volatile："></a>什么时候用Volatile：</h2><h3 id="单例模式："><a href="#单例模式：" class="headerlink" title="单例模式："></a>单例模式：</h3><ul>
<li>单例模式！！！本来是不用volatile的，但是当单线程 -&gt; 多线程的时候，就会出问题了嗷orz</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914183439.png" alt="image-20210914183438141"></p>
<ul>
<li>解决方法：<ul>
<li>getInstance方法前面加上synchronized，没有问题嗷！！！可以正常执行嗷！！！</li>
<li>但是太重了orz</li>
</ul>
</li>
</ul>
<h3 id="DCL模式："><a href="#DCL模式：" class="headerlink" title="DCL模式："></a>DCL模式：</h3><ul>
<li>Double Check Lock，双端检锁机制。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914183722.png" alt="image-20210914183722408"></p>
<p>对吗？不对！！！多线程，为了指令的效果，会指令重排！！！</p>
<ul>
<li>DCL不一定安全，指令重排！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914184250.png" alt="image-20210914184249691"></p>
<p>这个时候就可能取到null嗷！！！</p>
<ul>
<li>指令重排只保证单线程情况下的指令一致性，多线程则不保证嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914184532.png" alt="image-20210914184531643"></p>
<ul>
<li>禁止指令重排：<code>public static volatile SingletonDemo instance = null;</code></li>
</ul>
<h1 id="4-CAS："><a href="#4-CAS：" class="headerlink" title="4. CAS："></a>4. CAS：</h1><ul>
<li>Compare And Set，比较并且交换</li>
<li>Synchronized太重了，CAS就比synchronized轻量哦！！！</li>
<li>例如AutomicInteger , <code>compareAndSet(expect , update)</code></li>
</ul>
<h2 id="底层原理："><a href="#底层原理：" class="headerlink" title="底层原理："></a>底层原理：</h2><ul>
<li>why CAS not Synchronized？底层原理：<ul>
<li>自旋锁</li>
<li>Unsafe</li>
</ul>
</li>
<li>getAndIncrement底层实现：<ul>
<li>调用的JDK自带的unsafe类嗷！！！（都是底层的Native方法嗷！！！）</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914190803.png" alt="image-20210914190803601"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914190825.png" alt="image-20210914190825087"></p>
<ul>
<li>Unsafe类：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914191644.png" alt="image-20210914191643821"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914191909.png" alt="image-20210914191909041"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914192042.png" alt="image-20210914192041067"></p>
<ul>
<li>getAndAddInt</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914192335.png" alt="image-20210914192335325"></p>
<p>关键是底层的CAS的靠的是CPU的原子操作来实现的嗷！！！因此这样能够保证原子性嗷！！！读取，比较和设置一气呵成。不存在中间有线程特判比较的这种情况出现嗷！！！</p>
<ul>
<li>getAndIncrement：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914215818.png" alt="image-20210914215818159"></p>
<ul>
<li>原理：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914220153.png" alt="image-20210914220153739"></p>
<p><strong>Unsafe类+CAS思想（自旋）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914220305.png" alt="image-20210914220305279"></p>
<h2 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h2><ol>
<li>循环时间长，CPU开销大</li>
<li>只能保证一个变量的原子性操作，如果要一段代码，那就要synchronized嗷！！！</li>
<li>引出了ABA问题。</li>
</ol>
<h1 id="5-AtomicInteger的ABA问题："><a href="#5-AtomicInteger的ABA问题：" class="headerlink" title="5. AtomicInteger的ABA问题："></a>5. AtomicInteger的ABA问题：</h1><ul>
<li>原子引用更新 —&gt;&gt;&gt; 如何规避ABA问题</li>
<li>狸猫换太子：<ul>
<li>就是快速反复横跳，把值该到了，欸嘿，我又改回来了，吐了，慢的根本不知道嗷orz。</li>
</ul>
</li>
</ul>
<h2 id="AutomicReference："><a href="#AutomicReference：" class="headerlink" title="AutomicReference："></a>AutomicReference：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210914221952.png" alt="image-20210914221952711"></p>
<p>对于我们需要的类进行原子包装嗷！！！</p>
<h2 id="时间戳的原子引用："><a href="#时间戳的原子引用：" class="headerlink" title="时间戳的原子引用："></a>时间戳的原子引用：</h2><ul>
<li>规避ABA问题：时间戳的原子引用</li>
</ul>
<h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a>AtomicStampedReference</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915200923.png" alt="image-20210915200908489"></p>
<p><code>atomicStampedReference.compareAndSet(expectedReference , newReference , expectedStamp , newStamp)</code></p>
<p>常用用法：</p>
<p><code>boolean result = atomicStampedReference.compareAndSet(100 , 101 , automicStampedReference.getStamp() , automicStampedReference.getStamp()+1);</code></p>
<p><code>int stamp = atomicStampedReference.getStamp();</code></p>
<p><code>int result = atomicStampedReference.getReference();</code></p>
<p>相当于现在比较两个值了而已嘛，本质没啥区别</p>
<h1 id="6-ArrayList线程不安全："><a href="#6-ArrayList线程不安全：" class="headerlink" title="6. ArrayList线程不安全："></a>6. ArrayList线程不安全：</h1><ul>
<li>这里的名字不准确，应该是Collection类普遍不安全嗷！！！</li>
</ul>
<h2 id="写时复制："><a href="#写时复制：" class="headerlink" title="写时复制："></a>写时复制：</h2><ul>
<li>扩容：默认的capacity是10，超过10了要扩容</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915203909.png" alt="image-20210915203909547"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915204001.png" alt="image-20210915204001207"></p>
<ul>
<li>线程不安全！！！</li>
</ul>
<p>ArrayList的add方法为了保证并发性和效率，没有加锁嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915204430.png" alt="image-20210915204429858"></p>
<ol>
<li>故障现象：</li>
</ol>
<p>java.util.ConcurrentModificationException</p>
<ol start="2">
<li>导致原因：</li>
</ol>
<p>并发争抢修改导致，两个进程抢着写的时候，造成了数据不一致的情况嗷！！！</p>
<p>CopyOnWrite , OnWrite的时候才Copy</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915210514.png" alt="image-20210915210514393"></p>
<ol start="3">
<li>解决方案：</li>
</ol>
<ul>
<li>加锁！！！可以吗？不可以，JDK源码你加个锤子的锁？？？</li>
<li>3.1：用Vector类！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915204815.png" alt="image-20210915204814766"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915204846.png" alt="image-20210915204845542"></p>
<p>好使！！！但是太重了orz，而且Vector用的少orz，并发性低嗷orz。牺牲了安全性，提高了性能嗷！！！</p>
<ul>
<li><p>3.2：Collection接口和Collections类！！！注意嗷，后面那个是类！！！Collections就是帮助我们来解决这个问题的嗷！！！<img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915205140.png" alt="image-20210915205139824"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915205210.png" alt="image-20210915205210076"></p>
</li>
</ul>
<p>你设想一下，这里竟然有这么多Map , List , Set之类的，说明这些东西都是线程不安全的嗷！！！</p>
<ul>
<li>3.3：CopyOnWriteArrayList</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915210029.png" alt="image-20210915210029661"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915210105.png" alt="image-20210915210105142"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>老版本的copy出来，然后把自己的信息写进去，再让系统中的引用编程现在这个数组嗷！！！</li>
</ul>
<ol start="4">
<li>优化建议：</li>
</ol>
<h2 id="HashSet线程不安全："><a href="#HashSet线程不安全：" class="headerlink" title="HashSet线程不安全："></a>HashSet线程不安全：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915210928.png" alt="image-20210915210926940"></p>
<p>也是一样的问题嗷！！！</p>
<ul>
<li>解决方法：<ol>
<li><code>Collections.synchronizedSet(new HashSet&lt;&gt;());</code></li>
<li>JUC中的<code>CopyOnWriteSet&lt;&gt;()</code></li>
</ol>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915211451.png" alt="image-20210915211450931"></p>
<ul>
<li>HashSet底层数据结构就是HashMap&lt;&gt;()</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915211620.png" alt="image-20210915211620437"></p>
<ul>
<li>HashSet底层如果是HashMap，那为啥add方法只有一个参数捏？？？</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915211826.png" alt="image-20210915211825796"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915211803.png" alt="image-20210915211802866"></p>
<p>value是个恒定的值哦！！！</p>
<h2 id="HashMap线程不安全："><a href="#HashMap线程不安全：" class="headerlink" title="HashMap线程不安全："></a>HashMap线程不安全：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915212240.png" alt="image-20210915212239707"></p>
<ul>
<li>解决方法：<ol>
<li><code>ConcurrentHashMap</code></li>
<li><code>Collections.synchronizedMap</code></li>
</ol>
</li>
</ul>
<h1 id="7-TransferValue醒脑："><a href="#7-TransferValue醒脑：" class="headerlink" title="7. TransferValue醒脑："></a>7. TransferValue醒脑：</h1><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915215803.png" alt="image-20210915215802972"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915215840.png" alt="image-20210915215840582"></p>
<p>String比较特殊嗷！！！它是final，赋予了地址之后，这个地址是不会变动的。String str = “abc”，String指向了常量池中的地址。而str = “XXX”，确实找到了常量池中的”XXX”，如下右图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915220409.png" alt="image-20210915220409692"></p>
<p>说白了就是传进去就是一个地址，方法中参数的str本质上也是一个拷贝，一个指向这个地址的指针的拷贝，这里的赋值，无非是把拷贝指针的指向变了，改变不了原指针的指向嗷！！！</p>
<h1 id="8-Java中的锁们："><a href="#8-Java中的锁们：" class="headerlink" title="8. Java中的锁们："></a>8. Java中的锁们：</h1><h2 id="公平锁和非公平锁："><a href="#公平锁和非公平锁：" class="headerlink" title="公平锁和非公平锁："></a>公平锁和非公平锁：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915220950.png" alt="image-20210915220949873"></p>
<p>这里不传参数等于传入了false参数嗷！！！天生这个即使非公平锁嗷！！！公平锁就是先来后到，非公平就是允许某些线程能够“不公平竞争”，能够加塞！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915221301.png" alt="image-20210915221300727"></p>
<h3 id="ReentrantLock："><a href="#ReentrantLock：" class="headerlink" title="ReentrantLock："></a>ReentrantLock：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210915221459.png" alt="image-20210915221458845"></p>
<p>默认为非公平锁，非公平锁的有点在于吞吐量比公平锁大嗷！！！说白了又是体现了优先级呗！！！优先级高的能被响应，吞吐量就会大嗷！！！</p>
<ul>
<li>Synchronized而言，也是一种非公平锁哦！！！</li>
</ul>
<h2 id="可重入锁（递归锁）："><a href="#可重入锁（递归锁）：" class="headerlink" title="可重入锁（递归锁）："></a>可重入锁（递归锁）：</h2><ul>
<li>ReentrantLock就是可重入锁哦！！！</li>
<li>可重入锁就是递归锁</li>
<li>指的是统一线程外层函数获得锁之后，内层递归函数仍然能获取该锁的代码！在同一个线程在外层方法能够获取锁的时候，在进入内层方法会自动获取锁嗷！！！（也就是说：线程可以进入任何一个<strong>它已经拥有的锁所同步着的代码块</strong>！！！）</li>
<li><strong>线程可以进入任何一个它已经拥有的锁所同步的代码块。</strong></li>
<li>ReentrantLock/Synchronized就是典型的非公平可重入锁嗷！！！</li>
<li><strong>最大作用：避免死锁</strong></li>
<li>代码：</li>
</ul>
<h4 id="Case1："><a href="#Case1：" class="headerlink" title="Case1："></a>Case1：</h4><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210916201751.png" alt="image-20210916201750895"></p>
<p>这个就是例子：sendSMS()调用了sendEmail，进入sendSMS中执行sendEmail的时候会自动获取锁并进入这个代码块执行嗷！！！</p>
<h4 id="Case2："><a href="#Case2：" class="headerlink" title="Case2："></a>Case2：</h4><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210916202040.png" alt="image-20210916202040755"></p>
<ul>
<li>运行结果：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210916202204.png" alt="image-20210916202204510"></p>
<ul>
<li>思考：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210916202314.png" alt="image-20210916202314495"></p>
<p>只要锁配对正确，加几把锁都没问题嗷！！！可以正确运行嗷！！！！</p>
<h2 id="自旋锁："><a href="#自旋锁：" class="headerlink" title="自旋锁："></a>自旋锁：</h2><ul>
<li>spinlock：尝试获取锁的线程不会立即阻塞，而是采用循环的方式尝试去获取锁。好处是减少了上下文切换的消耗，缺点是循环会消耗CPU嗷！！！</li>
</ul>
<h3 id="手写自旋锁："><a href="#手写自旋锁：" class="headerlink" title="手写自旋锁："></a>手写自旋锁：</h3><ul>
<li>本质：while + compareAndSet()方法</li>
</ul>
<p>本质上利用一个拥有compareAndSet()方法的变量来帮助我们实现就行嗷！！！</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//加锁</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName <span class="token operator">+</span> <span class="token string">"\t come in O(n_n)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token punctuation">,</span> thread<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    <span class="token comment">//如果成功进入，根本就不进入while循环，直接执行下面的业务代码</span>
<span class="token punctuation">}</span>

<span class="token comment">//解锁</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName <span class="token operator">+</span> <span class="token string">"\t come out O(n_n)~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    automicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>thread <span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//上面这些统一放到一个类中就可以了嗷(叫做SpinLockDemo)！！！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SpinLockDemo</span> spinLockDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLockDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行业务逻辑，例如sleep等待</span>
        spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"AA"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行业务逻辑，例如sleep等待</span>
        spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"BB"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>这里非常有技巧性，这里的AtomicReference的泛型就可以拥有compareAndSet方法，但是为了让每个线程都可以“独立的拥有一些特征来获得自旋锁”，我们采用了线程作为泛型对象进行操作嗷！！！</li>
<li><code>thread.currentThread()</code>就能够获得当前的线程，不同线程的这个值肯定不一样嗷！！！这样就比较好一些嗷！！！</li>
</ul>
<h2 id="独占锁（写锁）-x2F-共享锁（读锁）-x2F-互斥锁"><a href="#独占锁（写锁）-x2F-共享锁（读锁）-x2F-互斥锁" class="headerlink" title="独占锁（写锁）/ 共享锁（读锁）/ 互斥锁"></a>独占锁（写锁）/ 共享锁（读锁）/ 互斥锁</h2><h3 id="独占锁（写锁）"><a href="#独占锁（写锁）" class="headerlink" title="独占锁（写锁）"></a>独占锁（写锁）</h3><ul>
<li><p>指该锁一次只能被一个线程所持有。</p>
</li>
<li><p>对于ReentrantLock和Synchronized而言都是独占锁。</p>
</li>
<li><p>发展历程：<code>sync ---&gt; lock ---&gt; ReentrantReadWriteLock</code></p>
</li>
<li><p>读写锁提高了并发效率嗷！！！从保证原子性到提高效率嗷！！！</p>
</li>
<li><p>规则：</p>
<ul>
<li>读-读可以共存</li>
<li>读-写不能共存</li>
<li>写-写不能共存</li>
</ul>
</li>
<li><p>实例代码：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917110338.png" alt="image-20210917110337741"></p>
<p>写操作：必须原子 + 独占（写锁）</p>
<p>这里模拟的时候，底层都是要用volatile的，保证可见性非常重要！！！缓存的可见性和及时性非常重要！！！</p>
<ul>
<li>ReentrantReadWriteLock读写同体，对于不同的方法要调用不同的方法适配嗷！！！</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ReentrantReadWriteLock</span> rwlock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//这里也很简单，直接根据不同情况获取不同的锁就成</span>
    rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>加写锁例子：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917112125.png"></p>
<ul>
<li>加读锁例子：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917112154.png" alt="image-20210917112154108"></p>
<ul>
<li>以上两者对比：</li>
</ul>
<h3 id="共享锁（读锁）："><a href="#共享锁（读锁）：" class="headerlink" title="共享锁（读锁）："></a>共享锁（读锁）：</h3><ul>
<li>该锁可以被多个线程所持有</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917112350.png" alt="image-20210917112350047"></p>
<h1 id="9-CountDownLatch-x2F-CyclicBarrier-x2F-Semaphore"><a href="#9-CountDownLatch-x2F-CyclicBarrier-x2F-Semaphore" class="headerlink" title="9. CountDownLatch / CyclicBarrier / Semaphore"></a>9. CountDownLatch / CyclicBarrier / Semaphore</h1><h2 id="CountDownLatch："><a href="#CountDownLatch：" class="headerlink" title="CountDownLatch："></a>CountDownLatch：</h2><ul>
<li><p>有点像Linux中那个等待子线程结束（waitpid / pthread_join），主线程才能够最后退出的函数方法。</p>
</li>
<li><p>Demo：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917113302.png" alt="image-20210917113301833"></p>
<ul>
<li>可谓是非常像了，这个玩意儿就是卡在这里，等所有线程的东西执行完了，才会继续往下执行嗷！！！</li>
</ul>
<h3 id="枚举："><a href="#枚举：" class="headerlink" title="枚举："></a>枚举：</h3><ul>
<li>可以当作小数据库来用嗷？？？还有这种操作？？？</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917114858.png" alt="image-20210917114857319"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917115028.png" alt="image-20210917115028480"></p>
<ul>
<li>原来的代码的修改：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917115117.png" alt="image-20210917115116832"></p>
<p>程序耦合度急剧降低，只要修改枚举中的元素，处处生效嗷！！！</p>
<ul>
<li>枚举中元素的读取：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917115228.png" alt="image-20210917115227796"></p>
<p>第一个相当于行的名字，第二三行相当于读取这一行某个元素的值嗷！！！</p>
<ul>
<li>非常实用嗷！！！</li>
</ul>
<h2 id="CyclicBarrier："><a href="#CyclicBarrier：" class="headerlink" title="CyclicBarrier："></a>CyclicBarrier：</h2><ul>
<li>增加到多少就能够发生某件事，和上面相反，这个是做甲方。</li>
<li>等人齐了，才能够开会~。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917144338.png" alt="image-20210917144338011"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917144706.png" alt="image-20210917144706100"></p>
<h2 id="Semaphore："><a href="#Semaphore：" class="headerlink" title="Semaphore："></a>Semaphore：</h2><ul>
<li>多个资源抢多份资源怎么控制哇？</li>
<li>这个就是信号量，一个是用于多个共享资源的互斥实用，另外一个适用于并发线程控制嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917145654.png" alt="image-20210917145653800"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917145712.png" alt="image-20210917145712432"></p>
<ul>
<li>这个和操作系统中的没啥区别，都是信号量嗷！！！一个信号量可以当作锁来用嗷！！！</li>
</ul>
<h1 id="10-阻塞队列"><a href="#10-阻塞队列" class="headerlink" title="10. 阻塞队列"></a>10. 阻塞队列</h1><h2 id="阻塞队列："><a href="#阻塞队列：" class="headerlink" title="阻塞队列："></a>阻塞队列：</h2><ul>
<li>阻塞队列有好的一面。</li>
<li>不得不阻塞，如何管理？</li>
</ul>
<h3 id="队列-阻塞队列以及其api："><a href="#队列-阻塞队列以及其api：" class="headerlink" title="队列+阻塞队列以及其api："></a>队列+阻塞队列以及其api：</h3><ul>
<li>就是生产者和消费者问题的Java版本而已</li>
<li>空的队列拿元素，阻塞。满的队列添加元素，阻塞。</li>
<li>why BlockingQueue？不需要关心什么时候阻塞和唤醒线程，BlockingQueue给我们一手包办了嗷！！！这个效率非常高嗷！！！（手动挡变成了自动挡嗷！！！）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917192349.png" alt="image-20210917192349179"></p>
<ul>
<li>有好多实现类嗷！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917192442.png" alt="image-20210917192442233"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917192507.png" alt="image-20210917192506647"></p>
<p>红色的是重点，这三个就是线程池的底层嗷！！！</p>
<p>最后一个是Deque嗷！！！双端队列，和上面的Queue是有区别的嗷！！！</p>
<p>SynchronousQueue专属定制版，就一个嗷！！！</p>
<ul>
<li>常用情况（抛出异常）：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917192913.png" alt="image-20210917192913651"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917213941.png" alt="image-20210917213941158"></p>
<p>像这个Queue，符合先进先出的概念，element就是检查第一个元素嗷！！！add和remove还有element就是有这样的一个特点：如果对应的操作失败，就会抛出异常嗷！！！</p>
<ul>
<li>常用情况（特殊值）：</li>
</ul>
<p>操作成功返回true，操作失败返回false嗷！！！</p>
<p>取出来的时候，取得到就是对应的元素，取不到就是NULL</p>
<ul>
<li>常用情况（阻塞）：</li>
</ul>
<p>如果操作失败的话，默认会进行阻塞，等待嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917214504.png" alt="image-20210917214504234"></p>
<ul>
<li>常用情况（超时）：</li>
</ul>
<p>不要那么猛，折中的一种做法嗷！！！我可以等，但是过时不候，如果超时了我线程就自己退出了嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917214652.png" alt="image-20210917214652384"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210917214711.png" alt="image-20210917214711162"></p>
<h2 id="SynchronousQueue："><a href="#SynchronousQueue：" class="headerlink" title="SynchronousQueue："></a>SynchronousQueue：</h2><ul>
<li>本质上是一个不存储元素的BlockingQueue，每一个put都要等待一个take嗷！！！</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"Producer1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t put 6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blockingQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"Producer2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"Consumer1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="用在哪里？"><a href="#用在哪里？" class="headerlink" title="用在哪里？"></a>用在哪里？</h2><h3 id="生产者消费者模式（老版）"><a href="#生产者消费者模式（老版）" class="headerlink" title="生产者消费者模式（老版）"></a>生产者消费者模式（老版）</h3><ul>
<li><p><code>ProdConsumer_TraditionDemo</code></p>
</li>
<li><p><code>ProdConsumer_BlockQueueDemo</code></p>
</li>
<li><p>传统版：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210918202929.png" alt="image-20210918202929146"></p>
<p>老版sync向新版lock的转换：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210918203703.png" alt="image-20210918203703145"></p>
<ul>
<li>代码：</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProdConsumer_TraditionDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShareData</span> shareData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    shareData<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"Thread A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    shareData<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"Thread B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ShareData</span> <span class="token comment">// 资源类</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//1. 判断</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//等待，不能生产</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//干活</span>
            number <span class="token operator">++</span> <span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//通知唤醒</span>
            condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//1. 判断</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//等待，不能生产</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//干活</span>
            number <span class="token operator">--</span> <span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//通知唤醒</span>
            condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>多线程判断都要用while</strong>，不要用if，if就有可能出现问题嗷！！！</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Thread A	<span class="token number">1</span>
Thread B	<span class="token number">0</span>
Thread A	<span class="token number">1</span>
Thread B	<span class="token number">0</span>
Thread A	<span class="token number">1</span>
Thread B	<span class="token number">0</span>
Thread A	<span class="token number">1</span>
Thread B	<span class="token number">0</span>
Thread A	<span class="token number">1</span>
Thread B	<span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="synchronized和lock的区别"><a href="#synchronized和lock的区别" class="headerlink" title="synchronized和lock的区别"></a>synchronized和lock的区别</h3><ol>
<li>原始构成</li>
</ol>
<ul>
<li>synchronized是Java关键字，lock是java5以后出现的一个类。</li>
<li>synchronized是属于JVM层面的，monitorenter和monitorexit，底层是通过monitor对象来完成的，其实wait / notify等方法也是依赖于monitor对象，只有在同步块或同步方法中才能调用wait / notify等方法。</li>
<li>Lock是具体类，JUC中，是api层面的锁嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210918210748.png" alt="image-20210918210748451"></p>
<ol start="2">
<li>使用方法</li>
</ol>
<ul>
<li>synchronized不需要用户去手动释放锁，当synchronized代码执行完成后系统会自动让线程释放对于锁的占用嗷！！！</li>
<li>ReentrantLock需要用户手动释放锁，如果用户没有主动释放锁，那么就有可能会出现死锁现象嗷！！！需要lock ， unlock方法配合try / finally语句块来完成嗷！！！</li>
</ul>
<ol start="3">
<li>判断是否可以中断</li>
</ol>
<ul>
<li>等待是否可以中断，synchronized不可中断，除非抛出异常或者正常运行完成。ReentrantLock可中断：<ol>
<li>设置超时方法 trylock（long timeout , TimeUnit unit）</li>
<li>LockInterruptibly()放代码块中，调用interrupt方法可以中断</li>
</ol>
</li>
</ul>
<ol start="4">
<li>加锁是否公平</li>
</ol>
<ul>
<li>synchronized非公平锁</li>
<li>ReentrantLock两者都可以，默认非公平锁，构造方法可以传入boolean值，true为公平锁，false为非公平锁。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210918212212.png" alt="image-20210918212212308"></p>
<ol start="5">
<li>锁绑定多个条件的Condition</li>
</ol>
<p>ReentrantLock可以实现分组唤醒需要唤醒的线程们，可以<strong>精确唤醒</strong>，而不是像synchronized要么随机唤醒一个要么唤醒全部线程嗷！！！</p>
<ul>
<li>例如A唤醒B，B唤醒C：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210918213531.png" alt="image-20210918213531894"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">ShareResource</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//A:1 , B:2 , C:3</span>
    <span class="token keyword">private</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> c1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> c2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> c3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//1. 判断</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                c1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//2. 干活</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            	lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span>
            
            <span class="token comment">//3. 通知</span>
            number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            c2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//1. 判断</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                c2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//2. 干活</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//3. 通知</span>
            number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            c3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print15</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//1. 判断</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                c3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//2. 干活</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            	lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">}</span>
            
            <span class="token comment">//3. 通知</span>
            number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            c1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="生产者消费者模式（阻塞队列）"><a href="#生产者消费者模式（阻塞队列）" class="headerlink" title="生产者消费者模式（阻塞队列）"></a>生产者消费者模式（阻塞队列）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">MyResource</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> FLAG <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//默认开启，进行生产+消费</span>
    <span class="token keyword">private</span> <span class="token class-name">AutomicInteger</span> automicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">BlockingQuere</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">MyResource</span><span class="token punctuation">(</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>blockingQueue <span class="token operator">=</span> blockingQueue<span class="token punctuation">;</span>
        <span class="token function">sout</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> retValue<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            data <span class="token operator">=</span> automicInteger<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span>
            retValue <span class="token operator">=</span> blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">2L</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>retValue<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 插入队列"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 插入队列"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 停下来了嗷！！！"</span> <span class="token operator">+</span> <span class="token string">"表示FLAG=false，生产动作结束！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            result <span class="token operator">=</span> blockingQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> result <span class="token operator">||</span> result<span class="token punctuation">.</span><span class="token function">equalIgnoreCase</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                FLAG <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 超过两秒没有取到产品，消费退出"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 消费队列"</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t 停下来了嗷！！！"</span> <span class="token operator">+</span> <span class="token string">"表示FLAG=false，生产动作结束！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>main代码块中的一些代码：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920151235.png" alt="image-20210920151235614"></p>
<h2 id="Callable接口（第三种多线程方式）："><a href="#Callable接口（第三种多线程方式）：" class="headerlink" title="Callable接口（第三种多线程方式）："></a>Callable接口（第三种多线程方式）：</h2><ul>
<li>两个接口：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920151426.png" alt="image-20210920151425701"></p>
<p>区别：</p>
<ol>
<li>Runnable没有返回值，Callable有返回值</li>
<li>Callable会抛出异常</li>
<li>接口需要实现的接口不一样嗷！！！</li>
</ol>
<ul>
<li><p>中间层同时适配了Callable和Runnable接口嗷！！FutureTask这个类同时实现了Callable接口和Runnable接口，是按了适配嗷！！！！</p>
</li>
<li><p>背景？为什么会出现呢？</p>
</li>
</ul>
<p>并发，异步导致。高并发最牛逼的控制嗷！！！初衷就是：麻烦的事儿交给别的线程去处理，实现高并发需要使用的嗷！！！</p>
<p>兔兔想法：实现更高程度的并行嗷！！！（分支合并操作嗷！！！）</p>
<ul>
<li>小建议：<ul>
<li>把get方法放在最后哦！！！get如果没有获取到值的话，会阻塞在这里嗷！！！</li>
<li>等它算完了再去取就会比较方便嗷！！！所以我们尽量放在后面取。</li>
<li>当然如果某一步就要结果，又不想阻塞的话，我们就可以类似于自旋锁，通过<code>futureTask.isDone()</code>来实现哦！！！</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920154316.png" alt="image-20210920154316590"></p>
<p>提高了并行性嗷！！！</p>
<ul>
<li>如果启动了多个线程来抢着执行同一个任务呢？<ul>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920154710.png" alt="image-20210920154709812"></li>
<li>不好意思，只执行了一次嗷！！！同样的动作就应该复用嗷！！！如果你真的想走两遍的话，再自己多去做一个FutureTask嗷！！！</li>
</ul>
</li>
</ul>
<h2 id="线程池使用以及优势（第四种多线程方式）："><a href="#线程池使用以及优势（第四种多线程方式）：" class="headerlink" title="线程池使用以及优势（第四种多线程方式）："></a>线程池使用以及优势（第四种多线程方式）：</h2><h3 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h3><ul>
<li>查看电脑CPU核数量：</li>
</ul>
<p><code>Runtime.getRuntime().availableProcessors()</code>可以获得硬件中可用的CPU的核数嗷！！！</p>
<ul>
<li>从new对象到IoC的反转，依赖注入 -&gt; 全都给你准备好，你直接复用我准备好的就成嗷！！！</li>
<li>底层就是阻塞队列嗷！！！</li>
<li>底层是<code>ThreadPoolExecutor ThreadPoolExecutor ThreadPoolExecutor</code>这个类嗷！！！Executor这个接口就对应了Executors这个工具类嗷！！！（和Array，Arrays一样的嗷！！！）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163453.png" alt="image-20210920163453304"></p>
<ul>
<li>了解：<ul>
<li><code>Executors.newScheduledThreadPool()</code>时间参数用于调度的</li>
<li><code>Executors.newWorkStealingPool(int)</code>可用的处理器作为它的并行级别</li>
</ul>
</li>
<li>重点：<ul>
<li><code>Executors.newFixedThreadPool(int)</code></li>
<li><code>Executors.newSingleThreadPool()</code></li>
<li><code>Executors.newCachedThreadPool(int)</code></li>
</ul>
</li>
</ul>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><h4 id="newFixedThreadPool："><a href="#newFixedThreadPool：" class="headerlink" title="newFixedThreadPool："></a>newFixedThreadPool：</h4><ul>
<li><p>固定数目线程池，处理线程数目固定哦！！！</p>
</li>
<li><p>模拟十个用户用五个请求来进行处理嗷！！！</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920162740.png" alt="image-20210920162739367"></p>
<p>处理结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920162759.png" alt="image-20210920162759410"></p>
<ul>
<li>关闭比使用更加重要嗷！！！</li>
</ul>
<h4 id="newSingleThreadExecutor："><a href="#newSingleThreadExecutor：" class="headerlink" title="newSingleThreadExecutor："></a>newSingleThreadExecutor：</h4><ul>
<li>固定单个数目线程池</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920162925.png" alt="image-20210920162925543"></p>
<h4 id="newCachedThreadPool："><a href="#newCachedThreadPool：" class="headerlink" title="newCachedThreadPool："></a>newCachedThreadPool：</h4><ul>
<li>线程池数目不固定，够用就好嗷！！！如果线程不够的话，还会自动扩容嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163118.png" alt="image-20210920163117475"></p>
<ul>
<li>核心思想：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163153.png" alt="image-20210920163152856"></p>
<p>我尽力办，我办的完的话，就ok。我要是办不完，我就摇人了嗷！！！</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><ul>
<li>发现上面这三个玩意儿，底层都是<code>return new ThreadPoolExecutor(...)</code>！！！所以ThreadPoolExecutor如此重要嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163734.png" alt="image-20210920163734036"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163752.png" alt="image-20210920163751881"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920163820.png" alt="image-20210920163820239"></p>
<ul>
<li><p>底层源码重点：</p>
<ul>
<li>ThreadPoolExecutor这个类很重要！！！</li>
<li>底层的阻塞队列也很重要嗷！！！！</li>
</ul>
</li>
<li><p>使用方法：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920164039.png" alt="image-20210920164038942"></p>
<h3 id="七大参数简介："><a href="#七大参数简介：" class="headerlink" title="七大参数简介："></a>七大参数简介：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920203544.png" alt="image-20210920203543898"></p>
<ol>
<li>corePoolSize：常驻核心线程数</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920203809.png" alt="image-20210920203809064"></p>
<ol start="2">
<li>maximumPoolSize：</li>
</ol>
<p>物理上线程池能够容纳的同时执行的最大线程数，此值必须大于等于1嗷！！！</p>
<ol start="3">
<li>keepAliveTime：</li>
</ol>
<p>多余的空闲线程的存活时间，当线程池数量超过CorePoolSize的时候，空闲时间达到keepAliveTime的值的时候，多余的空闲线程会被销毁直到只剩下corePoolSize个线程为止嗷！！！</p>
<p>没有业务了，“加班”的人会慢慢回退嗷！！！</p>
<ol start="4">
<li><p>unit：keepAliveTime的单位</p>
</li>
<li><p>workQueue：任务队列，被提交了，但是由于核心线程都被占用而无法执行，处于等待状态的任务嗷！！！</p>
</li>
</ol>
<p>类似于银行中的候客区</p>
<ol start="6">
<li><p>threadFactory：生成线程池中线程的线程工厂，用于创建线程，一般用默认的就可以了嗷！！！</p>
</li>
<li><p>handler：拒绝策略，如果线程池满了，阻塞队列都满了，那就……只能够采取一些操作了orz</p>
</li>
</ol>
<p>类似于银行网点，上班的人都在服务（但是还有多的空位），等待的人爆了，银行紧急通知其他休假的人赶紧赶回来上班嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920204832.png" alt="image-20210920204832709"></p>
<p>当所有人都在上班了（物理线程池被占满了），候客区也满了，不好意思。我银行已经尽力的，多来的请求我就不收了。</p>
<h3 id="底层工作原理："><a href="#底层工作原理：" class="headerlink" title="底层工作原理："></a>底层工作原理：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920210510.png" alt="image-20210920210509956"></p>
<p>这幅图就是上面的银行网点那幅图嗷！！！</p>
<ul>
<li>主要处理流程：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920211449.png" alt="image-20210920211449576"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920211539.png" alt="image-20210920211539142"></p>
<h3 id="四种拒绝理论："><a href="#四种拒绝理论：" class="headerlink" title="四种拒绝理论："></a>四种拒绝理论：</h3><h4 id="大坑："><a href="#大坑：" class="headerlink" title="大坑："></a>大坑：</h4><ul>
<li>上面学的三种，实际开发中，<strong>一个都不用嗷！！！（超级大坑！！！）</strong></li>
<li>阿里开发手册：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920212314.png" alt="image-20210920212314139"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920212414.png" alt="image-20210920212414735"></p>
<p>就是这里说的，由于底层是链表，没有最大长度，默认是Integer.MAX_VALUE。这就一个非常大的问题，就是如果我一直往阻塞队列里面加请求，加满了，你的Linux也就爆了orz。</p>
<h4 id="自定义线程池："><a href="#自定义线程池：" class="headerlink" title="自定义线程池："></a>自定义线程池：</h4><p><code>ExecutorService threadPool = new ThreadPoolExecutor(2,5,1L,TimeUnit.SECONDS,new LinkedBlockingQueue&lt;Runnable&gt;(3),Executors.defaultThreadFactory(),new ThreadExecutor.AbortPolicy());</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920213917.png" alt="image-20210920213917146"></p>
<ul>
<li>测试什么时候出问题呢？</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920214035.png" alt="image-20210920214035505"></p>
<p>最大承载量 = maximumPoolSize + 阻塞队列最大长度，因此来9个时候可能出现这个问题嗷！！！</p>
<h4 id="AbortPolicy："><a href="#AbortPolicy：" class="headerlink" title="AbortPolicy："></a>AbortPolicy：</h4><ul>
<li>概念：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920211802.png" alt="image-20210920211801937"></p>
<ul>
<li>种类：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920211826.png" alt="image-20210920211826013"></p>
<ul>
<li>如上图所示，出了问题直接报错嗷，程序运行终止。</li>
</ul>
<h4 id="CallerRunsPolicy："><a href="#CallerRunsPolicy：" class="headerlink" title="CallerRunsPolicy："></a>CallerRunsPolicy：</h4><ul>
<li>调用者运行的一种调节机制，不会抛弃任务也不会抛出异常，而是将一些任务<strong>回退给调用者进行处理</strong>，从而降低流量嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920214706.png" alt="image-20210920214706006"></p>
<p>这里就会退给main来处理了嗷！！！</p>
<h4 id="DiscardOldestPolicy："><a href="#DiscardOldestPolicy：" class="headerlink" title="DiscardOldestPolicy："></a>DiscardOldestPolicy：</h4><ul>
<li>抛弃等待最久的，将最新的加入到队列中再次尝试提交嗷！！！</li>
</ul>
<h4 id="DiscardPolicy："><a href="#DiscardPolicy：" class="headerlink" title="DiscardPolicy："></a>DiscardPolicy：</h4><ul>
<li>多来的直接就给了扔掉了嗷！！！</li>
</ul>
<h3 id="配置合理线程数："><a href="#配置合理线程数：" class="headerlink" title="配置合理线程数："></a>配置合理线程数：</h3><ul>
<li><p>熟悉硬件：</p>
<ol>
<li>CPU密集型</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920215354.png" alt="image-20210920215354656"></p>
<ol start="2">
<li>IO密集型</li>
</ol>
<ul>
<li>I/O密集型任务线程并不是一直在执行任务，配置尽可能多的线程，如CPU核数*2</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920215528.png" alt="image-20210920215528181"></li>
</ul>
</li>
</ul>
<h2 id="死锁编码及定位分析："><a href="#死锁编码及定位分析：" class="headerlink" title="死锁编码及定位分析："></a>死锁编码及定位分析：</h2><ul>
<li>两个火柴人拿枪指着对方orz，好家伙orz。</li>
</ul>
<h3 id="写个死锁呗："><a href="#写个死锁呗：" class="headerlink" title="写个死锁呗："></a>写个死锁呗：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920220626.png" alt="image-20210920220626213"></p>
<p>run没有写全，写全的版本在下面嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920220647.png" alt="image-20210920220647467"></p>
<ul>
<li>main函数：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920221006.png" alt="image-20210920221006854"></p>
<h3 id="小介绍："><a href="#小介绍：" class="headerlink" title="小介绍："></a>小介绍：</h3><ol>
<li>jps</li>
</ol>
<p>linux中<code>ps -ef | grep xxx</code></p>
<p>windows下的java运行程序捏？也有类似于ps查看进程的命令，但是目前我们需要查看的只是java的程序嗷！！</p>
<p>jps = java ps嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920222052.png" alt="image-20210920222052258"></p>
<ol start="2">
<li>jstack</li>
</ol>
<p>jstack + <code>进程号</code></p>
<p>结合上面的jps一起使用，找到对应的线程编号，再查看线程的错误信息嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920222340.png" alt="image-20210920222340886"></p>
<ul>
<li>summary：<ol>
<li>jsp命令定位进程号</li>
<li>jstack找到死锁查看</li>
</ol>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210920222637.png" alt="image-20210920222637114"></p>
<h1 id="11-JVM-GC"><a href="#11-JVM-GC" class="headerlink" title="11. JVM+GC"></a>11. JVM+GC</h1><h2 id="复习串讲："><a href="#复习串讲：" class="headerlink" title="复习串讲："></a>复习串讲：</h2><ul>
<li>JVM内存结构：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922204116.png" alt="image-20210922204101050"></p>
<ul>
<li>GC作用域：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922204138.png" alt="image-20210922204137849"></p>
<ul>
<li><p>常见垃圾回收算法：</p>
<ol>
<li>引用计数：</li>
</ol>
<p>有对象应用+1，没对象-1，到0就回收。<strong>较难解决循环引用问题</strong>，因此JVM不采用这种方式。</p>
<ol start="2">
<li>复制算法：</li>
</ol>
<p>复制算法在年轻代中用</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922205326.png" alt="image-20210922205325740"></p>
<p>名言：复制之后有交换，谁空谁是To</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922204836.png" alt="image-20210922204816262"></p>
<p>缺点就是复制大对象耗时，浪费空间嗷！！！</p>
<ol start="3">
<li>标记清除：</li>
</ol>
<p>Mark-Sweep，分为标记清除两个阶段。先标记出要回收的对象，然后统一回收这些对象。</p>
<p>好处：不用复制，耗时少了。</p>
<p>坏处：出现了内存碎片</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922205103.png" alt="image-20210922205102880"></p>
<ol start="4">
<li>标记清除整理：</li>
</ol>
<p>Mark-Compact</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922205201.png" alt="image-20210922205200495"></p>
<p>移动过程中，耗时比较多嗷！！！</p>
</li>
</ul>
<h2 id="如何确定垃圾-GCRoot："><a href="#如何确定垃圾-GCRoot：" class="headerlink" title="如何确定垃圾+GCRoot："></a>如何确定垃圾+GCRoot：</h2><ul>
<li><p>内存中不再被使用的空间就是垃圾</p>
</li>
<li><p>如何判断一个对象是否是垃圾？</p>
<ol>
<li>引用计数法：简单，但是循环引用解决不了</li>
<li>枚举根结点做可达性分析：</li>
</ol>
<p>复制，标记清除，标记压缩都要用GCRoots来判断哪些是垃圾嗷！！！</p>
</li>
<li><p>GCRoots：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922205724.png" alt="image-20210922205724103"></p>
<p>从GC对象进行扫描，看是否可达。</p>
<ul>
<li>哪些对象可以作为GC Roots对象：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922205901.png" alt="image-20210922205901103"></p>
<ul>
<li>可以作为GCRoot的根呢？</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922210038.png" alt="image-20210922210038211"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922210553.png" alt="image-20210922210552919"></p>
<h2 id="JVM的参数介绍和调整："><a href="#JVM的参数介绍和调整：" class="headerlink" title="JVM的参数介绍和调整："></a>JVM的参数介绍和调整：</h2><h3 id="查看参数："><a href="#查看参数：" class="headerlink" title="查看参数："></a>查看参数：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922215608.png" alt="image-20210922215607756"></p>
<ul>
<li><p><code>-Xms和-Xmx</code>尽量调成一致，防止GC频繁收集，忽高忽低。</p>
</li>
<li><p>参数类型：</p>
<ol>
<li><p>标配参数：</p>
<ul>
<li>随着java变更，基本不会动的参数，没有大的变化。</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922210932.png" alt="image-20210922210931972"></li>
</ul>
</li>
<li><p>X参数：</p>
<ul>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211038.png" alt="image-20210922211037799"></li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211115.png" alt="image-20210922211114713"></li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211133.png" alt="image-20210922211132961"></li>
</ul>
</li>
<li><p>XX参数：</p>
</li>
</ol>
</li>
<li><p>Boolean类型：</p>
<pre><code> - ![image-20210922211322130](https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211322.png)
</code></pre>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211556.png" alt="image-20210922211556106"></p>
<ul>
<li>先让一个程序空转，比如<code>sleep(Integer.MAX_VALUE)</code>：<ul>
<li><p>查看线程情况：</p>
<p><code>jps -l</code>和<code>jinfo</code>，这个jinfo是显示当前正在运行的线程的信息嗷！！！</p>
<ul>
<li>查看某个线程的情况：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922212646.png" alt="image-20210922212646075"></p>
<ul>
<li>编辑参数：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922211446.png" alt="image-20210922211446165"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922212743.png" alt="image-20210922212743398"></p>
<p>开启参数之后再测试：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922212834.png" alt="image-20210922212834155"></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>KV设值类型：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213125.png" alt="image-20210922213125480"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213147.png" alt="image-20210922213146784"></p>
<p>查出某个进程的Metaspace的默认设置：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213252.png" alt="image-20210922213251833"></p>
<p>设置对应的值：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213407.png" alt="image-20210922213406757"></p>
<p>例如这个MaxTenuringThreshold就是young区的对象进入老年区所需要的年纪嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213709.png" alt="image-20210922213708933"></p>
<p>所以这里就可以看出来默认的一些配置嗷！！！</p>
<ul>
<li>jinfo的配置使用：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922213921.png" alt="image-20210922213920863"></p>
<p>-flags：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922214035.png" alt="image-20210922214035429"></p>
<p>这个东西是要求得到运行中的线程的id，再去flags才能看得到的嗷！！！</p>
<p><code>Non-default</code>是系统干的，帮我们自动配置好的。</p>
<p><code>Command line</code>是我们自己配置的嗷！！！</p>
<ul>
<li>题外话，坑题（-Xms和-Xmx如何解释？）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922214901.png" alt="image-20210922214901303"></p>
<p>这两个参数也是一样样的，本质上就是-XX参数，用的多。这两个不属于<code>X</code>参数哈，还是属于<code>XX</code>参数嗷！！！只是用到多，单独提出来方便使用而已嗷！！！这两个值一般都是配置成一样的嗷！！！这样才能保证GC尽可能少哦！！！</p>
<h3 id="查看参数二："><a href="#查看参数二：" class="headerlink" title="查看参数二："></a>查看参数二：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922215640.png" alt="image-20210922215639580"></p>
<ul>
<li>方式：</li>
</ul>
<ol>
<li><code>-XX:+PrintFlagsInitial</code>查看初始参数值</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922215725.png" alt="image-20210922215725094"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922215803.png" alt="image-20210922215802398"></p>
<ol start="2">
<li><code>-XX:+PrintFlagsFinal</code>查看修改更新的参数值</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922220037.png" alt="image-20210922220037254"></p>
<ul>
<li><code>=和:=</code><ul>
<li>等于是没有被改过的初始值</li>
<li><code>:=</code>是我们人为改过的或者是JVM加载的时候修改过的参数值嗷！！！</li>
</ul>
</li>
<li>-version的话，只是在最后多打出了JVM的版本号而已嗷！！！</li>
<li>命令行修改：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922220932.png" alt="image-20210922220932163"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922220945.png" alt="image-20210922220945294"></p>
<p>修改之后，运行T之后，可以看出来元空间的值发生了变化嗷！！！</p>
<ol start="3">
<li><code>-XX:+PrintCommandLineFlags</code>打印命令行参数</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210922221211.png" alt="image-20210922221211484"></p>
<p>这个命令最方便就是看最后一个参数！！！垃圾回收器的种类和默认参数嗷！！！</p>
<h2 id="JVM基本配置："><a href="#JVM基本配置：" class="headerlink" title="JVM基本配置："></a>JVM基本配置：</h2><h3 id="Java8调整："><a href="#Java8调整：" class="headerlink" title="Java8调整："></a>Java8调整：</h3><ul>
<li>Java的MetaSpace：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923085939.png" alt="image-20210923085939278"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923090428.png" alt="image-20210923090428487"></p>
<ul>
<li>通过程序获得初始内存大小和最大的堆内存大小：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923090141.png" alt="image-20210923090141078"></p>
<h3 id="通用参数："><a href="#通用参数：" class="headerlink" title="通用参数："></a>通用参数：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923090542.png" alt="image-20210923090542706"></p>
<ol>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923090615.png" alt="image-20210923090615310"></li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923091333.png" alt="image-20210923091332550"></li>
</ol>
<ul>
<li>如何配置：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923091427.png" alt="image-20210923091426848"></p>
<p>注意：<strong>栈管运行，堆管存储</strong>嗷！！！！这个栈是线程运行的时候所拥有的栈的大小</p>
<p>当我们不配置-Xss参数的时候，出现了神奇的问题：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923091541.png" alt="image-20210923091541472"></p>
<p>它默认值为0</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923091733.png" alt="image-20210923091733044"></p>
<p>这里为0其实上表示采用系统的默认值，默认值又是多少呢？上图实际上告诉我们了嗷！！！（这个东西在Java的官方文档中都有嗷！！！）</p>
<ol start="3">
<li><code>-Xmn</code>：设置年轻代的大小嗷！！！</li>
</ol>
<ul>
<li>一般自己不用调，采用系统默认的</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923092140.png" alt="image-20210923092139544"></p>
<ol start="4">
<li><code>-XX:MetaspaceSize</code></li>
</ol>
<h4 id="典型参数设置案例："><a href="#典型参数设置案例：" class="headerlink" title="典型参数设置案例："></a>典型参数设置案例：</h4><ul>
<li>设置元空间大小：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923092248.png" alt="image-20210923092247567"></p>
<ul>
<li>坑：</li>
</ul>
<p>虽然说着元空间有这么多可以用，但是元空间自己取的少啊orz，就有可能报<code>OOM:Metaspace</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923092536.png" alt="image-20210923092536820"></p>
<p>这里默认值就20多M而已啊orz，我内存16个G呢orz。</p>
<ul>
<li>为了保证不会出现OOM：</li>
</ul>
<p>参数配置实例：</p>
<p>下面是我们要手动配置的参数：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923092916.png" alt="image-20210923092916447"></p>
<p><code>-XX:+UserSerialGC</code>是串行垃圾回收器嗷！！！</p>
<p>默认设置也可以瞅一眼哦：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923093114.png" alt="image-20210923093113771"></p>
<p>运行结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923093152.png" alt="image-20210923093152554"></p>
<p>查看默认参数：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923093223.png" alt="image-20210923093223512"></p>
<p>可以看到默认是这些，我们修改之后再康康嗷！！！</p>
<p>我们配置一下上面最开始提到的参数：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923093335.png" alt="image-20210923093334904"></p>
<p>参数设置后的结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923093511.png" alt="image-20210923093511004"></p>
<p>完全按照我们的配置来启动了嗷！！！</p>
<ol start="5">
<li><code>-XX:+PrintGCDetails</code></li>
</ol>
<ul>
<li>输出GC的详细收集日志信息</li>
<li>可以通过限定堆的大小，然后人为new一个贼大的对象来构造GC的错误嗷，这个过程中会产生GC嗷！！！</li>
</ul>
<p>上下是对应的嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923182346.png" alt="image-20210923182346063"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923182405.png" alt="image-20210923182404627"></p>
<p>规律：<code>[名称： GC前内存占用 -&gt; GC后内存占用(该区总内存大小)]</code></p>
<ol start="6">
<li><code>SurvivorRatio</code></li>
</ol>
<ul>
<li>设置新生代中eden区和S0/S1空间的比例。</li>
<li>默认：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923182945.png" alt="image-20210923182944953"></p>
<ul>
<li>查看默认参数：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923183152.png" alt="image-20210923183152525"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923183235.png" alt="image-20210923183235580"></p>
<p>改了之后再打印就是我们修改之后的值了嗷！！！</p>
<ol start="7">
<li><code>-XX:NewRatio</code></li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923185443.png" alt="image-20210923185442895"></p>
<p>设置老年代占比，剩下1给新生代</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923185749.png" alt="image-20210923185749201"></p>
<p>默认就是1：2嗷！！！</p>
<ol start="8">
<li><code>-XX:MaxTenuringThreshold</code></li>
</ol>
<ul>
<li>设置垃圾的最大年龄，超过这个年龄就从年轻代进入老年代嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923185951.png" alt="image-20210923185951515"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923190031.png" alt="image-20210923190031165"></p>
<p>通过这个参数就可以设置垃圾的最大年龄嗷！！！</p>
<h2 id="四种引用："><a href="#四种引用：" class="headerlink" title="四种引用："></a>四种引用：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923190412.png" alt="image-20210923190412091"></p>
<ol>
<li>强引用（默认支持模式）</li>
</ol>
<p><code>Book book = new Book("兔子姐姐的小窝")</code></p>
<ul>
<li>当内存不足，JVM开始垃圾回收，对于强引用的对象，<strong>就算是出现了OOM也不会对于这个对象进行回收</strong>嗷！！！死都不收！！！</li>
</ul>
<ol start="2">
<li>软引用</li>
</ol>
<ul>
<li>内存足够的前提下我不收（就算手动GC也不回收哦，我够用嘛！！！），内存不够的情况收了你，来保证尽量不要出现OOM嗷！！！</li>
<li>软引用是相对强引用弱化了一些的引用，需要用<code>java.lang.ref.SoftReference</code>类来实现，可以让对象豁免一些垃圾回收。</li>
<li>通常用到对于内存敏感的程序中，高速缓存中就有用到嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923190911.png" alt="image-20210923190911406"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191004.png" alt="image-20210923191004767"></p>
<p>注意上面这里哈，实际上告诉了我们获得软引用的方式嗷！！！</p>
<ul>
<li>故意整活：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191149.png" alt="image-20210923191149341"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191208.png" alt="image-20210923191208008"></p>
<p>5M的小内存，分配了30M的对象，必垃圾回收嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191308.png" alt="image-20210923191308316"></p>
<ul>
<li>使用场景：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923192051.png" alt="image-20210923192050793"></p>
<p><code>Map&lt;String,SoftReference&lt;Bitmap&gt;&gt; imageCache = new Hashmap&lt;String,SoftReference&lt;Bitmap&gt;&gt;();</code></p>
<p>在保证我程序正常运行的情况下，把空间给你多存一点照片，提高你的效率，这是好事儿。但是如果我都不够用了，那我就不客气了，把你收了嗷，保证不OOM最重要嗷！！！</p>
<ol start="3">
<li>弱应用</li>
</ol>
<ul>
<li>不管够不够用，垃圾回收一律都收掉嗷！！！不管啥情况，回收我就收了你！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191526.png" alt="image-20210923191525848"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923191539.png" alt="image-20210923191539510"></p>
<ul>
<li>使用场景：</li>
</ul>
<p><code>WeakHashMap</code></p>
<p>key是弱key，如果被垃圾回收了的话，这个entry就会被自动移除嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923194114.png" alt="image-20210923194113847"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>

    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>底层本质是一个Node的数据结构，实现了Map的Entry，比如上面，本质上put的时候，map底层新建立了一个Node，Node中的key的引用就是传入的Integer的应用，因此如果你修改的是key的话，实际上对于对应位置的引用没有任何的改变，因此这个打印出来的结果还是上面那个结果嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923194648.png" alt="image-20210923194648193"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923194711.png" alt="image-20210923194711738"></p>
<p>这个key不会阻止垃圾回收嗷，如果key失效了，就会被remove嗷！！！</p>
<p>适用于对于内存敏感的使用嗷！！！</p>
<ol start="4">
<li>虚引用：</li>
</ol>
<ul>
<li>又被称为幽灵引用</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923194905.png" alt="image-20210923194905029"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923194930.png" alt="image-20210923194930822"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923195019.png" alt="image-20210923195019141"></p>
<ul>
<li>回收之前需要被引用队列保存一下嗷！！！</li>
<li>弱引用队列的例子：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923200814.png" alt="image-20210923200814571"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923200755.png" alt="image-20210923200754945"></p>
<ul>
<li>虚引用队列的例子：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923201325.png" alt="image-20210923201325447"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923201500.png" alt="image-20210923201500175"></p>
<p>重点就是后续操作，可以做一些通知之类的嗷！！！</p>
<h2 id="GCRoots-四大引用小总结："><a href="#GCRoots-四大引用小总结：" class="headerlink" title="GCRoots + 四大引用小总结："></a>GCRoots + 四大引用小总结：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210923201825.png" alt="image-20210923201825458"></p>
<ul>
<li>Java中可以作为GC Roots的对象：<ul>
<li>虚拟机栈（栈帧中的局部变量区，也叫做局部变量表）。</li>
<li>方法区中的类静态属性引用的对象。</li>
<li>方法区中常量引用的对象。</li>
<li>本地方法栈中JNI（Native方法）引用的对象</li>
</ul>
</li>
</ul>
<h1 id="12-SOFE"><a href="#12-SOFE" class="headerlink" title="12. SOFE"></a>12. SOFE</h1><h2 id="各种异常分类："><a href="#各种异常分类：" class="headerlink" title="各种异常分类："></a>各种异常分类：</h2><p><strong>栈管运行，堆管存储。</strong></p>
<ol>
<li>StackOverflowError</li>
</ol>
<p>这里的栈就是程序运行时对应的栈，由于内存不大，在调用方法的时候就会压栈，我们可以人为构造循环调用方法来制造SOFE：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924203911.png" alt="image-20210924203910628"></p>
<p>这个是错误，不是异常嗷！！！异常是Exception，错误是Error：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43698561/article/details/104382643">下面这个就是Error和Exception的解释嗷！！！</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924204413.png" alt="image-20210924204413080"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924204613.png" alt="image-20210924204613291"></p>
<p>栈爆了。</p>
<ol start="2">
<li>OOM：java heap space</li>
</ol>
<p>先把heap的大小调小：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924204801.png" alt="image-20210924204800557"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924204859.png" alt="image-20210924204858781">不断新建对象，这样就可以了嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924204932.png" alt="image-20210924204932664"></p>
<p>上面这样也行，直接new一个80M的数组，上面调过堆内存只有10M，这个对象远远大于10M。</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924205022.png" alt="image-20210924205021400"></p>
<p>这个也是个Error嗷！！！堆爆了。</p>
<ol start="3">
<li>OOM：GC overhead limit exceeded</li>
</ol>
<ul>
<li>程序特别诡异，Java内存急剧上升，大量对象被装载被创建出来。启动GC之后，超过最高警戒了。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924205328.png" alt="image-20210924205327339"></p>
<ul>
<li>GC反复执行，恶行循环，执行存在非常大的问题嗷！！！</li>
<li>实例：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924210445.png" alt="image-20210924210445570"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924210625.png" alt="image-20210924210624990"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924210648.png" alt="image-20210924210647590"></p>
<ol start="4">
<li>OOM：Direct buffer memory</li>
</ol>
<ul>
<li>是由于底层NIO引起的嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924211359.png" alt="image-20210924211358960"></p>
<p>里面够用，外面用满了orz。默认堆外可用内存是总内存的1/4嗷！！！</p>
<ul>
<li>示例代码：</li>
</ul>
<p>查看本地可用的JVM内存：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924211557.png" alt="image-20210924211557162"></p>
<p>内存的图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924213350.png" alt="image-20210924213349784"></p>
<p>内存：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924213444.png" alt="image-20210924213444653"></p>
<ul>
<li>下面是示例哈，把外部内存的可用参数调成5M之后，在内存中new一个6M的对象，就会出现上面的问题嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924213507.png" alt="image-20210924213507575"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924214305.png" alt="image-20210924214304637"></p>
<p>这个问题就是由于NIO所引出的哦，面试的时候就有可能问你这个<code>Direct buffer memory</code>的问题，来刺探你是否使用过NIO嗷！！！</p>
<ol start="5">
<li>OOM：unable to create new native thread</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924215151.png" alt="image-20210924215151360"></p>
<ul>
<li>准确的讲，该native thread异常与对应的平台有关。说白了就是：创建的线程的数量超过了系统允许的最大值嗷，导致出现了这个异常嗷！！！！！</li>
<li>示例：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924220700.png" alt="image-20210924220700427"></p>
<p>Linux中默认允许单个进程可以创建的线程数是1024嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210924221132.png"></p>
<ul>
<li><p>解决方案：</p>
<ol>
<li>减少跑起来的线程数</li>
<li>扩大底层机器允许的最大线程数</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925150440.png" alt="image-20210925150439766"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925150525.png" alt="image-20210925150524905"></p>
<p>注意，linux下的root用户对于线程是没有上限的，其他用户默认一个进程最多创建的线程数就是1024，修改：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925150621.png" alt="image-20210925150621473"></p>
</li>
</ul>
<ol start="6">
<li>OOM：Metaspace</li>
</ol>
<ul>
<li>元空间是方法区，方法区装类的模板，常量池啊之类的东东。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925150910.png" alt="image-20210925150909936"></p>
<ul>
<li>元空间与持久代的最大区别：Metaspace并不在虚拟机内存中，而是使用本地内存。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925151016.png" alt="image-20210925151015937"></p>
<ul>
<li>示例：</li>
</ul>
<p>设置元空间的大小为8M：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925151905.png" alt="image-20210925151904788"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925151930.png" alt="image-20210925151929884"></p>
<h2 id="GC垃圾回收器的理解："><a href="#GC垃圾回收器的理解：" class="headerlink" title="GC垃圾回收器的理解："></a>GC垃圾回收器的理解：</h2><ul>
<li>GC有四种垃圾回收算法（引用计数/复制/标记清除/标记整理），垃圾收集器本质上就是这些算法的落地实现。</li>
<li>没有完美的垃圾收集器，都有具体的使用场景嗷！！！</li>
<li>四种垃圾收集器</li>
</ul>
<h3 id="垃圾收集器策略："><a href="#垃圾收集器策略：" class="headerlink" title="垃圾收集器策略："></a>垃圾收集器策略：</h3><h4 id="Serial"><a href="#Serial" class="headerlink" title="Serial"></a>Serial</h4><ul>
<li>串行</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925152550.png" alt="image-20210925152550265"></p>
<ul>
<li>为单线程环境设计，只使用一个线程进行回收，并且会<strong>暂停全部的用户线程</strong>，不适用于服务器环境。（中间业务线程被打断了orz）</li>
</ul>
<h4 id="Parallel"><a href="#Parallel" class="headerlink" title="Parallel"></a>Parallel</h4><ul>
<li>并行</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925152745.png" alt="image-20210925152745385"></p>
<ul>
<li>多个垃圾收集线程并行工作，此时用户线程是暂停的，适用于科学计算 / 大数据处理等弱前台交互系统。</li>
<li>停顿回收垃圾的时间回比串行少，但是仍然和前面一样的，需要把所有的用户线程<strong>停下来</strong>！！！</li>
</ul>
<h4 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h4><ul>
<li>并发垃圾回收器（并发标记垃圾清除）</li>
<li>用户线程和垃圾回收线程同时执行（不一定是并行，有可能交替执行），不需要停顿用户线程。互联网公司大多都用CMS，它适用于对于<strong>响应时间有要求的场景</strong>。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925153059.png" alt="image-20210925153058844"></p>
<h4 id="小总结："><a href="#小总结：" class="headerlink" title="小总结："></a>小总结：</h4><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925153238.png" alt="image-20210925153237964"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925153256.png" alt="image-20210925153256070"></p>
<h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><ul>
<li>将堆内存分割为不同的区域，然后并发对于不同的区域进行垃圾回收嗷！！！</li>
</ul>
<h4 id="ZGC"><a href="#ZGC" class="headerlink" title="ZGC"></a>ZGC</h4><ul>
<li><p>G1的升级版本</p>
</li>
<li><p>比较新，Java12之后才出现的，需要自己下去看看嗷！</p>
</li>
</ul>
<h2 id="服务器默认垃圾收集器查看："><a href="#服务器默认垃圾收集器查看：" class="headerlink" title="服务器默认垃圾收集器查看："></a>服务器默认垃圾收集器查看：</h2><ul>
<li>GC深透明细，思想：四大垃圾回收算法 —&gt;&gt;&gt; 落地实现</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925153851.png" alt="image-20210925153851252"></p>
<ul>
<li>打印出垃圾收集器：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925153935.png" alt="image-20210925153934881"></p>
<p>默认使用的是并行垃圾回收器</p>
<ul>
<li>设置垃圾收集器：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925154143.png" alt="image-20210925154143267"></p>
<h2 id="默认垃圾收集器有哪些？"><a href="#默认垃圾收集器有哪些？" class="headerlink" title="默认垃圾收集器有哪些？"></a>默认垃圾收集器有哪些？</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925154304.png" alt="image-20210925154304571"></p>
<ul>
<li>CMS（ConcMarkSystem）</li>
<li>总共理论上有七种的，UseSerialOldGC和引用计数一样，已经被这个时代废除了，源码中也看不到了，但是它曾经存在过嗷！！！</li>
<li>查看某个运行中的进程的垃圾回收器：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925155113.png" alt="image-20210925155113074"></p>
<h2 id="七种垃圾收集器："><a href="#七种垃圾收集器：" class="headerlink" title="七种垃圾收集器："></a>七种垃圾收集器：</h2><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925155942.png" alt="image-20210925155941812"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925160146.png" alt="image-20210925160145418"></p>
<ul>
<li>年轻代更多使用复制算法，老年代我们更多使用标记清除或者标记整理算法。</li>
</ul>
<h3 id="部分参数说明-x2F-C-x2F-S模式有什么区别"><a href="#部分参数说明-x2F-C-x2F-S模式有什么区别" class="headerlink" title="部分参数说明 / C/S模式有什么区别"></a>部分参数说明 / C/S模式有什么区别</h3><ul>
<li><p>参数：</p>
<ul>
<li>DefNew - Default New Generation</li>
<li>Tenured - Old</li>
<li>ParNew - Parallel New Generation</li>
<li>PSYoungGen - Parallel Scanvenge Young Generation</li>
<li>ParOldGen - Parallel Old Generation</li>
</ul>
</li>
<li><p>C/S模式：</p>
<ul>
<li>只需要掌握Server模式即可，Client模式基本不会用</li>
<li>操作系统：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925160643.png" alt="image-20210925160642642"></p>
</li>
</ul>
<h3 id="新生代："><a href="#新生代：" class="headerlink" title="新生代："></a>新生代：</h3><ul>
<li>Young和Old的垃圾收集器是搭配使用的嗷，注意上面那张图图捏！！！新生代的指定了，老年代的基本上就确定了嗷！！！</li>
</ul>
<h4 id="Serial-x2F-Serial-Copying："><a href="#Serial-x2F-Serial-Copying：" class="headerlink" title="Serial / Serial Copying："></a>Serial / Serial Copying：</h4><ul>
<li>串行+串行</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925161602.png" alt="image-20210925161602019"></p>
<p>简单高效，没有线程交互的开销，可以获得最高的单线程垃圾收集效率，因此Serial垃圾收集器依然是Java虚拟机运行在Clinet模式下默认的垃圾收集器</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925161807.png" alt="image-20210925161807280"></p>
<ul>
<li>Y和O都是Serial回收，只是回收过程中，采取的回收算法不一样而已嗷！！！</li>
</ul>
<h4 id="ParNew："><a href="#ParNew：" class="headerlink" title="ParNew："></a>ParNew：</h4><ul>
<li>并行+串行</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925162131.png" alt="image-20210925162130287"></p>
<ul>
<li>年轻代的ParNew是搭配老年代的CMS使用的嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925162840.png" alt="image-20210925162839624"></p>
<h4 id="ParallelScanvenge："><a href="#ParallelScanvenge：" class="headerlink" title="ParallelScanvenge："></a>ParallelScanvenge：</h4><ul>
<li>并行+并行</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163018.png" alt="image-20210925163017590"></p>
<ul>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163201.png" alt="image-20210925163200837"></li>
</ul>
<p>串行收集器在新生代和老年代的并行化</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163326.png" alt="image-20210925163325742"></p>
<ul>
<li>配置这个模式：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163434.png" alt="image-20210925163433318"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163508.png" alt="image-20210925163508148"></p>
<h3 id="老年代："><a href="#老年代：" class="headerlink" title="老年代："></a>老年代：</h3><h4 id="Serial-Old-x2F-Serial-MSC："><a href="#Serial-Old-x2F-Serial-MSC：" class="headerlink" title="Serial Old / Serial MSC："></a>Serial Old / Serial MSC：</h4><ul>
<li>老年代的串行收集器</li>
<li>单线程+标记整理算法，这个收集器也是主要运行在Client默认的java虚拟机默认的老年代垃圾收集器。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925172206.png" alt="image-20210925172206379"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925172228.png" alt="image-20210925172227843"></p>
<ul>
<li>已经优化掉了，都不用了都orz</li>
</ul>
<h4 id="Parallel-Old："><a href="#Parallel-Old：" class="headerlink" title="Parallel Old："></a>Parallel Old：</h4><ul>
<li><p>并行+并行</p>
</li>
<li><p>Parallel Scavenge的老年代版本，使用多线程的标记-整理算法，Parallel Old收集器在1.6才开始使用嗷！！！</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925163901.png" alt="image-20210925163901411"></p>
<ul>
<li>不加的话默认使用的是<code>UseParrellelGC</code>，就在上面，所以老年代默认的也是使用Parallel Old嗷！！！</li>
</ul>
<h4 id="CMS："><a href="#CMS：" class="headerlink" title="CMS："></a>CMS：</h4><ul>
<li>并发标记清除GC（CMS）</li>
<li>好处：解决空间和时间，坏处：内存碎片</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925170643.png" alt="image-20210925170642985"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925170707.png" alt="image-20210925170707008"></p>
<ul>
<li>过程：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925170740.png" alt="image-20210925170740207"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925171346.png" alt="image-20210925171345757"></p>
<p>1，3要停，2，4不要停：</p>
<p>重新标记：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925171053.png" alt="image-20210925171053270"></p>
<p>并发清除：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925171123.png" alt="image-20210925171123242"></p>
<p>标记和清除这两个最耗时的操作，可以并发执行嗷！！！</p>
<ul>
<li>优缺点：<ul>
<li>优点：并发收集低停顿</li>
<li>缺点：并发执行，CMS在收集与应用线程会同时增减对于堆内存的占用，CPU的压力比较大！！！CMS必须在老年代堆内存用尽之前完成垃圾回收，否则就会回收失败，触发担保机制。串行老年代收集器将会以STW的方式进行一次GC，从而造成较大停顿时间。此外，标记清除算法会导致大量碎片嗷！！！</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925171815.png" alt="image-20210925171814442"></p>
<ul>
<li>同时配置多个垃圾收集器：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925172417.png" alt="image-20210925172416956"></p>
<p>关联激活，完全没有必要这么去写嗷！！！</p>
<h2 id="选择合适的垃圾收集器："><a href="#选择合适的垃圾收集器：" class="headerlink" title="选择合适的垃圾收集器："></a>选择合适的垃圾收集器：</h2><ul>
<li>适用场景：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925172835.png" alt="image-20210925172835478"></p>
<ul>
<li>对应关系：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210925173108.png" alt="image-20210925173107600"></p>
<h2 id="G1垃圾回收器："><a href="#G1垃圾回收器：" class="headerlink" title="G1垃圾回收器："></a>G1垃圾回收器：</h2><ul>
<li>G1又被称为<code>Garbage-First</code>嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926191656.png" alt="image-20210926191553163"></p>
<ul>
<li>打印结果显示：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926191729.png" alt="image-20210926191630759"></p>
<p>别的都有两个区哦这里，G1只有一个garbage-first heap，这就是上面所提到过的，G1横跨两个区哦！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926191942.png" alt="image-20210926191942141"></p>
<p>G1是一种服务端的垃圾收集器，应用在<strong>多处理器和大容量内存环境</strong>中，实现高吞吐量的同时，尽可能满足垃圾收集暂停时间的要求。</p>
<ul>
<li><p>特性：</p>
<ol>
<li>像CMS一样，能与应用程序并发执行</li>
<li>整理空闲时间空间更快</li>
<li>需要更多的时间来预测GC停顿时间</li>
<li>不希望牺牲大量的吞吐性能</li>
<li>不需要更大的Java Heap</li>
</ol>
</li>
<li><p>G1就是为了取代CMS而被设计的，不会产生很多内存碎片，而且添加了预测机制，用户可以指定期望停顿时间嗷！！！</p>
</li>
<li><p>Eden和Survivor和Tenured等区域不再是连续的，而是变成了一个个大小一样的region。</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926192932.png" alt="image-20210926192932201"></p>
<p>Java9开始就作为默认的垃圾收集器了嗷！！！</p>
<ul>
<li>特点：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926193156.png" alt="image-20210926193155568"></p>
<h3 id="底层原理：-1"><a href="#底层原理：-1" class="headerlink" title="底层原理："></a>底层原理：</h3><ul>
<li><p>Region区域化垃圾收集器，化整为零，避免全内存扫描，只需要按照区域进行内存扫描嗷！！！</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926193424.png" alt="image-20210926193423711"></p>
</li>
<li><p>G1的改变：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926193704.png" alt="image-20210926193703956"></p>
<p>化整为零，避免了全内存扫描嗷！！！相当于把垃圾回收的基本单位变小了orz，粒度小了，并发度就高了嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926194304.png" alt="image-20210926193946667"></p>
<p>大的对象，也可以通过紧凑的方法来腾出空间，边清理，边内存整理，当然效率高哇！！！</p>
<ul>
<li><p>G1分为了四个区嗷：</p>
<ul>
<li>Eden区</li>
<li>Survivor区</li>
<li>Old区</li>
<li>Humongou大对象区</li>
</ul>
</li>
<li><p>垃圾回收流程：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926194412.png" alt="image-20210926194411751"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926194432.png" alt="image-20210926194432326"></p>
<p>G1中的内存处于一个动态变化的过程中嗷！！！有点像分页算法？？？？？？？这种熟悉的感觉，emmmmmm</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926194520.png" alt="image-20210926194519537"></p>
<p>回收步骤倒是和CMS一模一样，这不就和HashTable和ConcurrentHashMap一样嘛orz，对于每一个小块，采用的都是同样的CMS算法嗷！！！</p>
<ul>
<li>好多参数嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926195230.png" alt="image-20210926195229637"></p>
<p>这些都可以尝试着看一下哈！！！一般都是用默认值的嗷！！！</p>
<h3 id="G1和CMS相比的优势"><a href="#G1和CMS相比的优势" class="headerlink" title="G1和CMS相比的优势"></a>G1和CMS相比的优势</h3><ol>
<li>G1没有内存碎片嗷！！！</li>
<li>G1可以精确控制停顿嗷！！！</li>
</ol>
<h2 id="JVMGC-SpringBoot微服务部署"><a href="#JVMGC-SpringBoot微服务部署" class="headerlink" title="JVMGC + SpringBoot微服务部署"></a>JVMGC + SpringBoot微服务部署</h2><ul>
<li><p>JVMGC –&gt; 调优 –&gt; 应用于微服务</p>
</li>
<li><p>步骤：</p>
<ol>
<li>IDEA开发完成微服务工程</li>
<li>maven进行clean和package</li>
<li>微服务启动的时候，同时配置我们JVM / GC的调优参数：<ul>
<li>内</li>
<li>外 =&gt; 中带你</li>
</ul>
</li>
<li>公式：<code>java -server jvm的各种参数 -jar jar/war包的名字</code></li>
</ol>
</li>
<li><p>示例：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926200212.png" alt="image-20210926200212372"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926200313.png" alt="image-20210926200313040"></p>
<h1 id="13-Linux相关"><a href="#13-Linux相关" class="headerlink" title="13. Linux相关"></a>13. Linux相关</h1><h2 id="生产环境服务器变慢了"><a href="#生产环境服务器变慢了" class="headerlink" title="生产环境服务器变慢了"></a>生产环境服务器变慢了</h2><h3 id="top："><a href="#top：" class="headerlink" title="top："></a>top：</h3><ul>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926201513.png" alt="image-20210926201513031"></li>
<li>在top的情况下，按下<code>1</code>，就会显示所有的CPU的占用情况嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926202106.png" alt="image-20210926202105515"></p>
<p>可以看到每个CPU的各种参数的使用情况嗷！！！</p>
<h3 id="uptime："><a href="#uptime：" class="headerlink" title="uptime："></a>uptime：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926202244.png" alt="image-20210926202244709"></p>
<p>精简版的ps，uptime你值得拥有</p>
<h3 id="vmstat："><a href="#vmstat：" class="headerlink" title="vmstat："></a>vmstat：</h3><p><code>vmstat -n 2 3</code></p>
<ul>
<li>主要用于查看CPU，但是包含不限于嗷！！！</li>
<li>每2秒采样一次，共计采样3次</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@VM-12-10-centos ~<span class="token punctuation">]</span><span class="token comment"># vmstat -n 2 3</span>
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   <span class="token function">free</span>   buff  cache   si   so    bi    bo   <span class="token keyword">in</span>   cs us sy <span class="token function">id</span> wa st
 <span class="token number">3</span>  <span class="token number">1</span>      <span class="token number">0</span>  <span class="token number">76776</span> <span class="token number">139660</span> <span class="token number">1405012</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">29</span>    <span class="token number">2</span>   <span class="token number">12</span>  <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">99</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">0</span>  <span class="token number">0</span>      <span class="token number">0</span>  <span class="token number">76272</span> <span class="token number">139660</span> <span class="token number">1405044</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">48</span> <span class="token number">1145</span> <span class="token number">2390</span>  <span class="token number">3</span>  <span class="token number">3</span> <span class="token number">94</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">1</span>  <span class="token number">0</span>      <span class="token number">0</span>  <span class="token number">76256</span> <span class="token number">139660</span> <span class="token number">1405060</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">1093</span> <span class="token number">2187</span>  <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">100</span>  <span class="token number">0</span>  <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>头和尾的两个比较重要嗷！！！</li>
<li>r是run , b是block。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926202753.png" alt="image-20210926202752052"></p>
<h3 id="mpstat："><a href="#mpstat：" class="headerlink" title="mpstat："></a>mpstat：</h3><ul>
<li><code>mpstat -P ALL 2</code></li>
</ul>
<p>每两秒采样一次，查看所有CPU的核信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926203030.png" alt="image-20210926203029814"></p>
<p>查看每个进程使用CPU的用量分解信息：</p>
<p><code>pidstat -u 1 -p 进程编号</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926203218.png" alt="image-20210926203218298"></p>
<h3 id="free："><a href="#free：" class="headerlink" title="free："></a>free：</h3><ul>
<li><p>查看程序可用内存数</p>
</li>
<li><p><code>free -m</code>按照M来看，系统内存的可用数量</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926203425.png" alt="image-20210926203425023"></p>
<ul>
<li><code>pidstat -p 进程号 -r 采样间隔秒数</code></li>
</ul>
<h3 id="df："><a href="#df：" class="headerlink" title="df："></a>df：</h3><ul>
<li><p>disk free，查看磁盘剩余空间数</p>
</li>
<li><p><code>df -h</code> 用人类看得懂的方式来告诉我们，可用的磁盘空间大小</p>
</li>
</ul>
<h3 id="ioStat："><a href="#ioStat：" class="headerlink" title="ioStat："></a>ioStat：</h3><ul>
<li><code>iostat</code>，查看磁盘IO，磁盘I/O性能评估</li>
<li><code>iostat -xdk 2 3</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926204128.png" alt="image-20210926204127348"></p>
<ul>
<li><code>pidstat -d 时间间隔 -p 进程号</code></li>
</ul>
<h3 id="ifstat："><a href="#ifstat：" class="headerlink" title="ifstat："></a>ifstat：</h3><ul>
<li>默认本地没有，要下载的嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926204426.png" alt="image-20210926204425422"></p>
<h2 id="CPU占用过高，分析-定位？"><a href="#CPU占用过高，分析-定位？" class="headerlink" title="CPU占用过高，分析+定位？"></a>CPU占用过高，分析+定位？</h2><ul>
<li><p>Linux加上JDK共同分析</p>
</li>
<li><p>步骤：</p>
<ol>
<li>top命令找出惹事儿的Java程序，记录它的id</li>
<li>ps -ef | grep 进程号或者 jps 进一步定位，得知怎样的后台程序在惹事儿</li>
<li>定位到具体的<strong>线程</strong>或者<strong>代码：</strong></li>
</ol>
<p><strong><code>ps -mp 进程 -o THREAD,tid,time</code></strong></p>
<p>tid是哪一个线程，time是某个线程已经耗费的时间</p>
<p>参数解释：</p>
<ul>
<li>-m显示所有的线程</li>
<li>-p pid进程使用cpu的时间</li>
<li>-o 该参数后面是用户自定义格式</li>
</ul>
<ol start="4">
<li>将需要的<strong>线程ID</strong>转换为<strong>16进制格式</strong>（英文小写格式）</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926205055.png" alt="image-20210926205054790"></p>
<p>或者手动算或用计算机算也成嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926205131.png" alt="image-20210926205130839"></p>
<p>注意哈，机器内存里面全是小写嗷！！！</p>
<ol start="5">
<li><code>jstack 进程ID | grep tid（16进制线程id小写英文）-A60</code></li>
</ol>
<p>-A60是打印出前60行嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210926205849.png" alt="image-20210926205848429"></p>
</li>
</ul>
<h1 id="14-Github骚操作"><a href="#14-Github骚操作" class="headerlink" title="14. Github骚操作"></a>14. Github骚操作</h1><h2 id="常用词："><a href="#常用词：" class="headerlink" title="常用词："></a>常用词：</h2><ul>
<li>watch：持续获得某个项目更新的通知嗷</li>
<li>fork：复制某个项目到自己的仓库中</li>
<li>star：项目点赞数</li>
<li>clone：把项目下载到你本地</li>
<li>follow：关注感兴趣的作者，会收到他们的动态</li>
</ul>
<h2 id="具体骚操作："><a href="#具体骚操作：" class="headerlink" title="具体骚操作："></a>具体骚操作：</h2><h3 id="In关键词限制搜索范围："><a href="#In关键词限制搜索范围：" class="headerlink" title="In关键词限制搜索范围："></a>In关键词限制搜索范围：</h3><ul>
<li><p>公式：<code>xxx关键词 in:name 或 description 或 readme</code></p>
</li>
<li><p>例如<code>seckill in:name</code>，项目的名字中必须有seckill这个关键字嗷！！！</p>
</li>
<li><p>组合使用：<code>seckill in:name,description</code></p>
</li>
</ul>
<h3 id="stars或fork项目查找项目："><a href="#stars或fork项目查找项目：" class="headerlink" title="stars或fork项目查找项目："></a>stars或fork项目查找项目：</h3><ul>
<li>公式：<code>xxx关键字 stars 通配符</code><ul>
<li>例如<code>:&gt; 或者 :&gt;=</code></li>
<li>区间范围数字：<code>数字1...数字2</code></li>
</ul>
</li>
<li>例如：<code>springboot stars:&gt;=5000</code></li>
<li>例如：<code>springboot forks:&gt;=500</code></li>
<li>组合使用：<code>springboot forks:100..200 stars:2000..4000</code></li>
</ul>
<h3 id="awesome加强搜索："><a href="#awesome加强搜索：" class="headerlink" title="awesome加强搜索："></a>awesome加强搜索：</h3><ul>
<li>awesome系列一般是用来收集</li>
<li>查找官方收集的学习，工具，书籍类相关的项目</li>
<li>公式：<code>awesome 项目名字</code></li>
<li>例如：<code>awesome redis</code></li>
</ul>
<h3 id="高亮显示代码："><a href="#高亮显示代码：" class="headerlink" title="高亮显示代码："></a>高亮显示代码：</h3><ul>
<li><p>给别人指出关键代码的行数或者行号</p>
</li>
<li><p>公式：<code>项目对应代码的URL + #L + 数字</code></p>
</li>
<li><p>例如：<code>https://github.com/coding/.../killDao.java#L13</code></p>
</li>
<li><p>范围高亮：</p>
<p><code>项目对应代码的URL + #L + 数字 + - + L + 数字</code></p>
<p>例如：<code>https://github.com/coding/.../killDao.java#L13-L23</code></p>
</li>
</ul>
<h3 id="T搜索："><a href="#T搜索：" class="headerlink" title="T搜索："></a>T搜索：</h3><ul>
<li>项目内搜索</li>
<li>在项目主页按下小写字母t，这个快捷键就是项目中搜索嗷！！！</li>
<li><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210927102201.png" alt="image-20210927102153357"></li>
<li>进入列表显示和搜索栏，可以列出项目中全部的文件，方便我们查找和检索阅读嗷！！！</li>
<li>还有好多好多快捷键嗷！！！</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://docs.github.com/en/get-started/using-github/keyboard-shortcuts">github官网快捷键嗷！！！</a></p>
<h3 id="搜索某个地区的大佬："><a href="#搜索某个地区的大佬：" class="headerlink" title="搜索某个地区的大佬："></a>搜索某个地区的大佬：</h3><ul>
<li>公式：搜索栏中<code>location:beijing language:java</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20210927102957.png" alt="image-20210927102956944"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Alexander Liu</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2021/08/05/java-da-han-chang-wen-mian-shi-ti/">http://example.com/2021/08/05/java-da-han-chang-wen-mian-shi-ti/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Alexander Liu</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%A4%A7%E4%B8%89%E8%87%AA%E5%AD%A6/">
                                    <span class="chip bg-color">大三自学</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/08/12/nginx-xue-xi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="Nginx学习">
                        
                        <span class="card-title">Nginx学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Alexander Liu
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%90%8E%E7%AB%AF/">
                        <span class="chip bg-color">后端</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/07/24/spring-cloud-spring-cloud-alibaba/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="Spring Cloud + Spring Cloud Alibaba">
                        
                        <span class="card-title">Spring Cloud + Spring Cloud Alibaba</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Alexander Liu
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%90%8E%E7%AB%AF/">
                        <span class="chip bg-color">后端</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="421696726"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">Alexander Liu</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">495.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/alexanderliu-creator" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:haoeliu@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2632746476" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2632746476" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
