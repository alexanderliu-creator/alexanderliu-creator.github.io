

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/tuzi.png">
  <link rel="icon" href="/img/tuzi.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Alexander Liu">
  <meta name="keywords" content="分布式系统,后端研发,数据协同">
  
    <meta name="description" content="Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！">
<meta property="og:type" content="article">
<meta property="og:title" content="初识Go语言">
<meta property="og:url" content="http://example.com/2021/10/12/chu-shi-go-yu-yan/index.html">
<meta property="og:site_name" content="兔の博客">
<meta property="og:description" content="Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202212071744888.png">
<meta property="article:published_time" content="2021-10-12T14:17:11.000Z">
<meta property="article:modified_time" content="2022-12-07T09:45:52.505Z">
<meta property="article:author" content="Alexander Liu">
<meta property="article:tag" content="大三自学">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/alexanderliu-creator/blog_img/img/202212071744888.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>初识Go语言 - 兔の博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="兔の博客" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>兔的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background_post.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="初识Go语言"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Alexander Liu
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-10-12 22:17" pubdate>
          2021年10月12日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          33k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          272 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">初识Go语言</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2 个月前
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！"><a href="#Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！" class="headerlink" title="Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！"></a>Go非常有意思的一门语言，这一次的学习偏向于基础知识，后面可能还会接触工程项目，总之先把基础打好！！！</h1><span id="more"></span>



<h1 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h1><h2 id="具体步骤："><a href="#具体步骤：" class="headerlink" title="具体步骤："></a>具体步骤：</h2><ul>
<li>在Window上直接下载Golang加上Goland就好，这里比较简单我不做过多的记录，电脑崩了好几次，这已经是第二次配置Go语言了orz。</li>
<li>下面记录一下在Linux中配置环境的过程：<ul>
<li><p>镜像网站：</p>
<ol>
<li>官方网站<code>https://golang.org/dl/</code>，搭梯子，访问太慢。</li>
<li>Go官方镜像站（推荐）：<code>https://golang.google.cn/dl</code></li>
<li>中文网站：<code>https://studygolang.com/dl</code></li>
</ol>
</li>
<li><p>下载源码之后：<code>sudo tar -zxvf 源码包 -C /usr/local/</code>才能够很好的解决上述的问题嗷！！！</p>
</li>
<li><p>解压完成之后配置环境变量：</p>
<ul>
<li>首先<code>cd / cd ~</code>，回到<code>$HOME目录下</code>，HOME目录下有个.bashrc文件，就是环境目录的配置文件</li>
<li>在文件末尾加上我们的环境配置：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211013094212.png" srcset="/img/loading.gif" lazyload alt="image-20211013094203229"></p>
<p>其中第一行是我们解压的go源码所在的目录。第二行GOPATH是我们写go代码的工作路径，可以自定义，这里我们将其配置在$HOME目录下的go文件夹中。第三行我们去写系统的环境变量，取并集，机上我们GOROOT的bin和GOPATH的bin就可以了嗷！！！</p>
<ul>
<li><code>source ~/.bashrc</code>重新加载我们的配置文件进来嗷！！！</li>
<li><code>go version</code>以及<code>go help</code>没有问题，说明就配置成功了。</li>
<li>使用本地的VSCode通过SSH插件连接虚拟机中对应的go的工作目录，可以成功连上，说明配置成功了！！！</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Go的序言"><a href="#Go的序言" class="headerlink" title="Go的序言"></a>Go的序言</h1><h2 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h2><h3 id="部署简单："><a href="#部署简单：" class="headerlink" title="部署简单："></a>部署简单：</h3><ol>
<li>可以直接编译成机器码（go build）</li>
<li>不依赖其他库（编译生成的文件就全部整好了！！！）</li>
<li>直接运行就可以部署！！！（./生成的可执行文件就可以完成服务器的运行嗷！！！）</li>
</ol>
<h3 id="静态类型语言："><a href="#静态类型语言：" class="headerlink" title="静态类型语言："></a>静态类型语言：</h3><ul>
<li>编译的时候就可以查出来隐藏的大多数问题，防止跑的过程中出现问题。</li>
</ul>
<h3 id="语言层面的并发："><a href="#语言层面的并发：" class="headerlink" title="语言层面的并发："></a>语言层面的并发：</h3><ul>
<li>天生的基因支持并发</li>
<li>充分利用多核</li>
</ul>
<h3 id="强大的标准化："><a href="#强大的标准化：" class="headerlink" title="强大的标准化："></a>强大的标准化：</h3><ul>
<li>runtime系统调度机制：<ul>
<li>帮助垃圾回收</li>
<li>帮助我们做一些Go的调度的平均分配</li>
<li>很多的优化机制</li>
</ul>
</li>
<li>高效的GC垃圾回收：<ul>
<li>1.8版本之后就加入了三色标记和混合写屏障，效率非常搞了</li>
</ul>
</li>
<li>丰富的标准库：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211013095232.png" srcset="/img/loading.gif" lazyload alt="image-20211013095232293"></p>
<h3 id="简单易学："><a href="#简单易学：" class="headerlink" title="简单易学："></a>简单易学：</h3><ul>
<li>25个关键字</li>
<li>C基因，内嵌C都支持？？？</li>
<li>面向对象的特征（继承，多态，封装）</li>
<li>跨平台</li>
</ul>
<h3 id="大厂领军："><a href="#大厂领军：" class="headerlink" title="大厂领军："></a>大厂领军：</h3><ul>
<li>背书猛的一批：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211013095437.png" srcset="/img/loading.gif" lazyload alt="image-20211013095436889"></p>
<ul>
<li>编译速度很快啊！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211013095553.png" srcset="/img/loading.gif" lazyload alt="image-20211013095552886"></p>
<h2 id="适用领域："><a href="#适用领域：" class="headerlink" title="适用领域："></a>适用领域：</h2><ol>
<li>云计算基础设施：<strong>Docker , k8s</strong> , etcd , consul , cloudflare CDN等等</li>
<li>基础后端软件：tidb , influxdb</li>
<li>微服务：go-kit , micro , monzo bank的bilibili等</li>
<li>互联网基础设施：以太坊 ， hyperledger等</li>
</ol>
<h2 id="不足："><a href="#不足：" class="headerlink" title="不足："></a>不足：</h2><ol>
<li>包管理的不足</li>
<li>没有泛化，GO计划2.0上加上（传言）</li>
<li>所有的Exception都用Error来处理</li>
<li>对于C的降级处理，并非无缝衔接</li>
</ol>
<h1 id="认识Go程序"><a href="#认识Go程序" class="headerlink" title="认识Go程序"></a>认识Go程序</h1><h2 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h2><h3 id="简单程序入门："><a href="#简单程序入门：" class="headerlink" title="简单程序入门："></a>简单程序入门：</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main <span class="hljs-comment">//程序的包名</span><br><br><span class="hljs-comment">//引入的包</span><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"time"</span><br>)<br><br><span class="hljs-comment">//main函数</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//Golang中的";"，加上和不加上都可以哦</span><br>   fmt.Println(<span class="hljs-string">"hello Go!!!"</span>)<br>   time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>一个Package中只有一个Main入口哦！！！</li>
<li>函数的<code>{</code>一定是和函数名在同一行的，否则编译错误。</li>
</ul>
<h3 id="变量声明："><a href="#变量声明：" class="headerlink" title="变量声明："></a>变量声明：</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"math"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//方法一：声明一个变量</span><br>   <span class="hljs-keyword">var</span> a <span class="hljs-type">int</span><br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Printf(<span class="hljs-string">"type of a = %T\n"</span>,a)<br><br>   <span class="hljs-comment">//方法二：声明一个变量，初始化一个值</span><br>   <span class="hljs-keyword">var</span> b <span class="hljs-type">int</span> = <span class="hljs-number">100</span><br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br>   fmt.Printf(<span class="hljs-string">"type of b = %T\n"</span>,b)<br><br>   <span class="hljs-comment">//方法三：初始化的时候，可以省去数据类型，通过值自动会匹配当前的变量的数据类型</span><br>   <span class="hljs-keyword">var</span> c = <span class="hljs-number">200</span><br>   fmt.Println(<span class="hljs-string">"c = "</span>,c)<br>   fmt.Printf(<span class="hljs-string">"type of c = %T\n"</span>,c)<br><br>   <span class="hljs-keyword">var</span> d = <span class="hljs-string">"abcd"</span><br>   fmt.Printf(<span class="hljs-string">"d = %s, type of d = %T\n"</span>,d,d)<br><br>   <span class="hljs-comment">//方法四：（最常用的方法）省去var关键词，直接自动匹配</span><br>   e := math.Pi<br>   fmt.Printf(<span class="hljs-string">"e = %f, type of e = %T\n"</span>,e,e)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>上面就是声明变量的方法。</li>
<li>如果想要全局变量，把变量的声明放在方法外面就成嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> gA <span class="hljs-type">int</span> = <span class="hljs-number">100</span><br><span class="hljs-keyword">var</span> gB = <span class="hljs-number">200</span><br><span class="hljs-comment">//gC := 300</span><br></code></pre></td></tr></tbody></table></figure>

<p>上面的方法一二三都可以声明全局变量，但是方法四这种简单的是不适用的嗷！！！</p>
<ul>
<li>声明多个变量</li>
</ul>
<p><code>var xx , yy int  = 100, 200</code></p>
<p><code>var kk , ll  = 100 , "Alexander"</code></p>
<p>多行的多变量声明：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span>(<br>	vv <span class="hljs-type">int</span> = <span class="hljs-number">100</span><br>    jj <span class="hljs-type">bool</span> = <span class="hljs-literal">true</span><br>)<br></code></pre></td></tr></tbody></table></figure>

<p>语法四声明变量：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">xx , yy := <span class="hljs-number">100</span>,<span class="hljs-number">200</span><br>fmt.Println(xx)<br>fmt.Println(yy)<br></code></pre></td></tr></tbody></table></figure>





<h3 id="Const与Iota知识点注意事项"><a href="#Const与Iota知识点注意事项" class="headerlink" title="Const与Iota知识点注意事项"></a>Const与Iota知识点注意事项</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-comment">// const可以用于枚举类型</span><br><span class="hljs-keyword">const</span> (<br>   <span class="hljs-comment">//可以在const() 中添加一个关键字iota，每行iota都会累加1，第一行的ioat默认值为0</span><br>   BEIJING = <span class="hljs-number">10</span>*<span class="hljs-literal">iota</span>  <span class="hljs-comment">//iota = 0</span><br>   SHANGHAI      <span class="hljs-comment">//iota = 1</span><br>   SHENZHEN      <span class="hljs-comment">//iota = 2</span><br>)<br><br><span class="hljs-keyword">const</span> (<br>   a, b = <span class="hljs-literal">iota</span>+<span class="hljs-number">1</span> , <span class="hljs-literal">iota</span>+<span class="hljs-number">2</span> <span class="hljs-comment">// iota = 0 , a = iota + 1 , b = iota + 2 , a = 1 , b = 2</span><br>   c, d               <span class="hljs-comment">// iota = 1 , c = iota + 1 , d = iota + 2 , c = 2 , d = 3</span><br>   e, f               <span class="hljs-comment">// iota = 2 , e = iota + 1 , f = iota + 2 , e = 3 , f = 4</span><br><br>   g, h = <span class="hljs-literal">iota</span>*<span class="hljs-number">2</span> , <span class="hljs-literal">iota</span>*<span class="hljs-number">3</span> <span class="hljs-comment">// iota = 3 , g = iota * 2 , h = iota * 3 , g = 6 , h = 9</span><br>   i,k                   <span class="hljs-comment">// iota = 4 , i = iota * 2 , k = iota * 3 , i = 8 , k = 12</span><br>)<br><br><span class="hljs-comment">// summary: iota每一行都加1，第一行为0（从0开始），具体的计算公式则是根据我们第一行给出的计算公式来确定的嗷！！！</span><br><span class="hljs-comment">// iota只能够配合const() 一起使用哦！！！iota只有在const进行累加效果。。。</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//常量（只读属性）</span><br>   <span class="hljs-keyword">const</span> length <span class="hljs-type">int</span> = <span class="hljs-number">10</span><br><br>   fmt.Println(<span class="hljs-string">"length = "</span>,length)<br><br>   <span class="hljs-comment">//length = 100，常量是不允许修改的</span><br>   fmt.Println(<span class="hljs-string">"BEIJING = "</span>,BEIJING)<br>   fmt.Println(<span class="hljs-string">"SHANGHAI = "</span>,SHANGHAI)<br>   fmt.Println(<span class="hljs-string">"SHENZHEN = "</span>,SHENZHEN)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h3 id="函数的多返回值三种写法"><a href="#函数的多返回值三种写法" class="headerlink" title="函数的多返回值三种写法"></a>函数的多返回值三种写法</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo1</span><span class="hljs-params">(a <span class="hljs-type">string</span>, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {<br>   fmt.Println(<span class="hljs-string">"--- foo1 ---"</span>)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br><br>   c := <span class="hljs-number">100</span><br><br>   <span class="hljs-keyword">return</span> c<br>}<br><br><span class="hljs-comment">//返回多个匿名返回值</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo2</span><span class="hljs-params">(a <span class="hljs-type">string</span>, b <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">int</span>,<span class="hljs-type">int</span>) {<br>   fmt.Println(<span class="hljs-string">"--- foo2 ---"</span>)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br><br>   <span class="hljs-keyword">return</span> <span class="hljs-number">666</span>,<span class="hljs-number">777</span><br>}<br><br><span class="hljs-comment">//返回多个返回值，有形参名称的，这两值就算我的函数中不赋值，默认的返回值也为0嗷！！！</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo3</span><span class="hljs-params">(a <span class="hljs-type">string</span>, b <span class="hljs-type">string</span>)</span></span> (r1 <span class="hljs-type">int</span>,r2 <span class="hljs-type">int</span>) {<br>   fmt.Println(<span class="hljs-string">"--- foo3 ---"</span>)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br><br>   <span class="hljs-comment">//给有名称的返回值变量赋值</span><br>   r1 = <span class="hljs-number">1000</span><br>   r2 = <span class="hljs-number">2000</span><br><br>   <span class="hljs-keyword">return</span><br>}<br><br><span class="hljs-comment">//r1 , r2类型相同的时候，可以使用一个int就成嗷！！！</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo4</span><span class="hljs-params">(a <span class="hljs-type">string</span>, b <span class="hljs-type">string</span>)</span></span> (r1 ,r2 <span class="hljs-type">int</span>) {<br>   fmt.Println(<span class="hljs-string">"--- foo4 ---"</span>)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br><br>   <span class="hljs-comment">//给有名称的返回值变量赋值</span><br>   r1 = <span class="hljs-number">1000</span><br>   r2 = <span class="hljs-number">2000</span><br><br>   <span class="hljs-keyword">return</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   c := foo1(<span class="hljs-string">"foo1"</span>,<span class="hljs-number">6666</span>)<br>   fmt.Println(<span class="hljs-string">"c = "</span>,c)<br><br><br>   ret1 , ret2 := foo2(<span class="hljs-string">"foo2"</span>,<span class="hljs-string">"Hah, this is another one!!!"</span>)<br>   fmt.Println(ret1)<br>   fmt.Println(ret2)<br><br><br>   ret1 , ret2 = foo3(<span class="hljs-string">"foo3"</span>,<span class="hljs-string">"Hah, this is the third one!!!"</span>)<br>   fmt.Println(<span class="hljs-string">"ret1 = "</span>,ret1,<span class="hljs-string">" ret2 = "</span>,ret2)<br><br>   ret1 , ret2 = foo4(<span class="hljs-string">"foo4"</span>,<span class="hljs-string">"Hah, this is the fourth one!!!"</span>)<br>   fmt.Println(<span class="hljs-string">"ret1 = "</span>,ret1,<span class="hljs-string">" ret2 = "</span>,ret2)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>summary：<ol>
<li>匿名</li>
<li>匿名多返回值</li>
<li>有名称的返回值</li>
</ol>
</li>
</ul>
<h3 id="Import导包路径和Init方法"><a href="#Import导包路径和Init方法" class="headerlink" title="Import导包路径和Init方法"></a>Import导包路径和Init方法</h3><ul>
<li>示意图：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211014194110.png" srcset="/img/loading.gif" lazyload alt="image-20211014194102605"></p>
<p>有点像Java的初始化函数，在调用某个包中的方法的时候，先会执行Init()方法进行初始化。</p>
<ul>
<li>函数：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><br><span class="hljs-comment">//大写的函数才是对外开放的函数，不然的话就只有当前包中才可以调用嗷！！！</span><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">"go2/GolangStudy/5-init/lib1"</span><br>	<span class="hljs-string">"go2/GolangStudy/5-init/lib2"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	lib1.Lib1Test()<br>	lib2.Lib2Test()<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>文件目录结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211014194749.png" srcset="/img/loading.gif" lazyload alt="image-20211014194749257"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211014194943.png" srcset="/img/loading.gif" lazyload alt="image-20211014194943744"></p>
<p>GoLand非常强，不用自己导入包，直接输入lib1就有提示的嗷！！！</p>
<ul>
<li>lib1中对应的go文件的内容：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> lib1<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Lib1Test</span><span class="hljs-params">()</span></span>{<br>   fmt.Println(<span class="hljs-string">"Lib1Test()..."</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>{<br>   fmt.Println(<span class="hljs-string">"lib1 , init() ..."</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>







<h3 id="Import匿名及别名导包方式"><a href="#Import匿名及别名导包方式" class="headerlink" title="Import匿名及别名导包方式"></a>Import匿名及别名导包方式</h3><ul>
<li>导入的包如果不使用任何函数，那么会报错，如果我仅仅想要执行某个包中的初始化方法但是又用不到这个包中的任何方法呢？？？</li>
</ul>
<ol>
<li>匿名导入包：</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><br><span class="hljs-comment">//大写的函数才是对外开放的函数，不然的话就只有当前包中才可以调用嗷！！！</span><br><span class="hljs-keyword">import</span> (<br>	_ <span class="hljs-string">"go2/GolangStudy/5-init/lib1"</span><br>	<span class="hljs-string">"go2/GolangStudy/5-init/lib2"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	<span class="hljs-comment">// lib1.Lib1Test()</span><br>	lib2.Lib2Test()<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>如上就可以使得lib1中的Init()方法执行嗷！！！</p>
<p>如果匿名导入包的话是无法使用这个包的方法的，但是可以使得对应包的初始化方法执行嗷！！！</p>
<ol start="2">
<li>同理，可以给导入的包起别名嗷！！！</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><br><span class="hljs-comment">//大写的函数才是对外开放的函数，不然的话就只有当前包中才可以调用嗷！！！</span><br><span class="hljs-keyword">import</span> (<br>	_ <span class="hljs-string">"go2/GolangStudy/5-init/lib1"</span><br>	mylib2 <span class="hljs-string">"go2/GolangStudy/5-init/lib2"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	<span class="hljs-comment">// lib1.Lib1Test()</span><br>	mylib2.Lib2Test()<br>}<br></code></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>全部方法的导入方法：</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><br><span class="hljs-comment">//大写的函数才是对外开放的函数，不然的话就只有当前包中才可以调用嗷！！！</span><br><span class="hljs-keyword">import</span> (<br>	_ <span class="hljs-string">"go2/GolangStudy/5-init/lib1"</span><br>	. <span class="hljs-string">"go2/GolangStudy/5-init/lib2"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	<span class="hljs-comment">// lib1.Lib1Test()</span><br>	Lib2Test()<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>类似于Python中的<code>from package import *</code></p>
<p>点不要轻易使用，如果两个包中有同名的方法就会发生冲突嗷！！！</p>
<h3 id="Golang中的指针速通"><a href="#Golang中的指针速通" class="headerlink" title="Golang中的指针速通"></a>Golang中的指针速通</h3><ul>
<li>和C语言中的是一样的嗷！！！简单的参数就是传值！！！如果<code>*a</code>和C语言是一样的嗷！！！就是传址操作嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211014200036.png" srcset="/img/loading.gif" lazyload alt="image-20211014200036290"></p>
<ul>
<li>经典示例代码：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">swap</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> {<br>   <span class="hljs-keyword">var</span> temp = a<br>   a = b<br>   b = temp<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">swap2</span><span class="hljs-params">(a, b *<span class="hljs-type">int</span>)</span></span> {<br>   <span class="hljs-keyword">var</span> temp = *a<br>   *a = *b<br>   *b = temp<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   a, b := <span class="hljs-number">10</span>, <span class="hljs-number">20</span><br>   swap(a,b)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br><br>   <span class="hljs-comment">//swap</span><br>   a,b = <span class="hljs-number">10</span>,<span class="hljs-number">20</span><br>   swap2(&amp;a,&amp;b)<br>   fmt.Println(<span class="hljs-string">"a = "</span>,a)<br>   fmt.Println(<span class="hljs-string">"b = "</span>,b)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h3 id="defer语句"><a href="#defer语句" class="headerlink" title="defer语句"></a>defer语句</h3><ul>
<li>示例代码：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//写入defer关键字</span><br>   <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"main end1"</span>)<br>   <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"main end2"</span>)<br><br>   fmt.Println(<span class="hljs-string">"main::hello go 1"</span>)<br>   fmt.Println(<span class="hljs-string">"main::hello go 2"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>defer后面的语句在所有流程结束，代码结束之前执行，类似于Java中的finally，经常用于释放资源。</li>
<li>defer可以有多个，本质是进行了压栈，所以上面的end1在栈底，end2在栈首，执行的时候先main end2再main end1嗷！！！</li>
<li>另外一个Demo：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span> {<br>   fmt.Println(<span class="hljs-string">"hehe, I am here !!!"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//写入defer关键字</span><br>   <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"main end"</span>)<br>   <span class="hljs-keyword">defer</span> test()<br><br>   fmt.Println(<span class="hljs-string">"main::hello go 1"</span>)<br>   fmt.Println(<span class="hljs-string">"main::hello go 2"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>输出结果：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">main::hello go 1<br>main::hello go 2<br>hehe, I am here !!!<br>main end<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>defer要放在return之前哈，不然defer根本执行不到哇！！！return应该放在最后嗷！！！现在探究的是return和defer的执行顺序：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211014201307.png" srcset="/img/loading.gif" lazyload alt="image-20211014201307142"></p>
<p>很好理解，当程序运行到<code>}</code>的时候，才执行deter函数嗷，这个时候return早就执行完了嗷！！！deter是在return后面执行的嗷！！！</p>
<ul>
<li>另外一个小例子：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span> {<br>   fmt.Println(<span class="hljs-string">"hehe, I am here !!!"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {<br>   <span class="hljs-keyword">defer</span> test()<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello this is the return function"</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//写入defer关键字</span><br>   <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"main end"</span>)<br>   <span class="hljs-keyword">defer</span> test()<br><br>   fmt.Println(<span class="hljs-string">"main::hello go 1"</span>)<br>   fmt.Println(<span class="hljs-string">"main::hello go 2"</span>)<br><br>   test2()<br><br>   fmt.Println(<span class="hljs-string">"======================"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">main::hello go 1<br>main::hello go 2<br>hehe, I am here !!!<br>======================<br>hehe, I am here !!!<br>main end<br></code></pre></td></tr></tbody></table></figure>

<p>可以看到，deter是在 <strong>本方法执行结束之后执行的嗷！！！</strong></p>
<h3 id="Go中的Slice"><a href="#Go中的Slice" class="headerlink" title="Go中的Slice"></a>Go中的Slice</h3><ul>
<li>相应笔记在代码中哦！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printArray</span><span class="hljs-params">(myArray []<span class="hljs-type">int</span>)</span></span> {<br>   <span class="hljs-keyword">for</span> _,val := <span class="hljs-keyword">range</span> myArray {<br>      fmt.Println(val)<br>   }<br><br>   myArray[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//固定长度数组</span><br>   <span class="hljs-keyword">var</span> myArray1 [<span class="hljs-number">10</span>]<span class="hljs-type">int</span><br>   myArray2 := [<span class="hljs-number">10</span>]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>}<br><br>   <span class="hljs-comment">//第一种遍历方式</span><br>   <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(myArray1); i++ {<br>      fmt.Println(myArray1[i])<br>   }<br>   <br>   fmt.Println(<span class="hljs-string">"================"</span>)<br>   <br>   <span class="hljs-comment">//第二种方式</span><br>   <span class="hljs-keyword">for</span> index, value := <span class="hljs-keyword">range</span> myArray2 {<br>      fmt.Println(<span class="hljs-string">"index = "</span>,index,<span class="hljs-string">",value = "</span>,value)<br>   }<br><br>   fmt.Println(<span class="hljs-string">"================"</span>)<br><br>   <span class="hljs-comment">//查看数组的数据类型</span><br>   fmt.Printf(<span class="hljs-string">"myArray1 type = %T\n"</span>, myArray1)<br>   fmt.Printf(<span class="hljs-string">"myArray2 type = %T\n"</span>, myArray2)<br><br>   fmt.Println(<span class="hljs-string">"================"</span>)<br><br>   <span class="hljs-comment">//不同长度数组的类型都不一样，那咱怎么传参呢？？？不可能给每个长度的数组定制啊，这也太麻烦了！！！</span><br>   <span class="hljs-comment">//引入我们的动态数组的概念</span><br>   <span class="hljs-comment">//注意，如果传参是myArray [10]int这种形式，本质是传值，如果是myArray []int这种动态数组，本质是传址</span><br>   myArray := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>} <span class="hljs-comment">//这个也是动态数组的表示方式哦！！！最大的区别，就是没有写长度嗷！！！</span><br>   fmt.Printf(<span class="hljs-string">"myArray type = %T\n"</span>, myArray)<br>   printArray(myArray)<br>   fmt.Println(<span class="hljs-string">"===="</span>)<br>   <span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> myArray {<br>      fmt.Println(value)<br>   }<br><br>   fmt.Println(<span class="hljs-string">"================"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>注意上面哦！！！如果我们写死了传递的数组如：<code>myArray [4]int</code>这样的话，本质上也是值拷贝，不好修改元素，也不方便传值嗷！！！由此，动态数组非常重要嗷！！！</li>
<li>动态数组在传参上使用的类似于Java的引用传递，而且不同元素长度的动态数组，他们的形参是一致的嗷！！！</li>
</ul>
<h4 id="Slice的声明方式"><a href="#Slice的声明方式" class="headerlink" title="Slice的声明方式"></a>Slice的声明方式</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//第一种哦！！！</span><br>   slice1 := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>}<br>   fmt.Printf(<span class="hljs-string">"len = %d, slice = %v\n"</span>,<span class="hljs-built_in">len</span>(slice1),slice1)<br><br>   <span class="hljs-comment">//第二种</span><br>   <span class="hljs-keyword">var</span> slice2 []<span class="hljs-type">int</span> <span class="hljs-comment">//声明slice2是一个切片，但是没有给他分配空间嗷！！！这个时候直接slice[0] = 100是错误的，因为这个空间都不存在嗷！！！</span><br>   slice2 = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span> , <span class="hljs-number">3</span>) <span class="hljs-comment">// 为这个slice分配空间，默认值都是0哈！！！</span><br>   fmt.Printf(<span class="hljs-string">"len = %d, slice = %v\n"</span>,<span class="hljs-built_in">len</span>(slice2),slice2)<br><br>   <span class="hljs-comment">//第三种，声明的同时为其分配空间嗷！！！</span><br>   <span class="hljs-keyword">var</span> slice3 []<span class="hljs-type">int</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>,<span class="hljs-number">3</span>)<br>   fmt.Printf(<span class="hljs-string">"len = %d, slice = %v\n"</span>,<span class="hljs-built_in">len</span>(slice3),slice3)<br><br>   <span class="hljs-comment">//第四种，通过给遍历分配空间，通过:=推导出slice是一个切片</span><br>   slice4 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>,<span class="hljs-number">3</span>)<br>   fmt.Printf(<span class="hljs-string">"len = %d, slice = %v\n"</span>,<span class="hljs-built_in">len</span>(slice4),slice4)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>常用分配空间方式</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">if</span> slice == <span class="hljs-literal">nil</span>{<br>    slice = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>,<span class="hljs-number">3</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="Slice的使用方式"><a href="#Slice的使用方式" class="headerlink" title="Slice的使用方式"></a>Slice的使用方式</h4><ul>
<li>切片容量追加</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> numbers = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span> , <span class="hljs-number">3</span> , <span class="hljs-number">5</span>)<br>fmt.Printf(<span class="hljs-string">"len = %d , cap = %d , slice = %v\n"</span>, <span class="hljs-built_in">len</span>(numbers) , <span class="hljs-built_in">cap</span>(numbers) , numbers)<br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211016155338.png" srcset="/img/loading.gif" lazyload alt="image-20211016155330391">ptr指向合法空间末尾，后面两个格子是非法空间，虽然无法访问，但是为位置已经开辟好了嗷！！！</p>
<ul>
<li>追加两个元素：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">numbers = <span class="hljs-built_in">append</span>(numbers, <span class="hljs-number">1</span>)<br>numbers = <span class="hljs-built_in">append</span>(numbers, <span class="hljs-number">2</span>)<br></code></pre></td></tr></tbody></table></figure>

<p>向numbers中追加两个元素，这个时候numbers已经满了。</p>
<ul>
<li>numbers已经满了，再向其中添加内容怎么办？</li>
</ul>
<blockquote>
<p>go会自动帮助我们再去开辟一段空间，默认容量拓展为原来容量的两倍（切片扩容机制）</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211016155711.png" srcset="/img/loading.gif" lazyload alt="image-20211016155711564"></p>
</blockquote>
<ul>
<li>如果不指定cap，默认的cap和你分配的len是一样嗷！！！</li>
<li>切片的截取：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">s := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>}<br><br><span class="hljs-comment">//第一种方式，startIndex : endIndex</span><br>s1 := s[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>]<br><span class="hljs-comment">//下面这种表示全部元素，还有类似的</span><br>s2 := s[:]<br>s[startIndex:]<br>s[:endIndex]<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>截取本质：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211016160146.png" srcset="/img/loading.gif" lazyload alt="image-20211016160146239"></p>
<p>默认截取指向的底层切片是同一个！！</p>
<p>如果我想要完成copy呢？</p>
<p><code>s2 := make([]int , 3)</code></p>
<p><code>copy(s3, s)</code></p>
<p>这个就类似于Java中的浅拷贝和深拷贝，上面这个意思就是将s中的内容依次拷贝到s3中嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211016160419.png" srcset="/img/loading.gif" lazyload alt="image-20211016160418875"></p>
<h3 id="Go中的Map"><a href="#Go中的Map" class="headerlink" title="Go中的Map"></a>Go中的Map</h3><h4 id="Map的声明方式"><a href="#Map的声明方式" class="headerlink" title="Map的声明方式"></a>Map的声明方式</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//===》 第一种方式：声明myMap1是一个map，key和value都为string，和slice一样，这样声明map底层是没有空间的嗷</span><br>   <span class="hljs-keyword">var</span> myMap1 <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span><br>   <span class="hljs-keyword">if</span> myMap1 == <span class="hljs-literal">nil</span> {<br>      fmt.Println(<span class="hljs-string">"myMap1 is an empty map!!!"</span>)<br>   }<br><br>   myMap1 = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> , <span class="hljs-number">2</span>)<br>   myMap1[<span class="hljs-string">"one"</span>] = <span class="hljs-string">"java"</span><br>   myMap1[<span class="hljs-string">"two"</span>] = <span class="hljs-string">"python"</span><br>   myMap1[<span class="hljs-string">"three"</span>] = <span class="hljs-string">"c++"</span><br><br>   <span class="hljs-comment">//如果我的map赋值赋满了，底层也会自动帮助我们开辟空间，和slice是一样的嗷！！！</span><br>   fmt.Printf(<span class="hljs-string">"%v , %d\n"</span> , myMap1,<span class="hljs-built_in">len</span>(myMap1))<br><br>   <span class="hljs-comment">//===》 第二种方式：可以不指定长度哦，自动会给我们分配长度的</span><br>   myMap2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">string</span>)<br>   myMap2[<span class="hljs-number">1</span>] = <span class="hljs-string">"java"</span><br><br>   <span class="hljs-comment">//===》 第三种方式</span><br>   myMap3 := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<br>      <span class="hljs-string">"one"</span>: <span class="hljs-string">"php"</span>,<br>      <span class="hljs-string">"two"</span>: <span class="hljs-string">"python"</span>,<br>   }<br>   fmt.Println(myMap3)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>和Java很像，声明了一个这种变量，一定要初始化（在Go中叫做分配空间），才能够使用嗷！！！</p>
<h4 id="Map的使用方式"><a href="#Map的使用方式" class="headerlink" title="Map的使用方式"></a>Map的使用方式</h4><ul>
<li>增删改查：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go">cityMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)<br><br><span class="hljs-comment">//添加</span><br>cityMap[<span class="hljs-string">"china"</span>] = <span class="hljs-string">"BeiJing"</span><br>cityMap[<span class="hljs-string">"Japan"</span>] = <span class="hljs-string">"Tokyo"</span><br>cityMap[<span class="hljs-string">"USA"</span>] = <span class="hljs-string">"NewYork"</span><br><br><span class="hljs-comment">//删除</span><br><span class="hljs-built_in">delete</span>(cityMap , <span class="hljs-string">"Japan"</span>)<br><br><span class="hljs-comment">//修改</span><br>cityMap[<span class="hljs-string">"USA"</span>] = <span class="hljs-string">"DC"</span><br><br><span class="hljs-comment">//遍历</span><br><span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> cityMap{<br>    fmt.Println(<span class="hljs-string">"key = "</span>,key)<br>    fmt.Println(<span class="hljs-string">"value = "</span>,value)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>定义打印Map的函数</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printMap</span><span class="hljs-params">(cityMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)</span></span>{<br>    <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> cityMap{<br>        fmt.Println(<span class="hljs-string">"key = "</span>,key)<br>        fmt.Println(<span class="hljs-string">"value = "</span>,value)<br>    }<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">changeValue</span><span class="hljs-params">(cityMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)</span></span>{<br>    cityMap[<span class="hljs-string">"England"</span>] = <span class="hljs-string">"London"</span><br>}<br><br><span class="hljs-comment">//调用</span><br>printMap(cityMap)<br></code></pre></td></tr></tbody></table></figure>

<p>这里要注意，调用这个函数的时候，本质上是一个引用传递，实质上传递的是cityMap的指针嗷！！！指向的是同一块空间嗷！！！</p>
<h3 id="struct的基本定义和使用"><a href="#struct的基本定义和使用" class="headerlink" title="struct的基本定义和使用"></a>struct的基本定义和使用</h3><ul>
<li>结构体基本使用，函数定义（传值或传址）</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-keyword">type</span> myint <span class="hljs-type">int</span><br><br><span class="hljs-keyword">type</span> Book <span class="hljs-keyword">struct</span> {<br>	title <span class="hljs-type">string</span><br>	auth <span class="hljs-type">string</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">changeBook</span><span class="hljs-params">(book Book)</span></span>{<br>	<span class="hljs-comment">//传递一个Book的副本</span><br>	book.auth = <span class="hljs-string">"tuzijiejie"</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">changeBook2</span><span class="hljs-params">(book *Book)</span></span>{<br>	<span class="hljs-comment">//传递一个Book的指针</span><br>	book.auth = <span class="hljs-string">"tuzijiejie"</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	<span class="hljs-keyword">var</span> a myint = <span class="hljs-number">10</span><br>	fmt.Println(<span class="hljs-string">"a = "</span>,a)<br><br>	<span class="hljs-keyword">var</span> book1 Book<br>	book1.title = <span class="hljs-string">"Golang"</span><br>	book1.auth = <span class="hljs-string">"tuzi"</span><br><br>	fmt.Printf(<span class="hljs-string">"%v\n"</span>,book1)<br><br>	changeBook(book1)<br>	fmt.Printf(<span class="hljs-string">"%v\n"</span>,book1)<br><br>	changeBook2(&amp;book1)<br>	fmt.Printf(<span class="hljs-string">"%v\n"</span>,book1)<br>}<br></code></pre></td></tr></tbody></table></figure>

<h4 id="类的表示："><a href="#类的表示：" class="headerlink" title="类的表示："></a>类的表示：</h4><ul>
<li>将结构体和方法分开，此外要注意大小写，大写才是能够被外部访问到的嗷！！！</li>
</ul>
<p>下面这一个struct搭配上下面专属的方法，构成了一个完整的类嗷！！！</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Hero <span class="hljs-keyword">struct</span>{<br>    Name <span class="hljs-type">string</span><br>    Ad <span class="hljs-type">int</span><br>    Level <span class="hljs-type">int</span><br>}<br><br><span class="hljs-comment">//(this Hero)这种是传值嗷！！！打咩，只有*才是传地址，才可以改变属性嗷！！！</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Hero)</span></span> GetName(){<br>    fmt.Println(<span class="hljs-string">"Name = "</span>, this.Name)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Hero)</span></span> SetName(newName <span class="hljs-type">string</span>){<br>    this.name = newName<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Hero)</span></span> Show(){<br>    fmt.Println(<span class="hljs-string">"Name = "</span>,this.Name)<br>    fmt.Println(<span class="hljs-string">"Ad = "</span>,this.Ad)<br>    fmt.Println(<span class="hljs-string">"Level = "</span>,this.Level)<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>this Hero指的是和Hero这个struct绑定，调用这个属性的是Hero对象，实际调用的对象可以用this来指代</p>
<ul>
<li>创建对象：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">hero := Hero{Name: <span class="hljs-string">"tuzi"</span>, Ad: <span class="hljs-number">100</span> , Level: <span class="hljs-number">1</span>}<br>hero.Show()<br><br>hero.SetName(<span class="hljs-string">"lisi"</span>)<br>hero.Show()<br></code></pre></td></tr></tbody></table></figure>

<p>虽然语法没有任何错误，但是所有的方法传入的对象（this Hero），都是该对象的一个副本（拷贝）</p>
<p>因此要改为 <strong>指针</strong> ！！！（this *Hero），这样写，当对象调用的时候，才默认是传递引用嗷！！！</p>
<ul>
<li>大写与小写：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211016165449.png" srcset="/img/loading.gif" lazyload alt="image-20211016165448638"></p>
<p>例如Level -&gt; level，这个只有类中可以访问嗷！！！如果方法是大写，其他的包中是能够访问的。但是如果是小写，只有本包之内能访问这个方法。</p>
<h4 id="类的继承："><a href="#类的继承：" class="headerlink" title="类的继承："></a>类的继承：</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-comment">//父类</span><br><span class="hljs-keyword">type</span> Human <span class="hljs-keyword">struct</span> {<br>   name <span class="hljs-type">string</span><br>   sex <span class="hljs-type">string</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Human)</span></span> Eat(){<br>   fmt.Println(<span class="hljs-string">"Human eat ......"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Human)</span></span> Walk() {<br>   fmt.Println(<span class="hljs-string">"Human walk ......"</span>)<br>}<br><br><span class="hljs-comment">//=====================================================</span><br><br><span class="hljs-comment">//子类</span><br><span class="hljs-keyword">type</span> SuperMan <span class="hljs-keyword">struct</span> {<br>   Human <span class="hljs-comment">// 这么写就表示继承了Human这个类</span><br><br>   level <span class="hljs-type">int</span><br>}<br><br><span class="hljs-comment">//重定义父类方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *SuperMan)</span></span> Eat() {<br>   fmt.Println(<span class="hljs-string">"SuperHuman eat ......"</span>)<br>}<br><br><span class="hljs-comment">//子类新方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *SuperMan)</span></span> Fly()  {<br>   fmt.Println(<span class="hljs-string">"SuperHuman fly ......"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *SuperMan)</span></span> Print()  {<br>   fmt.Println(<span class="hljs-string">"========================"</span>)<br>   fmt.Println(<span class="hljs-string">"name = "</span>,this.name)<br>   fmt.Println(<span class="hljs-string">"gender = "</span>,this.sex)<br>   fmt.Println(<span class="hljs-string">"level = "</span>,this.level)<br>}<br><br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//定义父类对象</span><br>   h := Human{<span class="hljs-string">"zhang3"</span>,<span class="hljs-string">"male"</span>}<br><br>   h.Eat()<br>   h.Walk()<br><br>   fmt.Println(<span class="hljs-string">"======================"</span>)<br><br>   <span class="hljs-comment">//定义子类对象</span><br>   s := SuperMan{Human{<span class="hljs-string">"Clerk"</span>,<span class="hljs-string">"male"</span>},<span class="hljs-number">100</span>}<br>   s.Eat() <span class="hljs-comment">//子类重写的方法</span><br>   s.Walk() <span class="hljs-comment">//父类定义的方法</span><br>   s.Fly() <span class="hljs-comment">//子类新增的方法</span><br><br>   <span class="hljs-comment">//子类定义对象的另外一种方式</span><br>   <span class="hljs-keyword">var</span> s2 SuperMan<br>   s2.name = <span class="hljs-string">"Alexander Liu"</span><br>   s2.sex = <span class="hljs-string">"male"</span><br>   s2.level = <span class="hljs-number">88</span><br>   s2.Print()<br>}<br></code></pre></td></tr></tbody></table></figure>



<h3 id="Interface的基本定义和使用"><a href="#Interface的基本定义和使用" class="headerlink" title="Interface的基本定义和使用"></a>Interface的基本定义和使用</h3><h4 id="多态的实现："><a href="#多态的实现：" class="headerlink" title="多态的实现："></a>多态的实现：</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-comment">//本质上是一个指针</span><br><span class="hljs-keyword">type</span> Animal <span class="hljs-keyword">interface</span> {<br>   Sleep()<br>   GetColor() <span class="hljs-type">string</span> <span class="hljs-comment">//获取动物的颜色</span><br>   GetType() <span class="hljs-type">string</span> <span class="hljs-comment">//获得动物的种类</span><br>}<br><br><span class="hljs-comment">//具体的类1</span><br><span class="hljs-keyword">type</span> Cat <span class="hljs-keyword">struct</span> {<br><span class="hljs-comment">// 继承接口甚至都不用写继承，直接把接口中的方法全部实现就行了嗷！！！</span><br>   color <span class="hljs-type">string</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Cat)</span></span> Sleep() {<br>   fmt.Println(<span class="hljs-string">"Cat is sleeping"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Cat)</span></span> GetColor() <span class="hljs-type">string</span> {<br>   <span class="hljs-keyword">return</span> this.color<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Cat)</span></span> GetType() <span class="hljs-type">string</span> {<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">"Cat"</span><br>}<br><br><span class="hljs-comment">//具体的类2</span><br><span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> {<br>   <span class="hljs-comment">// 继承接口甚至都不用写继承，直接把接口中的方法全部实现就行了嗷！！！</span><br>   color <span class="hljs-type">string</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Dog)</span></span> Sleep() {<br>   fmt.Println(<span class="hljs-string">"Dog is sleeping"</span>)<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Dog)</span></span> GetColor() <span class="hljs-type">string</span> {<br>   <span class="hljs-keyword">return</span> this.color<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Dog)</span></span> GetType() <span class="hljs-type">string</span> {<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">"Dog"</span><br>}<br><br><span class="hljs-comment">//定义接口的方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">showAnimal</span><span class="hljs-params">(animal Animal)</span></span>  {<br>   animal.Sleep()<br>   fmt.Println(<span class="hljs-string">"kind = "</span>,animal.GetType())<br>   fmt.Println(<span class="hljs-string">"color = "</span>,animal.GetColor())<br>}<br><br><span class="hljs-comment">//完全实现了所有的方法，接口的指针才能够具体的实现类</span><br><span class="hljs-comment">//什么是多态：接口指针指向具体的实现类，由于实现类的不同，导致状态也不一样嗷！！！</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-keyword">var</span> animal Animal<br><br>   animal = &amp;Cat{<span class="hljs-string">"White"</span>}<br><br>   showAnimal(animal)<br>   fmt.Println(<span class="hljs-string">"============="</span>)<br><br>   animal = &amp;Dog{<span class="hljs-string">"Black"</span>}<br><br>   showAnimal(animal)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>多态的基本要素：<ol>
<li>有一个父类（有接口）。</li>
<li>有子类（实现了父类的全部接口方法）。</li>
<li>父类的类型的变量（指针）指向（引用）子类的具体数据变量。</li>
</ol>
</li>
</ul>
<h4 id="通用万能类型（空接口）："><a href="#通用万能类型（空接口）：" class="headerlink" title="通用万能类型（空接口）："></a>通用万能类型（空接口）：</h4><ul>
<li>interface {}</li>
<li>所有的int , string , float64 , struct ……都实现了interface{} ——&gt; 可以使用interface {} 类型引用任意的数据类型。</li>
<li>本质上空接口没有方法，也就是所有类型都实现了空接口，因此空接口可以调用任何类型的数据。</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><br><br><span class="hljs-comment">//interface是万能数据类型</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myFunc</span><span class="hljs-params">(arg <span class="hljs-keyword">interface</span>{})</span></span>  {<br>   fmt.Println(<span class="hljs-string">"MyFunc is called ... "</span>)<br>   fmt.Println(arg)<br><br>   <span class="hljs-comment">//interface{} 如何区分引用的底层数据类型是什么</span><br><br>   <span class="hljs-comment">//底层有“类型断言机制”</span><br>   value , ok := arg.(<span class="hljs-type">string</span>)<br>   <span class="hljs-keyword">if</span> !ok {<br>      fmt.Println(<span class="hljs-string">"arg is not string type"</span>)<br>   }<span class="hljs-keyword">else</span> {<br>      fmt.Println(<span class="hljs-string">"arg is string , value = "</span>,value)<br>      fmt.Printf(<span class="hljs-string">"value type is %T\n"</span>,arg)<br>   }<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   myFunc(<span class="hljs-number">0</span>)<br>   fmt.Println(<span class="hljs-string">"============="</span>)<br>   myFunc(<span class="hljs-string">"0"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>类型断言为什么会成功？</li>
</ul>
<p>底层变量的构造：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211017102801.png" srcset="/img/loading.gif" lazyload alt="image-20211017102801380"></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> a <span class="hljs-type">string</span><br>a = <span class="hljs-string">"abc"</span><br><span class="hljs-comment">//pair&lt;static type:string , value:"abc"&gt;</span><br><br><span class="hljs-keyword">var</span> allType <span class="hljs-keyword">interface</span>{}<br>allType = a<br><span class="hljs-comment">//pair&lt;type: string , value:"abc"&gt;</span><br><br>str , _ := allType.(<span class="hljs-type">string</span>)<br><span class="hljs-comment">//这个断言会去查找上面的pair，判断这个type和你的判断类型是否相等嗷！！！</span><br></code></pre></td></tr></tbody></table></figure>

<p>具体类型：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211017103355.png" srcset="/img/loading.gif" lazyload alt="image-20211017103354620"></p>
<ul>
<li>另外一个小例子：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211017103856.png" srcset="/img/loading.gif" lazyload alt="image-20211017103856558"></p>
<p>虽然拿着它的Interface一直在变，但是在记录的pair中的数据，始终如一嗷！！！</p>
<h3 id="Reflect反射机制"><a href="#Reflect反射机制" class="headerlink" title="Reflect反射机制"></a>Reflect反射机制</h3><ul>
<li><p>这里的反射机制要承接上面的pair &lt;type , value&gt;使用哦</p>
</li>
<li><p>允许我们把变量的原型给他造出来</p>
</li>
</ul>
<p>常用方式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211018192045.png" srcset="/img/loading.gif" lazyload alt="image-20211018192044873"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211018192059.png" srcset="/img/loading.gif" lazyload alt="image-20211018192059582"></p>
<p>下面这两个其实就是获得了传入的interface的pair来获得了对应的类型信息。</p>
<ul>
<li>使用代码：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">"fmt"</span><br>	<span class="hljs-string">"reflect"</span><br>)<br><br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {<br>	Id <span class="hljs-type">int</span><br>	Name <span class="hljs-type">string</span><br>	Age <span class="hljs-type">int</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> Call() {<br>	fmt.Println(<span class="hljs-string">"user is called ... "</span>)<br>	fmt.Printf(<span class="hljs-string">"%v\n"</span>,this)<br>}<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reflectNum</span><span class="hljs-params">(arg <span class="hljs-keyword">interface</span>{})</span></span>{<br>	fmt.Println(<span class="hljs-string">"type : "</span>,reflect.TypeOf(arg))<br>	fmt.Println(<span class="hljs-string">"value : "</span>,reflect.ValueOf(arg))<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DoFiledAndMethod</span><span class="hljs-params">(input <span class="hljs-keyword">interface</span>{})</span></span>{<br>	<span class="hljs-comment">//获取input的type</span><br>	inputType := reflect.TypeOf(input)<br>	fmt.Println(<span class="hljs-string">"input type is : "</span>,inputType.Name())<br><br>	<span class="hljs-comment">//获取input的value</span><br>	inputValue := reflect.ValueOf(inputType).Elem()<br>	fmt.Println(<span class="hljs-string">"input value is : "</span>,inputValue)<br><br>	<span class="hljs-comment">//通过type获取里面的字段</span><br>	<span class="hljs-comment">//1. 获取interface的reflect.type，通过type得到NumField，进行遍历</span><br>	<span class="hljs-comment">//2. 得到每个field，数据类型</span><br>	<span class="hljs-comment">//3. 通过field又一个Interface{}方法得到对应的value</span><br>	<span class="hljs-comment">//for i := 0; i &lt; inputType.NumField(); i++ {</span><br>	<span class="hljs-comment">//	field := inputType.Field(i)</span><br>	<span class="hljs-comment">//	value := inputValue.Field(i).Elem()</span><br>	<span class="hljs-comment">//</span><br>	<span class="hljs-comment">//	fmt.Printf("%s : %v = %v\n",field.Name,field.Type,value)</span><br>	<span class="hljs-comment">//}</span><br><br>	<span class="hljs-comment">//通过type获取里面的方法</span><br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; inputType.NumMethod(); i++ {<br>		m := inputType.Method(i)<br>		fmt.Printf(<span class="hljs-string">"%s: %v\n"</span>,m.Name,m.Type)<br>	}<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	num := <span class="hljs-number">3.1415926525</span><br><br>	reflectNum(num)<br><br>	fmt.Println(<span class="hljs-string">"==================="</span>)<br><br>	user := User{<br>		Id:   <span class="hljs-number">22</span>,<br>		Name: <span class="hljs-string">"Alexander liu"</span>,<br>		Age:  <span class="hljs-number">19</span>,<br>	}<br><br>	DoFiledAndMethod(user)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="反射解析结构体标签tag"><a href="#反射解析结构体标签tag" class="headerlink" title="反射解析结构体标签tag"></a>反射解析结构体标签tag</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"reflect"</span><br>)<br><br><span class="hljs-keyword">type</span> resume <span class="hljs-keyword">struct</span> {<br>   Name <span class="hljs-type">string</span> <span class="hljs-string">`info:"name" doc:"我的名字"`</span><br>   Sex <span class="hljs-type">string</span> <span class="hljs-string">`info:"sex"`</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">findTag</span><span class="hljs-params">(str <span class="hljs-keyword">interface</span>{})</span></span>{<br>   t := reflect.TypeOf(str).Elem()<br><br>   <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; t.NumField(); i++ {<br>      tagString := t.Field(i).Tag.Get(<span class="hljs-string">"info"</span>)<br>      tagdoc := t.Field(i).Tag.Get(<span class="hljs-string">"doc"</span>)<br><br>      fmt.Println(<span class="hljs-string">"info: "</span>, tagString , <span class="hljs-string">" doc: "</span>,tagdoc)<br>   }<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-keyword">var</span> re resume<br><br>   findTag(&amp;re)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h4 id="结构体标签在JSON中的使用"><a href="#结构体标签在JSON中的使用" class="headerlink" title="结构体标签在JSON中的使用"></a>结构体标签在JSON中的使用</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"encoding/json"</span><br>   <span class="hljs-string">"fmt"</span><br>)<br><br><span class="hljs-keyword">type</span> Movie <span class="hljs-keyword">struct</span> {<br>   <span class="hljs-comment">//后面的json后面就是json中对应的标签</span><br>   Title <span class="hljs-type">string</span> <span class="hljs-string">`json:"title"`</span><br>   Year <span class="hljs-type">int</span> <span class="hljs-string">`json:"year"`</span><br>   Price <span class="hljs-type">int</span>  <span class="hljs-string">`json:"rmb"`</span><br>   Actors []<span class="hljs-type">string</span> <span class="hljs-string">`json:"actors"`</span><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   movie := Movie{<br>      Title:  <span class="hljs-string">"Avengers"</span>,<br>      Year:   <span class="hljs-number">2019</span>,<br>      Price:  <span class="hljs-number">142</span>,<br>      Actors: []<span class="hljs-type">string</span>{<span class="hljs-string">"Iron Man"</span>,<span class="hljs-string">"Thor"</span>,<span class="hljs-string">"Hulk"</span>,<span class="hljs-string">"Vision"</span>,<span class="hljs-string">"Captain America"</span>},<br>   }<br><br>   <span class="hljs-comment">//编码的过程   结构体---&gt;json</span><br>   jsonStr, err := json.Marshal(movie)<br>   <span class="hljs-keyword">if</span> err!=<span class="hljs-literal">nil</span> {<br>      fmt.Println(<span class="hljs-string">"json marshal error"</span>,err)<br>      <span class="hljs-keyword">return</span><br>   }<br><br>   fmt.Printf(<span class="hljs-string">"jsonStr = %s\n"</span>,jsonStr)<br>    <br>    <span class="hljs-comment">//解码的过程 jsonStr ---&gt; 结构体</span><br>    my_movie := Movie{}<br>    err = json.Unmarshal(jsonStr,&amp;myMovie)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span>{<br>        fmt.Println(<span class="hljs-string">"json unmarshal error"</span>, err)<br>        <span class="hljs-keyword">return</span><br>    }<br>    <br>    fmt.Printf(<span class="hljs-string">"%v\n"</span>,myMovie)<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>可以看一下JSON的结果哦！！！</li>
</ul>
<p><code>jsonStr = {"title":"Avengers","year":2019,"rmb":142,"actors":["Iron Man","Thor","Hulk","Vision","Captain America"]}</code></p>
<p>可以看到这里的标签就是我们上面的tag中的标签哦！！！和Java相比，多了一种方式嗷！！！</p>
<h1 id="GoRoutine"><a href="#GoRoutine" class="headerlink" title="GoRoutine"></a>GoRoutine</h1><h2 id="设计策略："><a href="#设计策略：" class="headerlink" title="设计策略："></a>设计策略：</h2><ol>
<li>复用内核级线程</li>
</ol>
<ul>
<li>多线程，多进程解决了阻塞的问题，但是还是有问题！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020204527.png" srcset="/img/loading.gif" lazyload alt="image-20211020204519579"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020205213.png" srcset="/img/loading.gif" lazyload alt="image-20211020205213128"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020205235.png" srcset="/img/loading.gif" lazyload alt="image-20211020205234515"></p>
<ul>
<li>go-routine的引入：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020205350.png" srcset="/img/loading.gif" lazyload alt="image-20211020205350253"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020205405.png" srcset="/img/loading.gif" lazyload alt="image-20211020205405129"></p>
<p>M:N关系：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020205456.png" srcset="/img/loading.gif" lazyload alt="image-20211020205456336"></p>
<p>GMP：</p>
<p>G -&gt; goroutine协程</p>
<p>P -&gt; processor处理器</p>
<p>M -&gt; thread线程（内核态线程）</p>
<p>整体结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020210016.png" srcset="/img/loading.gif" lazyload alt="image-20211020210016275"></p>
<ul>
<li>Work Stealing机制：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020210235.png" srcset="/img/loading.gif" lazyload alt="image-20211020210234665">自己的没了，从旁边的队列偷一个过来执行，偷取机制！！！</p>
<ul>
<li>Hand Off机制：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020210436.png" srcset="/img/loading.gif" lazyload alt="image-20211020210435926"></p>
<p>分离机制，一个携程卡死了，CPU里面进行M的切换，队列也发生改变，让阻塞的阻塞去吧，我继续干活了嗷！！！</p>
<ol start="2">
<li>利用并行</li>
</ol>
<p>GOMAXPROCS限定P的个数 = CPU核数 / 2</p>
<ol start="3">
<li>抢占：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020210713.png" srcset="/img/loading.gif" lazyload alt="image-20211020210712773"></p>
<ol start="4">
<li>全局G队列</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211020210745.png" srcset="/img/loading.gif" lazyload alt="image-20211020210745336"></p>
<h2 id="创建GoRoutine："><a href="#创建GoRoutine：" class="headerlink" title="创建GoRoutine："></a>创建GoRoutine：</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"time"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newTask</span><span class="hljs-params">()</span></span>{<br>   i := <span class="hljs-number">0</span><br>   <span class="hljs-keyword">for</span> {<br>      i++<br>      fmt.Printf(<span class="hljs-string">"new Gouroutine : i = %d\n"</span>,i)<br>      time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>   }<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//创建一个go程</span><br>   <span class="hljs-comment">//第一种方式，定义方法，用go去执行</span><br>   <span class="hljs-keyword">go</span> newTask()<br><br>   <span class="hljs-comment">//所有的子goroutine空间都是从main给的</span><br>   <span class="hljs-comment">//main退出了，其他的子goroutine都会退出嗷！！！！</span><br><br>   <span class="hljs-comment">//第二种方法，匿名函数跑跑跑！！！</span><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"B.defer"</span>)<br>      <span class="hljs-comment">//退出当前GoRoutine，不影响其他Goroutine</span><br>      <span class="hljs-comment">//runtime.Goexit()</span><br>      <span class="hljs-comment">//直接让整个Go程序退出</span><br>      <span class="hljs-comment">//return</span><br>      <br>      fmt.Println(<span class="hljs-string">"B"</span>)<br>   }()<br><br>   <span class="hljs-comment">//第二种方法（二），匿名+参数</span><br>   <span class="hljs-comment">//这里的返回值是拿不到的嗷！！！</span><br>   <span class="hljs-comment">//本来就是并行的，我都往下走了，我还回头把值返回给你吗？？？？？？</span><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a <span class="hljs-type">int</span>, b <span class="hljs-type">int</span>)</span></span>  {<br>      fmt.Println(a + b)<br>   }(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>)<br><br>   i := <span class="hljs-number">0</span><br>   <span class="hljs-keyword">for</span> i != <span class="hljs-number">5</span>{<br>      i ++<br>      fmt.Printf(<span class="hljs-string">"             main goroutine : i = %d\n"</span>,i)<br>      time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/inthat/article/details/118531656">Goroutine中exit函数的使用！！！</a></li>
</ul>
<h2 id="通信机制Channel："><a href="#通信机制Channel：" class="headerlink" title="通信机制Channel："></a>通信机制Channel：</h2><ul>
<li><p>本身就是一种数据类型，具有同步两个goroutine的能力嗷！！！如果队列中没有数据读取数据会阻塞！！！当其中有数据的时候，会通知刚刚阻塞的线程嗷！！！</p>
</li>
<li><p>创建channel：</p>
</li>
</ul>
<p><code>make(chan Type, capacity)</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   <span class="hljs-comment">//定义一个channel</span><br><br>   c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"goroutine结束"</span>)<br>      time.Sleep(time.Second*<span class="hljs-number">5</span>)<br>      fmt.Println(<span class="hljs-string">"goroutine正在执行"</span>)<br>      <span class="hljs-comment">//发送数据给channel c</span><br>      c &lt;- <span class="hljs-number">666</span><br>   }()<br><br>   <span class="hljs-comment">//接收c并且赋值给变量num</span><br>   <span class="hljs-comment">//这里会阻塞嗷！！！！因为上面sleep了，channel中啥都没有，主线程就阻塞在这里了嗷！！！</span><br>   num := &lt;- c<br>   fmt.Println(<span class="hljs-string">"num = "</span>,num)<br>   fmt.Println(<span class="hljs-string">"main goroutine 结束..."</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>



<h3 id="无缓冲Channel："><a href="#无缓冲Channel：" class="headerlink" title="无缓冲Channel："></a>无缓冲Channel：</h3><p>示意图：</p>
<p><img src="C:\Users\Alexander\AppData\Roaming\Typora\typora-user-images\image-20211021190714968.png" srcset="/img/loading.gif" lazyload alt="image-20211021190714968"></p>
<p>上面的代码其实就是无缓冲的channel嗷</p>
<h3 id="有缓冲Channel："><a href="#有缓冲Channel：" class="headerlink" title="有缓冲Channel："></a>有缓冲Channel：</h3><p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021190751.png" srcset="/img/loading.gif" lazyload alt="image-20211021190750932"></p>
<ul>
<li>channel满了塞数据就会阻塞，channel空了取数据就会阻塞。</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span> , <span class="hljs-number">3</span>)<span class="hljs-comment">//带有缓冲的channel</span><br><br>   fmt.Println(<span class="hljs-string">"len(c) = "</span>,<span class="hljs-built_in">len</span>(c) , <span class="hljs-string">" cap(c) = "</span>,<span class="hljs-built_in">cap</span>(c))<br><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"子go程结束"</span>)<br><br>      <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++ {<br>         c &lt;- i<br>         fmt.Println(<span class="hljs-string">"子go正在执行，发送的元素是："</span>,i)<br>      }<br>   }()<br><br>   time.Sleep(<span class="hljs-number">2</span>*time.Second)<br>   <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {<br>      num := &lt;-c <span class="hljs-comment">//从c中接受数据</span><br>      fmt.Println(<span class="hljs-string">"num = "</span>,num)<br>   }<br><br>   fmt.Println(<span class="hljs-string">"main结束了嗷！！！"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<h3 id="关闭Channel："><a href="#关闭Channel：" class="headerlink" title="关闭Channel："></a>关闭Channel：</h3><ol>
<li>如果不关闭Channel：</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {<br>         c &lt;- i<br>      }<br><br>      <span class="hljs-comment">//close可以关闭一个channel</span><br>      <span class="hljs-comment">//close(c)</span><br>      <br>   }()<br><br>   <span class="hljs-keyword">for</span> {<br>      <span class="hljs-comment">//ok为true说明channel没有关闭，false的话channel已经关闭了嗷！！！</span><br>      <span class="hljs-keyword">if</span> data, ok := &lt;- c;ok {<br>         fmt.Println(data)<br>      }<span class="hljs-keyword">else</span> {<br>         <span class="hljs-keyword">break</span><br>      }<br>   }<br><br>   fmt.Println(<span class="hljs-string">"Main Finished ... "</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021191846.png" srcset="/img/loading.gif" lazyload alt="image-20211021191845813"></p>
<p>因为子goroutine退出了，channel没有关闭，main在取数据的时候阻塞，又没有人叫它起来，gg了。</p>
<p>如果关闭了话！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021191959.png" srcset="/img/loading.gif" lazyload alt="image-20211021191958941"></p>
<ul>
<li>Channel不像文件一样需要经常去关闭，只有当我们没有任何数据要发送了，才关闭channel</li>
<li><strong>关闭channel后再发数据会引发panic，并且接收立即返回零值</strong>。</li>
<li><strong>关闭channel后，可以继续从channel接收数据</strong></li>
<li>对于nil channel，无论收发都会被阻塞嗷！！！（比如声明了一个chan但是并没有make，就是nil咯orz）</li>
</ul>
<h3 id="Channel和range："><a href="#Channel和range：" class="headerlink" title="Channel和range："></a>Channel和range：</h3><ul>
<li>迭代操作Channel的时候我们使用range嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> data := <span class="hljs-keyword">range</span> c{<br>   fmt.Println(data)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>非常好用嗷！！！有的话我就取，没有我就等，关了我就收！！！</p>
<h3 id="Channel和select："><a href="#Channel和select：" class="headerlink" title="Channel和select："></a>Channel和select：</h3><ul>
<li>单流程下一个go只能监控一个channel的状态，select可以监控多个channel的状态！！！</li>
<li>select一般和for搭配一起使用嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fibonacci</span><span class="hljs-params">(c , quit <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span>{<br>   x , y := <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br>   <span class="hljs-keyword">for</span>  {<br>      <span class="hljs-keyword">select</span> {<br>      <span class="hljs-keyword">case</span> c &lt;- x:<br>         <span class="hljs-comment">//如果c可以写进去，则该case就会进来</span><br>         x = y<br>         y = x + y<br>      <span class="hljs-keyword">case</span> &lt;- quit:<br>         <span class="hljs-comment">//如果quit可以读，则该case就会进来</span><br>         fmt.Println(<span class="hljs-string">"quit"</span>)<br>         <span class="hljs-keyword">return</span><br>      }<br>   }<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>   quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {<br>         fmt.Println( &lt;- c)<br>      }<br><br>      quit &lt;- <span class="hljs-number">0</span><br>   }()<br><br>   <span class="hljs-comment">//main go</span><br>   fibonacci(c,quit)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>多路Channel的一个监控功能嗷！！！</p>
<h1 id="GOMODULES"><a href="#GOMODULES" class="headerlink" title="GOMODULES"></a>GOMODULES</h1><h2 id="工作模式弊端"><a href="#工作模式弊端" class="headerlink" title="工作模式弊端"></a>工作模式弊端</h2><ul>
<li>Go Modules的出现淘汰了GoPath，例如之前GOPATH要求项目全写在$GOPATH下，很恼火，很不自由嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021194903.png" srcset="/img/loading.gif" lazyload alt="image-20211021194902854"></p>
<ul>
<li>cmd中输入go env可以查看go的环境变量</li>
<li>GOPAHT的弊端：<ol>
<li>没有版本控制的概念哈！！！无法指定拉取自己需要的版本的库之类的</li>
<li>无法同步一致第三方版本号</li>
<li>无法指定当前项目引用的第三方版本号</li>
</ol>
</li>
</ul>
<h2 id="GoModules模式"><a href="#GoModules模式" class="headerlink" title="GoModules模式"></a>GoModules模式</h2><ul>
<li><code>go mod help</code>可以得到go mod的全部指令的帮助文档。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021195641.png" srcset="/img/loading.gif" lazyload alt="image-20211021195641167"></p>
<ul>
<li>go mod环境变量：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021195727.png" srcset="/img/loading.gif" lazyload alt="image-20211021195727200"></p>
<ul>
<li>环境变量讲解：</li>
</ul>
<ol>
<li>GO111MODULE</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021195819.png" srcset="/img/loading.gif" lazyload alt="image-20211021195819381"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022114233.png" srcset="/img/loading.gif" lazyload alt="image-20211022114233438"></p>
<ol start="2">
<li>GOPROXY</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021200004.png" srcset="/img/loading.gif" lazyload alt="image-20211021200003916"></p>
<p>这个本质上就是配置镜像源嗷！！！</p>
<p>注意这里七牛云后面还有个<code>,direct</code>，或者表示如果在前面的仓库中找不到，就会回源到模块版本的源地址去找（比如Github，如果再找不到的话，就会报错了嗷！！！）</p>
<ol start="3">
<li>GOSUMDB</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021200730.png" srcset="/img/loading.gif" lazyload alt="image-20211021200730404"></p>
<p>校验拉取的第三方库是否完整。设置了GOPROXY，我们就不用担心这个原来的设置是外网的库拉，这个GOPROXY就会帮助我们自动校验嗷！！！</p>
<ol start="4">
<li>GONOPROXY/GONOSUMDB/GOPRIVATE</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021200943.png" srcset="/img/loading.gif" lazyload alt="image-20211021200943334"></p>
<p>通过设置一个GOPRIVATE即可嗷！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021201542.png" srcset="/img/loading.gif" lazyload alt="image-20211021201542414"></p>
<ul>
<li>小总结：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211021201056.png" srcset="/img/loading.gif" lazyload alt="image-20211021201056360"></p>
<p>环境变量设置：</p>
<p><code>go env -w 环境变量名=相应参数</code></p>
<h2 id="Go-Modules初始化项目"><a href="#Go-Modules初始化项目" class="headerlink" title="Go Modules初始化项目"></a>Go Modules初始化项目</h2><ul>
<li>步骤：<ol>
<li>创建对应的文件夹</li>
<li>进入文件夹中执行<code>go mod init 当前模块名称</code></li>
</ol>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022112500.png" srcset="/img/loading.gif" lazyload alt="image-20211022112500525"></p>
<p>后面导包的时候，项目的整体名称就是这个了嗷！！！</p>
<p>进入初始化好的go.mod文件看一眼</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022112605.png" srcset="/img/loading.gif" lazyload alt="image-20211022112604894"></p>
<p>可以看到这个项目的module名称还有go的版本号</p>
<ul>
<li>导入github的项目康康效果？</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022112735.png" srcset="/img/loading.gif" lazyload alt="image-20211022112734815"></p>
<ul>
<li>然后我们可以导入对应的包：</li>
</ul>
<ol>
<li>导入单个子模块：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022112936.png" srcset="/img/loading.gif" lazyload alt="image-20211022112936281"></p>
<p>直接找到对应的模块go get就可以拉下来了嗷！！！</p>
<ul>
<li>其实可以不用手动down的，你直接跑项目的时候go mod就会帮助我们自动down下来我们需要的依赖了嗷！！！</li>
</ul>
<ol start="2">
<li>下载整个模块：</li>
</ol>
<p><code>go get github.com/aceld/zinx</code></p>
<p>这样就把对应的项目的包全部都拉下来了嗷！！！</p>
<p>跑一把：</p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022113121.png" srcset="/img/loading.gif" lazyload alt="image-20211022113121334"></p>
<ul>
<li>导完之后发现当前目录下多了一个go.sum文件嗷！！！</li>
<li>而且当我们访问go mod的时候：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022113317.png" srcset="/img/loading.gif" lazyload alt="image-20211022113316814"></p>
<p>间接依赖，这里意味着，我只以来了这个包的子模块，不是整体依赖这个包嗷！！！</p>
<ul>
<li>我们再看看go.sum文件中的内容：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022113450.png" srcset="/img/loading.gif" lazyload alt="image-20211022113450155"></p>
<p>第一个h1 + hash，第二个是gomod + hash。表达一共就只有这两种方式哈！！！</p>
<p>h1 + hash：对于整个包所有文件做哈希，这是为了保证整个包全部文件的完整性。</p>
<p>gomod + hash：表示对于mod文件进行的Hash，确保hash没有问题。</p>
<ul>
<li>刚刚下载的库再哪里呢？</li>
</ul>
<p><code>$GOPATH/pkg</code>这个包中，有一个mod模块，里面记录了我们的所有的不同的module的依赖包，打开对应的module就能够看到我们在对应的module中下载的依赖包了嗷！！！</p>
<ul>
<li><p>项目可以在任意的目录中，因为下载位置等都配置好了嗷！！！</p>
</li>
<li><p>summary：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022114630.png" srcset="/img/loading.gif" lazyload alt="image-20211022114629646"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022114810.png" srcset="/img/loading.gif" lazyload alt="image-20211022114810294"></p>
<h2 id="改变模块依赖关系"><a href="#改变模块依赖关系" class="headerlink" title="改变模块依赖关系"></a>改变模块依赖关系</h2><ul>
<li>比如确定要使用某个版本的依赖，这个版本才有对应的依赖和资源。</li>
<li>第一：可以更改go mod中的版本依赖，改回某个老版本。</li>
<li>第二：使用指令进行版本替换：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022145950.png" srcset="/img/loading.gif" lazyload alt="image-20211022145950537"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022150021.png" srcset="/img/loading.gif" lazyload alt="image-20211022150021521"></p>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022150124.png" srcset="/img/loading.gif" lazyload alt="image-20211022150124165"></p>
<p>你需要找到$GOPATH下对应的下载的包和对应的版本，然后进行replace替换操作嗷！！！</p>
<h1 id="即时通信系统小项目"><a href="#即时通信系统小项目" class="headerlink" title="即时通信系统小项目"></a>即时通信系统小项目</h1><ul>
<li>技术结构：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211022150258.png" srcset="/img/loading.gif" lazyload alt="image-20211022150258190"></p>
<p>OnlineMap：记录在线用户</p>
<p>OnlineMap旁边的channel：进行广播channel</p>
<h2 id="版本一：构建基础Server"><a href="#版本一：构建基础Server" class="headerlink" title="版本一：构建基础Server"></a>版本一：构建基础Server</h2><ul>
<li>新建一个文件夹</li>
</ul>
<ol>
<li>建立server.go文件，写Server这个类，这个类包含三个大方法和一个重要的结构：<ul>
<li>Server类型的定义</li>
<li>创建一个Server对象方法</li>
<li>启动一个Server服务方法</li>
<li>处理一个连接方法</li>
</ul>
</li>
</ol>
<ul>
<li>server.go：</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"net"</span><br>)<br><br><span class="hljs-comment">// Server 这个Server就是用于定义对应的结构体和方法的嗷！！！</span><br><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<br>   Ip <span class="hljs-type">string</span><br>   Port <span class="hljs-type">int</span><br>}<br><br><span class="hljs-comment">// NewServer 创建一个server的接口</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(ip <span class="hljs-type">string</span>, port <span class="hljs-type">int</span>)</span></span> *Server {<br>   server := &amp;Server{<br>      Ip: ip,<br>      Port: port,<br>   }<br><br>   <span class="hljs-keyword">return</span> server<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Handler(conn net.Conn)  {<br>   <span class="hljs-comment">//...用于对接当前链接的业务</span><br>   fmt.Println(<span class="hljs-string">"连接建立成功"</span>)<br>}<br><br><br><span class="hljs-comment">// Start 启动服务器的端口</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Start() {<br>   <span class="hljs-comment">// socket listen</span><br>   listener , err := net.Listen(<span class="hljs-string">"tcp"</span>,fmt.Sprintf(<span class="hljs-string">"%s:%d"</span>,this.Ip,this.Port))<br>   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>      fmt.Println(<span class="hljs-string">"net.Listen error : "</span>,err)<br>      <span class="hljs-keyword">return</span><br>   }<br><br>   <span class="hljs-comment">//close listen socket</span><br>   <span class="hljs-keyword">defer</span> listener.Close()<br><br>   <span class="hljs-keyword">for</span> {<br>      <span class="hljs-comment">//accept</span><br>      conn , err := listener.Accept()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>         fmt.Println(<span class="hljs-string">"listener accept error : "</span>,err)<br>         <span class="hljs-keyword">continue</span><br>      }<br><br>      <span class="hljs-comment">//do handler</span><br>      <span class="hljs-keyword">go</span> this.Handler(conn)<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>main.go:</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>   server := NewServer(<span class="hljs-string">"127.0.0.1"</span>,<span class="hljs-number">8888</span>)<br>   server.Start()<br>}<br></code></pre></td></tr></tbody></table></figure>







<h2 id="版本二：用户上线功能"><a href="#版本二：用户上线功能" class="headerlink" title="版本二：用户上线功能"></a>版本二：用户上线功能</h2><p>还需要补充OnlineMap和Message这两个属性：</p>
<ul>
<li><p>OnlineMap：记录哪些用户在线。每一个用户实际上都绑定一个channel，这个channel是用于给client发消息的嗷，用户在监听channel，如果有数据会立刻把数据给client！！！</p>
</li>
<li><p>Message：本质上是server的一个channel，把消息广播嗷！！！</p>
</li>
<li><p>流程图：</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211023094952.png" srcset="/img/loading.gif" lazyload alt="image-20211023094951712"></p>
<ul>
<li>重点在于广播功能的实现：</li>
</ul>
<p>新增User.go：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">"net"</span><br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {<br>   Name <span class="hljs-type">string</span><br>   Addr <span class="hljs-type">string</span><br>   C <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span><br>   conn net.Conn<br>}<br><br><span class="hljs-comment">// NewUser 创建一个用户的API</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUser</span><span class="hljs-params">(conn net.Conn)</span></span> *User{<br>   userAddr := conn.RemoteAddr().String()<br><br>   user := &amp;User{<br>      Name: userAddr,<br>      Addr: userAddr,<br>      C: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>),<br>      conn: conn,<br>   }<br><br>   <span class="hljs-comment">//启动监听当前user channel消息的goroutine</span><br>   <span class="hljs-keyword">go</span> user.ListenMessage()<br><br>   <span class="hljs-keyword">return</span> user<br>}<br><br><span class="hljs-comment">// ListenMessage 监听当前User channel的方法，一旦有消息就直接发送给client</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> ListenMessage() {<br>   <span class="hljs-keyword">for</span> {<br>      msg := &lt;- this.C<br><br>      this.conn.Write([]<span class="hljs-type">byte</span>(msg+<span class="hljs-string">"\n"</span>))<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>修改server.go</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">"fmt"</span><br>   <span class="hljs-string">"net"</span><br>   <span class="hljs-string">"sync"</span><br>)<br><br><span class="hljs-comment">// Server 这个Server就是用于定义对应的结构体和方法的嗷！！！</span><br><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<br>   Ip <span class="hljs-type">string</span><br>   Port <span class="hljs-type">int</span><br><br>   <span class="hljs-comment">//子啊先用户的列表</span><br>   OnlineMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*User<br>   mapLock sync.RWMutex<br><br>   <span class="hljs-comment">//消息广播的channel</span><br>   Message <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span><br>}<br><br><span class="hljs-comment">// NewServer 创建一个server的接口</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(ip <span class="hljs-type">string</span>, port <span class="hljs-type">int</span>)</span></span> *Server {<br>   server := &amp;Server{<br>      Ip: ip,<br>      Port: port,<br>      OnlineMap: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*User),<br>      Message: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>),<br>   }<br><br>   <span class="hljs-keyword">return</span> server<br>}<br><br><span class="hljs-comment">// BroadCast 广播消息方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> BroadCast(user *User, msg <span class="hljs-type">string</span>)  {<br>   sendMsg := <span class="hljs-string">"["</span> + user.Addr + <span class="hljs-string">"]"</span> + user.Name + <span class="hljs-string">":"</span> + msg<br>   this.Message &lt;- sendMsg<br>}<br><br><span class="hljs-comment">// ListenMessage 监听Message广播消息channel的goroutine,一旦有消息就发送给全部的在线User</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> ListenMessage() {<br>   <span class="hljs-keyword">for</span> {<br>      msg := &lt;- this.Message<br><br>      <span class="hljs-comment">//将message发送给全部的在线User</span><br>      this.mapLock.Lock()<br><br>      <span class="hljs-keyword">for</span> _, cli := <span class="hljs-keyword">range</span> this.OnlineMap{<br>         cli.C &lt;- msg<br>      }<br><br>      this.mapLock.Unlock()<br>   }<br>}<br><br><br><span class="hljs-comment">// Handler 处理连接的方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Handler(conn net.Conn)  {<br>   <span class="hljs-comment">//...用于对接当前链接的业务</span><br>   <span class="hljs-comment">//fmt.Println("连接建立成功")</span><br><br>   user := NewUser(conn)<br><br>   <span class="hljs-comment">//用户上线，把用户加入到onlineMap中，并且广播消息</span><br>   this.mapLock.Lock()<br>   this.OnlineMap[user.Name] = user<br>   this.mapLock.Unlock()<br><br>   <span class="hljs-comment">//广播当前用户上线消息</span><br>   this.BroadCast(user,<span class="hljs-string">"已经上线"</span>)<br><br>   <span class="hljs-comment">//当前handler阻塞，为了防止这个死了之后，go程就挂了</span><br>   <span class="hljs-keyword">select</span> {<br>   }<br>}<br><br><br><span class="hljs-comment">// Start 启动服务器的端口</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Start() {<br>   <span class="hljs-comment">// socket listen</span><br>   listener , err := net.Listen(<span class="hljs-string">"tcp"</span>,fmt.Sprintf(<span class="hljs-string">"%s:%d"</span>,this.Ip,this.Port))<br>   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>      fmt.Println(<span class="hljs-string">"net.Listen error : "</span>,err)<br>      <span class="hljs-keyword">return</span><br>   }<br><br>   <span class="hljs-comment">//close listen socket</span><br>   <span class="hljs-keyword">defer</span> listener.Close()<br><br>   <span class="hljs-comment">//启动监听Message的goroutine</span><br>   <span class="hljs-keyword">go</span> this.ListenMessage()<br><br>   <span class="hljs-keyword">for</span> {<br>      <span class="hljs-comment">//accept</span><br>      conn , err := listener.Accept()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>         fmt.Println(<span class="hljs-string">"listener accept error : "</span>,err)<br>         <span class="hljs-keyword">continue</span><br>      }<br><br>      <span class="hljs-comment">//do handler</span><br>      <span class="hljs-keyword">go</span> this.Handler(conn)<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h2 id="版本三：用户消息广播机制"><a href="#版本三：用户消息广播机制" class="headerlink" title="版本三：用户消息广播机制"></a>版本三：用户消息广播机制</h2><ul>
<li>其实上面已经完成了相关的广播功能的编写了</li>
<li>我们接下来需要的就是编写对应的函数，把相应的用户消息放入我们的消息队列中即可</li>
</ul>
<h2 id="版本四：用户业务层封装"><a href="#版本四：用户业务层封装" class="headerlink" title="版本四：用户业务层封装"></a>版本四：用户业务层封装</h2><ul>
<li>把代码进行合并，整理成函数嗷，是谁负责的，例如用户的登录和退出，就封装在哪个类的方法中嗷！！！！同时通过数据结构中的指针，把用户和Service串起来，方便我们的操作嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//用户的上线业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> Online() {<br><br>   <span class="hljs-comment">//用户上线,将用户加入到onlineMap中</span><br>   this.server.mapLock.Lock()<br>   this.server.OnlineMap[this.Name] = this<br>   this.server.mapLock.Unlock()<br><br>   <span class="hljs-comment">//广播当前用户上线消息</span><br>   this.server.BroadCast(this, <span class="hljs-string">"已上线"</span>)<br>}<br><br><span class="hljs-comment">//用户的下线业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> Offline() {<br><br>   <span class="hljs-comment">//用户下线,将用户从onlineMap中删除</span><br>   this.server.mapLock.Lock()<br>   <span class="hljs-built_in">delete</span>(this.server.OnlineMap, this.Name)<br>   this.server.mapLock.Unlock()<br><br>   <span class="hljs-comment">//广播当前用户上线消息</span><br>   this.server.BroadCast(this, <span class="hljs-string">"下线"</span>)<br><br>}<br><br><span class="hljs-comment">//用户处理消息的业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> DoMessage(msg <span class="hljs-type">string</span>) {<br>   this.server.BroadCast(this, msg)<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>上面就是重构后提取出来的用户的业务嗷！！！</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Handler(conn net.Conn) {<br>   <span class="hljs-comment">//...当前链接的业务</span><br>   <span class="hljs-comment">//fmt.Println("链接建立成功")</span><br><br>   user := NewUser(conn, this)<br><br>   user.Online()<br><br>   <span class="hljs-comment">//接受客户端发送的消息</span><br>   <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>      buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">4096</span>)<br>      <span class="hljs-keyword">for</span> {<br>         n, err := conn.Read(buf)<br>         <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> {<br>            user.Offline()<br>            <span class="hljs-keyword">return</span><br>         }<br><br>         <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &amp;&amp; err != io.EOF {<br>            fmt.Println(<span class="hljs-string">"Conn Read err:"</span>, err)<br>            <span class="hljs-keyword">return</span><br>         }<br><br>         <span class="hljs-comment">//提取用户的消息(去除'\n')</span><br>         msg := <span class="hljs-type">string</span>(buf[:n<span class="hljs-number">-1</span>])<br><br>         <span class="hljs-comment">//用户针对msg进行消息处理</span><br>         user.DoMessage(msg)<br>      }<br>   }()<br><br>   <span class="hljs-comment">//当前handler阻塞</span><br>   <span class="hljs-keyword">select</span> {}<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>上面就是重构后提取出来的service的业务嗷！！！</p>
<p>以及把User和Server（正向一对一，反向一对多），分别使用指针和Map的方式将两者穿起来，方便我们后续的操作嗷！！！</p>
<h2 id="版本五：在线用户查询"><a href="#版本五：在线用户查询" class="headerlink" title="版本五：在线用户查询"></a>版本五：在线用户查询</h2><ul>
<li>添加在用户的DoMessage方法中，对于用户输入的消息进行判断，如果为”who”，就返回所有用户信息即可嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//专门用于给当前用户发消息的嗷！！！</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> SendMsg(msg <span class="hljs-type">string</span>) {<br>   this.conn.Write([]<span class="hljs-type">byte</span>(msg))<br>}<br><br><span class="hljs-comment">//用户处理消息的业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> DoMessage(msg <span class="hljs-type">string</span>) {<br>   <span class="hljs-keyword">if</span> msg == <span class="hljs-string">"who"</span>{<br>      <span class="hljs-comment">//查询在线的用户都有哪些</span><br>      this.server.mapLock.Lock()<br>      <span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> this.server.OnlineMap{<br>         onlineMsg := <span class="hljs-string">"["</span> + user.Addr + <span class="hljs-string">"]"</span> + user.Name + <span class="hljs-string">":"</span> + <span class="hljs-string">"在线...\n"</span><br>         this.SendMsg(onlineMsg)<br>      }<br>      this.server.mapLock.Unlock()<br><br>   } <span class="hljs-keyword">else</span> {<br>      this.server.BroadCast(this, msg)<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>



<h2 id="版本六：修改用户名"><a href="#版本六：修改用户名" class="headerlink" title="版本六：修改用户名"></a>版本六：修改用户名</h2><ul>
<li>定义一下：例如：<code>rename|兔子</code>就是当前用户名重命名为兔子！！！</li>
<li>和上面一样，都要使用DoMessage来判断处理</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//专门用于给当前用户发消息的嗷！！！</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> SendMsg(msg <span class="hljs-type">string</span>) {<br>   this.conn.Write([]<span class="hljs-type">byte</span>(msg))<br>}<br><br><span class="hljs-comment">//用户处理消息的业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> DoMessage(msg <span class="hljs-type">string</span>) {<br>   <span class="hljs-keyword">if</span> msg == <span class="hljs-string">"who"</span>{<br>      <span class="hljs-comment">//查询在线的用户都有哪些</span><br>      this.server.mapLock.Lock()<br>      <span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> this.server.OnlineMap{<br>         onlineMsg := <span class="hljs-string">"["</span> + user.Addr + <span class="hljs-string">"]"</span> + user.Name + <span class="hljs-string">":"</span> + <span class="hljs-string">"在线...\n"</span><br>         this.SendMsg(onlineMsg)<br>      }<br>      this.server.mapLock.Unlock()<br><br>   }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(msg) &gt; <span class="hljs-number">7</span> &amp;&amp; msg[:<span class="hljs-number">7</span>] == <span class="hljs-string">"rename|"</span> {<br>      <span class="hljs-comment">//消息格式：rename|张山</span><br>      newName := strings.Split(msg,<span class="hljs-string">"|"</span>)[<span class="hljs-number">1</span>]<br><br>      <span class="hljs-comment">//判断name是否存在</span><br>      _, ok := this.server.OnlineMap[newName]<br>      <span class="hljs-keyword">if</span> ok {<br>         this.SendMsg(<span class="hljs-string">"当前用户名被使用了！！！\n"</span>)<br>      }<span class="hljs-keyword">else</span> {<br>         <span class="hljs-comment">//修改服务器端的名字</span><br>         this.server.mapLock.Lock()<br>         <span class="hljs-built_in">delete</span>(this.server.OnlineMap,this.Name)<br>         this.server.OnlineMap[newName] = this<br>         this.server.mapLock.Unlock()<br><br>         <span class="hljs-comment">//修改用户端的名字</span><br>         this.Name = newName<br>         this.SendMsg(<span class="hljs-string">"您已经成功更新用户名为："</span> + this.Name + <span class="hljs-string">"\n"</span>)<br>      }<br>   } <span class="hljs-keyword">else</span> {<br>      this.server.BroadCast(this, msg)<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h2 id="版本七：超时强踢功能"><a href="#版本七：超时强踢功能" class="headerlink" title="版本七：超时强踢功能"></a>版本七：超时强踢功能</h2><ul>
<li>首先应该记录一个用户的在线时间嗷！！！</li>
<li>用到了select语法之类的 ，用到了两个channel嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *Server)</span></span> Handler(conn net.Conn) {<br>    <span class="hljs-comment">//...当前链接的业务</span><br>    <span class="hljs-comment">//fmt.Println("链接建立成功")</span><br> <br>    user := NewUser(conn, this)<br> <br>    user.Online()<br> <br>    <span class="hljs-comment">//监听用户是否活跃的channel</span><br>    isLive := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>)<br> <br>    <span class="hljs-comment">//接受客户端发送的消息</span><br>    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>        buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">4096</span>)<br>        <span class="hljs-keyword">for</span> {<br>            n, err := conn.Read(buf)<br>            <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> {<br>                user.Offline()<br>                <span class="hljs-keyword">return</span><br>            }<br> <br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &amp;&amp; err != io.EOF {<br>                fmt.Println(<span class="hljs-string">"Conn Read err:"</span>, err)<br>                <span class="hljs-keyword">return</span><br>            }<br> <br>            <span class="hljs-comment">//提取用户的消息(去除'\n')</span><br>            msg := <span class="hljs-type">string</span>(buf[:n<span class="hljs-number">-1</span>])<br> <br>            <span class="hljs-comment">//用户针对msg进行消息处理</span><br>            user.DoMessage(msg)<br> <br>            <span class="hljs-comment">//用户的任意消息，代表当前用户是一个活跃的</span><br>            isLive &lt;- <span class="hljs-literal">true</span><br>        }<br>    }()<br> <br>    <span class="hljs-comment">//当前handler阻塞</span><br>    <span class="hljs-keyword">for</span> {<br>        <span class="hljs-keyword">select</span> {<br>        <span class="hljs-keyword">case</span> &lt;-isLive:<br>            <span class="hljs-comment">//当前用户是活跃的，应该重置定时器</span><br>            <span class="hljs-comment">//不做任何事情，为了激活select，更新下面的定时器</span><br> <br>        <span class="hljs-keyword">case</span> &lt;-time.After(time.Second * <span class="hljs-number">10</span>):<br>            <span class="hljs-comment">//已经超时</span><br>            <span class="hljs-comment">//将当前的User强制的关闭</span><br> <br>            user.SendMsg(<span class="hljs-string">"你被踢了"</span>)<br> <br>            <span class="hljs-comment">//销毁用的资源</span><br>            <span class="hljs-built_in">close</span>(user.C)<br> <br>            <span class="hljs-comment">//关闭连接</span><br>            conn.Close()<br> <br>            <span class="hljs-comment">//退出当前Handler</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-comment">//runtime.Goexit()</span><br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h2 id="版本八：私聊功能"><a href="#版本八：私聊功能" class="headerlink" title="版本八：私聊功能"></a>版本八：私聊功能</h2><ul>
<li>和之前一样，修改DOMESSAGE，类似于自己定义通信协议嗷！！！</li>
<li>例如：<code>to|用户名|信息</code>这种方式，进行判断即可嗷！！！从全局的用户列表中，找到对应的用户，把他的Channel拿出来，把我要发的信息塞进去即可嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//用户处理消息的业务</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *User)</span></span> DoMessage(msg <span class="hljs-type">string</span>) {<br>    <span class="hljs-keyword">if</span> msg == <span class="hljs-string">"who"</span> {<br>        <span class="hljs-comment">//查询当前在线用户都有哪些</span><br> <br>        this.server.mapLock.Lock()<br>        <span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> this.server.OnlineMap {<br>            onlineMsg := <span class="hljs-string">"["</span> + user.Addr + <span class="hljs-string">"]"</span> + user.Name + <span class="hljs-string">":"</span> + <span class="hljs-string">"在线...\n"</span><br>            this.SendMsg(onlineMsg)<br>        }<br>        this.server.mapLock.Unlock()<br> <br>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(msg) &gt; <span class="hljs-number">7</span> &amp;&amp; msg[:<span class="hljs-number">7</span>] == <span class="hljs-string">"rename|"</span> {<br>        <span class="hljs-comment">//消息格式: rename|张三</span><br>        newName := strings.Split(msg, <span class="hljs-string">"|"</span>)[<span class="hljs-number">1</span>]<br> <br>        <span class="hljs-comment">//判断name是否存在</span><br>        _, ok := this.server.OnlineMap[newName]<br>        <span class="hljs-keyword">if</span> ok {<br>            this.SendMsg(<span class="hljs-string">"当前用户名被使用\n"</span>)<br>        } <span class="hljs-keyword">else</span> {<br>            this.server.mapLock.Lock()<br>            <span class="hljs-built_in">delete</span>(this.server.OnlineMap, this.Name)<br>            this.server.OnlineMap[newName] = this<br>            this.server.mapLock.Unlock()<br> <br>            this.Name = newName<br>            this.SendMsg(<span class="hljs-string">"您已经更新用户名:"</span> + this.Name + <span class="hljs-string">"\n"</span>)<br>        }<br> <br>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(msg) &gt; <span class="hljs-number">4</span> &amp;&amp; msg[:<span class="hljs-number">3</span>] == <span class="hljs-string">"to|"</span> {<br>        <span class="hljs-comment">//消息格式:  to|张三|消息内容</span><br> <br>        <span class="hljs-comment">//1 获取对方的用户名</span><br>        remoteName := strings.Split(msg, <span class="hljs-string">"|"</span>)[<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> remoteName == <span class="hljs-string">""</span> {<br>            this.SendMsg(<span class="hljs-string">"消息格式不正确，请使用 \"to|张三|你好啊\"格式。\n"</span>)<br>            <span class="hljs-keyword">return</span><br>        }<br> <br>        <span class="hljs-comment">//2 根据用户名 得到对方User对象</span><br>        remoteUser, ok := this.server.OnlineMap[remoteName]<br>        <span class="hljs-keyword">if</span> !ok {<br>            this.SendMsg(<span class="hljs-string">"该用户名不不存在\n"</span>)<br>            <span class="hljs-keyword">return</span><br>        }<br> <br>        <span class="hljs-comment">//3 获取消息内容，通过对方的User对象将消息内容发送过去</span><br>        content := strings.Split(msg, <span class="hljs-string">"|"</span>)[<span class="hljs-number">2</span>]<br>        <span class="hljs-keyword">if</span> content == <span class="hljs-string">""</span> {<br>            this.SendMsg(<span class="hljs-string">"无消息内容，请重发\n"</span>)<br>            <span class="hljs-keyword">return</span><br>        }<br>        remoteUser.SendMsg(this.Name + <span class="hljs-string">"对您说:"</span> + content)<br> <br>    } <span class="hljs-keyword">else</span> {<br>        this.server.BroadCast(this, msg)<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>





<h2 id="版本九：客户端实现"><a href="#版本九：客户端实现" class="headerlink" title="版本九：客户端实现"></a>版本九：客户端实现</h2><ul>
<li>新建Client.go嗷！！！</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br> <br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">"flag"</span><br>    <span class="hljs-string">"fmt"</span><br>    <span class="hljs-string">"io"</span><br>    <span class="hljs-string">"net"</span><br>    <span class="hljs-string">"os"</span><br>)<br> <br><span class="hljs-keyword">type</span> Client <span class="hljs-keyword">struct</span> {<br>    ServerIp   <span class="hljs-type">string</span><br>    ServerPort <span class="hljs-type">int</span><br>    Name       <span class="hljs-type">string</span><br>    conn       net.Conn<br>    flag       <span class="hljs-type">int</span> <span class="hljs-comment">//当前client的模式</span><br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewClient</span><span class="hljs-params">(serverIp <span class="hljs-type">string</span>, serverPort <span class="hljs-type">int</span>)</span></span> *Client {<br>    <span class="hljs-comment">//创建客户端对象</span><br>    client := &amp;Client{<br>        ServerIp:   serverIp,<br>        ServerPort: serverPort,<br>        flag:       <span class="hljs-number">999</span>,<br>    }<br> <br>    <span class="hljs-comment">//链接server</span><br>    conn, err := net.Dial(<span class="hljs-string">"tcp"</span>, fmt.Sprintf(<span class="hljs-string">"%s:%d"</span>, serverIp, serverPort))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>        fmt.Println(<span class="hljs-string">"net.Dial error:"</span>, err)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    }<br> <br>    client.conn = conn<br> <br>    <span class="hljs-comment">//返回对象</span><br>    <span class="hljs-keyword">return</span> client<br>}<br> <br><span class="hljs-comment">//处理server回应的消息， 直接显示到标准输出即可</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> DealResponse() {<br>    <span class="hljs-comment">//一旦client.conn有数据，就直接copy到stdout标准输出上, 永久阻塞监听</span><br>    io.Copy(os.Stdout, client.conn)<br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> menu() <span class="hljs-type">bool</span> {<br>    <span class="hljs-keyword">var</span> flag <span class="hljs-type">int</span><br> <br>    fmt.Println(<span class="hljs-string">"1.公聊模式"</span>)<br>    fmt.Println(<span class="hljs-string">"2.私聊模式"</span>)<br>    fmt.Println(<span class="hljs-string">"3.更新用户名"</span>)<br>    fmt.Println(<span class="hljs-string">"0.退出"</span>)<br> <br>    fmt.Scanln(&amp;flag)<br> <br>    <span class="hljs-keyword">if</span> flag &gt;= <span class="hljs-number">0</span> &amp;&amp; flag &lt;= <span class="hljs-number">3</span> {<br>        client.flag = flag<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    } <span class="hljs-keyword">else</span> {<br>        fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入合法范围内的数字&lt;&lt;&lt;&lt;"</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    }<br> <br>}<br> <br><span class="hljs-comment">//查询在线用户</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> SelectUsers() {<br>    sendMsg := <span class="hljs-string">"who\n"</span><br>    _, err := client.conn.Write([]<span class="hljs-type">byte</span>(sendMsg))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>        fmt.Println(<span class="hljs-string">"conn Write err:"</span>, err)<br>        <span class="hljs-keyword">return</span><br>    }<br>}<br> <br><span class="hljs-comment">//私聊模式</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> PrivateChat() {<br>    <span class="hljs-keyword">var</span> remoteName <span class="hljs-type">string</span><br>    <span class="hljs-keyword">var</span> chatMsg <span class="hljs-type">string</span><br> <br>    client.SelectUsers()<br>    fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入聊天对象[用户名], exit退出:"</span>)<br>    fmt.Scanln(&amp;remoteName)<br> <br>    <span class="hljs-keyword">for</span> remoteName != <span class="hljs-string">"exit"</span> {<br>        fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入消息内容, exit退出:"</span>)<br>        fmt.Scanln(&amp;chatMsg)<br> <br>        <span class="hljs-keyword">for</span> chatMsg != <span class="hljs-string">"exit"</span> {<br>            <span class="hljs-comment">//消息不为空则发送</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chatMsg) != <span class="hljs-number">0</span> {<br>                sendMsg := <span class="hljs-string">"to|"</span> + remoteName + <span class="hljs-string">"|"</span> + chatMsg + <span class="hljs-string">"\n\n"</span><br>                _, err := client.conn.Write([]<span class="hljs-type">byte</span>(sendMsg))<br>                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>                    fmt.Println(<span class="hljs-string">"conn Write err:"</span>, err)<br>                    <span class="hljs-keyword">break</span><br>                }<br>            }<br> <br>            chatMsg = <span class="hljs-string">""</span><br>            fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入消息内容, exit退出:"</span>)<br>            fmt.Scanln(&amp;chatMsg)<br>        }<br> <br>        client.SelectUsers()<br>        fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入聊天对象[用户名], exit退出:"</span>)<br>        fmt.Scanln(&amp;remoteName)<br>    }<br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> PublicChat() {<br>    <span class="hljs-comment">//提示用户输入消息</span><br>    <span class="hljs-keyword">var</span> chatMsg <span class="hljs-type">string</span><br> <br>    fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入聊天内容，exit退出."</span>)<br>    fmt.Scanln(&amp;chatMsg)<br> <br>    <span class="hljs-keyword">for</span> chatMsg != <span class="hljs-string">"exit"</span> {<br>        <span class="hljs-comment">//发给服务器</span><br> <br>        <span class="hljs-comment">//消息不为空则发送</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chatMsg) != <span class="hljs-number">0</span> {<br>            sendMsg := chatMsg + <span class="hljs-string">"\n"</span><br>            _, err := client.conn.Write([]<span class="hljs-type">byte</span>(sendMsg))<br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>                fmt.Println(<span class="hljs-string">"conn Write err:"</span>, err)<br>                <span class="hljs-keyword">break</span><br>            }<br>        }<br> <br>        chatMsg = <span class="hljs-string">""</span><br>        fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入聊天内容，exit退出."</span>)<br>        fmt.Scanln(&amp;chatMsg)<br>    }<br> <br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> UpdateName() <span class="hljs-type">bool</span> {<br> <br>    fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;请输入用户名:"</span>)<br>    fmt.Scanln(&amp;client.Name)<br> <br>    sendMsg := <span class="hljs-string">"rename|"</span> + client.Name + <span class="hljs-string">"\n"</span><br>    _, err := client.conn.Write([]<span class="hljs-type">byte</span>(sendMsg))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>        fmt.Println(<span class="hljs-string">"conn.Write err:"</span>, err)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    }<br> <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *Client)</span></span> Run() {<br>    <span class="hljs-keyword">for</span> client.flag != <span class="hljs-number">0</span> {<br>        <span class="hljs-keyword">for</span> client.menu() != <span class="hljs-literal">true</span> {<br>        }<br> <br>        <span class="hljs-comment">//根据不同的模式处理不同的业务</span><br>        <span class="hljs-keyword">switch</span> client.flag {<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-comment">//公聊模式</span><br>            client.PublicChat()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-comment">//私聊模式</span><br>            client.PrivateChat()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            <span class="hljs-comment">//更新用户名</span><br>            client.UpdateName()<br>            <span class="hljs-keyword">break</span><br>        }<br>    }<br>}<br> <br><span class="hljs-keyword">var</span> serverIp <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> serverPort <span class="hljs-type">int</span><br> <br><span class="hljs-comment">//./client -ip 127.0.0.1 -port 8888</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<br>    flag.StringVar(&amp;serverIp, <span class="hljs-string">"ip"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-string">"设置服务器IP地址(默认是127.0.0.1)"</span>)<br>    flag.IntVar(&amp;serverPort, <span class="hljs-string">"port"</span>, <span class="hljs-number">8888</span>, <span class="hljs-string">"设置服务器端口(默认是8888)"</span>)<br>}<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>    <span class="hljs-comment">//命令行解析</span><br>    flag.Parse()<br> <br>    client := NewClient(serverIp, serverPort)<br>    <span class="hljs-keyword">if</span> client == <span class="hljs-literal">nil</span> {<br>        fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt; 链接服务器失败..."</span>)<br>        <span class="hljs-keyword">return</span><br>    }<br> <br>    <span class="hljs-comment">//单独开启一个goroutine去处理server的回执消息</span><br>    <span class="hljs-keyword">go</span> client.DealResponse()<br> <br>    fmt.Println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;链接服务器成功..."</span>)<br> <br>    <span class="hljs-comment">//启动客户端的业务</span><br>    client.Run()<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>Init的使用，Init是一个非常有意思的东西，可以指定某些参数的值为定值，同时init()会在main之前执行嗷！！！</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/alexanderliu-creator/cloudimg/img/20211025154852.png" srcset="/img/loading.gif" lazyload alt="image-20211025154843964"></p>
<h1 id="Golang生态拓展介绍"><a href="#Golang生态拓展介绍" class="headerlink" title="Golang生态拓展介绍"></a>Golang生态拓展介绍</h1><ol>
<li>Web框架：<ul>
<li>beego</li>
<li>gin</li>
<li>echo</li>
<li>lris</li>
</ul>
</li>
<li>微服务框架：<ul>
<li>Go kit</li>
<li>Istio</li>
</ul>
</li>
<li>容器编排：<ul>
<li>K8S</li>
<li>swarm</li>
</ul>
</li>
<li>服务发现：<ul>
<li>Consul</li>
</ul>
</li>
<li>存储引擎：<ul>
<li>etcd</li>
<li>tidb</li>
</ul>
</li>
<li>静态建站：<ul>
<li>hugo</li>
</ul>
</li>
<li>中间键：<ul>
<li>nsg</li>
<li>zinx</li>
<li>Leaf</li>
<li>gRPC</li>
<li>codis</li>
</ul>
</li>
<li>爬虫框架：<ul>
<li>go query</li>
</ul>
</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%A4%A7%E4%B8%89%E8%87%AA%E5%AD%A6/">#大三自学</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>初识Go语言</div>
      <div>http://example.com/2021/10/12/chu-shi-go-yu-yan/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Alexander Liu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年10月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/10/16/lun-wen-jing-du/" title="论文精读之MapReduce">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">论文精读之MapReduce</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/09/27/java-da-han-chang-wen-mian-shi-ti-2/" title="Java常问面试题总结与提高2">
                        <span class="hidden-mobile">Java常问面试题总结与提高2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
